// ==UserScript==
// @name         Habr comments filter
// @description  Hide comments by filter
// @grant        GM_addValueChangeListener
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://habr.com/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.75596238
// @icon         https://www.google.com/s2/favicons?sz=64&domain=habr.com
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/habr.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var R={5467:(x,l,n)=>{n.d(l,{E2:()=>v});var C=n(9928);function v(s,r={},e=null){const o=(0,C.Sw)(r,e);return o.append(s),o}function g(s,r=null,e={},o={}){const d=createActionLink(s,r,o);return v(d,e)}function f(s,r=null,e=null,o={},d={}){const F=createActionLinkWithIcon(s,e,r,d);return v(F,o)}},9928:(x,l,n)=>{n.d(l,{S:()=>s,Sw:()=>T,o5:()=>f});var C=n(4921),v=n(6754);function g(c,E,w){const h=r(c,"text",E);return h.value=w,h}function f(c,E,w,h,O,k){const I=r(c,"number",E);return I.value=w,I.step=h,I.min=O,I.max=k,I}function s(c,E,w){const h=r(c,"checkbox",E);return h.checked=w,h}function r(c={},E=null,w=null){const h=y("input",c);return E&&(h.type=E),w&&(h.addEventListener("keyup",(0,C.sg)(w,200)),h.addEventListener("change",(0,C.sg)(w,100))),h}function e(c={},E=null){return y("span",c,E)}function o(c={},E=null,w=null){const h=y("a",c,E);return w&&(h.href=w),h}function d(c,E=null,w={}){w.cursor||="pointer";const h=o(w,E);return c&&h.addEventListener("click",c),h}function F(c,E,w=null,h={},O={}){h.display||="inline-flex",h.alignItems||="center",h.gap||="0.25em";const k=d(c,w,h);return k.prepend(b(E,O)),k}function N(c={},E=null,w=null){const h=y("button",c,E);return w&&h.addEventListener("click",w),h}function T(c={},E=null){return y("div",c,E)}function i(c={}){return y("i",c)}function b(c,E={}){E.width||="1em",E.height||="1em",E.paddingBottom||="1px";const w=i(E);return w.setAttribute("data-lucide",c),w}function y(c,E,w=null){if(typeof E!="object"||E===null)throw new TypeError("styles should be an object");const h=document.createElement(c);return(0,v.ZM)(h,E),w&&(h.innerHTML=w),h}},573:(x,l,n)=>{n.d(l,{Fi:()=>v,fI:()=>g});function C(i,b=document){return!!b.querySelector(i)}function v(i,b=document,y=!1){const c=b.querySelector(i);return y&&!c&&console.log(`No element found for selector: ${i}`),c}function g(i,b=document,y=!1){const c=b.querySelectorAll(i);return y&&!c.length&&console.log(`No elements found for selector: ${i}`),c}function f(i,b,y){return[...i.querySelectorAll(b)].find(c=>c.textContent.trim().includes(y))}function s(i,b,y=!1,c=!1,E=null){const w=v(b,i);return r(w,y,c,E)}function r(i,b=!1,y=!1,c=null){if(!i)return c===null?(console.log("No element found"),null):c;const E=i.innerText;return d(E,b,y)}function e(i,b,y=!1){const c=i[b];return r(c,y)}function o(i,b=!1,y=!1){const c=i.textContent;return d(c,b,y)}function d(i,b,y){b&&(i=removeNonNumber(i)),y&&(i=i.replace(",","."));const c=Number(i);return Number.isNaN(c)?(console.log(`Invalid number: ${i}`),0):c}function F(i){return[...i.childNodes].find(b=>b.nodeType===Node.TEXT_NODE)}function N(i){const b=y=>y.nodeType===Node.TEXT_NODE&&y.textContent.trim()!==""?[y]:[...y.childNodes].flatMap(b);return b(i)}function T(i){return normalizeSpacing(i.textContent)}},5539:(x,l,n)=>{n.d(l,{Bt:()=>v,kl:()=>s});function C(t,a){t.parentNode.insertBefore(a,t.nextSibling)}function v(t){t.style.display="none"}function g(t){F(t),v(t)}function f(t){t.intersectionObserver||runOnceOnIntersection(t,()=>v(t))}function s(t){t.style.display=""}function r(t){const a=d(t);t.style.display=a}function e(t,a){a?v(t):s(t)}function o(t,a){a?f(t):(clearIntersectionObserver(t),s(t))}function d(t){return F(t),t.defaultDisplay}function F(t){if(t.defaultDisplay)return;const{display:a}=getComputedStyle(t);t.defaultDisplay=a}function N(){return{show:[],hide:[]}}function T(t,a,S){t?a.hide.push(S):a.show.push(S)}function i(t){t.show.forEach(s),t.hide.forEach(v)}function b(t,a,S=.3){a?c(t,S):y(t)}function y(t){t.style.opacity=""}function c(t,a=.3){t.style.opacity=a}function E(t){t.style.order=""}function w(t,a){t.style.order=a}function h(t,a){t.style.background=a}function O(t,a){const S=getFirstElement(a);S&&k(t,S)}function k(t,a){const S=createLink();S.href=t,a.parentNode.append(S),S.append(a)}function I(t,a){const S=getFirstElement(a);S&&m(t,S)}function m(t,a){const S=createLink();S.href=t,S.append(...a.childNodes),a.append(S)}function p(){const t=getURLQueryParam("scrollTo");if(!t)return;const a=document.getElementById(t);a?a.scrollIntoView():console.log(`Element with ID "${t}" was not found.`)}function u(t,a,S="text/plain"){const A=new Blob([t],{type:S}),D=URL.createObjectURL(A),_=document.createElement("a");_.href=D,_.download=a,document.body.appendChild(_),_.click(),document.body.removeChild(_),requestAnimationFrame(()=>URL.revokeObjectURL(D))}},6754:(x,l,n)=>{n.d(l,{ZM:()=>C});function C(s,r){Object.assign(s.style,r)}function v(s,r="custom-global-style"){let e=document.getElementById(r);e||(e=document.createElement("style"),e.id=r,e.type="text/css",document.head.appendChild(e)),e.textContent=s}function g(s){return Object.entries(s).map(([r,e])=>`${r.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${e};`).join(" ")}function f(s){return s?s.split(";").filter(r=>r.trim()!=="").reduce((r,e)=>{const[o,d]=e.split(":").map(N=>N.trim()),F=o.replace(/-([a-z])/g,(N,T)=>T.toUpperCase());return r[F]=d,r},{}):{}}},4921:(x,l,n)=>{n.d(l,{sg:()=>f,xk:()=>C});function C(e,o,d=null){const F=e.querySelector(o);return F?Promise.resolve(F):new Promise(N=>{const T=new MutationObserver(b);T.observe(e,{childList:!0,subtree:!0});let i;d&&(i=setTimeout(()=>{T.disconnect(),console.log(`No element found for selector: ${o}`),N(null)},d));function b(){const y=e.querySelector(o);y&&(i&&clearTimeout(i),T.disconnect(),N(y))}})}function v(e,o){return e.querySelector(o)?new Promise(F=>{const N=new MutationObserver(T);N.observe(e,{childList:!0,subtree:!0});function T(){e.querySelector(o)||(N.disconnect(),F())}}):Promise.resolve()}function g(e,o=400){return new Promise(d=>{let F;const N=new MutationObserver(()=>{clearTimeout(F),T()});function T(){F=setTimeout(()=>{N.disconnect(),d()},o)}T(),N.observe(e,{childList:!0,subtree:!0})})}function f(e,o=250){let d;return(...F)=>{clearTimeout(d),d=setTimeout(()=>e(...F),o)}}function s(e,o){const d=new IntersectionObserver(F=>{F.forEach(N=>{N.isIntersecting&&(o(),r(e))})});e.intersectionObserver=d,d.observe(e)}function r(e){e.intersectionObserver&&(e.intersectionObserver.disconnect(),e.intersectionObserver=null)}},3829:(x,l,n)=>{n.d(l,{JE:()=>g});function C(r,e){return!v(r,e)}function v(r,e){if(!e.value)return!0;const o=r.toLowerCase(),d=getSearchStrings(e),F=[],N=[];return d.forEach(T=>{if(T.startsWith("!")){const i=T.substring(1);i&&N.push(i)}else F.push(T)}),F.every(T=>o.includes(T))&&N.every(T=>!o.includes(T))}function g(r,e){return e.value!=null&&r<e.value}function f(r,e){return e.value!=null&&r>e.value}function s(r,e){return e.value&&r!==e.value}},4521:(x,l,n)=>{n.d(l,{z:()=>v});var C=n(3048);function v(g,f=null){return{createGlobalFilter(s,r=null,e=g){return C.V.create(s,r,e)},createSectionFilter(s,r=null,e=g){if(!f)throw new Error("sectionId must be provided to use createSectionFilter.");return C.V.createWithCompositeKey(f,s,r,e)}}}},5884:(x,l,n)=>{n.d(l,{Hw:()=>s,nW:()=>f});var C=n(9928),v=n(5467);function g(r,e,o={},d={}){const F=createTextInput(d,e.updateValueFromEvent,e.value);return createControl(F,o,r)}function f(r,e,o,d,F,N={},T={}){const i=(0,C.o5)(T,e.updateValueFromEvent,e.value,o,d,F);return(0,v.E2)(i,N,r)}function s(r,e,o={},d={}){const F=(0,C.S)(d,e.updateValueFromEvent,e.value);return(0,v.E2)(F,o,r)}},7877:(x,l,n)=>{n.d(l,{aW:()=>b,pW:()=>I});var C=n(5884);function v(m,p={},u={}){return createTextFilterControl("\u041F\u043E\u0438\u0441\u043A: ",m,p,u)}function g(m,p={},u={},t=.1,a=3){return createNumberFilterControl("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",m,t,a,5,p,u)}function f(m,p={},u={},t=.1,a=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",m,t,a,5,p,u)}function s(m,p={},u={}){return e("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",m,p,u)}function r(m,p={},u={}){return e("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",m,p,u)}function e(m,p,u={},t={}){return createNumberFilterControl(m,p,"1","1","999999",u,t)}function o(m,p={},u={}){return d("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",m,p,u)}function d(m,p,u={},t={}){return createNumberFilterControl(m,p,"5","0","100",u,t)}function F(m,p={},u={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",m,"5","0","100",p,u)}function N(m,p,u={},t={},a="250"){return createNumberFilterControl(m,p,a,"0","1000000",u,t)}function T(m,p={},u={},t="25"){return N("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",m,p,u,t)}function i(m,p={},u={},t="25"){return N("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",m,p,u,t)}function b(m,p={},u={}){return y("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",m,p,u)}function y(m,p,u={},t={}){return(0,C.nW)(m,p,"1","0","99999",u,t)}function c(m,p={},u={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",m,"1","2","7",p,u)}function E(m,p={},u={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",m,1,1,10,p,u)}function w(m,p={},u={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",m,p,u)}function h(m,p={},u={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",m,p,u)}function O(m,p={},u={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",m,p,u)}function k(m,p={},u={}){return createCheckboxFilterControl("\u0411\u0430\u043B\u043B\u044B: ",m,p,u)}function I(m,p={},u={}){return(0,C.Hw)("\u0412\u043A\u043B: ",m,p,u)}},5213:(x,l,n)=>{n.d(l,{b:()=>g});var C=n(9928),v=n(573);function g(f,s,r=!1,e="customFiltersContainer"){let o=(0,v.Fi)(`#${e}`,f);if(o)if(r)o.remove();else return;o=(0,C.Sw)(),o.id=e,s(o,f)}},8200:(x,l,n)=>{n.d(l,{s:()=>C});function C(v){const{target:g}=v,{type:f}=g;switch(f){case"text":return`"${g.value}"`;case"number":return g.value;case"checkbox":return g.checked;default:return console.log(`Unknown input type: ${f}`),null}}},157:(x,l,n)=>{n.d(l,{Fg:()=>C,vx:()=>g});const C=window.GM_setValue,v=window.GM.setValue,g=window.GM_getValue,f=window.GM_addValueChangeListener},1870:(x,l,n)=>{n.d(l,{j:()=>C});class C{constructor(g,f){this.value=g,this.onChange=f}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(x,l,n)=>{n.d(l,{V:()=>s});var C=n(1870),v=n(8200),g=n(3976),f=n(157);class s extends C.j{constructor(e,o=null,d=null){super((0,f.vx)(e,o),d),this.storageKey=e,this.defaultValue=o}static create(e,o=null,d=null){return new s(e,o,d)}static createWithCompositeKey(e,o,d=null,F=null){const N=`${e}-${o}`;return new s(N,d,F)}updateValueFromEvent=e=>{const o=(0,v.s)(e),d=(0,g.$)(o);this.updateValue(d)};updateValue(e,o=!0){this.value!==e&&((0,f.Fg)(this.storageKey,e),this.value=e,o&&this.onChangeIfDefined())}clearValue(e=!1){this.updateValue(null,e)}resetValue(e=!1){this.updateValue(this.defaultValue,e)}}},3976:(x,l,n)=>{n.d(l,{$:()=>C});function C(v){return v===""?null:JSON.parse(v)}},6213:(x,l,n)=>{n.a(x,async(C,v)=>{try{let w=function(u,t){let a=u.innerText;function S(){const A=u.innerText;A!==a&&(a=A,t()),requestAnimationFrame(S)}requestAnimationFrame(S)},O=function(u,t){(0,T.ZM)(u,e.r.FILTERS_CONTAINER);const a=(0,s.aW)(b,e.r.CONTROL,e.r.NUMBER_INPUT),S=(0,s.pW)(y,e.r.CONTROL,e.r.CHECKBOX_INPUT);u.append(a,S),t.append(u)},k=function(){(0,f.fI)(r.Z.COMMENTS).forEach(I)},I=function(u){if(!y.value){p(u);return}let t=c.commentsCache.get(u);if(!t){const S=(0,f.Fi)(r.Z.RATING_WRAP,u);if(!S)return;const A=S.innerText.trim();if(A==="")return;t={rating:+A},c.commentsCache.set(u,t)}(0,F.JE)(t.rating,b)?m(u):p(u)},m=function(u){(0,g.Bt)(u);const t=u.parentElement;t&&[...t.children].every(a=>a.style.display==="none")&&m(t)},p=function(u){(0,g.kl)(u);const t=u.parentElement;t&&t.style.display==="none"&&p(t)};var g=n(5539),f=n(573),s=n(7877),r=n(1719),e=n(9175),o=n(4521),d=n(5213),F=n(3829),N=n(4921),T=n(6754);const{createGlobalFilter:i}=(0,o.z)(k),b=i("min-rating-filter",4),y=i("filter-enabled",!0),c={commentsCache:new WeakMap};await E();async function E(){const u=await(0,N.xk)(document,r.Z.COMMENTS_TREE);w(u,h)}async function h(){const u=await(0,N.xk)(document,r.Z.COMMENTS_HEADER);(0,d.b)(u,O),k()}v()}catch(i){v(i)}},1)},1719:(x,l,n)=>{n.d(l,{Z:()=>C});const C={COMMENTS_TREE:".tm-comments__tree",COMMENTS_HEADER:".tm-comments-wrapper__header",COMMENTS:".tm-comment-thread__comment:not(.process-passed)",RATING_WRAP:".tm-votes-lever__score-counter"}},9175:(x,l,n)=>{n.d(l,{r:()=>v});const v={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",marginLeft:"28px"},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},NUMBER_INPUT:{...{INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px",fontSize:"15px"}}.INPUT,width:"35px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},M={};function L(x){var l=M[x];if(l!==void 0)return l.exports;var n=M[x]={exports:{}};return R[x](n,n.exports,L),n.exports}(()=>{var x=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",l=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",n=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",C=g=>{g&&g.d<1&&(g.d=1,g.forEach(f=>f.r--),g.forEach(f=>f.r--?f.r++:f()))},v=g=>g.map(f=>{if(f!==null&&typeof f=="object"){if(f[x])return f;if(f.then){var s=[];s.d=0,f.then(o=>{r[l]=o,C(s)},o=>{r[n]=o,C(s)});var r={};return r[x]=o=>o(s),r}}var e={};return e[x]=o=>{},e[l]=f,e});L.a=(g,f,s)=>{var r;s&&((r=[]).d=-1);var e=new Set,o=g.exports,d,F,N,T=new Promise((i,b)=>{N=b,F=i});T[l]=o,T[x]=i=>(r&&i(r),e.forEach(i),T.catch(b=>{})),g.exports=T,f(i=>{d=v(i);var b,y=()=>d.map(E=>{if(E[n])throw E[n];return E[l]}),c=new Promise(E=>{b=()=>E(y),b.r=0;var w=h=>h!==r&&!e.has(h)&&(e.add(h),h&&!h.d&&(b.r++,h.push(b)));d.map(h=>h[x](w))});return b.r?c:y()},i=>(i?N(T[n]=i):F(o),C(r))),r&&r.d<0&&(r.d=0)}})(),L.d=(x,l)=>{for(var n in l)L.o(l,n)&&!L.o(x,n)&&Object.defineProperty(x,n,{enumerable:!0,get:l[n]})},L.o=(x,l)=>Object.prototype.hasOwnProperty.call(x,l);var P=L(6213)})();})();
