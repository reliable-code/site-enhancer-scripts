// ==UserScript==
// @name         Habr comments filter
// @description  Hide comments by filter
// @grant        GM_addValueChangeListener
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://habr.com/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.75569505
// @icon         https://www.google.com/s2/favicons?sz=64&domain=habr.com
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/habr.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var W={5467:(T,a,t)=>{t.d(a,{E2:()=>E});var y=t(9928);function E(g,i={},e=null){const u=(0,y.Sw)(i,e);return u.append(g),u}function b(g,i=null,e={},u={}){const s=createActionLink(g,i,u);return E(s,e)}function f(g,i=null,e=null,u={},s={}){const F=createActionLinkWithIcon(g,e,i,s);return E(F,u)}},9928:(T,a,t)=>{t.d(a,{S:()=>g,Sw:()=>x,o5:()=>f});var y=t(4921),E=t(5539);function b(l,m,w){const p=i(l,"text",m);return p.value=w,p}function f(l,m,w,p,O,A){const L=i(l,"number",m);return L.value=w,L.step=p,L.min=O,L.max=A,L}function g(l,m,w){const p=i(l,"checkbox",m);return p.checked=w,p}function i(l={},m=null,w=null){const p=C("input",l);return m&&(p.type=m),w&&(p.addEventListener("keyup",(0,y.sg)(w,200)),p.addEventListener("change",(0,y.sg)(w,100))),p}function e(l={},m=null){return C("span",l,m)}function u(l={},m=null,w=null){const p=C("a",l,m);return w&&(p.href=w),p}function s(l,m=null,w={}){w.cursor||="pointer";const p=u(w,m);return l&&p.addEventListener("click",l),p}function F(l,m,w=null,p={},O={}){p.display||="inline-flex",p.alignItems||="center",p.gap||="0.25em";const A=s(l,w,p);return A.prepend(v(m,O)),A}function N(l={},m=null,w=null){const p=C("button",l,m);return w&&p.addEventListener("click",w),p}function x(l={},m=null){return C("div",l,m)}function c(l={}){return C("i",l)}function v(l,m={}){m.width||="1em",m.height||="1em",m.paddingBottom||="1px";const w=c(m);return w.setAttribute("data-lucide",l),w}function C(l,m,w=null){if(typeof m!="object"||m===null)throw new TypeError("styles should be an object");const p=document.createElement(l);return(0,E.ZM)(p,m),w&&(p.innerHTML=w),p}},573:(T,a,t)=>{t.d(a,{Fi:()=>E,fI:()=>b});function y(c,v=document){return!!v.querySelector(c)}function E(c,v=document,C=!1){const l=v.querySelector(c);return C&&!l&&console.log(`No element found for selector: ${c}`),l}function b(c,v=document,C=!1){const l=v.querySelectorAll(c);return C&&!l.length&&console.log(`No elements found for selector: ${c}`),l}function f(c,v,C){return[...c.querySelectorAll(v)].find(l=>l.textContent.trim().includes(C))}function g(c,v,C=!1,l=!1,m=null){const w=E(v,c);return i(w,C,l,m)}function i(c,v=!1,C=!1,l=null){if(!c)return l===null?(console.log("No element found"),null):l;const m=c.innerText;return s(m,v,C)}function e(c,v,C=!1){const l=c[v];return i(l,C)}function u(c,v=!1,C=!1){const l=c.textContent;return s(l,v,C)}function s(c,v,C){v&&(c=removeNonNumber(c)),C&&(c=c.replace(",","."));const l=Number(c);return Number.isNaN(l)?(console.log(`Invalid number: ${c}`),0):l}function F(c){return[...c.childNodes].find(v=>v.nodeType===Node.TEXT_NODE)}function N(c){const v=C=>C.nodeType===Node.TEXT_NODE&&C.textContent.trim()!==""?[C]:[...C.childNodes].flatMap(v);return v(c)}function x(c){return normalizeSpacing(c.textContent)}},5539:(T,a,t)=>{t.d(a,{Bt:()=>E,ZM:()=>o,kl:()=>g});function y(n,h){n.parentNode.insertBefore(h,n.nextSibling)}function E(n){n.style.display="none"}function b(n){F(n),E(n)}function f(n){n.intersectionObserver||runOnceOnIntersection(n,()=>E(n))}function g(n){n.style.display=""}function i(n){const h=s(n);n.style.display=h}function e(n,h){h?E(n):g(n)}function u(n,h){h?f(n):(clearIntersectionObserver(n),g(n))}function s(n){return F(n),n.defaultDisplay}function F(n){if(n.defaultDisplay)return;const{display:h}=getComputedStyle(n);n.defaultDisplay=h}function N(){return{show:[],hide:[]}}function x(n,h,S){n?h.hide.push(S):h.show.push(S)}function c(n){n.show.forEach(g),n.hide.forEach(E)}function v(n,h,S=.3){h?l(n,S):C(n)}function C(n){n.style.opacity=""}function l(n,h=.3){n.style.opacity=h}function m(n){n.style.order=""}function w(n,h){n.style.order=h}function p(n,h){n.style.background=h}function O(n,h){const S=getFirstElement(h);if(!S)return;const M=createLink();M.href=n,S.parentNode.append(M),M.append(S)}function A(n,h){const S=getFirstElement(h);S&&L(n,S)}function L(n,h){const S=createLink();S.href=n,S.append(...h.childNodes),h.append(S)}function d(){const n=getURLQueryParam("scrollTo");if(!n)return;const h=document.getElementById(n);h?h.scrollIntoView():console.log(`Element with ID "${n}" was not found.`)}function r(n,h="custom-global-style"){let S=document.getElementById(h);S||(S=document.createElement("style"),S.id=h,S.type="text/css",document.head.appendChild(S)),S.textContent=n}function o(n,h){Object.assign(n.style,h)}function k(n){return Object.entries(n).map(([h,S])=>`${h.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${S};`).join(" ")}function I(n){return n?n.split(";").filter(h=>h.trim()!=="").reduce((h,S)=>{const[M,P]=S.split(":").map(V=>V.trim()),R=M.replace(/-([a-z])/g,(V,U)=>U.toUpperCase());return h[R]=P,h},{}):{}}function _(n,h,S="text/plain"){const M=new Blob([n],{type:S}),P=URL.createObjectURL(M),R=document.createElement("a");R.href=P,R.download=h,document.body.appendChild(R),R.click(),document.body.removeChild(R),requestAnimationFrame(()=>URL.revokeObjectURL(P))}},4921:(T,a,t)=>{t.d(a,{sg:()=>f,xk:()=>y});function y(e,u,s=null){const F=e.querySelector(u);return F?Promise.resolve(F):new Promise(N=>{const x=new MutationObserver(v);x.observe(e,{childList:!0,subtree:!0});let c;s&&(c=setTimeout(()=>{x.disconnect(),console.log(`No element found for selector: ${u}`),N(null)},s));function v(){const C=e.querySelector(u);C&&(c&&clearTimeout(c),x.disconnect(),N(C))}})}function E(e,u){return e.querySelector(u)?new Promise(F=>{const N=new MutationObserver(x);N.observe(e,{childList:!0,subtree:!0});function x(){e.querySelector(u)||(N.disconnect(),F())}}):Promise.resolve()}function b(e,u=400){return new Promise(s=>{let F;const N=new MutationObserver(()=>{clearTimeout(F),x()});function x(){F=setTimeout(()=>{N.disconnect(),s()},u)}x(),N.observe(e,{childList:!0,subtree:!0})})}function f(e,u=250){let s;return(...F)=>{clearTimeout(s),s=setTimeout(()=>e(...F),u)}}function g(e,u){const s=new IntersectionObserver(F=>{F.forEach(N=>{N.isIntersecting&&(u(),i(e))})});e.intersectionObserver=s,s.observe(e)}function i(e){e.intersectionObserver&&(e.intersectionObserver.disconnect(),e.intersectionObserver=null)}},3829:(T,a,t)=>{t.d(a,{JE:()=>b});function y(i,e){return!E(i,e)}function E(i,e){if(!e.value)return!0;const u=i.toLowerCase(),s=getSearchStrings(e),F=[],N=[];return s.forEach(x=>{if(x.startsWith("!")){const c=x.substring(1);c&&N.push(c)}else F.push(x)}),F.every(x=>u.includes(x))&&N.every(x=>!u.includes(x))}function b(i,e){return e.value!=null&&i<e.value}function f(i,e){return e.value!=null&&i>e.value}function g(i,e){return e.value&&i!==e.value}},4521:(T,a,t)=>{t.d(a,{z:()=>E});var y=t(3048);function E(b,f=null){return{createGlobalFilter(g,i=null,e=b){return y.V.create(g,i,e)},createSectionFilter(g,i=null,e=b){if(!f)throw new Error("sectionId must be provided to use createSectionFilter.");return y.V.createWithCompositeKey(f,g,i,e)}}}},5884:(T,a,t)=>{t.d(a,{Hw:()=>g,nW:()=>f});var y=t(9928),E=t(5467);function b(i,e,u={},s={}){const F=createTextInput(s,e.updateValueFromEvent,e.value);return createControl(F,u,i)}function f(i,e,u,s,F,N={},x={}){const c=(0,y.o5)(x,e.updateValueFromEvent,e.value,u,s,F);return(0,E.E2)(c,N,i)}function g(i,e,u={},s={}){const F=(0,y.S)(s,e.updateValueFromEvent,e.value);return(0,E.E2)(F,u,i)}},7877:(T,a,t)=>{t.d(a,{aW:()=>v,pW:()=>L});var y=t(5884);function E(d,r={},o={}){return createTextFilterControl("\u041F\u043E\u0438\u0441\u043A: ",d,r,o)}function b(d,r={},o={},k=.1,I=3){return createNumberFilterControl("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",d,k,I,5,r,o)}function f(d,r={},o={},k=.1,I=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",d,k,I,5,r,o)}function g(d,r={},o={}){return e("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",d,r,o)}function i(d,r={},o={}){return e("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",d,r,o)}function e(d,r,o={},k={}){return createNumberFilterControl(d,r,"1","1","999999",o,k)}function u(d,r={},o={}){return s("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",d,r,o)}function s(d,r,o={},k={}){return createNumberFilterControl(d,r,"5","0","100",o,k)}function F(d,r={},o={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",d,"5","0","100",r,o)}function N(d,r,o={},k={},I="250"){return createNumberFilterControl(d,r,I,"0","1000000",o,k)}function x(d,r={},o={},k="25"){return N("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",d,r,o,k)}function c(d,r={},o={},k="25"){return N("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",d,r,o,k)}function v(d,r={},o={}){return C("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",d,r,o)}function C(d,r,o={},k={}){return(0,y.nW)(d,r,"1","0","99999",o,k)}function l(d,r={},o={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",d,"1","2","7",r,o)}function m(d,r={},o={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",d,1,1,10,r,o)}function w(d,r={},o={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",d,r,o)}function p(d,r={},o={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",d,r,o)}function O(d,r={},o={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",d,r,o)}function A(d,r={},o={}){return createCheckboxFilterControl("\u0411\u0430\u043B\u043B\u044B: ",d,r,o)}function L(d,r={},o={}){return(0,y.Hw)("\u0412\u043A\u043B: ",d,r,o)}},5213:(T,a,t)=>{t.d(a,{b:()=>b});var y=t(9928),E=t(573);function b(f,g,i=!1,e="customFiltersContainer"){let u=(0,E.Fi)(`#${e}`,f);if(u)if(i)u.remove();else return;u=(0,y.Sw)(),u.id=e,g(u,f)}},8200:(T,a,t)=>{t.d(a,{s:()=>y});function y(E){const{target:b}=E,{type:f}=b;switch(f){case"text":return`"${b.value}"`;case"number":return b.value;case"checkbox":return b.checked;default:return console.log(`Unknown input type: ${f}`),null}}},157:(T,a,t)=>{t.d(a,{Fg:()=>y,vx:()=>b});const y=window.GM_setValue,E=window.GM.setValue,b=window.GM_getValue,f=window.GM_addValueChangeListener},1870:(T,a,t)=>{t.d(a,{j:()=>y});class y{constructor(b,f){this.value=b,this.onChange=f}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(T,a,t)=>{t.d(a,{V:()=>g});var y=t(1870),E=t(8200),b=t(3976),f=t(157);class g extends y.j{constructor(e,u=null,s=null){super((0,f.vx)(e,u),s),this.storageKey=e,this.defaultValue=u}static create(e,u=null,s=null){return new g(e,u,s)}static createWithCompositeKey(e,u,s=null,F=null){const N=`${e}-${u}`;return new g(N,s,F)}updateValueFromEvent=e=>{const u=(0,E.s)(e),s=(0,b.$)(u);this.updateValue(s)};updateValue(e,u=!0){this.value!==e&&((0,f.Fg)(this.storageKey,e),this.value=e,u&&this.onChangeIfDefined())}clearValue(e=!1){this.updateValue(null,e)}resetValue(e=!1){this.updateValue(this.defaultValue,e)}}},3976:(T,a,t)=>{t.d(a,{$:()=>y});function y(E){return E===""?null:JSON.parse(E)}},6213:(T,a,t)=>{t.a(T,async(y,E)=>{try{let m=function(r,o){let k=r.innerText;function I(){const _=r.innerText;_!==k&&(k=_,o()),requestAnimationFrame(I)}requestAnimationFrame(I)},p=function(r,o){(0,b.ZM)(r,e.r.FILTERS_CONTAINER);const k=(0,g.aW)(c,e.r.CONTROL,e.r.NUMBER_INPUT),I=(0,g.pW)(v,e.r.CONTROL,e.r.CHECKBOX_INPUT);r.append(k,I),o.append(r)},O=function(){(0,f.fI)(i.Z.COMMENTS).forEach(A)},A=function(r){if(!v.value){d(r);return}let o=C.commentsCache.get(r);if(!o){const I=(0,f.Fi)(i.Z.RATING_WRAP,r);if(!I)return;const _=I.innerText.trim();if(_==="")return;o={rating:+_},C.commentsCache.set(r,o)}(0,F.JE)(o.rating,c)?L(r):d(r)},L=function(r){(0,b.Bt)(r);const o=r.parentElement;o&&[...o.children].every(k=>k.style.display==="none")&&L(o)},d=function(r){(0,b.kl)(r);const o=r.parentElement;o&&o.style.display==="none"&&d(o)};var b=t(5539),f=t(573),g=t(7877),i=t(1719),e=t(9175),u=t(4521),s=t(5213),F=t(3829),N=t(4921);const{createGlobalFilter:x}=(0,u.z)(O),c=x("min-rating-filter",4),v=x("filter-enabled",!0),C={commentsCache:new WeakMap};await l();async function l(){const r=await(0,N.xk)(document,i.Z.COMMENTS_TREE);m(r,w)}async function w(){const r=await(0,N.xk)(document,i.Z.COMMENTS_HEADER);(0,s.b)(r,p),O()}E()}catch(x){E(x)}},1)},1719:(T,a,t)=>{t.d(a,{Z:()=>y});const y={COMMENTS_TREE:".tm-comments__tree",COMMENTS_HEADER:".tm-comments-wrapper__header",COMMENTS:".tm-comment-thread__comment:not(.process-passed)",RATING_WRAP:".tm-votes-lever__score-counter"}},9175:(T,a,t)=>{t.d(a,{r:()=>E});const E={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",marginLeft:"28px"},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},NUMBER_INPUT:{...{INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px",fontSize:"15px"}}.INPUT,width:"35px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},B={};function D(T){var a=B[T];if(a!==void 0)return a.exports;var t=B[T]={exports:{}};return W[T](t,t.exports,D),t.exports}(()=>{var T=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",a=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",t=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",y=b=>{b&&b.d<1&&(b.d=1,b.forEach(f=>f.r--),b.forEach(f=>f.r--?f.r++:f()))},E=b=>b.map(f=>{if(f!==null&&typeof f=="object"){if(f[T])return f;if(f.then){var g=[];g.d=0,f.then(u=>{i[a]=u,y(g)},u=>{i[t]=u,y(g)});var i={};return i[T]=u=>u(g),i}}var e={};return e[T]=u=>{},e[a]=f,e});D.a=(b,f,g)=>{var i;g&&((i=[]).d=-1);var e=new Set,u=b.exports,s,F,N,x=new Promise((c,v)=>{N=v,F=c});x[a]=u,x[T]=c=>(i&&c(i),e.forEach(c),x.catch(v=>{})),b.exports=x,f(c=>{s=E(c);var v,C=()=>s.map(m=>{if(m[t])throw m[t];return m[a]}),l=new Promise(m=>{v=()=>m(C),v.r=0;var w=p=>p!==i&&!e.has(p)&&(e.add(p),p&&!p.d&&(v.r++,p.push(v)));s.map(p=>p[T](w))});return v.r?l:C()},c=>(c?N(x[t]=c):F(u),y(i))),i&&i.d<0&&(i.d=0)}})(),D.d=(T,a)=>{for(var t in a)D.o(a,t)&&!D.o(T,t)&&Object.defineProperty(T,t,{enumerable:!0,get:a[t]})},D.o=(T,a)=>Object.prototype.hasOwnProperty.call(T,a);var $=D(6213)})();})();
