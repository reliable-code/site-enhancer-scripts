// ==UserScript==
// @name         Habr comments filter
// @description  Hide comments by filter
// @grant        GM_addValueChangeListener
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://habr.com/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.74553179
// @icon         https://www.google.com/s2/favicons?sz=64&domain=habr.com
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/habr.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var V={5467:(N,a,t)=>{t.d(a,{E2:()=>h});var y=t(9928);function h(g,i={},e=null){const u=(0,y.Sw)(i,e);return u.append(g),u}function b(g,i=null,e={},u={}){const d=createActionLink(g,i,u);return h(d,e)}function f(g,i=null,e=null,u={},d={}){const w=createActionLinkWithIcon(g,e,i,d);return h(w,u)}},9928:(N,a,t)=>{t.d(a,{S:()=>g,Sw:()=>F,o5:()=>f});var y=t(4921),h=t(5539);function b(l,p,x){const m=i(l,"text",p);return m.value=x,m}function f(l,p,x,m,D,L){const k=i(l,"number",p);return k.value=x,k.step=m,k.min=D,k.max=L,k}function g(l,p,x){const m=i(l,"checkbox",p);return m.checked=x,m}function i(l={},p=null,x=null){const m=C("input",l);return p&&(m.type=p),x&&(m.addEventListener("keyup",(0,y.sg)(x,200)),m.addEventListener("change",(0,y.sg)(x,100))),m}function e(l={},p=null){return C("span",l,p)}function u(l={},p=null,x=null){const m=C("a",l,p);return x&&(m.href=x),m}function d(l,p=null,x={}){x.cursor||="pointer";const m=u(x,p);return l&&m.addEventListener("click",l),m}function w(l,p,x=null,m={},D={}){m.display||="inline-flex",m.alignItems||="center",m.gap||="0.25em";const L=d(l,x,m);return L.prepend(v(p,D)),L}function T(l={},p=null,x=null){const m=C("button",l,p);return x&&m.addEventListener("click",x),m}function F(l={},p=null){return C("div",l,p)}function c(l={}){return C("i",l)}function v(l,p={}){p.width||="1em",p.height||="1em",p.paddingBottom||="1px";const x=c(p);return x.setAttribute("data-lucide",l),x}function C(l,p,x=null){if(typeof p!="object"||p===null)throw new TypeError("styles should be an object");const m=document.createElement(l);return(0,h.ZM)(m,p),x&&(m.innerHTML=x),m}},573:(N,a,t)=>{t.d(a,{Fi:()=>h,fI:()=>b});function y(c,v=document){return!!v.querySelector(c)}function h(c,v=document,C=!1){const l=v.querySelector(c);return C&&!l&&console.log(`No element found for selector: ${c}`),l}function b(c,v=document,C=!1){const l=v.querySelectorAll(c);return C&&!l.length&&console.log(`No elements found for selector: ${c}`),l}function f(c,v,C){return[...c.querySelectorAll(v)].find(l=>l.textContent.trim().includes(C))}function g(c,v,C=!1,l=!1,p=null){const x=h(v,c);return i(x,C,l,p)}function i(c,v=!1,C=!1,l=null){if(!c)return l===null?(console.log("No element found"),null):l;const p=c.innerText;return d(p,v,C)}function e(c,v,C=!1){const l=c[v];return i(l,C)}function u(c,v=!1,C=!1){const l=c.textContent;return d(l,v,C)}function d(c,v,C){v&&(c=removeNonNumber(c)),C&&(c=c.replace(",","."));const l=Number(c);return Number.isNaN(l)?(console.log(`Invalid number: ${c}`),0):l}function w(c){return[...c.childNodes].find(v=>v.nodeType===Node.TEXT_NODE)}function T(c){const v=C=>C.nodeType===Node.TEXT_NODE&&C.textContent.trim()!==""?[C]:[...C.childNodes].flatMap(v);return v(c)}function F(c){return normalizeSpacing(c.textContent)}},5539:(N,a,t)=>{t.d(a,{Bt:()=>h,ZM:()=>s,kl:()=>g});function y(n,E){n.parentNode.insertBefore(E,n.nextSibling)}function h(n){n.style.display="none"}function b(n){w(n),h(n)}function f(n){n.intersectionObserver||runOnceOnIntersection(n,()=>h(n))}function g(n){n.style.display=""}function i(n){const E=d(n);n.style.display=E}function e(n,E){E?h(n):g(n)}function u(n,E){E?f(n):(clearIntersectionObserver(n),g(n))}function d(n){return w(n),n.defaultDisplay}function w(n){if(n.defaultDisplay)return;const{display:E}=getComputedStyle(n);n.defaultDisplay=E}function T(){return{show:[],hide:[]}}function F(n,E,S){n?E.hide.push(S):E.show.push(S)}function c(n){n.show.forEach(g),n.hide.forEach(h)}function v(n,E,S=.3){E?l(n,S):C(n)}function C(n){n.style.opacity=""}function l(n,E=.3){n.style.opacity=E}function p(n){n.style.order=""}function x(n,E){n.style.order=E}function m(n,E){n.style.background=E}function D(n,E){const S=getFirstElement(E);if(!S)return;const M=createLink();M.href=n,S.parentNode.append(M),M.append(S)}function L(n,E){const S=getFirstElement(E);S&&k(n,S)}function k(n,E){const S=createLink();S.href=n,S.append(...E.childNodes),E.append(S)}function r(){const n=getURLQueryParam("scrollTo");if(!n)return;const E=document.getElementById(n);E?E.scrollIntoView():console.log(`Element with ID "${n}" was not found.`)}function o(n,E="custom-global-style"){let S=document.getElementById(E);S||(S=document.createElement("style"),S.id=E,S.type="text/css",document.head.appendChild(S)),S.textContent=n}function s(n,E){Object.assign(n.style,E)}function I(n){return Object.entries(n).map(([E,S])=>`${E.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${S};`).join(" ")}function O(n){return n?n.split(";").filter(E=>E.trim()!=="").reduce((E,S)=>{const[M,_]=S.split(":").map(B=>B.trim()),R=M.replace(/-([a-z])/g,(B,U)=>U.toUpperCase());return E[R]=_,E},{}):{}}function W(n,E,S="text/plain"){const M=new Blob([n],{type:S}),_=URL.createObjectURL(M),R=document.createElement("a");R.href=_,R.download=E,document.body.appendChild(R),R.click(),document.body.removeChild(R),requestAnimationFrame(()=>URL.revokeObjectURL(_))}},4921:(N,a,t)=>{t.d(a,{sg:()=>f,xk:()=>y});function y(e,u,d=null){const w=e.querySelector(u);return w?Promise.resolve(w):new Promise(T=>{const F=new MutationObserver(v);F.observe(e,{childList:!0,subtree:!0});let c;d&&(c=setTimeout(()=>{F.disconnect(),console.log(`No element found for selector: ${u}`),T(null)},d));function v(){const C=e.querySelector(u);C&&(c&&clearTimeout(c),F.disconnect(),T(C))}})}function h(e,u){return e.querySelector(u)?new Promise(w=>{const T=new MutationObserver(F);T.observe(e,{childList:!0,subtree:!0});function F(){e.querySelector(u)||(T.disconnect(),w())}}):Promise.resolve()}function b(e,u=400){return new Promise(d=>{let w;const T=new MutationObserver(()=>{clearTimeout(w),F()});function F(){w=setTimeout(()=>{T.disconnect(),d()},u)}F(),T.observe(e,{childList:!0,subtree:!0})})}function f(e,u=250){let d;return(...w)=>{clearTimeout(d),d=setTimeout(()=>e(...w),u)}}function g(e,u){const d=new IntersectionObserver(w=>{w.forEach(T=>{T.isIntersecting&&(u(),i(e))})});e.intersectionObserver=d,d.observe(e)}function i(e){e.intersectionObserver&&(e.intersectionObserver.disconnect(),e.intersectionObserver=null)}},3829:(N,a,t)=>{t.d(a,{JE:()=>b});function y(i,e){return!h(i,e)}function h(i,e){if(!e.value)return!0;const u=i.toLowerCase(),d=getSearchStrings(e),w=[],T=[];return d.forEach(F=>{if(F.startsWith("!")){const c=F.substring(1);c&&T.push(c)}else w.push(F)}),w.every(F=>u.includes(F))&&T.every(F=>!u.includes(F))}function b(i,e){return e.value!=null&&i<e.value}function f(i,e){return e.value!=null&&i>e.value}function g(i,e){return e.value&&i!==e.value}},4521:(N,a,t)=>{t.d(a,{z:()=>h});var y=t(3048);function h(b,f=null){return{createGlobalFilter(g,i=null,e=b){return y.V.create(g,i,e)},createSectionFilter(g,i=null,e=b){if(!f)throw new Error("sectionId must be provided to use createSectionFilter.");return y.V.createWithCompositeKey(f,g,i,e)}}}},5884:(N,a,t)=>{t.d(a,{Hw:()=>g,nW:()=>f});var y=t(9928),h=t(5467);function b(i,e,u={},d={}){const w=createTextInput(d,e.updateValueFromEvent,e.value);return createControl(w,u,i)}function f(i,e,u,d,w,T={},F={}){const c=(0,y.o5)(F,e.updateValueFromEvent,e.value,u,d,w);return(0,h.E2)(c,T,i)}function g(i,e,u={},d={}){const w=(0,y.S)(d,e.updateValueFromEvent,e.value);return(0,h.E2)(w,u,i)}},7877:(N,a,t)=>{t.d(a,{aW:()=>v,pW:()=>k});var y=t(5884);function h(r,o={},s={}){return createTextFilterControl("\u041F\u043E\u0438\u0441\u043A: ",r,o,s)}function b(r,o={},s={},I=.1,O=3){return createNumberFilterControl("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",r,I,O,5,o,s)}function f(r,o={},s={},I=.1,O=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",r,I,O,5,o,s)}function g(r,o={},s={}){return e("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",r,o,s)}function i(r,o={},s={}){return e("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",r,o,s)}function e(r,o,s={},I={}){return createNumberFilterControl(r,o,"1","1","999999",s,I)}function u(r,o={},s={}){return d("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",r,o,s)}function d(r,o,s={},I={}){return createNumberFilterControl(r,o,"5","0","100",s,I)}function w(r,o={},s={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",r,"5","0","100",o,s)}function T(r,o,s={},I={},O="250"){return createNumberFilterControl(r,o,O,"0","1000000",s,I)}function F(r,o={},s={},I="25"){return T("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",r,o,s,I)}function c(r,o={},s={},I="25"){return T("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",r,o,s,I)}function v(r,o={},s={}){return C("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",r,o,s)}function C(r,o,s={},I={}){return(0,y.nW)(r,o,"1","0","99999",s,I)}function l(r,o={},s={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",r,"1","2","7",o,s)}function p(r,o={},s={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",r,1,1,10,o,s)}function x(r,o={},s={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",r,o,s)}function m(r,o={},s={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",r,o,s)}function D(r,o={},s={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",r,o,s)}function L(r,o={},s={}){return createCheckboxFilterControl("\u0411\u0430\u043B\u043B\u044B: ",r,o,s)}function k(r,o={},s={}){return(0,y.Hw)("\u0412\u043A\u043B: ",r,o,s)}},5213:(N,a,t)=>{t.d(a,{b:()=>b});var y=t(9928),h=t(573);function b(f,g,i=!1,e="customFiltersContainer"){let u=(0,h.Fi)(`#${e}`,f);if(u)if(i)u.remove();else return;u=(0,y.Sw)(),u.id=e,g(u,f)}},8200:(N,a,t)=>{t.d(a,{s:()=>y});function y(h){const{target:b}=h,{type:f}=b;switch(f){case"text":return`"${b.value}"`;case"number":return b.value;case"checkbox":return b.checked;default:return console.log(`Unknown input type: ${f}`),null}}},157:(N,a,t)=>{t.d(a,{Fg:()=>y,vx:()=>b});const y=window.GM_setValue,h=window.GM.setValue,b=window.GM_getValue,f=window.GM_addValueChangeListener},1870:(N,a,t)=>{t.d(a,{j:()=>y});class y{constructor(b,f){this.value=b,this.onChange=f}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(N,a,t)=>{t.d(a,{V:()=>g});var y=t(1870),h=t(8200),b=t(3976),f=t(157);class g extends y.j{constructor(e,u=null,d=null){super((0,f.vx)(e,u),d),this.storageKey=e,this.defaultValue=u}static create(e,u=null,d=null){return new g(e,u,d)}static createWithCompositeKey(e,u,d=null,w=null){const T=`${e}-${u}`;return new g(T,d,w)}updateValueFromEvent=e=>{const u=(0,h.s)(e),d=(0,b.$)(u);this.updateValue(d)};updateValue(e,u=!0){this.value!==e&&((0,f.Fg)(this.storageKey,e),this.value=e,u&&this.onChangeIfDefined())}clearValue(e=!1){this.updateValue(null,e)}resetValue(e=!1){this.updateValue(this.defaultValue,e)}}},3976:(N,a,t)=>{t.d(a,{$:()=>y});function y(h){return h===""?null:JSON.parse(h)}},6213:(N,a,t)=>{t.a(N,async(y,h)=>{try{let x=function(r,o){(0,b.ZM)(r,e.r.FILTERS_CONTAINER);const s=(0,g.aW)(c,e.r.CONTROL,e.r.NUMBER_INPUT),I=(0,g.pW)(v,e.r.CONTROL,e.r.CHECKBOX_INPUT);r.append(s,I),o.append(r)},m=function(){(0,f.fI)(i.Z.COMMENTS).forEach(D)},D=function(r){if(!v.value){k(r);return}let o=C.commentsCache.get(r);if(!o){const I=(0,f.Fi)(i.Z.RATING_WRAP,r);if(!I)return;const O=I.innerText.trim();if(O==="")return;o={rating:+O},C.commentsCache.set(r,o)}(0,w.JE)(o.rating,c)?L(r):k(r)},L=function(r){(0,b.Bt)(r);const o=r.parentElement;o&&[...o.children].every(s=>s.style.display==="none")&&L(o)},k=function(r){(0,b.kl)(r);const o=r.parentElement;o&&o.style.display==="none"&&k(o)};var b=t(5539),f=t(573),g=t(7877),i=t(1719),e=t(9175),u=t(4521),d=t(5213),w=t(3829),T=t(4921);const{createGlobalFilter:F}=(0,u.z)(m),c=F("min-rating-filter",4),v=F("filter-enabled",!0),C={commentsCache:new WeakMap};await l();async function l(){const r=await(0,T.xk)(document,i.Z.COMMENTS_TREE);new MutationObserver(p).observe(r,{childList:!0,subtree:!0})}async function p(){const r=await(0,T.xk)(document,i.Z.COMMENTS_HEADER);(0,d.b)(r,x),m()}h()}catch(F){h(F)}},1)},1719:(N,a,t)=>{t.d(a,{Z:()=>y});const y={COMMENTS_TREE:".tm-comments__tree",COMMENTS_HEADER:".tm-comments-wrapper__header",COMMENTS:".tm-comment-thread__comment:not(.process-passed)",RATING_WRAP:".tm-votes-lever__score-counter"}},9175:(N,a,t)=>{t.d(a,{r:()=>h});const h={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",marginLeft:"28px"},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},NUMBER_INPUT:{...{INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px",fontSize:"15px"}}.INPUT,width:"35px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},P={};function A(N){var a=P[N];if(a!==void 0)return a.exports;var t=P[N]={exports:{}};return V[N](t,t.exports,A),t.exports}(()=>{var N=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",a=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",t=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",y=b=>{b&&b.d<1&&(b.d=1,b.forEach(f=>f.r--),b.forEach(f=>f.r--?f.r++:f()))},h=b=>b.map(f=>{if(f!==null&&typeof f=="object"){if(f[N])return f;if(f.then){var g=[];g.d=0,f.then(u=>{i[a]=u,y(g)},u=>{i[t]=u,y(g)});var i={};return i[N]=u=>u(g),i}}var e={};return e[N]=u=>{},e[a]=f,e});A.a=(b,f,g)=>{var i;g&&((i=[]).d=-1);var e=new Set,u=b.exports,d,w,T,F=new Promise((c,v)=>{T=v,w=c});F[a]=u,F[N]=c=>(i&&c(i),e.forEach(c),F.catch(v=>{})),b.exports=F,f(c=>{d=h(c);var v,C=()=>d.map(p=>{if(p[t])throw p[t];return p[a]}),l=new Promise(p=>{v=()=>p(C),v.r=0;var x=m=>m!==i&&!e.has(m)&&(e.add(m),m&&!m.d&&(v.r++,m.push(v)));d.map(m=>m[N](x))});return v.r?l:C()},c=>(c?T(F[t]=c):w(u),y(i))),i&&i.d<0&&(i.d=0)}})(),A.d=(N,a)=>{for(var t in a)A.o(a,t)&&!A.o(N,t)&&Object.defineProperty(N,t,{enumerable:!0,get:a[t]})},A.o=(N,a)=>Object.prototype.hasOwnProperty.call(N,a);var $=A(6213)})();})();
