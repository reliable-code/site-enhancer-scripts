// ==UserScript==
// @name         Perek product cards filter
// @description  Hide product cards by filter
// @grant        GM_addValueChangeListener
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://www.perekrestok.ru/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.75569505
// @icon         https://www.google.com/s2/favicons?sz=64&domain=perekrestok.ru
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/perekrestok.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var Q={5467:(y,s,t)=>{t.d(s,{E2:()=>m});var d=t(9928);function m(h,o={},e=null){const u=(0,d.Sw)(o,e);return u.append(h),u}function p(h,o=null,e={},u={}){const g=createActionLink(h,o,u);return m(g,e)}function l(h,o=null,e=null,u={},g={}){const S=createActionLinkWithIcon(h,e,o,g);return m(S,u)}},9928:(y,s,t)=>{t.d(s,{S:()=>h,Sw:()=>x,kU:()=>p,o5:()=>l});var d=t(4921),m=t(5539);function p(i,r,v){const f=o(i,"text",r);return f.value=v,f}function l(i,r,v,f,R,U){const V=o(i,"number",r);return V.value=v,V.step=f,V.min=R,V.max=U,V}function h(i,r,v){const f=o(i,"checkbox",r);return f.checked=v,f}function o(i={},r=null,v=null){const f=c("input",i);return r&&(f.type=r),v&&(f.addEventListener("keyup",(0,d.sg)(v,200)),f.addEventListener("change",(0,d.sg)(v,100))),f}function e(i={},r=null){return c("span",i,r)}function u(i={},r=null,v=null){const f=c("a",i,r);return v&&(f.href=v),f}function g(i,r=null,v={}){v.cursor||="pointer";const f=u(v,r);return i&&f.addEventListener("click",i),f}function S(i,r,v=null,f={},R={}){f.display||="inline-flex",f.alignItems||="center",f.gap||="0.25em";const U=g(i,v,f);return U.prepend(n(r,R)),U}function C(i={},r=null,v=null){const f=c("button",i,r);return v&&f.addEventListener("click",v),f}function x(i={},r=null){return c("div",i,r)}function E(i={}){return c("i",i)}function n(i,r={}){r.width||="1em",r.height||="1em",r.paddingBottom||="1px";const v=E(r);return v.setAttribute("data-lucide",i),v}function c(i,r,v=null){if(typeof r!="object"||r===null)throw new TypeError("styles should be an object");const f=document.createElement(i);return(0,m.ZM)(f,r),v&&(f.innerHTML=v),f}},573:(y,s,t)=>{t.d(s,{Fi:()=>p,YA:()=>e,fI:()=>l});var d=t(4214);function m(n,c=document){return!!c.querySelector(n)}function p(n,c=document,i=!1){const r=c.querySelector(n);return i&&!r&&console.log(`No element found for selector: ${n}`),r}function l(n,c=document,i=!1){const r=c.querySelectorAll(n);return i&&!r.length&&console.log(`No elements found for selector: ${n}`),r}function h(n,c,i){return[...n.querySelectorAll(c)].find(r=>r.textContent.trim().includes(i))}function o(n,c,i=!1,r=!1,v=null){const f=p(c,n);return e(f,i,r,v)}function e(n,c=!1,i=!1,r=null){if(!n)return r===null?(console.log("No element found"),null):r;const v=n.innerText;return S(v,c,i)}function u(n,c,i=!1){const r=n[c];return e(r,i)}function g(n,c=!1,i=!1){const r=n.textContent;return S(r,c,i)}function S(n,c,i){c&&(n=(0,d.zr)(n)),i&&(n=n.replace(",","."));const r=Number(n);return Number.isNaN(r)?(console.log(`Invalid number: ${n}`),0):r}function C(n){return[...n.childNodes].find(c=>c.nodeType===Node.TEXT_NODE)}function x(n){const c=i=>i.nodeType===Node.TEXT_NODE&&i.textContent.trim()!==""?[i]:[...i.childNodes].flatMap(c);return c(n)}function E(n){return normalizeSpacing(n.textContent)}},5539:(y,s,t)=>{t.d(s,{Bt:()=>m,UC:()=>e,ZM:()=>b,kl:()=>h});function d(a,w){a.parentNode.insertBefore(w,a.nextSibling)}function m(a){a.style.display="none"}function p(a){S(a),m(a)}function l(a){a.intersectionObserver||runOnceOnIntersection(a,()=>m(a))}function h(a){a.style.display=""}function o(a){const w=g(a);a.style.display=w}function e(a,w){w?m(a):h(a)}function u(a,w){w?l(a):(clearIntersectionObserver(a),h(a))}function g(a){return S(a),a.defaultDisplay}function S(a){if(a.defaultDisplay)return;const{display:w}=getComputedStyle(a);a.defaultDisplay=w}function C(){return{show:[],hide:[]}}function x(a,w,k){a?w.hide.push(k):w.show.push(k)}function E(a){a.show.forEach(h),a.hide.forEach(m)}function n(a,w,k=.3){w?i(a,k):c(a)}function c(a){a.style.opacity=""}function i(a,w=.3){a.style.opacity=w}function r(a){a.style.order=""}function v(a,w){a.style.order=w}function f(a,w){a.style.background=w}function R(a,w){const k=getFirstElement(w);if(!k)return;const G=createLink();G.href=a,k.parentNode.append(G),G.append(k)}function U(a,w){const k=getFirstElement(w);k&&V(a,k)}function V(a,w){const k=createLink();k.href=a,k.append(...w.childNodes),w.append(k)}function F(){const a=getURLQueryParam("scrollTo");if(!a)return;const w=document.getElementById(a);w?w.scrollIntoView():console.log(`Element with ID "${a}" was not found.`)}function N(a,w="custom-global-style"){let k=document.getElementById(w);k||(k=document.createElement("style"),k.id=w,k.type="text/css",document.head.appendChild(k)),k.textContent=a}function b(a,w){Object.assign(a.style,w)}function I(a){return Object.entries(a).map(([w,k])=>`${w.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${k};`).join(" ")}function H(a){return a?a.split(";").filter(w=>w.trim()!=="").reduce((w,k)=>{const[G,T]=k.split(":").map(A=>A.trim()),L=G.replace(/-([a-z])/g,(A,$)=>$.toUpperCase());return w[L]=T,w},{}):{}}function X(a,w,k="text/plain"){const G=new Blob([a],{type:k}),T=URL.createObjectURL(G),L=document.createElement("a");L.href=T,L.download=w,document.body.appendChild(L),L.click(),document.body.removeChild(L),requestAnimationFrame(()=>URL.revokeObjectURL(T))}},4921:(y,s,t)=>{t.d(s,{XW:()=>p,sg:()=>l});function d(e,u,g=null){const S=e.querySelector(u);return S?Promise.resolve(S):new Promise(C=>{const x=new MutationObserver(n);x.observe(e,{childList:!0,subtree:!0});let E;g&&(E=setTimeout(()=>{x.disconnect(),console.log(`No element found for selector: ${u}`),C(null)},g));function n(){const c=e.querySelector(u);c&&(E&&clearTimeout(E),x.disconnect(),C(c))}})}function m(e,u){return e.querySelector(u)?new Promise(S=>{const C=new MutationObserver(x);C.observe(e,{childList:!0,subtree:!0});function x(){e.querySelector(u)||(C.disconnect(),S())}}):Promise.resolve()}function p(e,u=400){return new Promise(g=>{let S;const C=new MutationObserver(()=>{clearTimeout(S),x()});function x(){S=setTimeout(()=>{C.disconnect(),g()},u)}x(),C.observe(e,{childList:!0,subtree:!0})})}function l(e,u=250){let g;return(...S)=>{clearTimeout(g),g=setTimeout(()=>e(...S),u)}}function h(e,u){const g=new IntersectionObserver(S=>{S.forEach(C=>{C.isIntersecting&&(u(),o(e))})});e.intersectionObserver=g,g.observe(e)}function o(e){e.intersectionObserver&&(e.intersectionObserver.disconnect(),e.intersectionObserver=null)}},3829:(y,s,t)=>{t.d(s,{Ay:()=>m,JE:()=>l,iG:()=>h});var d=t(8355);function m(e,u){return!p(e,u)}function p(e,u){if(!u.value)return!0;const g=e.toLowerCase(),S=(0,d.R)(u),C=[],x=[];return S.forEach(E=>{if(E.startsWith("!")){const n=E.substring(1);n&&x.push(n)}else C.push(E)}),C.every(E=>g.includes(E))&&x.every(E=>!g.includes(E))}function l(e,u){return u.value!=null&&e<u.value}function h(e,u){return u.value!=null&&e>u.value}function o(e,u){return u.value&&e!==u.value}},4521:(y,s,t)=>{t.d(s,{z:()=>m});var d=t(3048);function m(p,l=null){return{createGlobalFilter(h,o=null,e=p){return d.V.create(h,o,e)},createSectionFilter(h,o=null,e=p){if(!l)throw new Error("sectionId must be provided to use createSectionFilter.");return d.V.createWithCompositeKey(l,h,o,e)}}}},5884:(y,s,t)=>{t.d(s,{Hw:()=>h,Nm:()=>p,nW:()=>l});var d=t(9928),m=t(5467);function p(o,e,u={},g={}){const S=(0,d.kU)(g,e.updateValueFromEvent,e.value);return(0,m.E2)(S,u,o)}function l(o,e,u,g,S,C={},x={}){const E=(0,d.o5)(x,e.updateValueFromEvent,e.value,u,g,S);return(0,m.E2)(E,C,o)}function h(o,e,u={},g={}){const S=(0,d.S)(g,e.updateValueFromEvent,e.value);return(0,m.E2)(S,u,o)}},7877:(y,s,t)=>{t.d(s,{E9:()=>m,EY:()=>v,H1:()=>E,HX:()=>p,pW:()=>V});var d=t(5884);function m(F,N={},b={}){return(0,d.Nm)("\u041F\u043E\u0438\u0441\u043A: ",F,N,b)}function p(F,N={},b={},I=.1,H=3){return(0,d.nW)("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",F,I,H,5,N,b)}function l(F,N={},b={},I=.1,H=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",F,I,H,5,N,b)}function h(F,N={},b={}){return e("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",F,N,b)}function o(F,N={},b={}){return e("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",F,N,b)}function e(F,N,b={},I={}){return createNumberFilterControl(F,N,"1","1","999999",b,I)}function u(F,N={},b={}){return g("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",F,N,b)}function g(F,N,b={},I={}){return createNumberFilterControl(F,N,"5","0","100",b,I)}function S(F,N={},b={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",F,"5","0","100",N,b)}function C(F,N,b={},I={},H="250"){return(0,d.nW)(F,N,H,"0","1000000",b,I)}function x(F,N={},b={},I="25"){return C("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",F,N,b,I)}function E(F,N={},b={},I="25"){return C("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",F,N,b,I)}function n(F,N={},b={}){return c("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",F,N,b)}function c(F,N,b={},I={}){return createNumberFilterControl(F,N,"1","0","99999",b,I)}function i(F,N={},b={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",F,"1","2","7",N,b)}function r(F,N={},b={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",F,1,1,10,N,b)}function v(F,N={},b={}){return(0,d.Hw)("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",F,N,b)}function f(F,N={},b={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",F,N,b)}function R(F,N={},b={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",F,N,b)}function U(F,N={},b={}){return createCheckboxFilterControl("\u0411\u0430\u043B\u043B\u044B: ",F,N,b)}function V(F,N={},b={}){return(0,d.Hw)("\u0412\u043A\u043B: ",F,N,b)}},8355:(y,s,t)=>{t.d(s,{R:()=>d});function d(p){return p.value.toLowerCase().split(",").map(l=>l.trim()).filter(l=>l!=="")}function m(p){return d(p).filter(l=>!l.startsWith("!"))}},5213:(y,s,t)=>{t.d(s,{b:()=>p});var d=t(9928),m=t(573);function p(l,h,o=!1,e="customFiltersContainer"){let u=(0,m.Fi)(`#${e}`,l);if(u)if(o)u.remove();else return;u=(0,d.Sw)(),u.id=e,h(u,l)}},4444:(y,s,t)=>{t.d(s,{s:()=>d});function d(m){let h=2166136261;for(let o=0;o<m.length;o+=1){const e=m.charCodeAt(o);h^=e,h=Math.imul(h,16777619)}return h>>>0}},5081:(y,s,t)=>{t.d(s,{B:()=>p});var d=t(4444);function m(l){return(0,d.s)(l).toString(16).padStart(8,"0")}function p(l,h="common"){return l?m(l):h}},8200:(y,s,t)=>{t.d(s,{s:()=>d});function d(m){const{target:p}=m,{type:l}=p;switch(l){case"text":return`"${p.value}"`;case"number":return p.value;case"checkbox":return p.checked;default:return console.log(`Unknown input type: ${l}`),null}}},157:(y,s,t)=>{t.d(s,{Fg:()=>d,vx:()=>p});const d=window.GM_setValue,m=window.GM.setValue,p=window.GM_getValue,l=window.GM_addValueChangeListener},1870:(y,s,t)=>{t.d(s,{j:()=>d});class d{constructor(p,l){this.value=p,this.onChange=l}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(y,s,t)=>{t.d(s,{V:()=>h});var d=t(1870),m=t(8200),p=t(3976),l=t(157);class h extends d.j{constructor(e,u=null,g=null){super((0,l.vx)(e,u),g),this.storageKey=e,this.defaultValue=u}static create(e,u=null,g=null){return new h(e,u,g)}static createWithCompositeKey(e,u,g=null,S=null){const C=`${e}-${u}`;return new h(C,g,S)}updateValueFromEvent=e=>{const u=(0,m.s)(e),g=(0,p.$)(u);this.updateValue(g)};updateValue(e,u=!0){this.value!==e&&((0,l.Fg)(this.storageKey,e),this.value=e,u&&this.onChangeIfDefined())}clearValue(e=!1){this.updateValue(null,e)}resetValue(e=!1){this.updateValue(this.defaultValue,e)}}},3976:(y,s,t)=>{t.d(s,{$:()=>d});function d(m){return m===""?null:JSON.parse(m)}},4214:(y,s,t)=>{t.d(s,{zr:()=>m});function d(o){return o.replace(/\D/g,"")}function m(o){return o.replace(/[^\d.,-]/g,"")}function p(o){return o.replace(/\s/g,"")}function l(o){return o.charAt(0).toUpperCase()+o.slice(1)}function h(o){return o.replace(/\s+/g," ").trim()}},5406:(y,s,t)=>{t.d(s,{Es:()=>E,Fc:()=>d});function d(n,c="common",i=!1){const{pathname:r}=window.location;return m(r,n,c,i)}function m(n,c,i,r=!1){const v=n.split("/");c=c<0?v.length+c:c;const f=v[c]||i;return r&&console.log(`Pathname element: ${f}`),f}function p(n,c="common",i=!1){const r=d(n,"",i);return l(r,c,i)}function l(n,c,i){if(!n)return c;const r=n.split("-").at(-1);return i&&console.log(`Pathname element ending: ${r}`),r}function h(n,c,i="common",r=!1){const v=m(n,c,"",r);return l(v,i,r)}function o(n){return new URLSearchParams(window.location.search).get(n)}function e(n){return n.split("?")[0]}function u(n){return window.location.pathname.includes(n)}function g(n){return n.some(c=>u(c))}function S(n){return window.location.pathname.split("/").some(i=>i===n)}function C(n){try{const c=new URL(window.location.href);Object.entries(n).forEach(([i,r])=>{c.searchParams.set(i,r)}),window.location.href=c.toString()}catch(c){console.error("Failed to redirect:",c)}}function x(n,c=[]){const i={pathname:window.location.pathname};c.forEach(f=>{i[f]=o(f)});function r(){const f={pathname:window.location.pathname};c.forEach(R=>{f[R]=o(R)}),Object.keys(i).some(R=>i[R]!==f[R])&&n()}let v=window.location.href;setInterval(()=>{window.location.href!==v&&(v=window.location.href,r())},200),window.addEventListener("popstate",r)}function E(n=[]){x(()=>window.location.reload(),n)}},4709:(y,s,t)=>{t.a(y,async(d,m)=>{try{let I=function(){const T=(0,o.Fi)(e.Z.TAG_FILTER)||(0,o.Fi)(e.Z.SORT_SELECT)?.parentNode?.parentNode;T&&((0,g.b)(T,H),X(),a())},H=function(T,L){(0,S.ZM)(T,C.r.FILTERS_CONTAINER);const A=(0,x.E9)(v,C.r.CONTROL,C.r.TEXT_INPUT),$=(0,x.HX)(f,C.r.CONTROL,C.r.NUMBER_INPUT),Z=(0,x.EY)(R,C.r.CONTROL,C.r.CHECKBOX_INPUT),j=(0,x.H1)(U,C.r.CONTROL,C.r.NUMBER_INPUT),Y=(0,E.nW)("\u041C\u0438\u043D. \u0440\u0430\u0437\u043C\u0435\u0440: ",V,"2","1","10000",C.r.CONTROL,C.r.NUMBER_INPUT),B=(0,x.pW)(F,C.r.CONTROL,C.r.CHECKBOX_INPUT);T.append(A,$,Z,j,Y,B),L.append(T)},X=function(){const T=(0,o.fI)(e.Z.RELATED_SLIDER);T.length&&T.forEach(L=>{L.parentNode.remove(),console.log("removed related slider")})},a=function(){(0,o.fI)(e.Z.PRODUCT).forEach(w)},w=function(T){if(!F.value){(0,S.kl)(T);return}const L=(0,o.Fi)(e.Z.PRODUCT_NAME,T),A=(0,o.Fi)(e.Z.PRODUCT_PRICE,T);if(!L||!A){(0,S.Bt)(T);return}const $=L.innerText,Z=(0,o.YA)(A,!0,!0),j=(0,n.Ay)($,v)||k(T)||(0,n.iG)(Z,U)||G(T);(0,S.UC)(T,j)},k=function(T){const L=(0,o.Fi)(e.Z.PRODUCT_RATING,T);if(!L)return!R.value;const A=(0,o.YA)(L,!0,!0,0);return(0,n.JE)(A,f)},G=function(T){const L=(0,o.Fi)(e.Z.PRODUCT_VOLUME,T);if(!L)return V.value;const A=(0,o.YA)(L,!0,!0,0);return(0,n.JE)(A,V)};var p=t(5406),l=t(5081),h=t(4521),o=t(573),e=t(5767),u=t(4921),g=t(5213),S=t(5539),C=t(3607),x=t(7877),E=t(5884),n=t(3829);(0,p.Es)();const c=(0,l.B)((0,p.Fc)(-1)),{createGlobalFilter:i,createSectionFilter:r}=(0,h.z)(a,c),v=r("name-filter"),f=r("min-rating-filter",4.7),R=r("no-rating-filter",!0),U=r("max-price-filter"),V=r("min-volume-filter"),F=i("filter-enabled",!0),N=(0,o.Fi)(e.Z.CONTENT);N&&(await b(),new MutationObserver((0,u.sg)(b)).observe(N,{childList:!0}));async function b(){const T=(0,o.Fi)(e.Z.CATALOG_CONTENT);T&&(await(0,u.XW)(T),I(),new MutationObserver((0,u.sg)(I)).observe(T,{childList:!0,subtree:!0}))}m()}catch(c){m(c)}},1)},5767:(y,s,t)=>{t.d(s,{Z:()=>d});const d={CONTENT:".content",CATALOG_CONTENT:".catalog-content",TAG_FILTER:".tag__filter",SORT_SELECT:".page-header__select-sort",RELATED_SLIDER:".related-slider",PRODUCT:".product-card-wrapper",PRODUCT_NAME:".product-card__title",PRODUCT_PRICE:".price-new",PRODUCT_RATING:".rating-value",PRODUCT_VOLUME:".product-card__size"}},3607:(y,s,t)=>{t.d(s,{r:()=>m});const d={INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px 6px",fontSize:"15px"}},m={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",paddingTop:"8px",flexFlow:"wrap"},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},TEXT_INPUT:{...d.INPUT,width:"155px"},NUMBER_INPUT:{...d.INPUT,width:"75px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},z={};function O(y){var s=z[y];if(s!==void 0)return s.exports;var t=z[y]={exports:{}};return Q[y](t,t.exports,O),t.exports}(()=>{var y=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",s=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",t=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",d=p=>{p&&p.d<1&&(p.d=1,p.forEach(l=>l.r--),p.forEach(l=>l.r--?l.r++:l()))},m=p=>p.map(l=>{if(l!==null&&typeof l=="object"){if(l[y])return l;if(l.then){var h=[];h.d=0,l.then(u=>{o[s]=u,d(h)},u=>{o[t]=u,d(h)});var o={};return o[y]=u=>u(h),o}}var e={};return e[y]=u=>{},e[s]=l,e});O.a=(p,l,h)=>{var o;h&&((o=[]).d=-1);var e=new Set,u=p.exports,g,S,C,x=new Promise((E,n)=>{C=n,S=E});x[s]=u,x[y]=E=>(o&&E(o),e.forEach(E),x.catch(n=>{})),p.exports=x,l(E=>{g=m(E);var n,c=()=>g.map(r=>{if(r[t])throw r[t];return r[s]}),i=new Promise(r=>{n=()=>r(c),n.r=0;var v=f=>f!==o&&!e.has(f)&&(e.add(f),f&&!f.d&&(n.r++,f.push(n)));g.map(f=>f[y](v))});return n.r?i:c()},E=>(E?C(x[t]=E):S(u),d(o))),o&&o.d<0&&(o.d=0)}})(),O.d=(y,s)=>{for(var t in s)O.o(s,t)&&!O.o(y,t)&&Object.defineProperty(y,t,{enumerable:!0,get:s[t]})},O.o=(y,s)=>Object.prototype.hasOwnProperty.call(y,s);var J=O(4709)})();})();
