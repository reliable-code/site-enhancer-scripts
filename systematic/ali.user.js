// ==UserScript==
// @name         Aliexpress product cards filter
// @description  Hide product cards by filter
// @grant        GM_addStyle
// @grant        GM_deleteValue
// @grant        GM_listValues
// @grant        GM_addValueChangeListener
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://aliexpress.ru/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.77032393
// @icon         https://www.google.com/s2/favicons?sz=64&domain=aliexpress.ru
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/ali.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var me={9830:(w,g,r)=>{r.a(w,async(h,b)=>{try{var p=r(5406),m=r(4921),_=r(5027),u=r(5413),L=r(7708);(0,_.N)(),await(0,m.Un)(v),(0,p.$G)(async()=>{await v(!0)});async function v(E=!1){if(await(0,m.XW)(document.head),(0,p.z2)("category","store","wholesale")){await(0,u.P)(E);return}(0,p.z2)("item")&&await(0,L.K)(E)}b()}catch(v){b(v)}},1)},5027:(w,g,r)=>{r.d(g,{N:()=>b,p:()=>p});var h=r(5406);function b(){window.GM_addStyle(`        
        .userscript-control {
            color: #898993 !important;
            
            &:hover {
                color: #547dff !important;
            }
        }
        
        #customFiltersContainer {
          padding: 8px 0px 8px 3px !important;
        }
        
        [class*="RedSeoFilter_TopPanel__container__"] #customFiltersContainer {
          padding: 5px 0px 18px 3px !important;
        }
        
        [class*="RedFilter_FilterHeader__filterHeaderContainer__"] {
          padding: 0 !important;
        }
        
        [class*="RedFilter_RedFilter__topPadding__"] {
          padding-top: 2px !important;
        }
        
        span[class*="rating_Rating__rating__"] + span[class*="red-ali-kit_Body__M__"] {
          padding-top: 1px !important;
        }
    `)}function p(){return(0,h.C$)(2,"unknown").replace(".html","")}},7549:(w,g,r)=>{r.d(g,{r:()=>h});const h={DISLIKE_CONTROL:{marginLeft:"auto",gap:"3px"},DISLIKE_BUTTON_ICON_SM:{height:"0.9em",marginBottom:"1px",marginRight:"2px"},DISLIKE_BUTTON_ICON_MD:{marginTop:"1px"},REMOVE_DISLIKE_BUTTON_ICON_SM:{height:"0.9em",marginBottom:"1px"},REMOVE_DISLIKE_BUTTON_ICON_MD:{marginBottom:"1px"}}},5413:(w,g,r)=>{r.d(g,{P:()=>Fe});var h=r(4921),b=r(5539),p=r(573);const m={PRODUCT_LIST_CONTAINER:['[class*="RedFilter_RedFilter__centerBlock__"]','[class*="RedSeoFilter_RedSeoFilter__centerBlock__"]','[class*="ShopFilter_ShopFilter__centerBlock__"]'].join(", "),PRODUCT_LIST_HEADER:['[class*="RedFilter_TopPanel__container__"]','[class*="RedSeoFilter_TopPanel__container__"]','[class*="ShopFilter_TopPanel__container__"]'].join(", "),PRODUCT_LIST:['[class*="red-snippet_RedSnippet__grid__"]'].join(", "),PRODUCT:'[class^="red-snippet_RedSnippet__container__"]',PRODUCT_NAME:'[class^="red-snippet_RedSnippet__title__"]',PRODUCT_RATING_CONTAINER:'[class^="red-snippet_RedSnippet__trust__"]',PRODUCT_RATING_WRAP:":scope > div:has(img) > span",PRODUCT_PURCHASES_WRAP:":scope > div:not(:has(img)) > span"};function _(t){if(!t)return[];const n=u(t).flat().filter(i=>i&&!i.isNegative&&i.term).map(i=>i.term);return[...new Set(n)]}function u(t){return t?t.toLowerCase().split(",").map(L).filter(Boolean):[]}function L(t){const e=t.split("/").map(i=>i.trim()).filter(Boolean);if(e.length===0)return null;const n=e.map(v).filter(Boolean);return n.length>0?n:null}function v(t){const e=t.startsWith("!"),n=e?t.slice(1).trim():t;return n?{term:n,isNegative:e}:null}function E(t,e){T(t,n=>n.style.display!=="none",e)}function C(t,e){T(t,n=>n.style.opacity==="",e)}function T(t,e,n){const i=[...t].filter(e).length,D=t.length;d(n,i,D)}function d(t,e,n){t.textContent=`\u041F\u043E\u043A\u0430\u0437\u0430\u043D\u043E: ${e} \u0438\u0437 ${n}`}function s(t,e){return!R(t,e)}function R(t,e){if(!e||!e.value)return!0;const n=u(e.value);return o(t,n)}function o(t,e){if(!e||!e.length)return!0;const n=(t||"").toLowerCase();return e.every(i=>f(n,i))}function f(t,e){return e.some(({term:n,isNegative:i})=>{const D=t.includes(n);return i?!D:D})}function l(t,e){return e.value!=null&&t<e.value}function a(t,e){return e.value!=null&&t>e.value}function I(t,e){return e.value==null?!1:t<parseDateFromISO(e.value)}function F(t,e){return e.value==null?!1:t>parseDateFromISO(e.value)}function k(t,e){return e.value&&t!==e.value}function N(t){let i=2166136261;for(let D=0;D<t.length;D+=1){const A=t.charCodeAt(D);i^=A,i=Math.imul(i,16777619)}return i>>>0}function x(t){return N(t).toString(16).padStart(8,"0")}function X(t,e="common"){return t?x(t):e}var ne=r(6754);const Q={INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px 6px",fontSize:"15px"},CONTROL:{display:"flex",alignItems:"center",fontSize:"14px"}},U={FILTERS_CONTAINER:{display:"flex",justifyContent:"flex-end",gap:"12px"},CONTROL:Q.CONTROL,TEXT_INPUT_CONTROL:{...Q.CONTROL,flexGrow:1},TEXT_INPUT:{...Q.INPUT,flexGrow:1},NUMBER_INPUT:{...Q.INPUT,width:"85px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px",webkitAppearance:"auto"}};var ee=r(7549),$=r(5406),re=r(7273);function c(t,e={},n=null){const i=(0,re.S)(e,n);return i.append(t),i}function O(t,e=null,n={},i={}){const D=createActionLink(t,e,i);return c(D,n)}function P(t,e=null,n=null,i={},D={},A={}){const S=createActionLinkWithIcon(t,n,e,D,A);return c(S,i)}var B=r(5558);function G(t,e,n){const i=te(t,"text",e);return i.value=n,i}function M(t,e,n,i,D,A){const S=te(t,"number",e);return S.value=n,S.step=i,S.min=D,S.max=A,S}function oe(t,e,n){const i=te(t,"date",e);return i.value=n,i}function he(t,e,n){const i=te(t,"checkbox",e);return i.checked=n,i}function te(t={},e=null,n=null){const i=(0,B.n)("input",t);return e&&(i.type=e),n&&(i.addEventListener("keyup",(0,h.sg)(n,200)),i.addEventListener("change",(0,h.sg)(n,100))),i}function He(t,e,n){const i=createElement("select",t);return e&&i.addEventListener("change",e),i.value=n,i}function Ee(t,e,n={},i={}){const D=G(i,e.updateValueFromEvent,e.value);return c(D,n,t)}function ie(t,e,n,i,D,A={},S={}){const j=M(S,e.updateValueFromEvent,e.value,n,i,D);return c(j,A,t)}function Xe(t,e,n={},i={}){const D=createSelect(i,e.updateValueFromEvent,e.value);return createControl(D,n,t)}function Qe(t,e,n={},i={}){const D=createDateInput(i,e.updateValueFromEvent,e.value);return createControl(D,n,t)}function ge(t,e,n={},i={}){const D=he(i,e.updateValueFromEvent,e.value);return c(D,n,t)}function _e(t,e={},n={}){return Ee("\u041F\u043E\u0438\u0441\u043A: ",t,e,n)}function Ce(t,e={},n={},i=.1,D=3){return ie("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",t,i,D,5,e,n)}function Ye(t,e={},n={},i=.1,D=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",t,i,D,5,e,n)}function Ze(t,e={},n={}){return se("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",t,e,n)}function Je(t,e={},n={}){return se("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",t,e,n)}function se(t,e,n={},i={}){return createNumberFilterControl(t,e,"1","1","999999",n,i)}function qe(t,e={},n={}){return createDateFilterControl("\u041C\u0438\u043D. \u0434\u0430\u0442\u0430: ",t,e,n)}function et(t,e={},n={}){return ve("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",t,e,n)}function ve(t,e,n={},i={}){return createNumberFilterControl(t,e,"5","0","100",n,i)}function tt(t,e={},n={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",t,"5","0","100",e,n)}function ae(t,e,n={},i={},D="250"){return createNumberFilterControl(t,e,D,"0","1000000",n,i)}function nt(t,e={},n={},i="25"){return ae("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",t,e,n,i)}function rt(t,e={},n={},i="25"){return ae("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",t,e,n,i)}function ot(t,e={},n={}){return Re("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",t,e,n)}function Re(t,e,n={},i={}){return createNumberFilterControl(t,e,"1","0","99999",n,i)}function it(t,e={},n={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",t,"1","2","8",e,n)}function De(t,e={},n={}){return ie("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",t,1,1,10,e,n)}function ut(t,e={},n={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",t,e,n)}function st(t,e={},n={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",t,e,n)}function at(t,e={},n={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",t,e,n)}function lt(t,e={},n={}){return createCheckboxFilterControl("\u0411\u043E\u043D\u0443\u0441: ",t,e,n)}function ct(t,e={},n={}){return createCheckboxFilterControl("\u0412 \u043D\u0430\u043B\u0438\u0447\u0438\u0438: ",t,e,n)}function Le(t,e={},n={}){return ge("\u0412\u043A\u043B: ",t,e,n)}function dt(t,e,n={}){const i=[{value:-25,emoji:"\u{1F48E}",tooltip:"\u0421\u0443\u043F\u0435\u0440 \u0446\u0435\u043D\u0430 (-25%)"},{value:-15,emoji:"\u{1F525}",tooltip:"\u041E\u0442\u043B\u0438\u0447\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-15%)"},{value:-5,emoji:"\u{1F31F}",tooltip:"\u041A\u043B\u0430\u0441\u0441\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-5%)"},{value:5,emoji:"\u{1F44C}",tooltip:"\u0425\u043E\u0440\u043E\u0448\u0430\u044F \u0446\u0435\u043D\u0430 (+5%)"}],D={active:{background:"#e3f2fd",borderColor:"#2196f3",boxShadow:"0 0 0 1px #2196f3"},inactive:{background:"#fff",borderColor:"#ccc",boxShadow:"none"},hover:{background:"#f5f5f5"}},A=createDiv({display:"inline-flex",gap:"4px",marginLeft:"4px"}),S=[],j=()=>e?parseFloat(e.value)||0:t.value,K=()=>{const V=j();S.forEach(({button:J,value:q})=>{const H=q<=V?D.active:D.inactive;Object.assign(J.style,H)})};return i.forEach(({value:V,emoji:J,tooltip:q})=>{const W=createButton({padding:"2px 6px",fontSize:"16px",cursor:"pointer",border:"1px solid #ccc",borderRadius:"4px",background:"#fff",transition:"all 0.2s",...n},J);W.title=q,W.type="button",W.addEventListener("click",H=>{H.preventDefault(),t.updateValue(V),e&&(e.value=V),K()}),W.addEventListener("mouseenter",()=>{V<=j()||(W.style.background=D.hover.background)}),W.addEventListener("mouseleave",()=>{K()}),S.push({button:W,value:V}),A.appendChild(W)}),K(),e&&(e.addEventListener("input",K),e.addEventListener("change",K)),A}function be(t,e,n=!1,i="customFiltersContainer"){let D=(0,p.Fi)(`#${i}`,t);if(D)if(n)D.remove();else return;D=(0,re.S)(),D.id=i,e(D,t)}class Te{constructor(e,n){this.value=e,this.onChange=n}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}function Oe(t){const{target:e}=t,{type:n}=e;switch(n){case"text":return`"${e.value}"`;case"number":return e.value;case"select-one":return e.value;case"date":return`"${e.value}"`;case"checkbox":return e.checked;default:return console.log(`Unknown input type: ${n}`),null}}function we(t){return t===""?null:JSON.parse(t)}var le=r(157);class Y extends Te{constructor(e,n=null,i=null){super((0,le.vx)(e,n),i),this.storageKey=e,this.defaultValue=n}static create(e,n=null,i=null){return new Y(e,n,i)}static createWithCompositeKey(e,n,i=null,D=null){const A=`${e}-${n}`;return new Y(A,i,D)}updateValueFromEvent=e=>{const n=Oe(e),i=we(n);this.updateValue(i)};updateValue(e,n=!0){this.value!==e&&((0,le.Fg)(this.storageKey,e),this.value=e,n&&this.onChangeIfDefined())}clearValue(e=!1){this.updateValue(null,e)}resetValue(e=!1){this.updateValue(this.defaultValue,e)}}function Ie(t,e=null){return{createGlobalFilter(n,i=null,D=t){return Y.create(n,i,D)},createSectionFilter(n,i=null,D=t){if(!e)throw new Error("sectionId must be provided to use createSectionFilter.");return Y.createWithCompositeKey(e,n,i,D)}}}var ce=r(6700),de=r(9412);const ye=window.GM_addValueChangeListener,Pe=(0,de.wq)(pe),y={productListContainer:null,productListObserver:null,containerObserver:null,isFiltersInitialized:!1,filters:{nameFilter:null,minPurchasesFilter:null,minRatingFilter:null,maxNameLines:null,filterEnabled:null},productCardsCache:new WeakMap};async function Fe(t){t&&je(),Se(),xe()}function Se(){if(!y.isFiltersInitialized){const t=Ae(),{createGlobalFilter:e,createSectionFilter:n}=Ie(Z,t);y.filters.nameFilter=n("name-filter"),y.filters.minPurchasesFilter=n("min-purchases-filter"),y.filters.minRatingFilter=n("min-rating-filter",4.8),y.filters.maxNameLines=e("max-name-lines",4),y.filters.filterEnabled=n("filter-enabled",!0),y.isFiltersInitialized=!0}}function Ae(){return X(Ne())}function Ne(){return(0,$.z2)("store")?(0,$.Fc)(2):(0,$.z2)("category")?(0,$.Fc)(3):(0,$.z2)("wholesale")?(0,$.$F)("SearchText"):"common"}function xe(){y.productListContainer=(0,p.Fi)(m.PRODUCT_LIST_CONTAINER),y.productListContainer&&(fe(),y.containerObserver=new MutationObserver((0,h.sg)(fe)),y.containerObserver.observe(y.productListContainer,{childList:!0,subtree:!0}))}function fe(){const t=(0,p.Fi)(m.PRODUCT_LIST_HEADER,y.productListContainer);if(!t)return;const e=(0,p.Fi)(m.PRODUCT_LIST,y.productListContainer);e&&(be(t,ke),ye(ce.d5.LAST_RATE_UPDATE,()=>Z(!0)),Z(),y.productListObserver&&(0,h.wP)(y.productListObserver),y.productListObserver=new MutationObserver(Z),y.productListObserver.observe(e,{childList:!0}))}function ke(t,e){(0,ne.ZM)(t,U.FILTERS_CONTAINER);const n=_e(y.filters.nameFilter,U.TEXT_INPUT_CONTROL,U.TEXT_INPUT),i=ie("\u041C\u0438\u043D. \u043F\u043E\u043A\u0443\u043F\u043E\u043A: ",y.filters.minPurchasesFilter,"1","1","999999",U.CONTROL,U.NUMBER_INPUT),D=Ce(y.filters.minRatingFilter,U.CONTROL,U.NUMBER_INPUT),A=De(y.filters.maxNameLines,U.CONTROL,U.NUMBER_INPUT),S=Le(y.filters.filterEnabled,U.CONTROL,U.CHECKBOX_INPUT);t.append(n,i,D,A,S),e.append(t)}function Z(t=!1){(0,p.fI)(m.PRODUCT).forEach(n=>{Me(n,t)})}function Me(t,e){if(!y.filters.filterEnabled.value){(0,b.kl)(t);return}let n=y.productCardsCache.get(t);if(n)e&&Pe(n);else{const D=(0,p.Fi)("a",t),A=(0,p.Fi)(m.PRODUCT_NAME,t),S=(0,p.Fi)(m.PRODUCT_RATING_CONTAINER,t);if(!D||!A||!S){(0,b.Bt)(t);return}const j=A.innerText,{productId:K}=t.dataset,{ratingWrap:V,purchasesCount:J,rating:q,storedRating:W,originalRating:H}=Ue(S,D,K),ze=$e(S,K,W);n={productId:K,nameWrap:A,name:j,ratingWrap:V,purchasesCount:J,rating:q,storedRating:W,originalRating:H,dislikeControls:ze},y.productCardsCache.set(t,n)}Ve(n.nameWrap);const i=s(n.name,y.filters.nameFilter)||l(n.purchasesCount,y.filters.minPurchasesFilter)||l(n.rating,y.filters.minRatingFilter);(0,b.UC)(t,i)}function Ue(t,e,n){const i=(0,p.Fi)(m.PRODUCT_PURCHASES_WRAP,t),D=(0,p.YA)(i,!0,!1,0);if(i){const V=(0,$.y_)(e.getAttribute("href"));Be(i,V,n)}const A=(0,ce.b$)(n),S=(0,p.Fi)(m.PRODUCT_RATING_WRAP,t),j=S?.textContent,K=Ke(A,S);return{ratingWrap:S,purchasesCount:D,rating:K,storedRating:A,originalRating:j}}function Be(t,e,n){const i=We(e,n);(0,b.y4)(i,t)}function We(t,e){const n=new URL(t),i=n.pathname.split("/");return`${n.origin}/${i[1]}/${e}/reviews`}function Ke(t,e){return t?(e&&pe(e,t),t):(0,p.YA)(e,!0,!1,0)}function pe(t,e){t.textContent=e.toString().padEnd(5)}function Ve(t){const e=y.filters.maxNameLines.value;t.style.height=`${e}lh`,t.style.maxHeight=`${e}lh`,t.style.webkitLineClamp=e}function $e(t,e,n){const i=()=>Z(!0),D={needLabel:!1,onDislike:i,onRemoveDislike:i,styles:{link:ee.r.DISLIKE_CONTROL,dislikeIcon:ee.r.DISLIKE_BUTTON_ICON_MD,removeDislikeIcon:ee.r.REMOVE_DISLIKE_BUTTON_ICON_MD}};return(0,de.xb)(t,e,n,D)}function je(){y.productListContainer=null,y.isFiltersInitialized=!1,y.filters={nameFilter:null,minPurchasesFilter:null,minRatingFilter:null,maxNameLines:null,filterEnabled:null},y.productCardsCache=new WeakMap,(0,h.wP)(y.containerObserver),(0,h.wP)(y.productListObserver)}},7708:(w,g,r)=>{r.d(g,{K:()=>T});var h=r(5027),b=r(6700);const p={EXTRA_INFO:'[class*="HazeProductDescription_HazeProductDescription__extraInfo__"]:not([class*="__stickyOffer__"])',RATING_WRAP:'[class*="HazeProductDescription_HazeProductDescription__ratingWrap__"] > span:nth-of-type(2)',REVIEWS_LINK:'a[href="#reviews_anchor"]'};var m=r(573),_=r(4921),u=r(7273);const L={DISLIKE_CONTROLS_WRAP:{width:"100%",marginTop:"5px",fontSize:"15px",fontWeight:"500"}};var v=r(7549),E=r(9412);const C={productId:null,extraInfo:null,originalRating:null,ratingWraps:[],dislikeControls:null};async function T(a){a&&l(),C.productId=(0,h.p)(),C.extraInfo=await(0,_.xk)(document,p.EXTRA_INFO),await Promise.all([d(),R(),o()])}async function d(){if(C.ratingWraps=(0,m.fI)(p.RATING_WRAP),!C.ratingWraps.length)return;const a=(0,b.b$)(C.productId);a&&s(a)}function s(a){C.ratingWraps.forEach(I=>{C.originalRating??=I.textContent,I.textContent=a})}async function R(){const a=await(0,_.xk)(C.extraInfo,p.REVIEWS_LINK);a&&(a.href=`${window.location.pathname.replace(".html","")}/reviews`)}function o(){const a=(0,u.S)(L.DISLIKE_CONTROLS_WRAP),I=(0,b.b$)(C.productId);C.dislikeControls=(0,E.xb)(a,C.productId,I,{needLabel:!0,onDislike:F=>f(F,F),onRemoveDislike:F=>f(C.originalRating,F),styles:{link:v.r.DISLIKE_CONTROL,dislikeIcon:v.r.DISLIKE_BUTTON_ICON_SM,removeDislikeIcon:v.r.REMOVE_DISLIKE_BUTTON_ICON_SM}}),C.extraInfo.append(a)}function f(a,I){s(a),(0,E.nF)(I,C.dislikeControls)}function l(){C.productId=null,C.extraInfo=null,C.originalRating=null,C.ratingWraps=[],C.dislikeControls=null}},5059:(w,g,r)=>{var h=r(157);const b=window.GM_listValues;function p(v,E,C=!1){getStorageValue("dbVersion")!==E&&(v(),!C&&setStorageValue("dbVersion",E))}function m(v,E=!0){const C=b();u(C,v,E)}function _(v,E,C=!0){const d=b().filter(v);u(d,E,C)}function u(v,E,C){let T=0;v.forEach(d=>{const s=getStorageValue(d);C&&console.log(d,s),E(d,s),T+=1}),C&&console.log(`Total entries processed: ${T}`)}function L(v,E=!1){_(v,T=>{E||window.GM_deleteValue(T)})}},6700:(w,g,r)=>{r.d(g,{b$:()=>E,d5:()=>m,v7:()=>_});var h=r(157),b=r(6001),p=r(5059);const m={LAST_RATE_UPDATE:"last-rate-update",REVIEWS_LAST_PRODUCT_ARTICLE:"reviews-last-product-article"};function _(s,R,o=!1){const f=u(s),l=(0,h.vx)(f),a=L(l);o&&a.rating===1||(a.rating=R,a.updateLastCheckDate(),(0,h.Fg)(f,a),(0,h.Fg)(m.LAST_RATE_UPDATE,Date.now()))}function u(s){return`product-${s}`}function L(s){return s?b.w.fromObject(s):new b.w}function v(s){const R=u(s);return(0,h.vx)(R)}function E(s){return v(s)?.rating??null}function C(s){return setStorageValue(m.REVIEWS_LAST_PRODUCT_ARTICLE,s)}function T(){return getStorageValue(m.REVIEWS_LAST_PRODUCT_ARTICLE)}function d(){const s=l=>l.startsWith("product-"),R=[],o=(l,a)=>{new Date(a.lastCheckDate)<getDateMonthsAgo(9)&&R.push(a.lastCheckDate)};processEntriesByKeyFilter(s,o,!1),[...R].sort((l,a)=>new Date(l)-new Date(a)).forEach(l=>{console.log(new Date(l).toLocaleDateString())})}},8738:(w,g,r)=>{r.d(g,{d:()=>_,kv:()=>E,yu:()=>C});var h=r(9319),b=r(9898),p=r(5558),m=r(7811);function _(d={},s=null,R=null){const o=(0,p.n)("a",d,s);return R&&(o.href=R),o}function u(d,s=null,R={}){R.cursor||="pointer";const o=_(R,s);return d&&o.addEventListener("click",d),o}function L(d,s,R=null,o={},f={}){o.display||="inline-flex",o.alignItems||="center",o.gap||="0.25em";const l=u(d,R,o);return l.prepend((0,m.U)(s,f)),l}function v(d,s,R,o=null,f={},l={},a="userscript-control"){const I=N=>{N.stopPropagation(),N.preventDefault(),window.confirm(R)&&d()},F=o?`<span>${o}</span>`:null,k=L(I,s,F,f,l);return k.classList.add(a),k}function E(d,s,R={},o={}){return v(d,h.A,"\u0412\u044B\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u043D\u0438\u0437\u043A\u0438\u0439 \u0440\u0435\u0439\u0442\u0438\u043D\u0433?",s?"\u0414\u0438\u0437\u043B\u0430\u0439\u043A":null,R,o)}function C(d,s,R={},o={}){return v(d,b.A,"\u0423\u0431\u0440\u0430\u0442\u044C \u043D\u0438\u0437\u043A\u0438\u0439 \u0440\u0435\u0439\u0442\u0438\u043D\u0433?",s?"\u0423\u0431\u0440\u0430\u0442\u044C \u0434\u0438\u0437\u043B\u0430\u0439\u043A":null,R,o)}function T(d={},s=null,R=null){const o=createElement("button",d,s);return R&&o.addEventListener("click",R),o}},7273:(w,g,r)=>{r.d(g,{S:()=>p});var h=r(5558);function b(m={},_=null){return createElement("span",m,_)}function p(m={},_=null){return(0,h.n)("div",m,_)}},5558:(w,g,r)=>{r.d(g,{n:()=>b});var h=r(6754);function b(p,m,_=null){if(typeof m!="object"||m===null)throw new TypeError("styles should be an object");const u=document.createElement(p);return(0,h.ZM)(u,m),_&&(u.innerHTML=_),u}},7811:(w,g,r)=>{r.d(g,{U:()=>m});var h=r(4082),b=r(6754);function p(_={},u=null){return createElement("i",_,u)}function m(_,u={}){u.width||="1em",u.height||="1em";const L=(0,h.A)(_);return(0,b.ZM)(L,u),L}},573:(w,g,r)=>{r.d(g,{Fi:()=>p,YA:()=>v,fI:()=>m});var h=r(4214);function b(o,f=document){return!!f.querySelector(o)}function p(o,f=document,l=!1){const a=f.querySelector(o);return l&&!a&&console.log(`No element found for selector: ${o}`),a}function m(o,f=document,l=!1){const a=f.querySelectorAll(o);return l&&!a.length&&console.log(`No elements found for selector: ${o}`),a}function _(o,f=1){let l=o;for(let a=0;a<f;a++){if(!l.parentElement)return null;l=l.parentElement}return l}function u(o,f,l){return[...o.querySelectorAll(f)].find(a=>a.textContent.trim().includes(l))}function L(o,f,l=!1,a=!1,I=null){const F=p(f,o);return v(F,l,a,I)}function v(o,f=!1,l=!1,a=null){if(!o)return a===null?(console.log("No element found"),null):a;const I=o.innerText;return T(I,f,l)}function E(o,f,l=!1){const a=o[f];return v(a,l)}function C(o,f=!1,l=!1){const a=o.textContent;return T(a,f,l)}function T(o,f,l){f&&(o=(0,h.zr)(o)),l&&(o=o.replace(",","."));const a=Number(o);return Number.isNaN(a)?(console.log(`Invalid number: ${o}`),0):a}function d(o){return[...o.childNodes].find(f=>f.nodeType===Node.TEXT_NODE)}function s(o){const f=l=>l.nodeType===Node.TEXT_NODE&&l.textContent.trim()!==""?[l]:[...l.childNodes].flatMap(f);return f(o)}function R(o){return normalizeSpacing(o.textContent)}},5539:(w,g,r)=>{r.d(g,{Bt:()=>p,UC:()=>C,hh:()=>N,kl:()=>v,y4:()=>U});var h=r(8738);function b(c,O){c.parentNode.insertBefore(O,c.nextSibling)}function p(c){c.style.display="none"}function m(c,O=1){const P=document.querySelector(c);P&&_(P,O)}function _(c,O=1){const P=getElementAncestor(c,O);P&&p(P)}function u(c){s(c),p(c)}function L(c){c.intersectionObserver||runOnceOnIntersection(c,()=>p(c))}function v(c){c.style.display=""}function E(c){const O=d(c);c.style.display=O}function C(c,O){O?p(c):v(c)}function T(c,O){O?L(c):(clearIntersectionObserver(c),v(c))}function d(c){return s(c),c.dataset.defaultDisplay}function s(c){if(c.dataset.defaultDisplay)return;const{display:O}=getComputedStyle(c);c.dataset.defaultDisplay=O}function R(){return{show:[],hide:[]}}function o(c,O,P){c?O.hide.push(P):O.show.push(P)}function f(c){c.show.forEach(v),c.hide.forEach(p)}function l(c,O,P=.3){O?I(c,P):a(c)}function a(c){c.style.opacity=""}function I(c,O=.3){c.style.opacity=O}function F(c){c.style.order=""}function k(c,O){c.style.order=O}function N(c,O,P,B="inline-flex"){O.style.display=c?B:"none",P.style.display=c?"none":B}function x(c,O){c.style.background=O}function X(c,O){const P=getFirstElement(O);P&&ne(c,P)}function ne(c,O){const P=createLink();P.href=c,O.parentNode.append(P),P.append(O)}function Q(c,O){const P=getFirstElement(O);P&&U(c,P)}function U(c,O,P={}){const B=(0,h.d)(P);B.href=c,B.append(...O.childNodes),O.append(B)}function ee(){const c=getURLQueryParam("scrollTo");if(!c)return;const O=document.getElementById(c);O?O.scrollIntoView():console.log(`Element with ID "${c}" was not found.`)}function $(c,O,P=null){const B=`${O}-click-passed`,G=P?M=>findElementByText(M,c,P):M=>getFirstElement(c,M);return function(M){if(M.hasAttribute(B))return!1;const oe=G(M);return oe&&oe.click(),M.setAttribute(B,""),!0}}function re(c,O,P="text/plain"){const B=new Blob([c],{type:P}),G=URL.createObjectURL(B),M=document.createElement("a");M.href=G,M.download=O,document.body.appendChild(M),M.click(),document.body.removeChild(M),requestAnimationFrame(()=>URL.revokeObjectURL(G))}},6754:(w,g,r)=>{r.d(g,{ZM:()=>h});function h(_,u){Object.assign(_.style,u)}function b(_,u="custom-global-style"){let L=document.getElementById(u);L||(L=document.createElement("style"),L.id=u,L.type="text/css",document.head.appendChild(L)),L.textContent=_}function p(_){return Object.entries(_).map(([u,L])=>`${u.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${L};`).join(" ")}function m(_){return _?_.split(";").filter(u=>u.trim()!=="").reduce((u,L)=>{const[v,E]=L.split(":").map(T=>T.trim()),C=v.replace(/-([a-z])/g,(T,d)=>d.toUpperCase());return u[C]=E,u},{}):{}}},4921:(w,g,r)=>{r.d(g,{Un:()=>_,XW:()=>p,sg:()=>m,wP:()=>v,xk:()=>h});function h(E,C,T=null){const d=E.querySelector(C);return d?Promise.resolve(d):new Promise(s=>{const R=new MutationObserver(f);R.observe(E,{childList:!0,subtree:!0});let o;T&&(o=setTimeout(()=>{R.disconnect(),console.log(`No element found for selector: ${C}`),s(null)},T));function f(){const l=E.querySelector(C);l&&(o&&clearTimeout(o),R.disconnect(),s(l))}})}function b(E,C){return E.querySelector(C)?new Promise(d=>{const s=new MutationObserver(R);s.observe(E,{childList:!0,subtree:!0});function R(){E.querySelector(C)||(s.disconnect(),d())}}):Promise.resolve()}function p(E,C=400){return new Promise(T=>{let d;const s=new MutationObserver(()=>{clearTimeout(d),R()});function R(){d=setTimeout(()=>{s.disconnect(),T()},C)}R(),s.observe(E,{childList:!0,subtree:!0})})}function m(E,C=250){let T;return function(...d){const s=this;clearTimeout(T),T=setTimeout(()=>E.apply(s,d),C)}}async function _(E){document.visibilityState==="visible"?await E():document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&await E()},{once:!0})}function u(E,C){const T=new IntersectionObserver(d=>{d.forEach(s=>{s.isIntersecting&&(C(),L(E))})});E.intersectionObserver=T,T.observe(E)}function L(E){E.intersectionObserver&&(E.intersectionObserver.disconnect(),E.intersectionObserver=null)}function v(E){E&&(E.disconnect(),E=null)}},3789:(w,g,r)=>{r.d(g,{K:()=>h});class h{constructor(p=Date.now(),m=null,_=null,u={}){this.lastCheckDate=p,this.lowestPrice=m,this.highestPrice=_,this.priceHistory=u}get lowestPriceValue(){return this.lowestPrice?this.lowestPrice.value:0}get highestPriceValue(){return this.highestPrice?this.highestPrice.value:0}updateLastCheckDate=()=>{this.lastCheckDate=Date.now()};static fromObject(p){const{lastCheckDate:m,lowestPrice:_,highestPrice:u,priceHistory:L}=p;return new h(m,_,u,L)}}},6001:(w,g,r)=>{r.d(g,{w:()=>b});var h=r(3789);class b extends h.K{constructor(m=Date.now(),_=null,u=null,L={},v=null){super(m,_,u,L),this.rating=v}static fromObject(m){const{lastCheckDate:_,lowestPrice:u,highestPrice:L,priceHistory:v,rating:E}=m;return new b(_,u,L,v,E)}}},9412:(w,g,r)=>{r.d(g,{nF:()=>C,wq:()=>_,xb:()=>u});var h=r(5539),b=r(6700),p=r(8738);function m(T){let d=0,s=0;T.forEach(o=>{d+=o.rating,s+=1});const R=s>0?d/s:0;return roundToPrecision(R)}function _(T){return function(d){const s=(0,b.b$)(d.productId);d.storedRating!==s&&(d.storedRating=s,d.rating=s??d.originalRating,d.ratingWrap&&T(d.ratingWrap,d.rating),C(s,d.dislikeControls))}}function u(T,d,s,R={}){const{needLabel:o,onDislike:f,onRemoveDislike:l,styles:a={}}=R,I=(0,p.kv)(()=>L(d,f),o,a.link,a.dislikeIcon),F=(0,p.yu)(()=>v(d,l),o,a.link,a.removeDislikeIcon);T.append(I,F);const k={dislikeButton:I,removeDislikeButton:F};return C(s,k),k}async function L(T,d){await E(T,1,d)}async function v(T,d){await E(T,null,d)}async function E(T,d,s){(0,b.v7)(T,d),s&&await s(d)}function C(T,d){const{dislikeButton:s,removeDislikeButton:R}=d,o=T!==1;(0,h.hh)(o,s,R)}},157:(w,g,r)=>{r.d(g,{Fg:()=>h,vx:()=>p});const h=window.GM_setValue,b=window.GM.setValue,p=window.GM_getValue},4214:(w,g,r)=>{r.d(g,{zr:()=>b});function h(u){return u.replace(/\D/g,"")}function b(u){return u.replace(/[^\d.,-]/g,"")}function p(u){return u.replace(/\s/g,"")}function m(u){return u.charAt(0).toUpperCase()+u.slice(1)}function _(u){return u.replace(/\s+/g," ").trim()}},5406:(w,g,r)=>{r.d(g,{$F:()=>u,$G:()=>s,C$:()=>p,Fc:()=>h,y_:()=>L,z2:()=>C});function h(o,f="common",l=!1){const{pathname:a}=window.location;return b(a,o,f,l)}function b(o,f,l,a=!1){const I=o.split("/");f=f<0?I.length+f:f;const F=I[f]||l;return a&&console.log(`Pathname element: ${F}`),F}function p(o,f="common",l=!1){const a=h(o,"",l);return m(a,f,l)}function m(o,f,l){if(!o)return f;const a=o.split("-").at(-1);return l&&console.log(`Pathname element ending: ${a}`),a}function _(o,f,l="common",a=!1){const I=b(o,f,"",a);return m(I,l,a)}function u(o){return new URLSearchParams(window.location.search).get(o)}function L(o){return o.split("?")[0]}function v(o){return window.location.pathname.includes(o)}function E(o){return o.some(f=>v(f))}function C(...o){return window.location.pathname.split("/").some(l=>o.includes(l))}function T(o){try{const f=new URL(window.location.href);Object.entries(o).forEach(([l,a])=>{f.searchParams.set(l,a)}),window.location.href=f.toString()}catch(f){console.error("Failed to redirect:",f)}}function d(o,f=[]){const l=new AbortController;let a=!1;const I=k=>{const N=new URL(k),x={pathname:N.pathname};return f.forEach(X=>{x[X]=N.searchParams.get(X)}),x};let F=I(window.location.href);return window.navigation.addEventListener("navigatesuccess",async()=>{if(a)return;const k=I(window.navigation.currentEntry.url);if(Object.keys(F).some(x=>F[x]!==k[x])){F=k,a=!0;try{await o(k)}catch(x){console.error("URL observer error:",x)}finally{a=!1}}},{signal:l.signal}),()=>l.abort()}function s(o,f=[]){const l={pathname:window.location.pathname};f.forEach(N=>{l[N]=u(N)});let a=!1;async function I(){if(a)return;const N={pathname:window.location.pathname};if(f.forEach(x=>{N[x]=u(x)}),Object.keys(l).some(x=>l[x]!==N[x])){Object.assign(l,N),a=!0;try{await o()}catch(x){console.error("Error in URL observer callback:",x)}finally{a=!1}}}function F(){I().catch(N=>{console.error("Error in URL change handler:",N)})}let k=window.location.href;setInterval(()=>{window.location.href!==k&&(console.log("URL changed:",window.location.href),k=window.location.href,F())},200),window.addEventListener("popstate",F)}function R(o=[]){s(()=>window.location.reload(),o)}},4082:(w,g,r)=>{r.d(g,{A:()=>b});const h=(p,m,_=[])=>{const u=document.createElementNS("http://www.w3.org/2000/svg",p);return Object.keys(m).forEach(L=>{u.setAttribute(L,String(m[L]))}),_.length&&_.forEach(L=>{const v=h(...L);u.appendChild(v)}),u};var b=([p,m,_])=>h(p,m,_)},1426:(w,g,r)=>{r.d(g,{A:()=>h});const h={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"}},9898:(w,g,r)=>{r.d(g,{A:()=>b});var h=r(1426);const b=["svg",h.A,[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]]]},9319:(w,g,r)=>{r.d(g,{A:()=>b});var h=r(1426);const b=["svg",h.A,[["path",{d:"M17 14V2"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z"}]]]}},ue={};function z(w){var g=ue[w];if(g!==void 0)return g.exports;var r=ue[w]={exports:{}};return me[w](r,r.exports,z),r.exports}(()=>{var w=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",g=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",r=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",h=p=>{p&&p.d<1&&(p.d=1,p.forEach(m=>m.r--),p.forEach(m=>m.r--?m.r++:m()))},b=p=>p.map(m=>{if(m!==null&&typeof m=="object"){if(m[w])return m;if(m.then){var _=[];_.d=0,m.then(v=>{u[g]=v,h(_)},v=>{u[r]=v,h(_)});var u={};return u[w]=v=>v(_),u}}var L={};return L[w]=v=>{},L[g]=m,L});z.a=(p,m,_)=>{var u;_&&((u=[]).d=-1);var L=new Set,v=p.exports,E,C,T,d=new Promise((s,R)=>{T=R,C=s});d[g]=v,d[w]=s=>(u&&s(u),L.forEach(s),d.catch(R=>{})),p.exports=d,m(s=>{E=b(s);var R,o=()=>E.map(l=>{if(l[r])throw l[r];return l[g]}),f=new Promise(l=>{R=()=>l(o),R.r=0;var a=I=>I!==u&&!L.has(I)&&(L.add(I),I&&!I.d&&(R.r++,I.push(R)));E.map(I=>I[w](a))});return R.r?f:o()},s=>(s?T(d[r]=s):C(v),h(u))),u&&u.d<0&&(u.d=0)}})(),z.d=(w,g)=>{for(var r in g)z.o(g,r)&&!z.o(w,r)&&Object.defineProperty(w,r,{enumerable:!0,get:g[r]})},z.o=(w,g)=>Object.prototype.hasOwnProperty.call(w,g);var Ge=z(9830)})();})();
