// ==UserScript==
// @name         Aliexpress product cards filter
// @description  Hide product cards by filter
// @grant        GM_addStyle
// @grant        GM_deleteValue
// @grant        GM_listValues
// @grant        GM_addValueChangeListener
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://aliexpress.ru/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.76963183
// @icon         https://www.google.com/s2/favicons?sz=64&domain=aliexpress.ru
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/ali.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var be={9830:(v,g,f)=>{f.a(v,async(F,O)=>{try{var y=f(5406),p=f(4921),R=f(5027),C=f(6737);(0,R.N)(),await(0,p.Un)(T),(0,y.k1)(async()=>{await T(!0)});async function T(b=!1){(0,y.z2)("category","store","wholesale")&&await(0,C.P)(b)}O()}catch(T){O(T)}},1)},5027:(v,g,f)=>{f.d(g,{N:()=>F});function F(){window.GM_addStyle(`        
        .userscript-control {
            color: #898993 !important;
            
            &:hover {
                color: #547dff !important;
            }
        }
        
        #customFiltersContainer {
          padding: 8px 0px 8px 3px !important;
        }
        
        [class*="RedSeoFilter_TopPanel__container__"] #customFiltersContainer {
          padding: 5px 0px 18px 3px !important;
        }
        
        [class*="RedFilter_FilterHeader__filterHeaderContainer__"] {
          padding: 0 !important;
        }
        
        [class*="RedFilter_RedFilter__topPadding__"] {
          padding-top: 2px !important;
        }
    `)}},6737:(v,g,f)=>{f.d(g,{P:()=>ut});var F=f(4921);const O={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const y=["svg",O,[["path",{d:"M17 14V2"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z"}]]];function p(e,t){Object.assign(e.style,t)}function R(e,t="custom-global-style"){let n=document.getElementById(t);n||(n=document.createElement("style"),n.id=t,n.type="text/css",document.head.appendChild(n)),n.textContent=e}function C(e){return Object.entries(e).map(([t,n])=>`${t.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${n};`).join(" ")}function T(e){return e?e.split(";").filter(t=>t.trim()!=="").reduce((t,n)=>{const[r,o]=n.split(":").map(l=>l.trim()),i=r.replace(/-([a-z])/g,(l,S)=>S.toUpperCase());return t[i]=o,t},{}):{}}function b(e,t,n=null){if(typeof t!="object"||t===null)throw new TypeError("styles should be an object");const r=document.createElement(e);return p(r,t),n&&(r.innerHTML=n),r}const s=(e,t,n=[])=>{const r=document.createElementNS("http://www.w3.org/2000/svg",e);return Object.keys(t).forEach(o=>{r.setAttribute(o,String(t[o]))}),n.length&&n.forEach(o=>{const i=s(...o);r.appendChild(i)}),r};var w=([e,t,n])=>s(e,t,n);function L(e={},t=null){return createElement("i",e,t)}function E(e,t={}){t.width||="1em",t.height||="1em";const n=w(e);return p(n,t),n}function m(e={},t=null,n=null){const r=b("a",e,t);return n&&(r.href=n),r}function u(e,t=null,n={}){n.cursor||="pointer";const r=m(n,t);return e&&r.addEventListener("click",e),r}function a(e,t,n=null,r={},o={}){r.display||="inline-flex",r.alignItems||="center",r.gap||="0.25em";const i=u(e,n,r);return i.prepend(E(t,o)),i}function h(e,t,n={},r={}){const l=a(S=>{S.stopPropagation(),S.preventDefault(),window.confirm("\u0412\u044B\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u043D\u0438\u0437\u043A\u0438\u0439 \u0440\u0435\u0439\u0442\u0438\u043D\u0433?")&&e()},y,t?"<span>\u0414\u0438\u0437\u043B\u0430\u0439\u043A</span>":null,n,r);return l.classList.add("userscript-control"),l}function d(e={},t=null,n=null){const r=createElement("button",e,t);return n&&r.addEventListener("click",n),r}function A(e,t){e.parentNode.insertBefore(t,e.nextSibling)}function _(e){e.style.display="none"}function q(e,t=1){const n=document.querySelector(e);n&&N(n,t)}function N(e,t=1){const n=getElementAncestor(e,t);n&&_(n)}function k(e){ie(e),_(e)}function we(e){e.intersectionObserver||runOnceOnIntersection(e,()=>_(e))}function G(e){e.style.display=""}function Ft(e){const t=ye(e);e.style.display=t}function Fe(e,t){t?_(e):G(e)}function yt(e,t){t?we(e):(clearIntersectionObserver(e),G(e))}function ye(e){return ie(e),e.defaultDisplay}function ie(e){if(e.defaultDisplay)return;const{display:t}=getComputedStyle(e);e.defaultDisplay=t}function Tt(){return{show:[],hide:[]}}function Lt(e,t,n){e?t.hide.push(n):t.show.push(n)}function St(e){e.show.forEach(G),e.hide.forEach(_)}function Rt(e,t,n=.3){t?Le(e,n):Te(e)}function Te(e){e.style.opacity=""}function Le(e,t=.3){e.style.opacity=t}function Dt(e){e.style.order=""}function Pt(e,t){e.style.order=t}function Ot(e,t){e.style.background=t}function Nt(e,t){const n=getFirstElement(t);n&&Se(e,n)}function Se(e,t){const n=createLink();n.href=e,t.parentNode.append(n),n.append(t)}function xt(e,t){const n=getFirstElement(t);n&&ue(e,n)}function ue(e,t,n={}){const r=m(n);r.href=e,r.append(...t.childNodes),t.append(r)}function It(){const e=getURLQueryParam("scrollTo");if(!e)return;const t=document.getElementById(e);t?t.scrollIntoView():console.log(`Element with ID "${e}" was not found.`)}function At(e,t,n=null){const r=`${t}-click-passed`,o=n?i=>findElementByText(i,e,n):i=>getFirstElement(e,i);return function(i){if(i.hasAttribute(r))return!1;const l=o(i);return l&&l.click(),i.setAttribute(r,""),!0}}function kt(e,t,n="text/plain"){const r=new Blob([e],{type:n}),o=URL.createObjectURL(r),i=document.createElement("a");i.href=o,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),requestAnimationFrame(()=>URL.revokeObjectURL(o))}function Ut(e){return e.replace(/\D/g,"")}function Re(e){return e.replace(/[^\d.,-]/g,"")}function Bt(e){return e.replace(/\s/g,"")}function Mt(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Vt(e){return e.replace(/\s+/g," ").trim()}function $t(e,t=document){return!!t.querySelector(e)}function x(e,t=document,n=!1){const r=t.querySelector(e);return n&&!r&&console.log(`No element found for selector: ${e}`),r}function De(e,t=document,n=!1){const r=t.querySelectorAll(e);return n&&!r.length&&console.log(`No elements found for selector: ${e}`),r}function jt(e,t=1){let n=e;for(let r=0;r<t;r++){if(!n.parentElement)return null;n=n.parentElement}return n}function Wt(e,t,n){return[...e.querySelectorAll(t)].find(r=>r.textContent.trim().includes(n))}function Ht(e,t,n=!1,r=!1,o=null){const i=x(t,e);return z(i,n,r,o)}function z(e,t=!1,n=!1,r=null){if(!e)return r===null?(console.log("No element found"),null):r;const o=e.innerText;return ce(o,t,n)}function Kt(e,t,n=!1){const r=e[t];return z(r,n)}function Gt(e,t=!1,n=!1){const r=e.textContent;return ce(r,t,n)}function ce(e,t,n){t&&(e=Re(e)),n&&(e=e.replace(",","."));const r=Number(e);return Number.isNaN(r)?(console.log(`Invalid number: ${e}`),0):r}function zt(e){return[...e.childNodes].find(t=>t.nodeType===Node.TEXT_NODE)}function Qt(e){const t=n=>n.nodeType===Node.TEXT_NODE&&n.textContent.trim()!==""?[n]:[...n.childNodes].flatMap(t);return t(e)}function Xt(e){return normalizeSpacing(e.textContent)}const U={PRODUCT_LIST_CONTAINER:['[class*="RedFilter_RedFilter__centerBlock__"]','[class*="RedSeoFilter_RedSeoFilter__centerBlock__"]','[class*="ShopFilter_ShopFilter__centerBlock__"]'].join(", "),PRODUCT_LIST_HEADER:['[class*="RedFilter_TopPanel__container__"]','[class*="RedSeoFilter_TopPanel__container__"]','[class*="ShopFilter_TopPanel__container__"]'].join(", "),PRODUCT_LIST:['[class*="red-snippet_RedSnippet__grid__"]'].join(", "),PRODUCT:'[class^="red-snippet_RedSnippet__container__"]',PRODUCT_NAME:'[class^="red-snippet_RedSnippet__title__"]',PRODUCT_RATING_CONTAINER:'[class^="red-snippet_RedSnippet__trust__"]',PRODUCT_RATING_WRAP:":scope > div:has(img) > span",PRODUCT_PURCHASES_WRAP:":scope > div:not(:has(img)) > span"};function Yt(e){if(!e)return[];const n=se(e).flat().filter(r=>r&&!r.isNegative&&r.term).map(r=>r.term);return[...new Set(n)]}function se(e){return e?e.toLowerCase().split(",").map(Pe).filter(Boolean):[]}function Pe(e){const t=e.split("/").map(r=>r.trim()).filter(Boolean);if(t.length===0)return null;const n=t.map(Oe).filter(Boolean);return n.length>0?n:null}function Oe(e){const t=e.startsWith("!"),n=t?e.slice(1).trim():e;return n?{term:n,isNegative:t}:null}function Zt(e,t){ae(e,n=>n.style.display!=="none",t)}function Jt(e,t){ae(e,n=>n.style.opacity==="",t)}function ae(e,t,n){const r=[...e].filter(t).length;n.textContent=`\u041F\u043E\u043A\u0430\u0437\u0430\u043D\u043E: ${r} \u0438\u0437 ${e.length}`}function Ne(e,t){return!xe(e,t)}function xe(e,t){if(!t||!t.value)return!0;const n=se(t.value);return Ie(e,n)}function Ie(e,t){if(!t||!t.length)return!0;const n=(e||"").toLowerCase();return t.every(r=>Ae(n,r))}function Ae(e,t){return t.some(({term:n,isNegative:r})=>{const o=e.includes(n);return r?!o:o})}function le(e,t){return t.value!=null&&e<t.value}function qt(e,t){return t.value!=null&&e>t.value}function en(e,t){return t.value==null?!1:e<parseDateFromISO(t.value)}function tn(e,t){return t.value==null?!1:e>parseDateFromISO(t.value)}function nn(e,t){return t.value&&e!==t.value}function ke(e){let r=2166136261;for(let o=0;o<e.length;o+=1){const i=e.charCodeAt(o);r^=i,r=Math.imul(r,16777619)}return r>>>0}function Ue(e){return ke(e).toString(16).padStart(8,"0")}function Be(e,t="common"){return e?Ue(e):t}const Q={INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px 6px",fontSize:"15px"},CONTROL:{display:"flex",alignItems:"center",fontSize:"14px"}},D={FILTERS_CONTAINER:{display:"flex",justifyContent:"flex-end",gap:"12px"},CONTROL:Q.CONTROL,TEXT_INPUT_CONTROL:{...Q.CONTROL,flexGrow:1},TEXT_INPUT:{...Q.INPUT,flexGrow:1},NUMBER_INPUT:{...Q.INPUT,width:"85px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px",webkitAppearance:"auto"}},fe={DISLIKE_BUTTON:{marginLeft:"auto",gap:"8px"},DISLIKE_BUTTON_ICON_SM:{height:"0.9em",marginTop:"2px"},DISLIKE_BUTTON_ICON_MD:{marginTop:"1px"}};var V=f(5406);function rn(e={},t=null){return createElement("span",e,t)}function de(e={},t=null){return b("div",e,t)}function $(e,t={},n=null){const r=de(t,n);return r.append(e),r}function on(e,t=null,n={},r={}){const o=createActionLink(e,t,r);return $(o,n)}function un(e,t=null,n=null,r={},o={},i={}){const l=createActionLinkWithIcon(e,n,t,o,i);return $(l,r)}function Me(e,t,n){const r=X(e,"text",t);return r.value=n,r}function Ve(e,t,n,r,o,i){const l=X(e,"number",t);return l.value=n,l.step=r,l.min=o,l.max=i,l}function cn(e,t,n){const r=X(e,"date",t);return r.value=n,r}function $e(e,t,n){const r=X(e,"checkbox",t);return r.checked=n,r}function X(e={},t=null,n=null){const r=b("input",e);return t&&(r.type=t),n&&(r.addEventListener("keyup",(0,F.sg)(n,200)),r.addEventListener("change",(0,F.sg)(n,100))),r}function sn(e,t,n){const r=createElement("select",e);return t&&r.addEventListener("change",t),r.value=n,r}function je(e,t,n={},r={}){const o=Me(r,t.updateValueFromEvent,t.value);return $(o,n,e)}function ee(e,t,n,r,o,i={},l={}){const S=Ve(l,t.updateValueFromEvent,t.value,n,r,o);return $(S,i,e)}function an(e,t,n={},r={}){const o=createSelect(r,t.updateValueFromEvent,t.value);return createControl(o,n,e)}function ln(e,t,n={},r={}){const o=createDateInput(r,t.updateValueFromEvent,t.value);return createControl(o,n,e)}function We(e,t,n={},r={}){const o=$e(r,t.updateValueFromEvent,t.value);return $(o,n,e)}function He(e,t={},n={}){return je("\u041F\u043E\u0438\u0441\u043A: ",e,t,n)}function Ke(e,t={},n={},r=.1,o=3){return ee("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",e,r,o,5,t,n)}function fn(e,t={},n={},r=.1,o=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",e,r,o,5,t,n)}function dn(e,t={},n={}){return pe("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",e,t,n)}function pn(e,t={},n={}){return pe("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",e,t,n)}function pe(e,t,n={},r={}){return createNumberFilterControl(e,t,"1","1","999999",n,r)}function mn(e,t={},n={}){return createDateFilterControl("\u041C\u0438\u043D. \u0434\u0430\u0442\u0430: ",e,t,n)}function hn(e,t={},n={}){return Ge("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",e,t,n)}function Ge(e,t,n={},r={}){return createNumberFilterControl(e,t,"5","0","100",n,r)}function gn(e,t={},n={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",e,"5","0","100",t,n)}function me(e,t,n={},r={},o="250"){return createNumberFilterControl(e,t,o,"0","1000000",n,r)}function En(e,t={},n={},r="25"){return me("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",e,t,n,r)}function Cn(e,t={},n={},r="25"){return me("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",e,t,n,r)}function _n(e,t={},n={}){return ze("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",e,t,n)}function ze(e,t,n={},r={}){return createNumberFilterControl(e,t,"1","0","99999",n,r)}function vn(e,t={},n={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",e,"1","2","8",t,n)}function Qe(e,t={},n={}){return ee("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",e,1,1,10,t,n)}function bn(e,t={},n={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",e,t,n)}function wn(e,t={},n={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",e,t,n)}function Fn(e,t={},n={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",e,t,n)}function yn(e,t={},n={}){return createCheckboxFilterControl("\u0411\u043E\u043D\u0443\u0441: ",e,t,n)}function Tn(e,t={},n={}){return createCheckboxFilterControl("\u0412 \u043D\u0430\u043B\u0438\u0447\u0438\u0438: ",e,t,n)}function Xe(e,t={},n={}){return We("\u0412\u043A\u043B: ",e,t,n)}function Ln(e,t,n={}){const r=[{value:-25,emoji:"\u{1F48E}",tooltip:"\u0421\u0443\u043F\u0435\u0440 \u0446\u0435\u043D\u0430 (-25%)"},{value:-15,emoji:"\u{1F525}",tooltip:"\u041E\u0442\u043B\u0438\u0447\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-15%)"},{value:-5,emoji:"\u{1F31F}",tooltip:"\u041A\u043B\u0430\u0441\u0441\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-5%)"},{value:5,emoji:"\u{1F44C}",tooltip:"\u0425\u043E\u0440\u043E\u0448\u0430\u044F \u0446\u0435\u043D\u0430 (+5%)"}],o={active:{background:"#e3f2fd",borderColor:"#2196f3",boxShadow:"0 0 0 1px #2196f3"},inactive:{background:"#fff",borderColor:"#ccc",boxShadow:"none"},hover:{background:"#f5f5f5"}},i=createDiv({display:"inline-flex",gap:"4px",marginLeft:"4px"}),l=[],S=()=>t?parseFloat(t.value)||0:e.value,I=()=>{const B=S();l.forEach(({button:H,value:K})=>{const J=K<=B?o.active:o.inactive;Object.assign(H.style,J)})};return r.forEach(({value:B,emoji:H,tooltip:K})=>{const P=createButton({padding:"2px 6px",fontSize:"16px",cursor:"pointer",border:"1px solid #ccc",borderRadius:"4px",background:"#fff",transition:"all 0.2s",...n},H);P.title=K,P.type="button",P.addEventListener("click",J=>{J.preventDefault(),e.updateValue(B),t&&(t.value=B),I()}),P.addEventListener("mouseenter",()=>{B<=S()||(P.style.background=o.hover.background)}),P.addEventListener("mouseleave",()=>{I()}),l.push({button:P,value:B}),i.appendChild(P)}),I(),t&&(t.addEventListener("input",I),t.addEventListener("change",I)),i}function Ye(e,t,n=!1,r="customFiltersContainer"){let o=x(`#${r}`,e);if(o)if(n)o.remove();else return;o=de(),o.id=r,t(o,e)}class Ze{constructor(t,n){this.value=t,this.onChange=n}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}function Je(e){const{target:t}=e,{type:n}=t;switch(n){case"text":return`"${t.value}"`;case"number":return t.value;case"select-one":return t.value;case"date":return`"${t.value}"`;case"checkbox":return t.checked;default:return console.log(`Unknown input type: ${n}`),null}}function qe(e){return e===""?null:JSON.parse(e)}const te=window.GM_setValue,Sn=window.GM.setValue,ne=window.GM_getValue;class j extends Ze{constructor(t,n=null,r=null){super(ne(t,n),r),this.storageKey=t,this.defaultValue=n}static create(t,n=null,r=null){return new j(t,n,r)}static createWithCompositeKey(t,n,r=null,o=null){const i=`${t}-${n}`;return new j(i,r,o)}updateValueFromEvent=t=>{const n=Je(t),r=qe(n);this.updateValue(r)};updateValue(t,n=!0){this.value!==t&&(te(this.storageKey,t),this.value=t,n&&this.onChangeIfDefined())}clearValue(t=!1){this.updateValue(null,t)}resetValue(t=!1){this.updateValue(this.defaultValue,t)}}function et(e,t=null){return{createGlobalFilter(n,r=null,o=e){return j.create(n,r,o)},createSectionFilter(n,r=null,o=e){if(!t)throw new Error("sectionId must be provided to use createSectionFilter.");return j.createWithCompositeKey(t,n,r,o)}}}class re{constructor(t=Date.now(),n=null,r=null,o={}){this.lastCheckDate=t,this.lowestPrice=n,this.highestPrice=r,this.priceHistory=o}get lowestPriceValue(){return this.lowestPrice?this.lowestPrice.value:0}get highestPriceValue(){return this.highestPrice?this.highestPrice.value:0}updateLastCheckDate=()=>{this.lastCheckDate=Date.now()};static fromObject(t){const{lastCheckDate:n,lowestPrice:r,highestPrice:o,priceHistory:i}=t;return new re(n,r,o,i)}}class Y extends re{constructor(t=Date.now(),n=null,r=null,o={},i=null){super(t,n,r,o),this.rating=i}static fromObject(t){const{lastCheckDate:n,lowestPrice:r,highestPrice:o,priceHistory:i,rating:l}=t;return new Y(n,r,o,i,l)}}const he=window.GM_listValues;function Rn(e,t,n=!1){getStorageValue("dbVersion")!==t&&(e(),!n&&setStorageValue("dbVersion",t))}function Dn(e,t=!0){const n=he();ge(n,e,t)}function tt(e,t,n=!0){const o=he().filter(e);ge(o,t,n)}function ge(e,t,n){let r=0;e.forEach(o=>{const i=getStorageValue(o);n&&console.log(o,i),t(o,i),r+=1}),n&&console.log(`Total entries processed: ${r}`)}function Pn(e,t=!1){tt(e,r=>{t||window.GM_deleteValue(r)})}const Z={LAST_RATE_UPDATE:"last-rate-update",REVIEWS_LAST_PRODUCT_ARTICLE:"reviews-last-product-article"};function nt(e,t){const n=Ee(e),r=ne(n),o=rt(r);o.rating=t,o.updateLastCheckDate(),te(n,o),te(Z.LAST_RATE_UPDATE,Date.now())}function Ee(e){return`product-${e}`}function rt(e){return e?Y.fromObject(e):new Y}function ot(e){const t=Ee(e);return ne(t)}function Ce(e){return ot(e)?.rating??null}function On(e){return setStorageValue(Z.REVIEWS_LAST_PRODUCT_ARTICLE,e)}function Nn(){return getStorageValue(Z.REVIEWS_LAST_PRODUCT_ARTICLE)}function xn(){const e=o=>o.startsWith("product-"),t=[],n=(o,i)=>{new Date(i.lastCheckDate)<getDateMonthsAgo(9)&&t.push(i.lastCheckDate)};processEntriesByKeyFilter(e,n,!1),[...t].sort((o,i)=>new Date(o)-new Date(i)).forEach(o=>{console.log(new Date(o).toLocaleDateString())})}const it=window.GM_addValueChangeListener,c={productsListContainer:null,productListObserver:null,containerObserver:null,isFiltersInitialized:!1,filters:{nameFilter:null,minPurchasesFilter:null,minRatingFilter:null,maxNameLines:null,filterEnabled:null},productCardsCache:new WeakMap};async function ut(e){e&&bt(),ct(),lt()}function ct(){if(!c.isFiltersInitialized){const e=st(),{createGlobalFilter:t,createSectionFilter:n}=et(W,e);c.filters.nameFilter=n("name-filter"),c.filters.minPurchasesFilter=n("min-purchases-filter"),c.filters.minRatingFilter=n("min-rating-filter",4.8),c.filters.maxNameLines=t("max-name-lines",4),c.filters.filterEnabled=n("filter-enabled",!0),c.isFiltersInitialized=!0}}function st(){return Be(at())}function at(){return(0,V.z2)("store")?(0,V.Fc)(2):(0,V.z2)("category")?(0,V.Fc)(3):(0,V.z2)("wholesale")?(0,V.$F)("SearchText"):"common"}function lt(){c.productsListContainer=x(U.PRODUCT_LIST_CONTAINER),c.productsListContainer&&(_e(),c.containerObserver=new MutationObserver((0,F.sg)(_e)),c.containerObserver.observe(c.productsListContainer,{childList:!0,subtree:!0}))}function _e(){const e=x(U.PRODUCT_LIST_HEADER,c.productsListContainer);if(!e)return;const t=x(U.PRODUCT_LIST,c.productsListContainer);t&&(Ye(e,ft),it(Z.LAST_RATE_UPDATE,()=>W(!0)),W(),c.productListObserver&&(0,F.wP)(c.productListObserver),c.productListObserver=new MutationObserver(W),c.productListObserver.observe(t,{childList:!0}))}function ft(e,t){p(e,D.FILTERS_CONTAINER);const n=He(c.filters.nameFilter,D.TEXT_INPUT_CONTROL,D.TEXT_INPUT),r=ee("\u041C\u0438\u043D. \u043F\u043E\u043A\u0443\u043F\u043E\u043A: ",c.filters.minPurchasesFilter,"1","1","999999",D.CONTROL,D.NUMBER_INPUT),o=Ke(c.filters.minRatingFilter,D.CONTROL,D.NUMBER_INPUT),i=Qe(c.filters.maxNameLines,D.CONTROL,D.NUMBER_INPUT),l=Xe(c.filters.filterEnabled,D.CONTROL,D.CHECKBOX_INPUT);e.append(n,r,o,i,l),t.append(e)}function W(e=!1){De(U.PRODUCT).forEach(n=>{dt(n,e)})}function dt(e,t){if(!c.filters.filterEnabled.value){G(e);return}let n=c.productCardsCache.get(e);if(n)t&&vt(n);else{const o=x("a",e),i=x(U.PRODUCT_NAME,e),l=x(U.PRODUCT_RATING_CONTAINER,e);if(!o||!i||!l){_(e);return}const S=i.innerText,{productId:I}=e.dataset,{ratingWrap:B,purchasesCount:H,rating:K,storedRating:P}=pt(l,o,I);n={productId:I,nameWrap:i,name:S,ratingWrap:B,purchasesCount:H,rating:K,storedRating:P},c.productCardsCache.set(e,n)}Et(n.nameWrap);const r=Ne(n.name,c.filters.nameFilter)||le(n.purchasesCount,c.filters.minPurchasesFilter)||le(n.rating,c.filters.minRatingFilter);Fe(e,r)}function pt(e,t,n){const r=x(U.PRODUCT_PURCHASES_WRAP,e),o=z(r,!0,!1,0);if(r){const I=(0,V.y_)(t.getAttribute("href"));mt(r,I,n)}const i=Ce(n),l=x(U.PRODUCT_RATING_WRAP,e),S=gt(i,l);return Ct(e,n),{ratingWrap:l,purchasesCount:o,rating:S,storedRating:i}}function mt(e,t,n){const r=ht(t,n);ue(r,e)}function ht(e,t){const n=new URL(e),r=n.pathname.split("/");return`${n.origin}/${r[1]}/${t}/reviews`}function gt(e,t){return e?(t&&ve(t,e),e):z(t,!0,!1,0)}function ve(e,t){e.textContent=t.toString().padEnd(5)}function Et(e){const t=c.filters.maxNameLines.value,r=t*16;e.style.height=`${r}px`,e.style.maxHeight=`${r}px`,e.style.webkitLineClamp=t}function Ct(e,t){if(!t)return;const n=h(()=>_t(t),!1,fe.DISLIKE_BUTTON,fe.DISLIKE_BUTTON_ICON_MD);e.append(n)}async function _t(e){nt(e,1),W(!0)}function vt(e){const t=Ce(e.productId);t&&(e.storedRating=t,e.rating=t,e.ratingWrap&&ve(e.ratingWrap,t))}function bt(){c.productsListContainer=null,c.isFiltersInitialized=!1,c.filters={nameFilter:null,minPurchasesFilter:null,minRatingFilter:null,maxNameLines:null,filterEnabled:null},c.productCardsCache=new WeakMap,(0,F.wP)(c.containerObserver),(0,F.wP)(c.productListObserver)}},4921:(v,g,f)=>{f.d(g,{Un:()=>R,sg:()=>p,wP:()=>b});function F(s,w,L=null){const E=s.querySelector(w);return E?Promise.resolve(E):new Promise(m=>{const u=new MutationObserver(h);u.observe(s,{childList:!0,subtree:!0});let a;L&&(a=setTimeout(()=>{u.disconnect(),console.log(`No element found for selector: ${w}`),m(null)},L));function h(){const d=s.querySelector(w);d&&(a&&clearTimeout(a),u.disconnect(),m(d))}})}function O(s,w){return s.querySelector(w)?new Promise(E=>{const m=new MutationObserver(u);m.observe(s,{childList:!0,subtree:!0});function u(){s.querySelector(w)||(m.disconnect(),E())}}):Promise.resolve()}function y(s,w=400){return new Promise(L=>{let E;const m=new MutationObserver(()=>{clearTimeout(E),u()});function u(){E=setTimeout(()=>{m.disconnect(),L()},w)}u(),m.observe(s,{childList:!0,subtree:!0})})}function p(s,w=250){let L;return function(...E){const m=this;clearTimeout(L),L=setTimeout(()=>s.apply(m,E),w)}}async function R(s){document.visibilityState==="visible"?await s():document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&await s()},{once:!0})}function C(s,w){const L=new IntersectionObserver(E=>{E.forEach(m=>{m.isIntersecting&&(w(),T(s))})});s.intersectionObserver=L,L.observe(s)}function T(s){s.intersectionObserver&&(s.intersectionObserver.disconnect(),s.intersectionObserver=null)}function b(s){s&&(s.disconnect(),s=null)}},5406:(v,g,f)=>{f.d(g,{$F:()=>C,Fc:()=>F,k1:()=>E,y_:()=>T,z2:()=>w});function F(u,a="common",h=!1){const{pathname:d}=window.location;return O(d,u,a,h)}function O(u,a,h,d=!1){const A=u.split("/");a=a<0?A.length+a:a;const _=A[a]||h;return d&&console.log(`Pathname element: ${_}`),_}function y(u,a="common",h=!1){const d=F(u,"",h);return p(d,a,h)}function p(u,a,h){if(!u)return a;const d=u.split("-").at(-1);return h&&console.log(`Pathname element ending: ${d}`),d}function R(u,a,h="common",d=!1){const A=O(u,a,"",d);return p(A,h,d)}function C(u){return new URLSearchParams(window.location.search).get(u)}function T(u){return u.split("?")[0]}function b(u){return window.location.pathname.includes(u)}function s(u){return u.some(a=>b(a))}function w(...u){return window.location.pathname.split("/").some(h=>u.includes(h))}function L(u){try{const a=new URL(window.location.href);Object.entries(u).forEach(([h,d])=>{a.searchParams.set(h,d)}),window.location.href=a.toString()}catch(a){console.error("Failed to redirect:",a)}}function E(u,a=[]){const h={pathname:window.location.pathname};a.forEach(N=>{h[N]=C(N)});let d=!1;async function A(){if(d)return;const N={pathname:window.location.pathname};if(a.forEach(k=>{N[k]=C(k)}),Object.keys(h).some(k=>h[k]!==N[k])){Object.assign(h,N),d=!0;try{await u()}catch(k){console.error("Error in URL observer callback:",k)}finally{d=!1}}}function _(){A().catch(N=>{console.error("Error in URL change handler:",N)})}let q=window.location.href;setInterval(()=>{window.location.href!==q&&(q=window.location.href,_())},200),window.addEventListener("popstate",_)}function m(u=[]){E(()=>window.location.reload(),u)}}},oe={};function M(v){var g=oe[v];if(g!==void 0)return g.exports;var f=oe[v]={exports:{}};return be[v](f,f.exports,M),f.exports}(()=>{var v=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",g=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",f=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",F=y=>{y&&y.d<1&&(y.d=1,y.forEach(p=>p.r--),y.forEach(p=>p.r--?p.r++:p()))},O=y=>y.map(p=>{if(p!==null&&typeof p=="object"){if(p[v])return p;if(p.then){var R=[];R.d=0,p.then(b=>{C[g]=b,F(R)},b=>{C[f]=b,F(R)});var C={};return C[v]=b=>b(R),C}}var T={};return T[v]=b=>{},T[g]=p,T});M.a=(y,p,R)=>{var C;R&&((C=[]).d=-1);var T=new Set,b=y.exports,s,w,L,E=new Promise((m,u)=>{L=u,w=m});E[g]=b,E[v]=m=>(C&&m(C),T.forEach(m),E.catch(u=>{})),y.exports=E,p(m=>{s=O(m);var u,a=()=>s.map(d=>{if(d[f])throw d[f];return d[g]}),h=new Promise(d=>{u=()=>d(a),u.r=0;var A=_=>_!==C&&!T.has(_)&&(T.add(_),_&&!_.d&&(u.r++,_.push(u)));s.map(_=>_[v](A))});return u.r?h:a()},m=>(m?L(E[f]=m):w(b),F(C))),C&&C.d<0&&(C.d=0)}})(),M.d=(v,g)=>{for(var f in g)M.o(g,f)&&!M.o(v,f)&&Object.defineProperty(v,f,{enumerable:!0,get:g[f]})},M.o=(v,g)=>Object.prototype.hasOwnProperty.call(v,g);var wt=M(9830)})();})();
