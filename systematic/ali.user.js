// ==UserScript==
// @name         Aliexpress product cards filter
// @description  Hide product cards by filter
// @grant        GM_addStyle
// @grant        GM_deleteValue
// @grant        GM_listValues
// @grant        GM_addValueChangeListener
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://aliexpress.ru/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.76970372
// @icon         https://www.google.com/s2/favicons?sz=64&domain=aliexpress.ru
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/ali.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var de={9830:(O,E,o)=>{o.a(O,async(p,R)=>{try{var T=o(5406),d=o(4921),C=o(5027),u=o(1489),_=o(7708);(0,C.Ng)(),await(0,d.Un)(m),(0,T.k1)(async()=>{await m(!0)});async function m(c=!1){if(await(0,d.XW)(document.head),(0,T.z2)("category","store","wholesale")){await(0,u.P)(c);return}(0,T.z2)("item")&&await(0,_.K)(c)}R()}catch(m){R(m)}},1)},5027:(O,E,o)=>{o.d(E,{Ng:()=>R,nF:()=>d,px:()=>T});var p=o(5406);function R(){window.GM_addStyle(`        
        .userscript-control {
            color: #898993 !important;
            
            &:hover {
                color: #547dff !important;
            }
        }
        
        #customFiltersContainer {
          padding: 8px 0px 8px 3px !important;
        }
        
        [class*="RedSeoFilter_TopPanel__container__"] #customFiltersContainer {
          padding: 5px 0px 18px 3px !important;
        }
        
        [class*="RedFilter_FilterHeader__filterHeaderContainer__"] {
          padding: 0 !important;
        }
        
        [class*="RedFilter_RedFilter__topPadding__"] {
          padding-top: 2px !important;
        }
        
        span[class*="rating_Rating__rating__"] + span[class*="red-ali-kit_Body__M__"] {
          padding-top: 1px !important;
        }
    `)}function T(){return(0,p.C$)(2,"unknown").replace(".html","")}function d(C,u,_){const m=C===1;u.style.display=m?"none":"inline-flex",_.style.display=m?"inline-flex":"none"}},7549:(O,E,o)=>{o.d(E,{r:()=>p});const p={DISLIKE_CONTROL:{marginLeft:"auto",gap:"3px"},DISLIKE_BUTTON_ICON_SM:{height:"0.9em",marginBottom:"1px",marginRight:"2px"},DISLIKE_BUTTON_ICON_MD:{marginTop:"1px"},REMOVE_DISLIKE_BUTTON_ICON_SM:{height:"0.9em",marginBottom:"1px"},REMOVE_DISLIKE_BUTTON_ICON_MD:{marginBottom:"1px"}}},1489:(O,E,o)=>{o.d(E,{P:()=>Ke});var p=o(4921),R=o(8738);function T(e,t){e.parentNode.insertBefore(t,e.nextSibling)}function d(e){e.style.display="none"}function C(e,t=1){const n=document.querySelector(e);n&&u(n,t)}function u(e,t=1){const n=getElementAncestor(e,t);n&&d(n)}function _(e){s(e),d(e)}function m(e){e.intersectionObserver||runOnceOnIntersection(e,()=>d(e))}function c(e){e.style.display=""}function l(e){const t=f(e);e.style.display=t}function L(e,t){t?d(e):c(e)}function v(e,t){t?m(e):(clearIntersectionObserver(e),c(e))}function f(e){return s(e),e.dataset.defaultDisplay}function s(e){if(e.dataset.defaultDisplay)return;const{display:t}=getComputedStyle(e);e.dataset.defaultDisplay=t}function i(){return{show:[],hide:[]}}function h(e,t,n){e?t.hide.push(n):t.show.push(n)}function a(e){e.show.forEach(c),e.hide.forEach(d)}function F(e,t,n=.3){t?I(e,n):b(e)}function b(e){e.style.opacity=""}function I(e,t=.3){e.style.opacity=t}function w(e){e.style.order=""}function M(e,t){e.style.order=t}function ut(e,t){e.style.background=t}function st(e,t){const n=getFirstElement(t);n&&fe(e,n)}function fe(e,t){const n=createLink();n.href=e,t.parentNode.append(n),n.append(t)}function at(e,t){const n=getFirstElement(t);n&&ee(e,n)}function ee(e,t,n={}){const r=(0,R.d)(n);r.href=e,r.append(...t.childNodes),t.append(r)}function ct(){const e=getURLQueryParam("scrollTo");if(!e)return;const t=document.getElementById(e);t?t.scrollIntoView():console.log(`Element with ID "${e}" was not found.`)}function lt(e,t,n=null){const r=`${t}-click-passed`,g=n?D=>findElementByText(D,e,n):D=>getFirstElement(e,D);return function(D){if(D.hasAttribute(r))return!1;const S=g(D);return S&&S.click(),D.setAttribute(r,""),!0}}function dt(e,t,n="text/plain"){const r=new Blob([e],{type:n}),g=URL.createObjectURL(r),D=document.createElement("a");D.href=g,D.download=t,document.body.appendChild(D),D.click(),document.body.removeChild(D),requestAnimationFrame(()=>URL.revokeObjectURL(g))}var P=o(573);const U={PRODUCT_LIST_CONTAINER:['[class*="RedFilter_RedFilter__centerBlock__"]','[class*="RedSeoFilter_RedSeoFilter__centerBlock__"]','[class*="ShopFilter_ShopFilter__centerBlock__"]'].join(", "),PRODUCT_LIST_HEADER:['[class*="RedFilter_TopPanel__container__"]','[class*="RedSeoFilter_TopPanel__container__"]','[class*="ShopFilter_TopPanel__container__"]'].join(", "),PRODUCT_LIST:['[class*="red-snippet_RedSnippet__grid__"]'].join(", "),PRODUCT:'[class^="red-snippet_RedSnippet__container__"]',PRODUCT_NAME:'[class^="red-snippet_RedSnippet__title__"]',PRODUCT_RATING_CONTAINER:'[class^="red-snippet_RedSnippet__trust__"]',PRODUCT_RATING_WRAP:":scope > div:has(img) > span",PRODUCT_PURCHASES_WRAP:":scope > div:not(:has(img)) > span"};function ft(e){if(!e)return[];const n=te(e).flat().filter(r=>r&&!r.isNegative&&r.term).map(r=>r.term);return[...new Set(n)]}function te(e){return e?e.toLowerCase().split(",").map(pe).filter(Boolean):[]}function pe(e){const t=e.split("/").map(r=>r.trim()).filter(Boolean);if(t.length===0)return null;const n=t.map(me).filter(Boolean);return n.length>0?n:null}function me(e){const t=e.startsWith("!"),n=t?e.slice(1).trim():e;return n?{term:n,isNegative:t}:null}function pt(e,t){ne(e,n=>n.style.display!=="none",t)}function mt(e,t){ne(e,n=>n.style.opacity==="",t)}function ne(e,t,n){const r=[...e].filter(t).length;n.textContent=`\u041F\u043E\u043A\u0430\u0437\u0430\u043D\u043E: ${r} \u0438\u0437 ${e.length}`}function he(e,t){return!ge(e,t)}function ge(e,t){if(!t||!t.value)return!0;const n=te(t.value);return Ee(e,n)}function Ee(e,t){if(!t||!t.length)return!0;const n=(e||"").toLowerCase();return t.every(r=>_e(n,r))}function _e(e,t){return t.some(({term:n,isNegative:r})=>{const g=e.includes(n);return r?!g:g})}function re(e,t){return t.value!=null&&e<t.value}function ht(e,t){return t.value!=null&&e>t.value}function gt(e,t){return t.value==null?!1:e<parseDateFromISO(t.value)}function Et(e,t){return t.value==null?!1:e>parseDateFromISO(t.value)}function _t(e,t){return t.value&&e!==t.value}function Ce(e){let r=2166136261;for(let g=0;g<e.length;g+=1){const D=e.charCodeAt(g);r^=D,r=Math.imul(r,16777619)}return r>>>0}function ve(e){return Ce(e).toString(16).padStart(8,"0")}function Re(e,t="common"){return e?ve(e):t}var Te=o(6754);const Q={INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px 6px",fontSize:"15px"},CONTROL:{display:"flex",alignItems:"center",fontSize:"14px"}},N={FILTERS_CONTAINER:{display:"flex",justifyContent:"flex-end",gap:"12px"},CONTROL:Q.CONTROL,TEXT_INPUT_CONTROL:{...Q.CONTROL,flexGrow:1},TEXT_INPUT:{...Q.INPUT,flexGrow:1},NUMBER_INPUT:{...Q.INPUT,width:"85px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px",webkitAppearance:"auto"}};var Y=o(7549),K=o(5406),oe=o(7273);function H(e,t={},n=null){const r=(0,oe.S)(t,n);return r.append(e),r}function Ct(e,t=null,n={},r={}){const g=createActionLink(e,t,r);return H(g,n)}function vt(e,t=null,n=null,r={},g={},D={}){const S=createActionLinkWithIcon(e,n,t,g,D);return H(S,r)}var Fe=o(5558);function De(e,t,n){const r=Z(e,"text",t);return r.value=n,r}function be(e,t,n,r,g,D){const S=Z(e,"number",t);return S.value=n,S.step=r,S.min=g,S.max=D,S}function Rt(e,t,n){const r=Z(e,"date",t);return r.value=n,r}function Oe(e,t,n){const r=Z(e,"checkbox",t);return r.checked=n,r}function Z(e={},t=null,n=null){const r=(0,Fe.n)("input",e);return t&&(r.type=t),n&&(r.addEventListener("keyup",(0,p.sg)(n,200)),r.addEventListener("change",(0,p.sg)(n,100))),r}function Tt(e,t,n){const r=createElement("select",e);return t&&r.addEventListener("change",t),r.value=n,r}function Le(e,t,n={},r={}){const g=De(r,t.updateValueFromEvent,t.value);return H(g,n,e)}function J(e,t,n,r,g,D={},S={}){const B=be(S,t.updateValueFromEvent,t.value,n,r,g);return H(B,D,e)}function Ft(e,t,n={},r={}){const g=createSelect(r,t.updateValueFromEvent,t.value);return createControl(g,n,e)}function Dt(e,t,n={},r={}){const g=createDateInput(r,t.updateValueFromEvent,t.value);return createControl(g,n,e)}function ye(e,t,n={},r={}){const g=Oe(r,t.updateValueFromEvent,t.value);return H(g,n,e)}function Se(e,t={},n={}){return Le("\u041F\u043E\u0438\u0441\u043A: ",e,t,n)}function Ie(e,t={},n={},r=.1,g=3){return J("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",e,r,g,5,t,n)}function bt(e,t={},n={},r=.1,g=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",e,r,g,5,t,n)}function Ot(e,t={},n={}){return ie("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",e,t,n)}function Lt(e,t={},n={}){return ie("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",e,t,n)}function ie(e,t,n={},r={}){return createNumberFilterControl(e,t,"1","1","999999",n,r)}function yt(e,t={},n={}){return createDateFilterControl("\u041C\u0438\u043D. \u0434\u0430\u0442\u0430: ",e,t,n)}function St(e,t={},n={}){return we("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",e,t,n)}function we(e,t,n={},r={}){return createNumberFilterControl(e,t,"5","0","100",n,r)}function It(e,t={},n={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",e,"5","0","100",t,n)}function ue(e,t,n={},r={},g="250"){return createNumberFilterControl(e,t,g,"0","1000000",n,r)}function wt(e,t={},n={},r="25"){return ue("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",e,t,n,r)}function Pt(e,t={},n={},r="25"){return ue("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",e,t,n,r)}function Nt(e,t={},n={}){return Pe("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",e,t,n)}function Pe(e,t,n={},r={}){return createNumberFilterControl(e,t,"1","0","99999",n,r)}function At(e,t={},n={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",e,"1","2","8",t,n)}function Ne(e,t={},n={}){return J("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",e,1,1,10,t,n)}function xt(e,t={},n={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",e,t,n)}function kt(e,t={},n={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",e,t,n)}function Mt(e,t={},n={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",e,t,n)}function Ut(e,t={},n={}){return createCheckboxFilterControl("\u0411\u043E\u043D\u0443\u0441: ",e,t,n)}function Bt(e,t={},n={}){return createCheckboxFilterControl("\u0412 \u043D\u0430\u043B\u0438\u0447\u0438\u0438: ",e,t,n)}function Ae(e,t={},n={}){return ye("\u0412\u043A\u043B: ",e,t,n)}function Wt(e,t,n={}){const r=[{value:-25,emoji:"\u{1F48E}",tooltip:"\u0421\u0443\u043F\u0435\u0440 \u0446\u0435\u043D\u0430 (-25%)"},{value:-15,emoji:"\u{1F525}",tooltip:"\u041E\u0442\u043B\u0438\u0447\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-15%)"},{value:-5,emoji:"\u{1F31F}",tooltip:"\u041A\u043B\u0430\u0441\u0441\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-5%)"},{value:5,emoji:"\u{1F44C}",tooltip:"\u0425\u043E\u0440\u043E\u0448\u0430\u044F \u0446\u0435\u043D\u0430 (+5%)"}],g={active:{background:"#e3f2fd",borderColor:"#2196f3",boxShadow:"0 0 0 1px #2196f3"},inactive:{background:"#fff",borderColor:"#ccc",boxShadow:"none"},hover:{background:"#f5f5f5"}},D=createDiv({display:"inline-flex",gap:"4px",marginLeft:"4px"}),S=[],B=()=>t?parseFloat(t.value)||0:e.value,x=()=>{const k=B();S.forEach(({button:V,value:X})=>{const j=X<=k?g.active:g.inactive;Object.assign(V.style,j)})};return r.forEach(({value:k,emoji:V,tooltip:X})=>{const A=createButton({padding:"2px 6px",fontSize:"16px",cursor:"pointer",border:"1px solid #ccc",borderRadius:"4px",background:"#fff",transition:"all 0.2s",...n},V);A.title=X,A.type="button",A.addEventListener("click",j=>{j.preventDefault(),e.updateValue(k),t&&(t.value=k),x()}),A.addEventListener("mouseenter",()=>{k<=B()||(A.style.background=g.hover.background)}),A.addEventListener("mouseleave",()=>{x()}),S.push({button:A,value:k}),D.appendChild(A)}),x(),t&&(t.addEventListener("input",x),t.addEventListener("change",x)),D}function xe(e,t,n=!1,r="customFiltersContainer"){let g=(0,P.Fi)(`#${r}`,e);if(g)if(n)g.remove();else return;g=(0,oe.S)(),g.id=r,t(g,e)}class ke{constructor(t,n){this.value=t,this.onChange=n}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}function Me(e){const{target:t}=e,{type:n}=t;switch(n){case"text":return`"${t.value}"`;case"number":return t.value;case"select-one":return t.value;case"date":return`"${t.value}"`;case"checkbox":return t.checked;default:return console.log(`Unknown input type: ${n}`),null}}function Ue(e){return e===""?null:JSON.parse(e)}var se=o(157);class z extends ke{constructor(t,n=null,r=null){super((0,se.vx)(t,n),r),this.storageKey=t,this.defaultValue=n}static create(t,n=null,r=null){return new z(t,n,r)}static createWithCompositeKey(t,n,r=null,g=null){const D=`${t}-${n}`;return new z(D,r,g)}updateValueFromEvent=t=>{const n=Me(t),r=Ue(n);this.updateValue(r)};updateValue(t,n=!0){this.value!==t&&((0,se.Fg)(this.storageKey,t),this.value=t,n&&this.onChangeIfDefined())}clearValue(t=!1){this.updateValue(null,t)}resetValue(t=!1){this.updateValue(this.defaultValue,t)}}function Be(e,t=null){return{createGlobalFilter(n,r=null,g=e){return z.create(n,r,g)},createSectionFilter(n,r=null,g=e){if(!t)throw new Error("sectionId must be provided to use createSectionFilter.");return z.createWithCompositeKey(t,n,r,g)}}}var G=o(6700),ae=o(5027);const We=window.GM_addValueChangeListener,y={productsListContainer:null,productListObserver:null,containerObserver:null,isFiltersInitialized:!1,filters:{nameFilter:null,minPurchasesFilter:null,minRatingFilter:null,maxNameLines:null,filterEnabled:null},productCardsCache:new WeakMap};async function Ke(e){e&&rt(),Ve(),He()}function Ve(){if(!y.isFiltersInitialized){const e=$e(),{createGlobalFilter:t,createSectionFilter:n}=Be($,e);y.filters.nameFilter=n("name-filter"),y.filters.minPurchasesFilter=n("min-purchases-filter"),y.filters.minRatingFilter=n("min-rating-filter",4.8),y.filters.maxNameLines=t("max-name-lines",4),y.filters.filterEnabled=n("filter-enabled",!0),y.isFiltersInitialized=!0}}function $e(){return Re(je())}function je(){return(0,K.z2)("store")?(0,K.Fc)(2):(0,K.z2)("category")?(0,K.Fc)(3):(0,K.z2)("wholesale")?(0,K.$F)("SearchText"):"common"}function He(){y.productsListContainer=(0,P.Fi)(U.PRODUCT_LIST_CONTAINER),y.productsListContainer&&(ce(),y.containerObserver=new MutationObserver((0,p.sg)(ce)),y.containerObserver.observe(y.productsListContainer,{childList:!0,subtree:!0}))}function ce(){const e=(0,P.Fi)(U.PRODUCT_LIST_HEADER,y.productsListContainer);if(!e)return;const t=(0,P.Fi)(U.PRODUCT_LIST,y.productsListContainer);t&&(xe(e,ze),We(G.d5.LAST_RATE_UPDATE,()=>$(!0)),$(),y.productListObserver&&(0,p.wP)(y.productListObserver),y.productListObserver=new MutationObserver($),y.productListObserver.observe(t,{childList:!0}))}function ze(e,t){(0,Te.ZM)(e,N.FILTERS_CONTAINER);const n=Se(y.filters.nameFilter,N.TEXT_INPUT_CONTROL,N.TEXT_INPUT),r=J("\u041C\u0438\u043D. \u043F\u043E\u043A\u0443\u043F\u043E\u043A: ",y.filters.minPurchasesFilter,"1","1","999999",N.CONTROL,N.NUMBER_INPUT),g=Ie(y.filters.minRatingFilter,N.CONTROL,N.NUMBER_INPUT),D=Ne(y.filters.maxNameLines,N.CONTROL,N.NUMBER_INPUT),S=Ae(y.filters.filterEnabled,N.CONTROL,N.CHECKBOX_INPUT);e.append(n,r,g,D,S),t.append(e)}function $(e=!1){(0,P.fI)(U.PRODUCT).forEach(n=>{Ge(n,e)})}function Ge(e,t){if(!y.filters.filterEnabled.value){c(e);return}let n=y.productCardsCache.get(e);if(n)t&&nt(n);else{const g=(0,P.Fi)("a",e),D=(0,P.Fi)(U.PRODUCT_NAME,e),S=(0,P.Fi)(U.PRODUCT_RATING_CONTAINER,e);if(!g||!D||!S){d(e);return}const B=D.innerText,{productId:x}=e.dataset,{ratingWrap:k,purchasesCount:V,rating:X,storedRating:A,originalRating:j,dislikeControls:ot}=Xe(S,g,x);n={productId:x,nameWrap:D,name:B,ratingWrap:k,purchasesCount:V,rating:X,storedRating:A,originalRating:j,dislikeControls:ot},y.productCardsCache.set(e,n)}Je(n.nameWrap);const r=he(n.name,y.filters.nameFilter)||re(n.purchasesCount,y.filters.minPurchasesFilter)||re(n.rating,y.filters.minRatingFilter);L(e,r)}function Xe(e,t,n){const r=(0,P.Fi)(U.PRODUCT_PURCHASES_WRAP,e),g=(0,P.YA)(r,!0,!1,0);if(r){const V=(0,K.y_)(t.getAttribute("href"));Qe(r,V,n)}const D=(0,G.b$)(n),S=(0,P.Fi)(U.PRODUCT_RATING_WRAP,e),B=S?.textContent,x=Ze(D,S),k=qe(e,n,D);return{ratingWrap:S,purchasesCount:g,rating:x,storedRating:D,originalRating:B,dislikeControls:k}}function Qe(e,t,n){const r=Ye(t,n);ee(r,e)}function Ye(e,t){const n=new URL(e),r=n.pathname.split("/");return`${n.origin}/${r[1]}/${t}/reviews`}function Ze(e,t){return e?(t&&le(t,e),e):(0,P.YA)(t,!0,!1,0)}function le(e,t){e.textContent=t.toString().padEnd(5)}function Je(e){const t=y.filters.maxNameLines.value,r=t*16;e.style.height=`${r}px`,e.style.maxHeight=`${r}px`,e.style.webkitLineClamp=t}function qe(e,t,n){const r=(0,R.kv)(()=>et(t),!1,Y.r.DISLIKE_CONTROL,Y.r.DISLIKE_BUTTON_ICON_MD),g=(0,R.yu)(()=>tt(t),!1,Y.r.DISLIKE_CONTROL,Y.r.REMOVE_DISLIKE_BUTTON_ICON_MD),D=[r,g];return e.append(...D),(0,ae.nF)(n,...D),D}async function et(e){(0,G.v7)(e,1),$(!0)}async function tt(e){(0,G.v7)(e,null),$(!0)}function nt(e){const t=(0,G.b$)(e.productId);e.storedRating!==t&&(e.storedRating=t,e.rating=t??e.originalRating,e.ratingWrap&&le(e.ratingWrap,e.rating),(0,ae.nF)(t,...e.dislikeControls))}function rt(){y.productsListContainer=null,y.isFiltersInitialized=!1,y.filters={nameFilter:null,minPurchasesFilter:null,minRatingFilter:null,maxNameLines:null,filterEnabled:null},y.productCardsCache=new WeakMap,(0,p.wP)(y.containerObserver),(0,p.wP)(y.productListObserver)}},7708:(O,E,o)=>{o.d(E,{K:()=>L});var p=o(5027),R=o(6700);const T={EXTRA_INFO:'[class*="HazeProductDescription_HazeProductDescription__extraInfo__"]:not([class*="__stickyOffer__"])',RATING_WRAP:'[class*="HazeProductDescription_HazeProductDescription__ratingWrap__"] > span:nth-of-type(2)'};var d=o(573),C=o(4921),u=o(7273),_=o(8738);const m={DISLIKE_CONTROLS_WRAP:{width:"100%",marginTop:"5px",fontSize:"15px",fontWeight:"500"}};var c=o(7549);const l={productId:null,extraInfo:null,originalRating:null,ratingWraps:[],dislikeButton:null,removeDislikeButton:null};async function L(b){b&&F(),l.productId=(0,p.px)(),l.extraInfo=await(0,C.xk)(document,T.EXTRA_INFO),await Promise.all([v(),s()])}async function v(){if(l.ratingWraps=(0,d.fI)(T.RATING_WRAP),!l.ratingWraps.length)return;const b=(0,R.b$)(l.productId);b&&f(b)}function f(b){l.ratingWraps.forEach(I=>{l.originalRating??=I.textContent,I.textContent=b})}async function s(){const b=(0,u.S)(m.DISLIKE_CONTROLS_WRAP);l.dislikeButton=(0,_.kv)(i,!0,c.r.DISLIKE_CONTROL,c.r.DISLIKE_BUTTON_ICON_SM),l.removeDislikeButton=(0,_.yu)(h,!0,c.r.DISLIKE_CONTROL,c.r.REMOVE_DISLIKE_BUTTON_ICON_SM);const I=[l.dislikeButton,l.removeDislikeButton];b.append(...I),l.extraInfo.append(b);const w=(0,R.b$)(l.productId);(0,p.nF)(w,...I)}async function i(){(0,R.v7)(l.productId,1),a(1,1)}async function h(){(0,R.v7)(l.productId,null),a(l.originalRating,null)}function a(b,I){f(b),(0,p.nF)(I,l.dislikeButton,l.removeDislikeButton)}function F(){l.productId=null,l.extraInfo=null,l.originalRating=null,l.ratingWraps=[],l.dislikeButton=null,l.removeDislikeButton=null}},5059:(O,E,o)=>{var p=o(157);const R=window.GM_listValues;function T(m,c,l=!1){getStorageValue("dbVersion")!==c&&(m(),!l&&setStorageValue("dbVersion",c))}function d(m,c=!0){const l=R();u(l,m,c)}function C(m,c,l=!0){const v=R().filter(m);u(v,c,l)}function u(m,c,l){let L=0;m.forEach(v=>{const f=getStorageValue(v);l&&console.log(v,f),c(v,f),L+=1}),l&&console.log(`Total entries processed: ${L}`)}function _(m,c=!1){C(m,L=>{c||window.GM_deleteValue(L)})}},6700:(O,E,o)=>{o.d(E,{b$:()=>c,d5:()=>d,v7:()=>C});var p=o(157),R=o(6001),T=o(5059);const d={LAST_RATE_UPDATE:"last-rate-update",REVIEWS_LAST_PRODUCT_ARTICLE:"reviews-last-product-article"};function C(f,s){const i=u(f),h=(0,p.vx)(i),a=_(h);a.rating=s,a.updateLastCheckDate(),(0,p.Fg)(i,a),(0,p.Fg)(d.LAST_RATE_UPDATE,Date.now())}function u(f){return`product-${f}`}function _(f){return f?R.w.fromObject(f):new R.w}function m(f){const s=u(f);return(0,p.vx)(s)}function c(f){return m(f)?.rating??null}function l(f){return setStorageValue(d.REVIEWS_LAST_PRODUCT_ARTICLE,f)}function L(){return getStorageValue(d.REVIEWS_LAST_PRODUCT_ARTICLE)}function v(){const f=a=>a.startsWith("product-"),s=[],i=(a,F)=>{new Date(F.lastCheckDate)<getDateMonthsAgo(9)&&s.push(F.lastCheckDate)};processEntriesByKeyFilter(f,i,!1),[...s].sort((a,F)=>new Date(a)-new Date(F)).forEach(a=>{console.log(new Date(a).toLocaleDateString())})}},8738:(O,E,o)=>{o.d(E,{d:()=>C,kv:()=>c,yu:()=>l});var p=o(9319),R=o(9898),T=o(5558),d=o(5275);function C(v={},f=null,s=null){const i=(0,T.n)("a",v,f);return s&&(i.href=s),i}function u(v,f=null,s={}){s.cursor||="pointer";const i=C(s,f);return v&&i.addEventListener("click",v),i}function _(v,f,s=null,i={},h={}){i.display||="inline-flex",i.alignItems||="center",i.gap||="0.25em";const a=u(v,s,i);return a.prepend((0,d.U)(f,h)),a}function m(v,f,s,i=null,h={},a={}){const F=w=>{w.stopPropagation(),w.preventDefault(),window.confirm(s)&&v()},b=i?`<span>${i}</span>`:null,I=_(F,f,b,h,a);return I.classList.add("userscript-control"),I}function c(v,f,s={},i={}){return m(v,p.A,"\u0412\u044B\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u043D\u0438\u0437\u043A\u0438\u0439 \u0440\u0435\u0439\u0442\u0438\u043D\u0433?",f?"\u0414\u0438\u0437\u043B\u0430\u0439\u043A":null,s,i)}function l(v,f,s={},i={}){return m(v,R.A,"\u0423\u0431\u0440\u0430\u0442\u044C \u043D\u0438\u0437\u043A\u0438\u0439 \u0440\u0435\u0439\u0442\u0438\u043D\u0433?",f?"\u0423\u0431\u0440\u0430\u0442\u044C \u0434\u0438\u0437\u043B\u0430\u0439\u043A":null,s,i)}function L(v={},f=null,s=null){const i=createElement("button",v,f);return s&&i.addEventListener("click",s),i}},7273:(O,E,o)=>{o.d(E,{S:()=>T});var p=o(5558);function R(d={},C=null){return createElement("span",d,C)}function T(d={},C=null){return(0,p.n)("div",d,C)}},5558:(O,E,o)=>{o.d(E,{n:()=>R});var p=o(6754);function R(T,d,C=null){if(typeof d!="object"||d===null)throw new TypeError("styles should be an object");const u=document.createElement(T);return(0,p.ZM)(u,d),C&&(u.innerHTML=C),u}},5275:(O,E,o)=>{o.d(E,{U:()=>C});const p=(u,_,m=[])=>{const c=document.createElementNS("http://www.w3.org/2000/svg",u);return Object.keys(_).forEach(l=>{c.setAttribute(l,String(_[l]))}),m.length&&m.forEach(l=>{const L=p(...l);c.appendChild(L)}),c};var R=([u,_,m])=>p(u,_,m),T=o(6754);function d(u={},_=null){return createElement("i",u,_)}function C(u,_={}){_.width||="1em",_.height||="1em";const m=R(u);return(0,T.ZM)(m,_),m}},573:(O,E,o)=>{o.d(E,{Fi:()=>T,YA:()=>m,fI:()=>d});var p=o(4214);function R(i,h=document){return!!h.querySelector(i)}function T(i,h=document,a=!1){const F=h.querySelector(i);return a&&!F&&console.log(`No element found for selector: ${i}`),F}function d(i,h=document,a=!1){const F=h.querySelectorAll(i);return a&&!F.length&&console.log(`No elements found for selector: ${i}`),F}function C(i,h=1){let a=i;for(let F=0;F<h;F++){if(!a.parentElement)return null;a=a.parentElement}return a}function u(i,h,a){return[...i.querySelectorAll(h)].find(F=>F.textContent.trim().includes(a))}function _(i,h,a=!1,F=!1,b=null){const I=T(h,i);return m(I,a,F,b)}function m(i,h=!1,a=!1,F=null){if(!i)return F===null?(console.log("No element found"),null):F;const b=i.innerText;return L(b,h,a)}function c(i,h,a=!1){const F=i[h];return m(F,a)}function l(i,h=!1,a=!1){const F=i.textContent;return L(F,h,a)}function L(i,h,a){h&&(i=(0,p.zr)(i)),a&&(i=i.replace(",","."));const F=Number(i);return Number.isNaN(F)?(console.log(`Invalid number: ${i}`),0):F}function v(i){return[...i.childNodes].find(h=>h.nodeType===Node.TEXT_NODE)}function f(i){const h=a=>a.nodeType===Node.TEXT_NODE&&a.textContent.trim()!==""?[a]:[...a.childNodes].flatMap(h);return h(i)}function s(i){return normalizeSpacing(i.textContent)}},6754:(O,E,o)=>{o.d(E,{ZM:()=>p});function p(C,u){Object.assign(C.style,u)}function R(C,u="custom-global-style"){let _=document.getElementById(u);_||(_=document.createElement("style"),_.id=u,_.type="text/css",document.head.appendChild(_)),_.textContent=C}function T(C){return Object.entries(C).map(([u,_])=>`${u.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${_};`).join(" ")}function d(C){return C?C.split(";").filter(u=>u.trim()!=="").reduce((u,_)=>{const[m,c]=_.split(":").map(L=>L.trim()),l=m.replace(/-([a-z])/g,(L,v)=>v.toUpperCase());return u[l]=c,u},{}):{}}},4921:(O,E,o)=>{o.d(E,{Un:()=>C,XW:()=>T,sg:()=>d,wP:()=>m,xk:()=>p});function p(c,l,L=null){const v=c.querySelector(l);return v?Promise.resolve(v):new Promise(f=>{const s=new MutationObserver(h);s.observe(c,{childList:!0,subtree:!0});let i;L&&(i=setTimeout(()=>{s.disconnect(),console.log(`No element found for selector: ${l}`),f(null)},L));function h(){const a=c.querySelector(l);a&&(i&&clearTimeout(i),s.disconnect(),f(a))}})}function R(c,l){return c.querySelector(l)?new Promise(v=>{const f=new MutationObserver(s);f.observe(c,{childList:!0,subtree:!0});function s(){c.querySelector(l)||(f.disconnect(),v())}}):Promise.resolve()}function T(c,l=400){return new Promise(L=>{let v;const f=new MutationObserver(()=>{clearTimeout(v),s()});function s(){v=setTimeout(()=>{f.disconnect(),L()},l)}s(),f.observe(c,{childList:!0,subtree:!0})})}function d(c,l=250){let L;return function(...v){const f=this;clearTimeout(L),L=setTimeout(()=>c.apply(f,v),l)}}async function C(c){document.visibilityState==="visible"?await c():document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&await c()},{once:!0})}function u(c,l){const L=new IntersectionObserver(v=>{v.forEach(f=>{f.isIntersecting&&(l(),_(c))})});c.intersectionObserver=L,L.observe(c)}function _(c){c.intersectionObserver&&(c.intersectionObserver.disconnect(),c.intersectionObserver=null)}function m(c){c&&(c.disconnect(),c=null)}},3789:(O,E,o)=>{o.d(E,{K:()=>p});class p{constructor(T=Date.now(),d=null,C=null,u={}){this.lastCheckDate=T,this.lowestPrice=d,this.highestPrice=C,this.priceHistory=u}get lowestPriceValue(){return this.lowestPrice?this.lowestPrice.value:0}get highestPriceValue(){return this.highestPrice?this.highestPrice.value:0}updateLastCheckDate=()=>{this.lastCheckDate=Date.now()};static fromObject(T){const{lastCheckDate:d,lowestPrice:C,highestPrice:u,priceHistory:_}=T;return new p(d,C,u,_)}}},6001:(O,E,o)=>{o.d(E,{w:()=>R});var p=o(3789);class R extends p.K{constructor(d=Date.now(),C=null,u=null,_={},m=null){super(d,C,u,_),this.rating=m}static fromObject(d){const{lastCheckDate:C,lowestPrice:u,highestPrice:_,priceHistory:m,rating:c}=d;return new R(C,u,_,m,c)}}},157:(O,E,o)=>{o.d(E,{Fg:()=>p,vx:()=>T});const p=window.GM_setValue,R=window.GM.setValue,T=window.GM_getValue},4214:(O,E,o)=>{o.d(E,{zr:()=>R});function p(u){return u.replace(/\D/g,"")}function R(u){return u.replace(/[^\d.,-]/g,"")}function T(u){return u.replace(/\s/g,"")}function d(u){return u.charAt(0).toUpperCase()+u.slice(1)}function C(u){return u.replace(/\s+/g," ").trim()}},5406:(O,E,o)=>{o.d(E,{$F:()=>u,C$:()=>T,Fc:()=>p,k1:()=>v,y_:()=>_,z2:()=>l});function p(s,i="common",h=!1){const{pathname:a}=window.location;return R(a,s,i,h)}function R(s,i,h,a=!1){const F=s.split("/");i=i<0?F.length+i:i;const b=F[i]||h;return a&&console.log(`Pathname element: ${b}`),b}function T(s,i="common",h=!1){const a=p(s,"",h);return d(a,i,h)}function d(s,i,h){if(!s)return i;const a=s.split("-").at(-1);return h&&console.log(`Pathname element ending: ${a}`),a}function C(s,i,h="common",a=!1){const F=R(s,i,"",a);return d(F,h,a)}function u(s){return new URLSearchParams(window.location.search).get(s)}function _(s){return s.split("?")[0]}function m(s){return window.location.pathname.includes(s)}function c(s){return s.some(i=>m(i))}function l(...s){return window.location.pathname.split("/").some(h=>s.includes(h))}function L(s){try{const i=new URL(window.location.href);Object.entries(s).forEach(([h,a])=>{i.searchParams.set(h,a)}),window.location.href=i.toString()}catch(i){console.error("Failed to redirect:",i)}}function v(s,i=[]){const h={pathname:window.location.pathname};i.forEach(w=>{h[w]=u(w)});let a=!1;async function F(){if(a)return;const w={pathname:window.location.pathname};if(i.forEach(M=>{w[M]=u(M)}),Object.keys(h).some(M=>h[M]!==w[M])){Object.assign(h,w),a=!0;try{await s()}catch(M){console.error("Error in URL observer callback:",M)}finally{a=!1}}}function b(){F().catch(w=>{console.error("Error in URL change handler:",w)})}let I=window.location.href;setInterval(()=>{window.location.href!==I&&(I=window.location.href,b())},200),window.addEventListener("popstate",b)}function f(s=[]){v(()=>window.location.reload(),s)}},1426:(O,E,o)=>{o.d(E,{A:()=>p});const p={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"}},9898:(O,E,o)=>{o.d(E,{A:()=>R});var p=o(1426);const R=["svg",p.A,[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]]]},9319:(O,E,o)=>{o.d(E,{A:()=>R});var p=o(1426);const R=["svg",p.A,[["path",{d:"M17 14V2"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z"}]]]}},q={};function W(O){var E=q[O];if(E!==void 0)return E.exports;var o=q[O]={exports:{}};return de[O](o,o.exports,W),o.exports}(()=>{var O=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",E=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",o=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",p=T=>{T&&T.d<1&&(T.d=1,T.forEach(d=>d.r--),T.forEach(d=>d.r--?d.r++:d()))},R=T=>T.map(d=>{if(d!==null&&typeof d=="object"){if(d[O])return d;if(d.then){var C=[];C.d=0,d.then(m=>{u[E]=m,p(C)},m=>{u[o]=m,p(C)});var u={};return u[O]=m=>m(C),u}}var _={};return _[O]=m=>{},_[E]=d,_});W.a=(T,d,C)=>{var u;C&&((u=[]).d=-1);var _=new Set,m=T.exports,c,l,L,v=new Promise((f,s)=>{L=s,l=f});v[E]=m,v[O]=f=>(u&&f(u),_.forEach(f),v.catch(s=>{})),T.exports=v,d(f=>{c=R(f);var s,i=()=>c.map(a=>{if(a[o])throw a[o];return a[E]}),h=new Promise(a=>{s=()=>a(i),s.r=0;var F=b=>b!==u&&!_.has(b)&&(_.add(b),b&&!b.d&&(s.r++,b.push(s)));c.map(b=>b[O](F))});return s.r?h:i()},f=>(f?L(v[o]=f):l(m),p(u))),u&&u.d<0&&(u.d=0)}})(),W.d=(O,E)=>{for(var o in E)W.o(E,o)&&!W.o(O,o)&&Object.defineProperty(O,o,{enumerable:!0,get:E[o]})},W.o=(O,E)=>Object.prototype.hasOwnProperty.call(O,E);var it=W(9830)})();})();
