// ==UserScript==
// @name         2gis reviews filter
// @description  Hide reviews by filter
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://2gis.ru/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.75784360
// @icon         https://www.google.com/s2/favicons?sz=64&domain=2gis.ru
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/dgis.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var W={5467:(T,a,n)=>{n.d(a,{E2:()=>E});var v=n(9928);function E(f,i={},e=null){const r=(0,v.Sw)(i,e);return r.append(f),r}function s(f,i=null,e={},r={}){const h=createActionLink(f,i,r);return E(h,e)}function m(f,i=null,e=null,r={},h={}){const C=createActionLinkWithIcon(f,e,i,h);return E(C,r)}},9928:(T,a,n)=>{n.d(a,{Sw:()=>y,kU:()=>s});var v=n(4921),E=n(6754);function s(o,t,g){const p=i(o,"text",t);return p.value=g,p}function m(o,t,g,p,O,k){const N=i(o,"number",t);return N.value=g,N.step=p,N.min=O,N.max=k,N}function f(o,t,g){const p=i(o,"checkbox",t);return p.checked=g,p}function i(o={},t=null,g=null){const p=l("input",o);return t&&(p.type=t),g&&(p.addEventListener("keyup",(0,v.sg)(g,200)),p.addEventListener("change",(0,v.sg)(g,100))),p}function e(o={},t=null){return l("span",o,t)}function r(o={},t=null,g=null){const p=l("a",o,t);return g&&(p.href=g),p}function h(o,t=null,g={}){g.cursor||="pointer";const p=r(g,t);return o&&p.addEventListener("click",o),p}function C(o,t,g=null,p={},O={}){p.display||="inline-flex",p.alignItems||="center",p.gap||="0.25em";const k=h(o,g,p);return k.prepend(u(t,O)),k}function x(o={},t=null,g=null){const p=l("button",o,t);return g&&p.addEventListener("click",g),p}function y(o={},t=null){return l("div",o,t)}function S(o={}){return l("i",o)}function u(o,t={}){t.width||="1em",t.height||="1em",t.paddingBottom||="1px";const g=S(t);return g.setAttribute("data-lucide",o),g}function l(o,t,g=null){if(typeof t!="object"||t===null)throw new TypeError("styles should be an object");const p=document.createElement(o);return(0,E.ZM)(p,t),g&&(p.innerHTML=g),p}},573:(T,a,n)=>{n.d(a,{Fi:()=>E,Yl:()=>f,fI:()=>s,s$:()=>m});function v(u,l=document){return!!l.querySelector(u)}function E(u,l=document,o=!1){const t=l.querySelector(u);return o&&!t&&console.log(`No element found for selector: ${u}`),t}function s(u,l=document,o=!1){const t=l.querySelectorAll(u);return o&&!t.length&&console.log(`No elements found for selector: ${u}`),t}function m(u,l=1){let o=u;for(let t=0;t<l;t++){if(!o.parentElement)return null;o=o.parentElement}return o}function f(u,l,o){return[...u.querySelectorAll(l)].find(t=>t.textContent.trim().includes(o))}function i(u,l,o=!1,t=!1,g=null){const p=E(l,u);return e(p,o,t,g)}function e(u,l=!1,o=!1,t=null){if(!u)return t===null?(console.log("No element found"),null):t;const g=u.innerText;return C(g,l,o)}function r(u,l,o=!1){const t=u[l];return e(t,o)}function h(u,l=!1,o=!1){const t=u.textContent;return C(t,l,o)}function C(u,l,o){l&&(u=removeNonNumber(u)),o&&(u=u.replace(",","."));const t=Number(u);return Number.isNaN(t)?(console.log(`Invalid number: ${u}`),0):t}function x(u){return[...u.childNodes].find(l=>l.nodeType===Node.TEXT_NODE)}function y(u){const l=o=>o.nodeType===Node.TEXT_NODE&&o.textContent.trim()!==""?[o]:[...o.childNodes].flatMap(l);return l(u)}function S(u){return normalizeSpacing(u.textContent)}},8506:(T,a,n)=>{n.d(a,{hf:()=>E,kZ:()=>m});var v=n(573);function E(f,i){f.forEach(e=>s(i,e))}function s(f,i){if(!i)return;const e=new RegExp(`(${i})`,"gi"),r=document.createTreeWalker(f,NodeFilter.SHOW_TEXT,null);let h=r.nextNode();const C=[];for(;h;){const{textContent:x}=h;if(e.test(x)){const y=document.createDocumentFragment();let S=0;x.replace(e,(u,l,o)=>{o>S&&y.appendChild(document.createTextNode(x.slice(S,o)));const t=document.createElement("span");t.className="highlightedSubstring",t.style.backgroundColor="yellow",t.textContent=u,y.appendChild(t),S=o+u.length}),S<x.length&&y.appendChild(document.createTextNode(x.slice(S))),C.push({node:h,fragment:y})}h=r.nextNode()}C.forEach(({node:x,fragment:y})=>{x.parentNode.replaceChild(y,x)})}function m(f){(0,v.fI)(".highlightedSubstring",f).forEach(e=>{const{parentNode:r}=e;e.replaceWith(e.textContent),r.normalize()})}},5539:(T,a,n)=>{n.d(a,{Bt:()=>s,L5:()=>P,UC:()=>C});var v=n(573);function E(c,F){c.parentNode.insertBefore(F,c.nextSibling)}function s(c){c.style.display="none"}function m(c,F=1){const L=document.querySelector(c);L&&f(L,F)}function f(c,F=1){const L=getElementAncestor(c,F);L&&s(L)}function i(c){S(c),s(c)}function e(c){c.intersectionObserver||runOnceOnIntersection(c,()=>s(c))}function r(c){c.style.display=""}function h(c){const F=y(c);c.style.display=F}function C(c,F){F?s(c):r(c)}function x(c,F){F?e(c):(clearIntersectionObserver(c),r(c))}function y(c){return S(c),c.defaultDisplay}function S(c){if(c.defaultDisplay)return;const{display:F}=getComputedStyle(c);c.defaultDisplay=F}function u(){return{show:[],hide:[]}}function l(c,F,L){c?F.hide.push(L):F.show.push(L)}function o(c){c.show.forEach(r),c.hide.forEach(s)}function t(c,F,L=.3){F?p(c,L):g(c)}function g(c){c.style.opacity=""}function p(c,F=.3){c.style.opacity=F}function O(c){c.style.order=""}function k(c,F){c.style.order=F}function N(c,F){c.style.background=F}function w(c,F){const L=getFirstElement(F);L&&b(c,L)}function b(c,F){const L=createLink();L.href=c,F.parentNode.append(L),L.append(F)}function d(c,F){const L=getFirstElement(F);L&&I(c,L)}function I(c,F){const L=createLink();L.href=c,L.append(...F.childNodes),F.append(L)}function R(){const c=getURLQueryParam("scrollTo");if(!c)return;const F=document.getElementById(c);F?F.scrollIntoView():console.log(`Element with ID "${c}" was not found.`)}function P(c,F,L){const M=`${L}-click-passed`;return function(B){if(B.hasAttribute(M))return;const A=(0,v.Yl)(B,c,F);A&&A.click(),B.setAttribute(M,"")}}function U(c,F,L="text/plain"){const M=new Blob([c],{type:L}),B=URL.createObjectURL(M),A=document.createElement("a");A.href=B,A.download=F,document.body.appendChild(A),A.click(),document.body.removeChild(A),requestAnimationFrame(()=>URL.revokeObjectURL(B))}},6754:(T,a,n)=>{n.d(a,{ZM:()=>v});function v(f,i){Object.assign(f.style,i)}function E(f,i="custom-global-style"){let e=document.getElementById(i);e||(e=document.createElement("style"),e.id=i,e.type="text/css",document.head.appendChild(e)),e.textContent=f}function s(f){return Object.entries(f).map(([i,e])=>`${i.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${e};`).join(" ")}function m(f){return f?f.split(";").filter(i=>i.trim()!=="").reduce((i,e)=>{const[r,h]=e.split(":").map(x=>x.trim()),C=r.replace(/-([a-z])/g,(x,y)=>y.toUpperCase());return i[C]=h,i},{}):{}}},4921:(T,a,n)=>{n.d(a,{XW:()=>s,sg:()=>m,xk:()=>v});function v(e,r,h=null){const C=e.querySelector(r);return C?Promise.resolve(C):new Promise(x=>{const y=new MutationObserver(u);y.observe(e,{childList:!0,subtree:!0});let S;h&&(S=setTimeout(()=>{y.disconnect(),console.log(`No element found for selector: ${r}`),x(null)},h));function u(){const l=e.querySelector(r);l&&(S&&clearTimeout(S),y.disconnect(),x(l))}})}function E(e,r){return e.querySelector(r)?new Promise(C=>{const x=new MutationObserver(y);x.observe(e,{childList:!0,subtree:!0});function y(){e.querySelector(r)||(x.disconnect(),C())}}):Promise.resolve()}function s(e,r=400){return new Promise(h=>{let C;const x=new MutationObserver(()=>{clearTimeout(C),y()});function y(){C=setTimeout(()=>{x.disconnect(),h()},r)}y(),x.observe(e,{childList:!0,subtree:!0})})}function m(e,r=250){let h;return(...C)=>{clearTimeout(h),h=setTimeout(()=>e(...C),r)}}function f(e,r){const h=new IntersectionObserver(C=>{C.forEach(x=>{x.isIntersecting&&(r(),i(e))})});e.intersectionObserver=h,h.observe(e)}function i(e){e.intersectionObserver&&(e.intersectionObserver.disconnect(),e.intersectionObserver=null)}},3829:(T,a,n)=>{n.d(a,{Ay:()=>E});var v=n(8355);function E(e,r){return!s(e,r)}function s(e,r){if(!r.value)return!0;const h=e.toLowerCase(),C=(0,v.R)(r),x=[],y=[];return C.forEach(S=>{if(S.startsWith("!")){const u=S.substring(1);u&&y.push(u)}else x.push(S)}),x.every(S=>h.includes(S))&&y.every(S=>!h.includes(S))}function m(e,r){return r.value!=null&&e<r.value}function f(e,r){return r.value!=null&&e>r.value}function i(e,r){return r.value&&e!==r.value}},4521:(T,a,n)=>{n.d(a,{z:()=>E});var v=n(3048);function E(s,m=null){return{createGlobalFilter(f,i=null,e=s){return v.V.create(f,i,e)},createSectionFilter(f,i=null,e=s){if(!m)throw new Error("sectionId must be provided to use createSectionFilter.");return v.V.createWithCompositeKey(m,f,i,e)}}}},5884:(T,a,n)=>{n.d(a,{Nm:()=>s});var v=n(9928),E=n(5467);function s(i,e,r={},h={}){const C=(0,v.kU)(h,e.updateValueFromEvent,e.value);return(0,E.E2)(C,r,i)}function m(i,e,r,h,C,x={},y={}){const S=createNumberInput(y,e.updateValueFromEvent,e.value,r,h,C);return createControl(S,x,i)}function f(i,e,r={},h={}){const C=createCheckboxInput(h,e.updateValueFromEvent,e.value);return createControl(C,r,i)}},7877:(T,a,n)=>{n.d(a,{E9:()=>E});var v=n(5884);function E(w,b={},d={}){return(0,v.Nm)("\u041F\u043E\u0438\u0441\u043A: ",w,b,d)}function s(w,b={},d={},I=.1,R=3){return createNumberFilterControl("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",w,I,R,5,b,d)}function m(w,b={},d={},I=.1,R=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",w,I,R,5,b,d)}function f(w,b={},d={}){return e("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",w,b,d)}function i(w,b={},d={}){return e("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",w,b,d)}function e(w,b,d={},I={}){return createNumberFilterControl(w,b,"1","1","999999",d,I)}function r(w,b={},d={}){return h("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",w,b,d)}function h(w,b,d={},I={}){return createNumberFilterControl(w,b,"5","0","100",d,I)}function C(w,b={},d={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",w,"5","0","100",b,d)}function x(w,b,d={},I={},R="250"){return createNumberFilterControl(w,b,R,"0","1000000",d,I)}function y(w,b={},d={},I="25"){return x("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",w,b,d,I)}function S(w,b={},d={},I="25"){return x("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",w,b,d,I)}function u(w,b={},d={}){return l("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",w,b,d)}function l(w,b,d={},I={}){return createNumberFilterControl(w,b,"1","0","99999",d,I)}function o(w,b={},d={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",w,"1","2","7",b,d)}function t(w,b={},d={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",w,1,1,10,b,d)}function g(w,b={},d={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",w,b,d)}function p(w,b={},d={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",w,b,d)}function O(w,b={},d={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",w,b,d)}function k(w,b={},d={}){return createCheckboxFilterControl("\u0411\u0430\u043B\u043B\u044B: ",w,b,d)}function N(w,b={},d={}){return createCheckboxFilterControl("\u0412\u043A\u043B: ",w,b,d)}},8355:(T,a,n)=>{n.d(a,{R:()=>v,f:()=>E});function v(s){return s.value.toLowerCase().split(",").map(m=>m.trim()).filter(m=>m!=="")}function E(s){return v(s).filter(m=>!m.startsWith("!"))}},4292:(T,a,n)=>{n.d(a,{C:()=>s});var v=n(8355),E=n(8506);function s(f,i){const e=(0,v.f)(f);(0,E.hf)(e,i)}function m(f,i){const e=getIncludedSearchStrings(f);i.forEach(r=>highlightSubstrings(e,r))}},5213:(T,a,n)=>{n.d(a,{b:()=>s});var v=n(9928),E=n(573);function s(m,f,i=!1,e="customFiltersContainer"){let r=(0,E.Fi)(`#${e}`,m);if(r)if(i)r.remove();else return;r=(0,v.Sw)(),r.id=e,f(r,m)}},8200:(T,a,n)=>{n.d(a,{s:()=>v});function v(E){const{target:s}=E,{type:m}=s;switch(m){case"text":return`"${s.value}"`;case"number":return s.value;case"checkbox":return s.checked;default:return console.log(`Unknown input type: ${m}`),null}}},157:(T,a,n)=>{n.d(a,{Fg:()=>v,vx:()=>s});const v=window.GM_setValue,E=window.GM.setValue,s=window.GM_getValue},1870:(T,a,n)=>{n.d(a,{j:()=>v});class v{constructor(s,m){this.value=s,this.onChange=m}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(T,a,n)=>{n.d(a,{V:()=>f});var v=n(1870),E=n(8200),s=n(3976),m=n(157);class f extends v.j{constructor(e,r=null,h=null){super((0,m.vx)(e,r),h),this.storageKey=e,this.defaultValue=r}static create(e,r=null,h=null){return new f(e,r,h)}static createWithCompositeKey(e,r,h=null,C=null){const x=`${e}-${r}`;return new f(x,h,C)}updateValueFromEvent=e=>{const r=(0,E.s)(e),h=(0,s.$)(r);this.updateValue(h)};updateValue(e,r=!0){this.value!==e&&((0,m.Fg)(this.storageKey,e),this.value=e,r&&this.onChangeIfDefined())}clearValue(e=!1){this.updateValue(null,e)}resetValue(e=!1){this.updateValue(this.defaultValue,e)}}},3976:(T,a,n)=>{n.d(a,{$:()=>v});function v(E){return E===""?null:JSON.parse(E)}},5406:(T,a,n)=>{n.d(a,{k1:()=>y,z2:()=>C});function v(u,l="common",o=!1){const{pathname:t}=window.location;return E(t,u,l,o)}function E(u,l,o,t=!1){const g=u.split("/");l=l<0?g.length+l:l;const p=g[l]||o;return t&&console.log(`Pathname element: ${p}`),p}function s(u,l="common",o=!1){const t=v(u,"",o);return m(t,l,o)}function m(u,l,o){if(!u)return l;const t=u.split("-").at(-1);return o&&console.log(`Pathname element ending: ${t}`),t}function f(u,l,o="common",t=!1){const g=E(u,l,"",t);return m(g,o,t)}function i(u){return new URLSearchParams(window.location.search).get(u)}function e(u){return u.split("?")[0]}function r(u){return window.location.pathname.includes(u)}function h(u){return u.some(l=>r(l))}function C(u){return window.location.pathname.split("/").some(o=>o===u)}function x(u){try{const l=new URL(window.location.href);Object.entries(u).forEach(([o,t])=>{l.searchParams.set(o,t)}),window.location.href=l.toString()}catch(l){console.error("Failed to redirect:",l)}}function y(u,l=[]){const o={pathname:window.location.pathname};l.forEach(k=>{o[k]=i(k)});let t=!1;async function g(){if(t)return;const k={pathname:window.location.pathname};if(l.forEach(N=>{k[N]=i(N)}),Object.keys(o).some(N=>o[N]!==k[N])){Object.assign(o,k),t=!0;try{await u()}catch(N){console.error("Error in URL observer callback:",N)}finally{t=!1}}}function p(){g().catch(k=>{console.error("Error in URL change handler:",k)})}let O=window.location.href;setInterval(()=>{window.location.href!==O&&(O=window.location.href,p())},200),window.addEventListener("popstate",p)}function S(u=[]){y(()=>window.location.reload(),u)}},4615:(T,a,n)=>{n.a(T,async(v,E)=>{try{let O=function(){if(!t.isFiltersInitialized){const{createGlobalFilter:d}=(0,C.z)(N);t.reviewTextFilter=d("review-text-filter"),t.isFiltersInitialized=!0}},k=function(d,I){(0,x.ZM)(d,h.r.FILTERS_CONTAINER);const R=(0,e.E9)(t.reviewTextFilter,h.r.CONTROL,h.r.TEXT_INPUT);d.append(R),I.parentNode.insertBefore(d,I)},N=function(){t.isFiltersInitialized||O(),(0,i.fI)(t.reviewSelector).forEach(w)},w=function(d){o(d),(0,u.kZ)(d);const I=(0,i.Fi)(r.Z.REVIEW_TEXT_WRAP,d);if(!I){(0,f.Bt)(d);return}t.reviewTextFilter.value&&(0,S.C)(t.reviewTextFilter,I);const R=I.innerText,P=(0,m.Ay)(R,t.reviewTextFilter);(0,f.UC)(d,P)},b=function(){t.reviewSelector=null,t.isFiltersInitialized=!1,t.reviewTextFilter=null,t.reviewsObserver&&(t.reviewsObserver.disconnect(),t.reviewsObserver=null)};var s=n(5213),m=n(3829),f=n(5539),i=n(573),e=n(7877),r=n(281),h=n(8697),C=n(4521),x=n(6754),y=n(4921),S=n(4292),u=n(8506),l=n(5406);const o=(0,f.L5)("span","\u0427\u0438\u0442\u0430\u0442\u044C \u0446\u0435\u043B\u0438\u043A\u043E\u043C","read-more"),t={reviewSelector:null,isFiltersInitialized:!1,reviewTextFilter:null,reviewsObserver:null};await g(),(0,l.k1)(async()=>{b(),await g()});async function g(){(0,l.z2)("firm")&&(0,l.z2)("reviews")&&(await(0,y.XW)(document.body),await p())}async function p(){const d=await(0,y.xk)(document,r.Z.GOOD_REVIEWS_LABEL),I=(0,i.s$)(d,5),R=(0,i.Yl)(I,"button","\u041F\u043E\u043B\u0435\u0437\u043D\u043E"),P=(0,i.s$)(R,7),U=P.classList;U.length<1||(t.reviewSelector=`.${U[0]}`,O(),(0,s.b)(P,k,!0),N(),t.reviewsObserver=new MutationObserver((0,y.sg)(N)),t.reviewsObserver.observe(I,{childList:!0,subtree:!0}))}E()}catch(o){E(o)}},1)},281:(T,a,n)=>{n.d(a,{Z:()=>v});const v={GOOD_REVIEWS_LABEL:'label[title="\u041F\u043E\u043B\u043E\u0436\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435"]',REVIEW_TEXT_WRAP:"div > div > a"}},8697:(T,a,n)=>{n.d(a,{r:()=>E});const E={FILTERS_CONTAINER:{position:"sticky",top:"48px",display:"flex",flexDirection:"column",gap:"4px",padding:"12px 18px 14px 16px",backgroundColor:"#fff",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",zIndex:100},CONTROL:{display:"flex",flexDirection:"column",gap:"6px",fontSize:"14px",width:"100%"},TEXT_INPUT:{...{INPUT:{padding:"7px 14px",fontSize:"14px",borderRadius:"3px",border:"1px solid #ccc",outline:"none"}}.INPUT,width:"100%",boxSizing:"border-box"}}}},_={};function D(T){var a=_[T];if(a!==void 0)return a.exports;var n=_[T]={exports:{}};return W[T](n,n.exports,D),n.exports}(()=>{var T=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",a=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",n=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",v=s=>{s&&s.d<1&&(s.d=1,s.forEach(m=>m.r--),s.forEach(m=>m.r--?m.r++:m()))},E=s=>s.map(m=>{if(m!==null&&typeof m=="object"){if(m[T])return m;if(m.then){var f=[];f.d=0,m.then(r=>{i[a]=r,v(f)},r=>{i[n]=r,v(f)});var i={};return i[T]=r=>r(f),i}}var e={};return e[T]=r=>{},e[a]=m,e});D.a=(s,m,f)=>{var i;f&&((i=[]).d=-1);var e=new Set,r=s.exports,h,C,x,y=new Promise((S,u)=>{x=u,C=S});y[a]=r,y[T]=S=>(i&&S(i),e.forEach(S),y.catch(u=>{})),s.exports=y,m(S=>{h=E(S);var u,l=()=>h.map(t=>{if(t[n])throw t[n];return t[a]}),o=new Promise(t=>{u=()=>t(l),u.r=0;var g=p=>p!==i&&!e.has(p)&&(e.add(p),p&&!p.d&&(u.r++,p.push(u)));h.map(p=>p[T](g))});return u.r?o:l()},S=>(S?x(y[n]=S):C(r),v(i))),i&&i.d<0&&(i.d=0)}})(),D.d=(T,a)=>{for(var n in a)D.o(a,n)&&!D.o(T,n)&&Object.defineProperty(T,n,{enumerable:!0,get:a[n]})},D.o=(T,a)=>Object.prototype.hasOwnProperty.call(T,a);var V=D(4615)})();})();
