// ==UserScript==
// @name         Habr comments filter
// @description  Hide comments by filter
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://habr.com/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.75750712
// @icon         https://www.google.com/s2/favicons?sz=64&domain=habr.com
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/habr.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var P={5467:(w,a,t)=>{t.d(a,{E2:()=>v});var C=t(9928);function v(h,r={},e=null){const o=(0,C.Sw)(r,e);return o.append(h),o}function g(h,r=null,e={},o={}){const m=createActionLink(h,r,o);return v(m,e)}function f(h,r=null,e=null,o={},m={}){const F=createActionLinkWithIcon(h,e,r,m);return v(F,o)}},9928:(w,a,t)=>{t.d(a,{S:()=>h,Sw:()=>x,o5:()=>f});var C=t(4921),v=t(6754);function g(c,i,y){const p=r(c,"text",i);return p.value=y,p}function f(c,i,y,p,L,A){const O=r(c,"number",i);return O.value=y,O.step=p,O.min=L,O.max=A,O}function h(c,i,y){const p=r(c,"checkbox",i);return p.checked=y,p}function r(c={},i=null,y=null){const p=b("input",c);return i&&(p.type=i),y&&(p.addEventListener("keyup",(0,C.sg)(y,200)),p.addEventListener("change",(0,C.sg)(y,100))),p}function e(c={},i=null){return b("span",c,i)}function o(c={},i=null,y=null){const p=b("a",c,i);return y&&(p.href=y),p}function m(c,i=null,y={}){y.cursor||="pointer";const p=o(y,i);return c&&p.addEventListener("click",c),p}function F(c,i,y=null,p={},L={}){p.display||="inline-flex",p.alignItems||="center",p.gap||="0.25em";const A=m(c,y,p);return A.prepend(l(i,L)),A}function T(c={},i=null,y=null){const p=b("button",c,i);return y&&p.addEventListener("click",y),p}function x(c={},i=null){return b("div",c,i)}function S(c={}){return b("i",c)}function l(c,i={}){i.width||="1em",i.height||="1em",i.paddingBottom||="1px";const y=S(i);return y.setAttribute("data-lucide",c),y}function b(c,i,y=null){if(typeof i!="object"||i===null)throw new TypeError("styles should be an object");const p=document.createElement(c);return(0,v.ZM)(p,i),y&&(p.innerHTML=y),p}},573:(w,a,t)=>{t.d(a,{Fi:()=>v,fI:()=>g});function C(l,b=document){return!!b.querySelector(l)}function v(l,b=document,c=!1){const i=b.querySelector(l);return c&&!i&&console.log(`No element found for selector: ${l}`),i}function g(l,b=document,c=!1){const i=b.querySelectorAll(l);return c&&!i.length&&console.log(`No elements found for selector: ${l}`),i}function f(l,b=1){let c=l;for(let i=0;i<b;i++){if(!c.parentElement)return null;c=c.parentElement}return c}function h(l,b,c){return[...l.querySelectorAll(b)].find(i=>i.textContent.trim().includes(c))}function r(l,b,c=!1,i=!1,y=null){const p=v(b,l);return e(p,c,i,y)}function e(l,b=!1,c=!1,i=null){if(!l)return i===null?(console.log("No element found"),null):i;const y=l.innerText;return F(y,b,c)}function o(l,b,c=!1){const i=l[b];return e(i,c)}function m(l,b=!1,c=!1){const i=l.textContent;return F(i,b,c)}function F(l,b,c){b&&(l=removeNonNumber(l)),c&&(l=l.replace(",","."));const i=Number(l);return Number.isNaN(i)?(console.log(`Invalid number: ${l}`),0):i}function T(l){return[...l.childNodes].find(b=>b.nodeType===Node.TEXT_NODE)}function x(l){const b=c=>c.nodeType===Node.TEXT_NODE&&c.textContent.trim()!==""?[c]:[...c.childNodes].flatMap(b);return b(l)}function S(l){return normalizeSpacing(l.textContent)}},5539:(w,a,t)=>{t.d(a,{Bt:()=>v,kl:()=>e});function C(n,E){n.parentNode.insertBefore(E,n.nextSibling)}function v(n){n.style.display="none"}function g(n,E=1){const k=document.querySelector(n);k&&f(k,E)}function f(n,E=1){const k=getElementAncestor(n,E);k&&v(k)}function h(n){x(n),v(n)}function r(n){n.intersectionObserver||runOnceOnIntersection(n,()=>v(n))}function e(n){n.style.display=""}function o(n){const E=T(n);n.style.display=E}function m(n,E){E?v(n):e(n)}function F(n,E){E?r(n):(clearIntersectionObserver(n),e(n))}function T(n){return x(n),n.defaultDisplay}function x(n){if(n.defaultDisplay)return;const{display:E}=getComputedStyle(n);n.defaultDisplay=E}function S(){return{show:[],hide:[]}}function l(n,E,k){n?E.hide.push(k):E.show.push(k)}function b(n){n.show.forEach(e),n.hide.forEach(v)}function c(n,E,k=.3){E?y(n,k):i(n)}function i(n){n.style.opacity=""}function y(n,E=.3){n.style.opacity=E}function p(n){n.style.order=""}function L(n,E){n.style.order=E}function A(n,E){n.style.background=E}function O(n,E){const k=getFirstElement(E);k&&s(n,k)}function s(n,E){const k=createLink();k.href=n,E.parentNode.append(k),k.append(E)}function d(n,E){const k=getFirstElement(E);k&&u(n,k)}function u(n,E){const k=createLink();k.href=n,k.append(...E.childNodes),E.append(k)}function N(){const n=getURLQueryParam("scrollTo");if(!n)return;const E=document.getElementById(n);E?E.scrollIntoView():console.log(`Element with ID "${n}" was not found.`)}function I(n,E,k="text/plain"){const B=new Blob([n],{type:k}),R=URL.createObjectURL(B),_=document.createElement("a");_.href=R,_.download=E,document.body.appendChild(_),_.click(),document.body.removeChild(_),requestAnimationFrame(()=>URL.revokeObjectURL(R))}},6754:(w,a,t)=>{t.d(a,{ZM:()=>C});function C(h,r){Object.assign(h.style,r)}function v(h,r="custom-global-style"){let e=document.getElementById(r);e||(e=document.createElement("style"),e.id=r,e.type="text/css",document.head.appendChild(e)),e.textContent=h}function g(h){return Object.entries(h).map(([r,e])=>`${r.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${e};`).join(" ")}function f(h){return h?h.split(";").filter(r=>r.trim()!=="").reduce((r,e)=>{const[o,m]=e.split(":").map(T=>T.trim()),F=o.replace(/-([a-z])/g,(T,x)=>x.toUpperCase());return r[F]=m,r},{}):{}}},4921:(w,a,t)=>{t.d(a,{sg:()=>f,xk:()=>C});function C(e,o,m=null){const F=e.querySelector(o);return F?Promise.resolve(F):new Promise(T=>{const x=new MutationObserver(l);x.observe(e,{childList:!0,subtree:!0});let S;m&&(S=setTimeout(()=>{x.disconnect(),console.log(`No element found for selector: ${o}`),T(null)},m));function l(){const b=e.querySelector(o);b&&(S&&clearTimeout(S),x.disconnect(),T(b))}})}function v(e,o){return e.querySelector(o)?new Promise(F=>{const T=new MutationObserver(x);T.observe(e,{childList:!0,subtree:!0});function x(){e.querySelector(o)||(T.disconnect(),F())}}):Promise.resolve()}function g(e,o=400){return new Promise(m=>{let F;const T=new MutationObserver(()=>{clearTimeout(F),x()});function x(){F=setTimeout(()=>{T.disconnect(),m()},o)}x(),T.observe(e,{childList:!0,subtree:!0})})}function f(e,o=250){let m;return(...F)=>{clearTimeout(m),m=setTimeout(()=>e(...F),o)}}function h(e,o){const m=new IntersectionObserver(F=>{F.forEach(T=>{T.isIntersecting&&(o(),r(e))})});e.intersectionObserver=m,m.observe(e)}function r(e){e.intersectionObserver&&(e.intersectionObserver.disconnect(),e.intersectionObserver=null)}},3829:(w,a,t)=>{t.d(a,{JE:()=>g});function C(r,e){return!v(r,e)}function v(r,e){if(!e.value)return!0;const o=r.toLowerCase(),m=getSearchStrings(e),F=[],T=[];return m.forEach(x=>{if(x.startsWith("!")){const S=x.substring(1);S&&T.push(S)}else F.push(x)}),F.every(x=>o.includes(x))&&T.every(x=>!o.includes(x))}function g(r,e){return e.value!=null&&r<e.value}function f(r,e){return e.value!=null&&r>e.value}function h(r,e){return e.value&&r!==e.value}},4521:(w,a,t)=>{t.d(a,{z:()=>v});var C=t(3048);function v(g,f=null){return{createGlobalFilter(h,r=null,e=g){return C.V.create(h,r,e)},createSectionFilter(h,r=null,e=g){if(!f)throw new Error("sectionId must be provided to use createSectionFilter.");return C.V.createWithCompositeKey(f,h,r,e)}}}},5884:(w,a,t)=>{t.d(a,{Hw:()=>h,nW:()=>f});var C=t(9928),v=t(5467);function g(r,e,o={},m={}){const F=createTextInput(m,e.updateValueFromEvent,e.value);return createControl(F,o,r)}function f(r,e,o,m,F,T={},x={}){const S=(0,C.o5)(x,e.updateValueFromEvent,e.value,o,m,F);return(0,v.E2)(S,T,r)}function h(r,e,o={},m={}){const F=(0,C.S)(m,e.updateValueFromEvent,e.value);return(0,v.E2)(F,o,r)}},7877:(w,a,t)=>{t.d(a,{aW:()=>l,pW:()=>O});var C=t(5884);function v(s,d={},u={}){return createTextFilterControl("\u041F\u043E\u0438\u0441\u043A: ",s,d,u)}function g(s,d={},u={},N=.1,I=3){return createNumberFilterControl("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",s,N,I,5,d,u)}function f(s,d={},u={},N=.1,I=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",s,N,I,5,d,u)}function h(s,d={},u={}){return e("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",s,d,u)}function r(s,d={},u={}){return e("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",s,d,u)}function e(s,d,u={},N={}){return createNumberFilterControl(s,d,"1","1","999999",u,N)}function o(s,d={},u={}){return m("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",s,d,u)}function m(s,d,u={},N={}){return createNumberFilterControl(s,d,"5","0","100",u,N)}function F(s,d={},u={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",s,"5","0","100",d,u)}function T(s,d,u={},N={},I="250"){return createNumberFilterControl(s,d,I,"0","1000000",u,N)}function x(s,d={},u={},N="25"){return T("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",s,d,u,N)}function S(s,d={},u={},N="25"){return T("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",s,d,u,N)}function l(s,d={},u={}){return b("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",s,d,u)}function b(s,d,u={},N={}){return(0,C.nW)(s,d,"1","0","99999",u,N)}function c(s,d={},u={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",s,"1","2","7",d,u)}function i(s,d={},u={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",s,1,1,10,d,u)}function y(s,d={},u={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",s,d,u)}function p(s,d={},u={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",s,d,u)}function L(s,d={},u={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",s,d,u)}function A(s,d={},u={}){return createCheckboxFilterControl("\u0411\u0430\u043B\u043B\u044B: ",s,d,u)}function O(s,d={},u={}){return(0,C.Hw)("\u0412\u043A\u043B: ",s,d,u)}},5213:(w,a,t)=>{t.d(a,{b:()=>g});var C=t(9928),v=t(573);function g(f,h,r=!1,e="customFiltersContainer"){let o=(0,v.Fi)(`#${e}`,f);if(o)if(r)o.remove();else return;o=(0,C.Sw)(),o.id=e,h(o,f)}},8200:(w,a,t)=>{t.d(a,{s:()=>C});function C(v){const{target:g}=v,{type:f}=g;switch(f){case"text":return`"${g.value}"`;case"number":return g.value;case"checkbox":return g.checked;default:return console.log(`Unknown input type: ${f}`),null}}},157:(w,a,t)=>{t.d(a,{Fg:()=>C,vx:()=>g});const C=window.GM_setValue,v=window.GM.setValue,g=window.GM_getValue},1870:(w,a,t)=>{t.d(a,{j:()=>C});class C{constructor(g,f){this.value=g,this.onChange=f}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(w,a,t)=>{t.d(a,{V:()=>h});var C=t(1870),v=t(8200),g=t(3976),f=t(157);class h extends C.j{constructor(e,o=null,m=null){super((0,f.vx)(e,o),m),this.storageKey=e,this.defaultValue=o}static create(e,o=null,m=null){return new h(e,o,m)}static createWithCompositeKey(e,o,m=null,F=null){const T=`${e}-${o}`;return new h(T,m,F)}updateValueFromEvent=e=>{const o=(0,v.s)(e),m=(0,g.$)(o);this.updateValue(m)};updateValue(e,o=!0){this.value!==e&&((0,f.Fg)(this.storageKey,e),this.value=e,o&&this.onChangeIfDefined())}clearValue(e=!1){this.updateValue(null,e)}resetValue(e=!1){this.updateValue(this.defaultValue,e)}}},3976:(w,a,t)=>{t.d(a,{$:()=>C});function C(v){return v===""?null:JSON.parse(v)}},6213:(w,a,t)=>{t.a(w,async(C,v)=>{try{let y=function(u,N){let I=u.innerText;function n(){const E=u.innerText;E!==I&&(I=E,N()),requestAnimationFrame(n)}requestAnimationFrame(n)},L=function(u,N){(0,x.ZM)(u,e.r.FILTERS_CONTAINER);const I=(0,h.aW)(l,e.r.CONTROL,e.r.NUMBER_INPUT),n=(0,h.pW)(b,e.r.CONTROL,e.r.CHECKBOX_INPUT);u.append(I,n),N.append(u)},A=function(){(0,f.fI)(r.Z.COMMENTS).forEach(O)},O=function(u){if(!b.value){d(u);return}let N=c.commentsCache.get(u);if(!N){const n=(0,f.Fi)(r.Z.RATING_WRAP,u);if(!n)return;const E=n.innerText.trim();if(E==="")return;N={rating:+E},c.commentsCache.set(u,N)}(0,F.JE)(N.rating,l)?s(u):d(u)},s=function(u){(0,g.Bt)(u);const N=u.parentElement;N&&[...N.children].every(I=>I.style.display==="none")&&s(N)},d=function(u){(0,g.kl)(u);const N=u.parentElement;N&&N.style.display==="none"&&d(N)};var g=t(5539),f=t(573),h=t(7877),r=t(1719),e=t(9175),o=t(4521),m=t(5213),F=t(3829),T=t(4921),x=t(6754);const{createGlobalFilter:S}=(0,o.z)(A),l=S("min-rating-filter",4),b=S("filter-enabled",!0),c={commentsCache:new WeakMap};await i();async function i(){const u=await(0,T.xk)(document,r.Z.COMMENTS_TREE);y(u,p)}async function p(){const u=await(0,T.xk)(document,r.Z.COMMENTS_HEADER);(0,m.b)(u,L),A()}v()}catch(S){v(S)}},1)},1719:(w,a,t)=>{t.d(a,{Z:()=>C});const C={COMMENTS_TREE:".tm-comments__tree",COMMENTS_HEADER:".tm-comments-wrapper__header",COMMENTS:".tm-comment-thread__comment:not(.process-passed)",RATING_WRAP:".tm-votes-lever__score-counter"}},9175:(w,a,t)=>{t.d(a,{r:()=>v});const v={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",marginLeft:"28px"},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},NUMBER_INPUT:{...{INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px",fontSize:"15px"}}.INPUT,width:"35px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},M={};function D(w){var a=M[w];if(a!==void 0)return a.exports;var t=M[w]={exports:{}};return P[w](t,t.exports,D),t.exports}(()=>{var w=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",a=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",t=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",C=g=>{g&&g.d<1&&(g.d=1,g.forEach(f=>f.r--),g.forEach(f=>f.r--?f.r++:f()))},v=g=>g.map(f=>{if(f!==null&&typeof f=="object"){if(f[w])return f;if(f.then){var h=[];h.d=0,f.then(o=>{r[a]=o,C(h)},o=>{r[t]=o,C(h)});var r={};return r[w]=o=>o(h),r}}var e={};return e[w]=o=>{},e[a]=f,e});D.a=(g,f,h)=>{var r;h&&((r=[]).d=-1);var e=new Set,o=g.exports,m,F,T,x=new Promise((S,l)=>{T=l,F=S});x[a]=o,x[w]=S=>(r&&S(r),e.forEach(S),x.catch(l=>{})),g.exports=x,f(S=>{m=v(S);var l,b=()=>m.map(i=>{if(i[t])throw i[t];return i[a]}),c=new Promise(i=>{l=()=>i(b),l.r=0;var y=p=>p!==r&&!e.has(p)&&(e.add(p),p&&!p.d&&(l.r++,p.push(l)));m.map(p=>p[w](y))});return l.r?c:b()},S=>(S?T(x[t]=S):F(o),C(r))),r&&r.d<0&&(r.d=0)}})(),D.d=(w,a)=>{for(var t in a)D.o(a,t)&&!D.o(w,t)&&Object.defineProperty(w,t,{enumerable:!0,get:a[t]})},D.o=(w,a)=>Object.prototype.hasOwnProperty.call(w,a);var W=D(6213)})();})();
