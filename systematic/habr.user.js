// ==UserScript==
// @name         Habr comments filter
// @description  Hide comments by filter
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://habr.com/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.76927367
// @icon         https://www.google.com/s2/favicons?sz=64&domain=habr.com
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/habr.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var $={5467:(k,m,n)=>{n.d(m,{E2:()=>b});var T=n(9928);function b(C,d={},t=null){const s=(0,T.Sw)(d,t);return s.append(C),s}function g(C,d=null,t={},s={}){const o=createActionLink(C,d,s);return b(o,t)}function p(C,d=null,t=null,s={},o={}){const a=createActionLinkWithIcon(C,t,d,o);return b(a,s)}},9928:(k,m,n)=>{n.d(m,{S:()=>d,Sw:()=>c,o5:()=>p});var T=n(4921),b=n(6754);function g(F,f,S){const y=t(F,"text",f);return y.value=S,y}function p(F,f,S,y,_,L){const O=t(F,"number",f);return O.value=S,O.step=y,O.min=_,O.max=L,O}function C(F,f,S){const y=t(F,"date",f);return y.value=S,y}function d(F,f,S){const y=t(F,"checkbox",f);return y.checked=S,y}function t(F={},f=null,S=null){const y=h("input",F);return f&&(y.type=f),S&&(y.addEventListener("keyup",(0,T.sg)(S,200)),y.addEventListener("change",(0,T.sg)(S,100))),y}function s(F,f,S){const y=h("select",F);return f&&y.addEventListener("change",f),y.value=S,y}function o(F={},f=null){return h("span",F,f)}function a(F={},f=null,S=null){const y=h("a",F,f);return S&&(y.href=S),y}function i(F,f=null,S={}){S.cursor||="pointer";const y=a(S,f);return F&&y.addEventListener("click",F),y}function v(F,f,S=null,y={},_={}){y.display||="inline-flex",y.alignItems||="center",y.gap||="0.25em";const L=i(F,S,y);return L.prepend(w(f,_)),L}function N(F={},f=null,S=null){const y=h("button",F,f);return S&&y.addEventListener("click",S),y}function c(F={},f=null){return h("div",F,f)}function x(F={},f=null){return h("i",F,f)}function w(F,f={}){f.width||="1em",f.height||="1em",f.paddingBottom||="1px";const S=x(f);return S.setAttribute("data-lucide",F),S}function h(F,f,S=null){if(typeof f!="object"||f===null)throw new TypeError("styles should be an object");const y=document.createElement(F);return(0,b.ZM)(y,f),S&&(y.innerHTML=S),y}},573:(k,m,n)=>{n.d(m,{Fi:()=>b,fI:()=>g});function T(c,x=document){return!!x.querySelector(c)}function b(c,x=document,w=!1){const h=x.querySelector(c);return w&&!h&&console.log(`No element found for selector: ${c}`),h}function g(c,x=document,w=!1){const h=x.querySelectorAll(c);return w&&!h.length&&console.log(`No elements found for selector: ${c}`),h}function p(c,x=1){let w=c;for(let h=0;h<x;h++){if(!w.parentElement)return null;w=w.parentElement}return w}function C(c,x,w){return[...c.querySelectorAll(x)].find(h=>h.textContent.trim().includes(w))}function d(c,x,w=!1,h=!1,F=null){const f=b(x,c);return t(f,w,h,F)}function t(c,x=!1,w=!1,h=null){if(!c)return h===null?(console.log("No element found"),null):h;const F=c.innerText;return a(F,x,w)}function s(c,x,w=!1){const h=c[x];return t(h,w)}function o(c,x=!1,w=!1){const h=c.textContent;return a(h,x,w)}function a(c,x,w){x&&(c=removeNonNumber(c)),w&&(c=c.replace(",","."));const h=Number(c);return Number.isNaN(h)?(console.log(`Invalid number: ${c}`),0):h}function i(c){return[...c.childNodes].find(x=>x.nodeType===Node.TEXT_NODE)}function v(c){const x=w=>w.nodeType===Node.TEXT_NODE&&w.textContent.trim()!==""?[w]:[...w.childNodes].flatMap(x);return x(c)}function N(c){return normalizeSpacing(c.textContent)}},5539:(k,m,n)=>{n.d(m,{Bt:()=>b,kl:()=>t});function T(e,E){e.parentNode.insertBefore(E,e.nextSibling)}function b(e){e.style.display="none"}function g(e,E=1){const D=document.querySelector(e);D&&p(D,E)}function p(e,E=1){const D=getElementAncestor(e,E);D&&b(D)}function C(e){v(e),b(e)}function d(e){e.intersectionObserver||runOnceOnIntersection(e,()=>b(e))}function t(e){e.style.display=""}function s(e){const E=i(e);e.style.display=E}function o(e,E){E?b(e):t(e)}function a(e,E){E?d(e):(clearIntersectionObserver(e),t(e))}function i(e){return v(e),e.defaultDisplay}function v(e){if(e.defaultDisplay)return;const{display:E}=getComputedStyle(e);e.defaultDisplay=E}function N(){return{show:[],hide:[]}}function c(e,E,D){e?E.hide.push(D):E.show.push(D)}function x(e){e.show.forEach(t),e.hide.forEach(b)}function w(e,E,D=.3){E?F(e,D):h(e)}function h(e){e.style.opacity=""}function F(e,E=.3){e.style.opacity=E}function f(e){e.style.order=""}function S(e,E){e.style.order=E}function y(e,E){e.style.background=E}function _(e,E){const D=getFirstElement(E);D&&L(e,D)}function L(e,E){const D=createLink();D.href=e,E.parentNode.append(D),D.append(E)}function O(e,E){const D=getFirstElement(E);D&&r(e,D)}function r(e,E,D={}){const R=createLink(D);R.href=e,R.append(...E.childNodes),E.append(R)}function u(){const e=getURLQueryParam("scrollTo");if(!e)return;const E=document.getElementById(e);E?E.scrollIntoView():console.log(`Element with ID "${e}" was not found.`)}function l(e,E,D=null){const R=`${E}-click-passed`,M=D?I=>findElementByText(I,e,D):I=>getFirstElement(e,I);return function(I){if(I.hasAttribute(R))return!1;const V=M(I);return V&&V.click(),I.setAttribute(R,""),!0}}function A(e,E,D="text/plain"){const R=new Blob([e],{type:D}),M=URL.createObjectURL(R),I=document.createElement("a");I.href=M,I.download=E,document.body.appendChild(I),I.click(),document.body.removeChild(I),requestAnimationFrame(()=>URL.revokeObjectURL(M))}},6754:(k,m,n)=>{n.d(m,{ZM:()=>T});function T(C,d){Object.assign(C.style,d)}function b(C,d="custom-global-style"){let t=document.getElementById(d);t||(t=document.createElement("style"),t.id=d,t.type="text/css",document.head.appendChild(t)),t.textContent=C}function g(C){return Object.entries(C).map(([d,t])=>`${d.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${t};`).join(" ")}function p(C){return C?C.split(";").filter(d=>d.trim()!=="").reduce((d,t)=>{const[s,o]=t.split(":").map(i=>i.trim()),a=s.replace(/-([a-z])/g,(i,v)=>v.toUpperCase());return d[a]=o,d},{}):{}}},4921:(k,m,n)=>{n.d(m,{sg:()=>p,xk:()=>T});function T(o,a,i=null){const v=o.querySelector(a);return v?Promise.resolve(v):new Promise(N=>{const c=new MutationObserver(w);c.observe(o,{childList:!0,subtree:!0});let x;i&&(x=setTimeout(()=>{c.disconnect(),console.log(`No element found for selector: ${a}`),N(null)},i));function w(){const h=o.querySelector(a);h&&(x&&clearTimeout(x),c.disconnect(),N(h))}})}function b(o,a){return o.querySelector(a)?new Promise(v=>{const N=new MutationObserver(c);N.observe(o,{childList:!0,subtree:!0});function c(){o.querySelector(a)||(N.disconnect(),v())}}):Promise.resolve()}function g(o,a=400){return new Promise(i=>{let v;const N=new MutationObserver(()=>{clearTimeout(v),c()});function c(){v=setTimeout(()=>{N.disconnect(),i()},a)}c(),N.observe(o,{childList:!0,subtree:!0})})}function p(o,a=250){let i;return(...v)=>{clearTimeout(i),i=setTimeout(()=>o(...v),a)}}async function C(o){document.visibilityState==="visible"?await o():document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&await o()},{once:!0})}function d(o,a){const i=new IntersectionObserver(v=>{v.forEach(N=>{N.isIntersecting&&(a(),t(o))})});o.intersectionObserver=i,i.observe(o)}function t(o){o.intersectionObserver&&(o.intersectionObserver.disconnect(),o.intersectionObserver=null)}function s(o){o&&(o.disconnect(),o=null)}},3829:(k,m,n)=>{n.d(m,{JE:()=>C});function T(a,i){return!b(a,i)}function b(a,i){if(!i||!i.value)return!0;const v=parseFilterQuery(i.value);return g(a,v)}function g(a,i){if(!i||!i.length)return!0;const v=(a||"").toLowerCase();return i.every(N=>p(v,N))}function p(a,i){return i.some(({term:v,isNegative:N})=>{const c=a.includes(v);return N?!c:c})}function C(a,i){return i.value!=null&&a<i.value}function d(a,i){return i.value!=null&&a>i.value}function t(a,i){return i.value==null?!1:a<parseDateFromISO(i.value)}function s(a,i){return i.value==null?!1:a>parseDateFromISO(i.value)}function o(a,i){return i.value&&a!==i.value}},4521:(k,m,n)=>{n.d(m,{z:()=>b});var T=n(3048);function b(g,p=null){return{createGlobalFilter(C,d=null,t=g){return T.V.create(C,d,t)},createSectionFilter(C,d=null,t=g){if(!p)throw new Error("sectionId must be provided to use createSectionFilter.");return T.V.createWithCompositeKey(p,C,d,t)}}}},5884:(k,m,n)=>{n.d(m,{Hw:()=>t,nW:()=>p});var T=n(9928),b=n(5467);function g(s,o,a={},i={}){const v=createTextInput(i,o.updateValueFromEvent,o.value);return createControl(v,a,s)}function p(s,o,a,i,v,N={},c={}){const x=(0,T.o5)(c,o.updateValueFromEvent,o.value,a,i,v);return(0,b.E2)(x,N,s)}function C(s,o,a={},i={}){const v=createSelect(i,o.updateValueFromEvent,o.value);return createControl(v,a,s)}function d(s,o,a={},i={}){const v=createDateInput(i,o.updateValueFromEvent,o.value);return createControl(v,a,s)}function t(s,o,a={},i={}){const v=(0,T.S)(i,o.updateValueFromEvent,o.value);return(0,b.E2)(v,a,s)}},7877:(k,m,n)=>{n.d(m,{aW:()=>x,pW:()=>L});var T=n(5884);function b(r,u={},l={}){return createTextFilterControl("\u041F\u043E\u0438\u0441\u043A: ",r,u,l)}function g(r,u={},l={},A=.1,e=3){return createNumberFilterControl("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",r,A,e,5,u,l)}function p(r,u={},l={},A=.1,e=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",r,A,e,5,u,l)}function C(r,u={},l={}){return t("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",r,u,l)}function d(r,u={},l={}){return t("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",r,u,l)}function t(r,u,l={},A={}){return createNumberFilterControl(r,u,"1","1","999999",l,A)}function s(r,u={},l={}){return createDateFilterControl("\u041C\u0438\u043D. \u0434\u0430\u0442\u0430: ",r,u,l)}function o(r,u={},l={}){return a("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",r,u,l)}function a(r,u,l={},A={}){return createNumberFilterControl(r,u,"5","0","100",l,A)}function i(r,u={},l={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",r,"5","0","100",u,l)}function v(r,u,l={},A={},e="250"){return createNumberFilterControl(r,u,e,"0","1000000",l,A)}function N(r,u={},l={},A="25"){return v("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",r,u,l,A)}function c(r,u={},l={},A="25"){return v("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",r,u,l,A)}function x(r,u={},l={}){return w("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",r,u,l)}function w(r,u,l={},A={}){return(0,T.nW)(r,u,"1","0","99999",l,A)}function h(r,u={},l={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",r,"1","2","8",u,l)}function F(r,u={},l={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",r,1,1,10,u,l)}function f(r,u={},l={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",r,u,l)}function S(r,u={},l={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",r,u,l)}function y(r,u={},l={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",r,u,l)}function _(r,u={},l={}){return createCheckboxFilterControl("\u0411\u043E\u043D\u0443\u0441: ",r,u,l)}function L(r,u={},l={}){return(0,T.Hw)("\u0412\u043A\u043B: ",r,u,l)}function O(r,u,l={}){const A=[{value:-25,emoji:"\u{1F48E}",tooltip:"\u0421\u0443\u043F\u0435\u0440 \u0446\u0435\u043D\u0430 (-25%)"},{value:-15,emoji:"\u{1F525}",tooltip:"\u041E\u0442\u043B\u0438\u0447\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-15%)"},{value:-5,emoji:"\u{1F31F}",tooltip:"\u041A\u043B\u0430\u0441\u0441\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-5%)"},{value:5,emoji:"\u{1F44C}",tooltip:"\u0425\u043E\u0440\u043E\u0448\u0430\u044F \u0446\u0435\u043D\u0430 (+5%)"}],e={active:{background:"#e3f2fd",borderColor:"#2196f3",boxShadow:"0 0 0 1px #2196f3"},inactive:{background:"#fff",borderColor:"#ccc",boxShadow:"none"},hover:{background:"#f5f5f5"}},E=createDiv({display:"inline-flex",gap:"4px",marginLeft:"4px"}),D=[],R=()=>u?parseFloat(u.value)||0:r.value,M=()=>{const I=R();D.forEach(({button:V,value:U})=>{const W=U<=I?e.active:e.inactive;Object.assign(V.style,W)})};return A.forEach(({value:I,emoji:V,tooltip:U})=>{const B=createButton({padding:"2px 6px",fontSize:"16px",cursor:"pointer",border:"1px solid #ccc",borderRadius:"4px",background:"#fff",transition:"all 0.2s",...l},V);B.title=U,B.type="button",B.addEventListener("click",W=>{W.preventDefault(),r.updateValue(I),u&&(u.value=I),M()}),B.addEventListener("mouseenter",()=>{I<=R()||(B.style.background=e.hover.background)}),B.addEventListener("mouseleave",()=>{M()}),D.push({button:B,value:I}),E.appendChild(B)}),M(),u&&(u.addEventListener("input",M),u.addEventListener("change",M)),E}},5213:(k,m,n)=>{n.d(m,{b:()=>g});var T=n(9928),b=n(573);function g(p,C,d=!1,t="customFiltersContainer"){let s=(0,b.Fi)(`#${t}`,p);if(s)if(d)s.remove();else return;s=(0,T.Sw)(),s.id=t,C(s,p)}},8200:(k,m,n)=>{n.d(m,{s:()=>T});function T(b){const{target:g}=b,{type:p}=g;switch(p){case"text":return`"${g.value}"`;case"number":return g.value;case"select-one":return g.value;case"date":return`"${g.value}"`;case"checkbox":return g.checked;default:return console.log(`Unknown input type: ${p}`),null}}},157:(k,m,n)=>{n.d(m,{Fg:()=>T,vx:()=>g});const T=window.GM_setValue,b=window.GM.setValue,g=window.GM_getValue},1870:(k,m,n)=>{n.d(m,{j:()=>T});class T{constructor(g,p){this.value=g,this.onChange=p}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(k,m,n)=>{n.d(m,{V:()=>C});var T=n(1870),b=n(8200),g=n(3976),p=n(157);class C extends T.j{constructor(t,s=null,o=null){super((0,p.vx)(t,s),o),this.storageKey=t,this.defaultValue=s}static create(t,s=null,o=null){return new C(t,s,o)}static createWithCompositeKey(t,s,o=null,a=null){const i=`${t}-${s}`;return new C(i,o,a)}updateValueFromEvent=t=>{const s=(0,b.s)(t),o=(0,g.$)(s);this.updateValue(o)};updateValue(t,s=!0){this.value!==t&&((0,p.Fg)(this.storageKey,t),this.value=t,s&&this.onChangeIfDefined())}clearValue(t=!1){this.updateValue(null,t)}resetValue(t=!1){this.updateValue(this.defaultValue,t)}}},3976:(k,m,n)=>{n.d(m,{$:()=>T});function T(b){return b===""?null:JSON.parse(b)}},6213:(k,m,n)=>{n.a(k,async(T,b)=>{try{let F=function(r,u){let l=r.innerText;function A(){const e=r.innerText;e!==l&&(l=e,u()),requestAnimationFrame(A)}requestAnimationFrame(A)},S=function(r,u){(0,v.ZM)(r,t.r.FILTERS_CONTAINER),(0,v.ZM)(u,t.r.FILTERS_CONTAINER_WRAP);const l=(0,C.aW)(c,t.r.CONTROL,t.r.NUMBER_INPUT),A=(0,C.pW)(x,t.r.CONTROL,t.r.CHECKBOX_INPUT);r.append(l,A),u.append(r)},y=function(){(0,p.fI)(d.Z.COMMENTS).forEach(_)},_=function(r){if(!x.value){O(r);return}let u=w.commentsCache.get(r);if(!u){const A=(0,p.Fi)(d.Z.RATING_WRAP,r);if(!A)return;const e=A.innerText.trim();if(e==="")return;u={rating:+e},w.commentsCache.set(r,u)}(0,a.JE)(u.rating,c)?L(r):O(r)},L=function(r){(0,g.Bt)(r);const u=r.parentElement;u&&[...u.children].every(l=>l.style.display==="none")&&L(u)},O=function(r){(0,g.kl)(r);const u=r.parentElement;u&&u.style.display==="none"&&O(u)};var g=n(5539),p=n(573),C=n(7877),d=n(1719),t=n(9175),s=n(4521),o=n(5213),a=n(3829),i=n(4921),v=n(6754);const{createGlobalFilter:N}=(0,s.z)(y),c=N("min-rating-filter",4),x=N("filter-enabled",!0),w={commentsCache:new WeakMap};await h();async function h(){const r=await(0,i.xk)(document,d.Z.COMMENTS_TREE);F(r,f)}async function f(){const r=await(0,i.xk)(document,d.Z.COMMENTS_HEADER);(0,o.b)(r,S),y()}b()}catch(N){b(N)}},1)},1719:(k,m,n)=>{n.d(m,{Z:()=>T});const T={COMMENTS_TREE:".tm-comments__tree",COMMENTS_HEADER:".tm-comments-wrapper__header",COMMENTS:".tm-comment-thread__comment:not(.process-passed)",RATING_WRAP:".tm-votes-lever__score-counter"}},9175:(k,m,n)=>{n.d(m,{r:()=>b});const b={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",marginLeft:"28px"},FILTERS_CONTAINER_WRAP:{background:"#fff",borderBottom:"1px solid rgba(146, 156, 165, .4)",position:"sticky",top:"56px",zIndex:10},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},NUMBER_INPUT:{...{INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px",fontSize:"15px"}}.INPUT,width:"35px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},j={};function P(k){var m=j[k];if(m!==void 0)return m.exports;var n=j[k]={exports:{}};return $[k](n,n.exports,P),n.exports}(()=>{var k=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",m=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",n=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",T=g=>{g&&g.d<1&&(g.d=1,g.forEach(p=>p.r--),g.forEach(p=>p.r--?p.r++:p()))},b=g=>g.map(p=>{if(p!==null&&typeof p=="object"){if(p[k])return p;if(p.then){var C=[];C.d=0,p.then(s=>{d[m]=s,T(C)},s=>{d[n]=s,T(C)});var d={};return d[k]=s=>s(C),d}}var t={};return t[k]=s=>{},t[m]=p,t});P.a=(g,p,C)=>{var d;C&&((d=[]).d=-1);var t=new Set,s=g.exports,o,a,i,v=new Promise((N,c)=>{i=c,a=N});v[m]=s,v[k]=N=>(d&&N(d),t.forEach(N),v.catch(c=>{})),g.exports=v,p(N=>{o=b(N);var c,x=()=>o.map(h=>{if(h[n])throw h[n];return h[m]}),w=new Promise(h=>{c=()=>h(x),c.r=0;var F=f=>f!==d&&!t.has(f)&&(t.add(f),f&&!f.d&&(c.r++,f.push(c)));o.map(f=>f[k](F))});return c.r?w:x()},N=>(N?i(v[n]=N):a(s),T(d))),d&&d.d<0&&(d.d=0)}})(),P.d=(k,m)=>{for(var n in m)P.o(m,n)&&!P.o(k,n)&&Object.defineProperty(k,n,{enumerable:!0,get:m[n]})},P.o=(k,m)=>Object.prototype.hasOwnProperty.call(k,m);var G=P(6213)})();})();
