// ==UserScript==
// @name         Habr comments filter
// @description  Hide comments by filter
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://habr.com/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.77144488
// @icon         https://www.google.com/s2/favicons?sz=64&domain=habr.com
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/habr.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var Z={7273:(x,f,t)=>{t.d(f,{S:()=>b});var y=t(5558);function h(p={},v=null){return createElement("span",p,v)}function b(p={},v=null){return(0,y.n)("div",p,v)}},5467:(x,f,t)=>{t.d(f,{E2:()=>h});var y=t(7273);function h(v,d={},u=null){const m=(0,y.S)(d,u);return m.append(v),m}function b(v,d=null,u={},m={}){const r=createActionLink(v,d,m);return h(r,u)}function p(v,d=null,u=null,m={},r={},o={}){const n=createActionLinkWithIcon(v,u,d,r,o);return h(n,m)}},5558:(x,f,t)=>{t.d(f,{n:()=>h});var y=t(6754);function h(b,p,v=null){if(typeof p!="object"||p===null)throw new TypeError("styles should be an object");const d=document.createElement(b);return(0,y.ZM)(d,p),v&&(d.innerHTML=v),d}},740:(x,f,t)=>{t.d(f,{S:()=>d,o5:()=>p});var y=t(5558),h=t(4921);function b(r,o,n){const c=u(r,"text",o);return c.value=n,c}function p(r,o,n,c,F,l){const C=u(r,"number",o);return C.value=n,C.step=c,C.min=F,C.max=l,C}function v(r,o,n){const c=u(r,"date",o);return c.value=n,c}function d(r,o,n){const c=u(r,"checkbox",o);return c.checked=n,c}function u(r={},o=null,n=null){const c=(0,y.n)("input",r);return o&&(c.type=o),n&&(c.addEventListener("keyup",(0,h.sg)(n,200)),c.addEventListener("change",(0,h.sg)(n,100))),c}function m(r,o,n){const c=createElement("select",r);return o&&c.addEventListener("change",o),c.value=n,c}},573:(x,f,t)=>{t.d(f,{Fi:()=>h,fI:()=>b});function y(l,C=document){return!!C.querySelector(l)}function h(l,C=document,T=!1){const w=C.querySelector(l);return T&&!w&&console.log(`No element found for selector: ${l}`),w}function b(l,C=document,T=!1){const w=C.querySelectorAll(l);return T&&!w.length&&console.log(`No elements found for selector: ${l}`),w}function p(l,C=1){let T=l;for(let w=0;w<C;w++){if(!T.parentElement)return null;T=T.parentElement}return T}function v(l,C,T){return[...l.querySelectorAll(C)].find(w=>w.textContent.trim().includes(T))}function d(l,C,T=!1,w=!1,O=null){const D=h(C,l);return u(D,T,w,O)}function u(l,C=!1,T=!1,w=null){if(!l)return w===null?(console.log("No element found"),null):w;const O=l.innerText;return o(O,C,T)}function m(l,C,T=!1){const w=l[C];return u(w,T)}function r(l,C=!1,T=!1){const w=l.textContent;return o(w,C,T)}function o(l,C,T){C&&(l=removeNonNumber(l)),T&&(l=l.replace(",","."));const w=Number(l);return Number.isNaN(w)?(console.log(`Invalid number: ${l}`),0):w}function n(l){return[...l.childNodes].find(C=>C.nodeType===Node.TEXT_NODE)}function c(l){const C=T=>T.nodeType===Node.TEXT_NODE&&T.textContent.trim()!==""?[T]:[...T.childNodes].flatMap(C);return C(l)}function F(l){return normalizeSpacing(l.textContent)}},5539:(x,f,t)=>{t.d(f,{Bt:()=>h,kl:()=>m});function y(e,E){e.parentNode.insertBefore(E,e.nextSibling)}function h(e){e.style.display="none"}function b(e,E=1){const g=document.querySelector(e);g&&p(g,E)}function p(e,E=1){const g=getElementAncestor(e,E);g&&h(g)}function v(e,E,g){const k=findElementByText(e,E,g);k&&h(k)}function d(e){F(e),h(e)}function u(e){e.intersectionObserver||runOnceOnIntersection(e,()=>h(e))}function m(e){e.style.display=""}function r(e){const E=c(e);e.style.display=E}function o(e,E){E?h(e):m(e)}function n(e,E){E?u(e):(clearIntersectionObserver(e),m(e))}function c(e){return F(e),e.dataset.defaultDisplay}function F(e){if(e.dataset.defaultDisplay)return;const{display:E}=getComputedStyle(e);e.dataset.defaultDisplay=E}function l(){return{show:[],hide:[]}}function C(e,E,g){e?E.hide.push(g):E.show.push(g)}function T(e){e.show.forEach(m),e.hide.forEach(h)}function w(e,E,g=.3){E?D(e,g):O(e)}function O(e){e.style.opacity=""}function D(e,E=.3){e.style.opacity=E}function B(e){e.style.order=""}function P(e,E){e.style.order=E}function j(e,E,g,k="inline-flex"){E.style.display=e?k:"none",g.style.display=e?"none":k}function V(e,E=.3){e.style.transition="opacity 0.3s",e.style.opacity=E,a(e)}function R(e){e.style.opacity="",s(e)}function S(e){e.style.animation="loading-pulse 2.5s ease-in-out infinite",a(e)}function i(e){e.style.animation="",s(e)}function a(e){e.style.pointerEvents="none",e.style.cursor="wait"}function s(e){e.style.pointerEvents="",e.style.cursor=""}function N(e,E){const g=getFirstElement(E);g&&L(e,g)}function L(e,E){const g=createLink();g.href=e,E.parentNode.append(g),g.append(E)}function $(e,E){const g=getFirstElement(E);g&&W(e,g)}function W(e,E,g={}){const k=createLink(g);k.href=e,k.append(...E.childNodes),E.append(k)}function G(){const e=getURLQueryParam("scrollTo");if(!e)return;const E=document.getElementById(e);E?E.scrollIntoView():console.log(`Element with ID "${e}" was not found.`)}function _(e,E,g=null){const k=`${E}-click-passed`,U=g?A=>findElementByText(A,e,g):A=>getFirstElement(e,A);return function(A){if(A.hasAttribute(k))return!1;const z=U(A);return z&&z.click(),A.setAttribute(k,""),!0}}function M(e,E,g="text/plain"){const k=new Blob([e],{type:g}),U=URL.createObjectURL(k),A=document.createElement("a");A.href=U,A.download=E,document.body.appendChild(A),A.click(),document.body.removeChild(A),requestAnimationFrame(()=>URL.revokeObjectURL(U))}},6754:(x,f,t)=>{t.d(f,{ZM:()=>y});function y(v,d){Object.assign(v.style,d)}function h(v,d="custom-global-style"){let u=document.getElementById(d);u||(u=document.createElement("style"),u.id=d,u.type="text/css",document.head.appendChild(u)),u.textContent=v}function b(v){return Object.entries(v).map(([d,u])=>`${d.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${u};`).join(" ")}function p(v){return v?v.split(";").filter(d=>d.trim()!=="").reduce((d,u)=>{const[m,r]=u.split(":").map(n=>n.trim()),o=m.replace(/-([a-z])/g,(n,c)=>c.toUpperCase());return d[o]=r,d},{}):{}}},4921:(x,f,t)=>{t.d(f,{sg:()=>p,xk:()=>y});function y(r,o,n=null){const c=r.querySelector(o);return c?Promise.resolve(c):new Promise(F=>{const l=new MutationObserver(T);l.observe(r,{childList:!0,subtree:!0});let C;n&&(C=setTimeout(()=>{l.disconnect(),console.log(`No element found for selector: ${o}`),F(null)},n));function T(){const w=r.querySelector(o);w&&(C&&clearTimeout(C),l.disconnect(),F(w))}})}function h(r,o){return r.querySelector(o)?new Promise(c=>{const F=new MutationObserver(l);F.observe(r,{childList:!0,subtree:!0});function l(){r.querySelector(o)||(F.disconnect(),c())}}):Promise.resolve()}function b(r,o=400){return new Promise(n=>{let c;const F=new MutationObserver(()=>{clearTimeout(c),l()});function l(){c=setTimeout(()=>{F.disconnect(),n()},o)}l(),F.observe(r,{childList:!0,subtree:!0})})}function p(r,o=250){let n;return function(...c){const F=this;clearTimeout(n),n=setTimeout(()=>r.apply(F,c),o)}}async function v(r){document.visibilityState==="visible"?await r():document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&await r()},{once:!0})}function d(r,o){const n=new IntersectionObserver(c=>{c.forEach(F=>{F.isIntersecting&&(o(),u(r))})});r.intersectionObserver=n,n.observe(r)}function u(r){r.intersectionObserver&&(r.intersectionObserver.disconnect(),r.intersectionObserver=null)}function m(r){r&&(r.disconnect(),r=null)}},3829:(x,f,t)=>{t.d(f,{JE:()=>v});function y(o,n){return!h(o,n)}function h(o,n){if(!n||!n.value)return!0;const c=parseFilterQuery(n.value);return b(o,c)}function b(o,n){if(!n||!n.length)return!0;const c=(o||"").toLowerCase();return n.every(F=>p(c,F))}function p(o,n){return n.some(({term:c,isNegative:F})=>{const l=o.includes(c);return F?!l:l})}function v(o,n){return n.value!=null&&o<n.value}function d(o,n){return n.value!=null&&o>n.value}function u(o,n){return n.value==null?!1:o<parseDateFromISO(n.value)}function m(o,n){return n.value==null?!1:o>parseDateFromISO(n.value)}function r(o,n){return n.value&&o!==n.value}},4521:(x,f,t)=>{t.d(f,{z:()=>h});var y=t(3048);function h(b,p=null){return{createGlobalFilter(v,d=null,u=b){return y.V.create(v,d,u)},createSectionFilter(v,d=null,u=b){if(!p)throw new Error("sectionId must be provided to use createSectionFilter.");return y.V.createWithCompositeKey(p,v,d,u)}}}},5884:(x,f,t)=>{t.d(f,{Hw:()=>u,nW:()=>p});var y=t(5467),h=t(740);function b(m,r,o={},n={}){const c=createTextInput(n,r.updateValueFromEvent,r.value);return createControl(c,o,m)}function p(m,r,o,n,c,F={},l={}){const C=(0,h.o5)(l,r.updateValueFromEvent,r.value,o,n,c);return(0,y.E2)(C,F,m)}function v(m,r,o={},n={}){const c=createSelect(n,r.updateValueFromEvent,r.value);return createControl(c,o,m)}function d(m,r,o={},n={}){const c=createDateInput(n,r.updateValueFromEvent,r.value);return createControl(c,o,m)}function u(m,r,o={},n={}){const c=(0,h.S)(n,r.updateValueFromEvent,r.value);return(0,y.E2)(c,o,m)}},7877:(x,f,t)=>{t.d(f,{aW:()=>C,pW:()=>R});var y=t(5884);function h(i,a={},s={}){return createTextFilterControl("\u041F\u043E\u0438\u0441\u043A: ",i,a,s)}function b(i,a={},s={},N=.1,L=3){return createNumberFilterControl("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",i,N,L,5,a,s)}function p(i,a={},s={},N=.1,L=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",i,N,L,5,a,s)}function v(i,a={},s={}){return u("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",i,a,s)}function d(i,a={},s={}){return u("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",i,a,s)}function u(i,a,s={},N={}){return createNumberFilterControl(i,a,"1","1","999999",s,N)}function m(i,a={},s={}){return createDateFilterControl("\u041C\u0438\u043D. \u0434\u0430\u0442\u0430: ",i,a,s)}function r(i,a={},s={}){return o("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",i,a,s)}function o(i,a,s={},N={}){return createNumberFilterControl(i,a,"5","0","100",s,N)}function n(i,a={},s={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",i,"5","0","100",a,s)}function c(i,a,s={},N={},L="250"){return createNumberFilterControl(i,a,L,"0","1000000",s,N)}function F(i,a={},s={},N="25"){return c("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",i,a,s,N)}function l(i,a={},s={},N="25"){return c("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",i,a,s,N)}function C(i,a={},s={}){return T("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",i,a,s)}function T(i,a,s={},N={}){return(0,y.nW)(i,a,"1","0","99999",s,N)}function w(i,a={},s={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",i,"1","2","8",a,s)}function O(i,a={},s={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",i,1,1,10,a,s)}function D(i,a={},s={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",i,a,s)}function B(i,a={},s={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",i,a,s)}function P(i,a={},s={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",i,a,s)}function j(i,a={},s={}){return createCheckboxFilterControl("\u0411\u043E\u043D\u0443\u0441: ",i,a,s)}function V(i,a={},s={}){return createCheckboxFilterControl("\u0412 \u043D\u0430\u043B\u0438\u0447\u0438\u0438: ",i,a,s)}function R(i,a={},s={}){return(0,y.Hw)("\u0412\u043A\u043B: ",i,a,s)}function S(i,a,s={}){const N=[{value:-25,emoji:"\u{1F48E}",tooltip:"\u0421\u0443\u043F\u0435\u0440 \u0446\u0435\u043D\u0430 (-25%)"},{value:-15,emoji:"\u{1F525}",tooltip:"\u041E\u0442\u043B\u0438\u0447\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-15%)"},{value:-5,emoji:"\u{1F31F}",tooltip:"\u041A\u043B\u0430\u0441\u0441\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-5%)"},{value:5,emoji:"\u{1F44C}",tooltip:"\u0425\u043E\u0440\u043E\u0448\u0430\u044F \u0446\u0435\u043D\u0430 (+5%)"}],L={active:{background:"#e3f2fd",borderColor:"#2196f3",boxShadow:"0 0 0 1px #2196f3"},inactive:{background:"#fff",borderColor:"#ccc",boxShadow:"none"},hover:{background:"#f5f5f5"}},$=createDiv({display:"inline-flex",gap:"4px",marginLeft:"4px"}),W=[],G=()=>a?parseFloat(a.value)||0:i.value,_=()=>{const M=G();W.forEach(({button:e,value:E})=>{const k=E<=M?L.active:L.inactive;Object.assign(e.style,k)})};return N.forEach(({value:M,emoji:e,tooltip:E})=>{const g=createButton({padding:"2px 6px",fontSize:"16px",cursor:"pointer",border:"1px solid #ccc",borderRadius:"4px",background:"#fff",transition:"all 0.2s",...s},e);g.title=E,g.type="button",g.addEventListener("click",k=>{k.preventDefault(),i.updateValue(M),a&&(a.value=M),_()}),g.addEventListener("mouseenter",()=>{M<=G()||(g.style.background=L.hover.background)}),g.addEventListener("mouseleave",()=>{_()}),W.push({button:g,value:M}),$.appendChild(g)}),_(),a&&(a.addEventListener("input",_),a.addEventListener("change",_)),$}},5213:(x,f,t)=>{t.d(f,{b:()=>h});var y=t(7273);function h(b,p,v=!1,d="customFiltersContainer"){let u=b.querySelector(`#${d}`);if(u){if(!v)return;u.replaceChildren()}else u=(0,y.S)(),u.id=d;p(u,b)}},8200:(x,f,t)=>{t.d(f,{s:()=>y});function y(h){const{target:b}=h,{type:p}=b;switch(p){case"text":return`"${b.value}"`;case"number":return b.value;case"select-one":return b.value;case"date":return`"${b.value}"`;case"checkbox":return b.checked;default:return console.log(`Unknown input type: ${p}`),null}}},157:(x,f,t)=>{t.d(f,{Fg:()=>y,vx:()=>b});const y=window.GM_setValue,h=window.GM.setValue,b=window.GM_getValue},1870:(x,f,t)=>{t.d(f,{j:()=>y});class y{constructor(b,p){this.value=b,this.onChange=p}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(x,f,t)=>{t.d(f,{V:()=>v});var y=t(1870),h=t(8200),b=t(3976),p=t(157);class v extends y.j{constructor(u,m=null,r=null){super((0,p.vx)(u,m),r),this.storageKey=u,this.defaultValue=m}static create(u,m=null,r=null){return new v(u,m,r)}static createWithCompositeKey(u,m,r=null,o=null){const n=`${u}-${m}`;return new v(n,r,o)}updateValueFromEvent=u=>{const m=(0,h.s)(u),r=(0,b.$)(m);this.updateValue(r)};updateValue(u,m=!0){this.value!==u&&((0,p.Fg)(this.storageKey,u),this.value=u,m&&this.onChangeIfDefined())}clearValue(u=!1){this.updateValue(null,u)}resetValue(u=!1){this.updateValue(this.defaultValue,u)}}},3976:(x,f,t)=>{t.d(f,{$:()=>y});function y(h){return h===""?null:JSON.parse(h)}},6213:(x,f,t)=>{t.a(x,async(y,h)=>{try{let O=function(S,i){let a=S.innerText;function s(){const N=S.innerText;N!==a&&(a=N,i()),requestAnimationFrame(s)}requestAnimationFrame(s)},B=function(S,i){(0,c.ZM)(S,u.r.FILTERS_CONTAINER),(0,c.ZM)(i,u.r.FILTERS_CONTAINER_WRAP);const a=(0,v.aW)(l,u.r.CONTROL,u.r.NUMBER_INPUT),s=(0,v.pW)(C,u.r.CONTROL,u.r.CHECKBOX_INPUT);S.append(a,s),i.append(S)},P=function(){(0,p.fI)(d.Z.COMMENTS).forEach(j)},j=function(S){if(!C.value){R(S);return}let i=T.commentsCache.get(S);if(!i){const s=(0,p.Fi)(d.Z.RATING_WRAP,S);if(!s)return;const N=s.innerText.trim();if(N==="")return;i={rating:+N},T.commentsCache.set(S,i)}(0,o.JE)(i.rating,l)?V(S):R(S)},V=function(S){(0,b.Bt)(S);const i=S.parentElement;i&&[...i.children].every(a=>a.style.display==="none")&&V(i)},R=function(S){(0,b.kl)(S);const i=S.parentElement;i&&i.style.display==="none"&&R(i)};var b=t(5539),p=t(573),v=t(7877),d=t(1719),u=t(9175),m=t(4521),r=t(5213),o=t(3829),n=t(4921),c=t(6754);const{createGlobalFilter:F}=(0,m.z)(P),l=F("min-rating-filter",4),C=F("filter-enabled",!0),T={commentsCache:new WeakMap};await w();async function w(){const S=await(0,n.xk)(document,d.Z.COMMENTS_TREE);O(S,D)}async function D(){const S=await(0,n.xk)(document,d.Z.COMMENTS_HEADER);(0,r.b)(S,B),P()}h()}catch(F){h(F)}},1)},1719:(x,f,t)=>{t.d(f,{Z:()=>y});const y={COMMENTS_TREE:".tm-comments__tree",COMMENTS_HEADER:".tm-comments-wrapper__header",COMMENTS:".tm-comment-thread__comment:not(.process-passed)",RATING_WRAP:".tm-votes-lever__score-counter"}},9175:(x,f,t)=>{t.d(f,{r:()=>h});const h={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",marginLeft:"28px"},FILTERS_CONTAINER_WRAP:{background:"#fff",borderBottom:"1px solid rgba(146, 156, 165, .4)",position:"sticky",top:"56px",zIndex:10},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},NUMBER_INPUT:{...{INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px",fontSize:"15px"}}.INPUT,width:"35px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},H={};function I(x){var f=H[x];if(f!==void 0)return f.exports;var t=H[x]={exports:{}};return Z[x](t,t.exports,I),t.exports}(()=>{var x=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",f=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",t=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",y=b=>{b&&b.d<1&&(b.d=1,b.forEach(p=>p.r--),b.forEach(p=>p.r--?p.r++:p()))},h=b=>b.map(p=>{if(p!==null&&typeof p=="object"){if(p[x])return p;if(p.then){var v=[];v.d=0,p.then(m=>{d[f]=m,y(v)},m=>{d[t]=m,y(v)});var d={};return d[x]=m=>m(v),d}}var u={};return u[x]=m=>{},u[f]=p,u});I.a=(b,p,v)=>{var d;v&&((d=[]).d=-1);var u=new Set,m=b.exports,r,o,n,c=new Promise((F,l)=>{n=l,o=F});c[f]=m,c[x]=F=>(d&&F(d),u.forEach(F),c.catch(l=>{})),b.exports=c,p(F=>{r=h(F);var l,C=()=>r.map(w=>{if(w[t])throw w[t];return w[f]}),T=new Promise(w=>{l=()=>w(C),l.r=0;var O=D=>D!==d&&!u.has(D)&&(u.add(D),D&&!D.d&&(l.r++,D.push(l)));r.map(D=>D[x](O))});return l.r?T:C()},F=>(F?n(c[t]=F):o(m),y(d))),d&&d.d<0&&(d.d=0)}})(),I.d=(x,f)=>{for(var t in f)I.o(f,t)&&!I.o(x,t)&&Object.defineProperty(x,t,{enumerable:!0,get:f[t]})},I.o=(x,f)=>Object.prototype.hasOwnProperty.call(x,f);var K=I(6213)})();})();
