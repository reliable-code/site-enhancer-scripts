// ==UserScript==
// @name         Habr comments filter
// @description  Hide comments by filter
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://habr.com/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.76089594
// @icon         https://www.google.com/s2/favicons?sz=64&domain=habr.com
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/habr.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var j={5467:(T,d,r)=>{r.d(d,{E2:()=>b});var C=r(9928);function b(E,u={},e=null){const s=(0,C.Sw)(u,e);return s.append(E),s}function g(E,u=null,e={},s={}){const l=createActionLink(E,u,s);return b(l,e)}function m(E,u=null,e=null,s={},l={}){const F=createActionLinkWithIcon(E,e,u,l);return b(F,s)}},9928:(T,d,r)=>{r.d(d,{S:()=>E,Sw:()=>y,o5:()=>m});var C=r(4921),b=r(6754);function g(c,o,x){const p=u(c,"text",o);return p.value=x,p}function m(c,o,x,p,B,R){const O=u(c,"number",o);return O.value=x,O.step=p,O.min=B,O.max=R,O}function E(c,o,x){const p=u(c,"checkbox",o);return p.checked=x,p}function u(c={},o=null,x=null){const p=h("input",c);return o&&(p.type=o),x&&(p.addEventListener("keyup",(0,C.sg)(x,200)),p.addEventListener("change",(0,C.sg)(x,100))),p}function e(c={},o=null){return h("span",c,o)}function s(c={},o=null,x=null){const p=h("a",c,o);return x&&(p.href=x),p}function l(c,o=null,x={}){x.cursor||="pointer";const p=s(x,o);return c&&p.addEventListener("click",c),p}function F(c,o,x=null,p={},B={}){p.display||="inline-flex",p.alignItems||="center",p.gap||="0.25em";const R=l(c,x,p);return R.prepend(a(o,B)),R}function S(c={},o=null,x=null){const p=h("button",c,o);return x&&p.addEventListener("click",x),p}function y(c={},o=null){return h("div",c,o)}function w(c={}){return h("i",c)}function a(c,o={}){o.width||="1em",o.height||="1em",o.paddingBottom||="1px";const x=w(o);return x.setAttribute("data-lucide",c),x}function h(c,o,x=null){if(typeof o!="object"||o===null)throw new TypeError("styles should be an object");const p=document.createElement(c);return(0,b.ZM)(p,o),x&&(p.innerHTML=x),p}},573:(T,d,r)=>{r.d(d,{Fi:()=>b,fI:()=>g});function C(a,h=document){return!!h.querySelector(a)}function b(a,h=document,c=!1){const o=h.querySelector(a);return c&&!o&&console.log(`No element found for selector: ${a}`),o}function g(a,h=document,c=!1){const o=h.querySelectorAll(a);return c&&!o.length&&console.log(`No elements found for selector: ${a}`),o}function m(a,h=1){let c=a;for(let o=0;o<h;o++){if(!c.parentElement)return null;c=c.parentElement}return c}function E(a,h,c){return[...a.querySelectorAll(h)].find(o=>o.textContent.trim().includes(c))}function u(a,h,c=!1,o=!1,x=null){const p=b(h,a);return e(p,c,o,x)}function e(a,h=!1,c=!1,o=null){if(!a)return o===null?(console.log("No element found"),null):o;const x=a.innerText;return F(x,h,c)}function s(a,h,c=!1){const o=a[h];return e(o,c)}function l(a,h=!1,c=!1){const o=a.textContent;return F(o,h,c)}function F(a,h,c){h&&(a=removeNonNumber(a)),c&&(a=a.replace(",","."));const o=Number(a);return Number.isNaN(o)?(console.log(`Invalid number: ${a}`),0):o}function S(a){return[...a.childNodes].find(h=>h.nodeType===Node.TEXT_NODE)}function y(a){const h=c=>c.nodeType===Node.TEXT_NODE&&c.textContent.trim()!==""?[c]:[...c.childNodes].flatMap(h);return h(a)}function w(a){return normalizeSpacing(a.textContent)}},5539:(T,d,r)=>{r.d(d,{Bt:()=>b,kl:()=>e});function C(t,v){t.parentNode.insertBefore(v,t.nextSibling)}function b(t){t.style.display="none"}function g(t,v=1){const N=document.querySelector(t);N&&m(N,v)}function m(t,v=1){const N=getElementAncestor(t,v);N&&b(N)}function E(t){y(t),b(t)}function u(t){t.intersectionObserver||runOnceOnIntersection(t,()=>b(t))}function e(t){t.style.display=""}function s(t){const v=S(t);t.style.display=v}function l(t,v){v?b(t):e(t)}function F(t,v){v?u(t):(clearIntersectionObserver(t),e(t))}function S(t){return y(t),t.defaultDisplay}function y(t){if(t.defaultDisplay)return;const{display:v}=getComputedStyle(t);t.defaultDisplay=v}function w(){return{show:[],hide:[]}}function a(t,v,N){t?v.hide.push(N):v.show.push(N)}function h(t){t.show.forEach(e),t.hide.forEach(b)}function c(t,v,N=.3){v?x(t,N):o(t)}function o(t){t.style.opacity=""}function x(t,v=.3){t.style.opacity=v}function p(t){t.style.order=""}function B(t,v){t.style.order=v}function R(t,v){t.style.background=v}function O(t,v){const N=getFirstElement(v);N&&W(t,N)}function W(t,v){const N=createLink();N.href=t,v.parentNode.append(N),N.append(v)}function f(t,v){const N=getFirstElement(v);N&&n(t,N)}function n(t,v){const N=createLink();N.href=t,N.append(...v.childNodes),v.append(N)}function i(){const t=getURLQueryParam("scrollTo");if(!t)return;const v=document.getElementById(t);v?v.scrollIntoView():console.log(`Element with ID "${t}" was not found.`)}function k(t,v,N=null){const D=`${v}-click-passed`,L=N?I=>findElementByText(I,t,N):I=>getFirstElement(t,I);return function(I){if(I.hasAttribute(D))return!1;const _=L(I);return _&&_.click(),I.setAttribute(D,""),!0}}function A(t,v,N="text/plain"){const D=new Blob([t],{type:N}),L=URL.createObjectURL(D),I=document.createElement("a");I.href=L,I.download=v,document.body.appendChild(I),I.click(),document.body.removeChild(I),requestAnimationFrame(()=>URL.revokeObjectURL(L))}},6754:(T,d,r)=>{r.d(d,{ZM:()=>C});function C(E,u){Object.assign(E.style,u)}function b(E,u="custom-global-style"){let e=document.getElementById(u);e||(e=document.createElement("style"),e.id=u,e.type="text/css",document.head.appendChild(e)),e.textContent=E}function g(E){return Object.entries(E).map(([u,e])=>`${u.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${e};`).join(" ")}function m(E){return E?E.split(";").filter(u=>u.trim()!=="").reduce((u,e)=>{const[s,l]=e.split(":").map(S=>S.trim()),F=s.replace(/-([a-z])/g,(S,y)=>y.toUpperCase());return u[F]=l,u},{}):{}}},4921:(T,d,r)=>{r.d(d,{sg:()=>m,xk:()=>C});function C(l,F,S=null){const y=l.querySelector(F);return y?Promise.resolve(y):new Promise(w=>{const a=new MutationObserver(c);a.observe(l,{childList:!0,subtree:!0});let h;S&&(h=setTimeout(()=>{a.disconnect(),console.log(`No element found for selector: ${F}`),w(null)},S));function c(){const o=l.querySelector(F);o&&(h&&clearTimeout(h),a.disconnect(),w(o))}})}function b(l,F){return l.querySelector(F)?new Promise(y=>{const w=new MutationObserver(a);w.observe(l,{childList:!0,subtree:!0});function a(){l.querySelector(F)||(w.disconnect(),y())}}):Promise.resolve()}function g(l,F=400){return new Promise(S=>{let y;const w=new MutationObserver(()=>{clearTimeout(y),a()});function a(){y=setTimeout(()=>{w.disconnect(),S()},F)}a(),w.observe(l,{childList:!0,subtree:!0})})}function m(l,F=250){let S;return(...y)=>{clearTimeout(S),S=setTimeout(()=>l(...y),F)}}async function E(l){document.visibilityState==="visible"?await l():document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&await l()},{once:!0})}function u(l,F){const S=new IntersectionObserver(y=>{y.forEach(w=>{w.isIntersecting&&(F(),e(l))})});l.intersectionObserver=S,S.observe(l)}function e(l){l.intersectionObserver&&(l.intersectionObserver.disconnect(),l.intersectionObserver=null)}function s(l){l&&(l.disconnect(),l=null)}},3829:(T,d,r)=>{r.d(d,{JE:()=>g});function C(u,e){return!b(u,e)}function b(u,e){if(!e.value)return!0;const s=u.toLowerCase(),l=getSearchStrings(e),F=[],S=[];return l.forEach(y=>{if(y.startsWith("!")){const w=y.substring(1);w&&S.push(w)}else F.push(y)}),F.every(y=>s.includes(y))&&S.every(y=>!s.includes(y))}function g(u,e){return e.value!=null&&u<e.value}function m(u,e){return e.value!=null&&u>e.value}function E(u,e){return e.value&&u!==e.value}},4521:(T,d,r)=>{r.d(d,{z:()=>b});var C=r(3048);function b(g,m=null){return{createGlobalFilter(E,u=null,e=g){return C.V.create(E,u,e)},createSectionFilter(E,u=null,e=g){if(!m)throw new Error("sectionId must be provided to use createSectionFilter.");return C.V.createWithCompositeKey(m,E,u,e)}}}},5884:(T,d,r)=>{r.d(d,{Hw:()=>E,nW:()=>m});var C=r(9928),b=r(5467);function g(u,e,s={},l={}){const F=createTextInput(l,e.updateValueFromEvent,e.value);return createControl(F,s,u)}function m(u,e,s,l,F,S={},y={}){const w=(0,C.o5)(y,e.updateValueFromEvent,e.value,s,l,F);return(0,b.E2)(w,S,u)}function E(u,e,s={},l={}){const F=(0,C.S)(l,e.updateValueFromEvent,e.value);return(0,b.E2)(F,s,u)}},7877:(T,d,r)=>{r.d(d,{aW:()=>a,pW:()=>O});var C=r(5884);function b(f,n={},i={}){return createTextFilterControl("\u041F\u043E\u0438\u0441\u043A: ",f,n,i)}function g(f,n={},i={},k=.1,A=3){return createNumberFilterControl("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",f,k,A,5,n,i)}function m(f,n={},i={},k=.1,A=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",f,k,A,5,n,i)}function E(f,n={},i={}){return e("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",f,n,i)}function u(f,n={},i={}){return e("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",f,n,i)}function e(f,n,i={},k={}){return createNumberFilterControl(f,n,"1","1","999999",i,k)}function s(f,n={},i={}){return l("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",f,n,i)}function l(f,n,i={},k={}){return createNumberFilterControl(f,n,"5","0","100",i,k)}function F(f,n={},i={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",f,"5","0","100",n,i)}function S(f,n,i={},k={},A="250"){return createNumberFilterControl(f,n,A,"0","1000000",i,k)}function y(f,n={},i={},k="25"){return S("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",f,n,i,k)}function w(f,n={},i={},k="25"){return S("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",f,n,i,k)}function a(f,n={},i={}){return h("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",f,n,i)}function h(f,n,i={},k={}){return(0,C.nW)(f,n,"1","0","99999",i,k)}function c(f,n={},i={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",f,"1","2","7",n,i)}function o(f,n={},i={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",f,1,1,10,n,i)}function x(f,n={},i={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",f,n,i)}function p(f,n={},i={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",f,n,i)}function B(f,n={},i={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",f,n,i)}function R(f,n={},i={}){return createCheckboxFilterControl("\u0411\u0430\u043B\u043B\u044B: ",f,n,i)}function O(f,n={},i={}){return(0,C.Hw)("\u0412\u043A\u043B: ",f,n,i)}function W(f,n,i={}){const k=[{value:-25,emoji:"\u{1F48E}",tooltip:"\u0421\u0443\u043F\u0435\u0440 \u0446\u0435\u043D\u0430 (-25%)"},{value:-15,emoji:"\u{1F525}",tooltip:"\u041E\u0442\u043B\u0438\u0447\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-15%)"},{value:-5,emoji:"\u{1F31F}",tooltip:"\u041A\u043B\u0430\u0441\u0441\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-5%)"},{value:5,emoji:"\u{1F44C}",tooltip:"\u0425\u043E\u0440\u043E\u0448\u0430\u044F \u0446\u0435\u043D\u0430 (+5%)"}],A={active:{background:"#e3f2fd",borderColor:"#2196f3",boxShadow:"0 0 0 1px #2196f3"},inactive:{background:"#fff",borderColor:"#ccc",boxShadow:"none"},hover:{background:"#f5f5f5"}},t=createDiv({display:"inline-flex",gap:"4px",marginLeft:"4px"}),v=[],N=()=>n?parseFloat(n.value)||0:f.value,D=()=>{const L=N();v.forEach(({button:I,value:_})=>{const V=_<=L?A.active:A.inactive;Object.assign(I.style,V)})};return k.forEach(({value:L,emoji:I,tooltip:_})=>{const M=createButton({padding:"2px 6px",fontSize:"16px",cursor:"pointer",border:"1px solid #ccc",borderRadius:"4px",background:"#fff",transition:"all 0.2s",...i},I);M.title=_,M.type="button",M.addEventListener("click",V=>{V.preventDefault(),f.updateValue(L),n&&(n.value=L),D()}),M.addEventListener("mouseenter",()=>{L<=N()||(M.style.background=A.hover.background)}),M.addEventListener("mouseleave",()=>{D()}),v.push({button:M,value:L}),t.appendChild(M)}),D(),n&&(n.addEventListener("input",D),n.addEventListener("change",D)),t}},5213:(T,d,r)=>{r.d(d,{b:()=>g});var C=r(9928),b=r(573);function g(m,E,u=!1,e="customFiltersContainer"){let s=(0,b.Fi)(`#${e}`,m);if(s)if(u)s.remove();else return;s=(0,C.Sw)(),s.id=e,E(s,m)}},8200:(T,d,r)=>{r.d(d,{s:()=>C});function C(b){const{target:g}=b,{type:m}=g;switch(m){case"text":return`"${g.value}"`;case"number":return g.value;case"checkbox":return g.checked;default:return console.log(`Unknown input type: ${m}`),null}}},157:(T,d,r)=>{r.d(d,{Fg:()=>C,vx:()=>g});const C=window.GM_setValue,b=window.GM.setValue,g=window.GM_getValue},1870:(T,d,r)=>{r.d(d,{j:()=>C});class C{constructor(g,m){this.value=g,this.onChange=m}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(T,d,r)=>{r.d(d,{V:()=>E});var C=r(1870),b=r(8200),g=r(3976),m=r(157);class E extends C.j{constructor(e,s=null,l=null){super((0,m.vx)(e,s),l),this.storageKey=e,this.defaultValue=s}static create(e,s=null,l=null){return new E(e,s,l)}static createWithCompositeKey(e,s,l=null,F=null){const S=`${e}-${s}`;return new E(S,l,F)}updateValueFromEvent=e=>{const s=(0,b.s)(e),l=(0,g.$)(s);this.updateValue(l)};updateValue(e,s=!0){this.value!==e&&((0,m.Fg)(this.storageKey,e),this.value=e,s&&this.onChangeIfDefined())}clearValue(e=!1){this.updateValue(null,e)}resetValue(e=!1){this.updateValue(this.defaultValue,e)}}},3976:(T,d,r)=>{r.d(d,{$:()=>C});function C(b){return b===""?null:JSON.parse(b)}},6213:(T,d,r)=>{r.a(T,async(C,b)=>{try{let x=function(n,i){let k=n.innerText;function A(){const t=n.innerText;t!==k&&(k=t,i()),requestAnimationFrame(A)}requestAnimationFrame(A)},B=function(n,i){(0,y.ZM)(n,e.r.FILTERS_CONTAINER),(0,y.ZM)(i,e.r.FILTERS_CONTAINER_WRAP);const k=(0,E.aW)(a,e.r.CONTROL,e.r.NUMBER_INPUT),A=(0,E.pW)(h,e.r.CONTROL,e.r.CHECKBOX_INPUT);n.append(k,A),i.append(n)},R=function(){(0,m.fI)(u.Z.COMMENTS).forEach(O)},O=function(n){if(!h.value){f(n);return}let i=c.commentsCache.get(n);if(!i){const A=(0,m.Fi)(u.Z.RATING_WRAP,n);if(!A)return;const t=A.innerText.trim();if(t==="")return;i={rating:+t},c.commentsCache.set(n,i)}(0,F.JE)(i.rating,a)?W(n):f(n)},W=function(n){(0,g.Bt)(n);const i=n.parentElement;i&&[...i.children].every(k=>k.style.display==="none")&&W(i)},f=function(n){(0,g.kl)(n);const i=n.parentElement;i&&i.style.display==="none"&&f(i)};var g=r(5539),m=r(573),E=r(7877),u=r(1719),e=r(9175),s=r(4521),l=r(5213),F=r(3829),S=r(4921),y=r(6754);const{createGlobalFilter:w}=(0,s.z)(R),a=w("min-rating-filter",4),h=w("filter-enabled",!0),c={commentsCache:new WeakMap};await o();async function o(){const n=await(0,S.xk)(document,u.Z.COMMENTS_TREE);x(n,p)}async function p(){const n=await(0,S.xk)(document,u.Z.COMMENTS_HEADER);(0,l.b)(n,B),R()}b()}catch(w){b(w)}},1)},1719:(T,d,r)=>{r.d(d,{Z:()=>C});const C={COMMENTS_TREE:".tm-comments__tree",COMMENTS_HEADER:".tm-comments-wrapper__header",COMMENTS:".tm-comment-thread__comment:not(.process-passed)",RATING_WRAP:".tm-votes-lever__score-counter"}},9175:(T,d,r)=>{r.d(d,{r:()=>b});const b={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",marginLeft:"28px"},FILTERS_CONTAINER_WRAP:{background:"#fff",borderBottom:"1px solid rgba(146, 156, 165, .4)",position:"sticky",top:"56px",zIndex:10},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},NUMBER_INPUT:{...{INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px",fontSize:"15px"}}.INPUT,width:"35px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},U={};function P(T){var d=U[T];if(d!==void 0)return d.exports;var r=U[T]={exports:{}};return j[T](r,r.exports,P),r.exports}(()=>{var T=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",d=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",r=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",C=g=>{g&&g.d<1&&(g.d=1,g.forEach(m=>m.r--),g.forEach(m=>m.r--?m.r++:m()))},b=g=>g.map(m=>{if(m!==null&&typeof m=="object"){if(m[T])return m;if(m.then){var E=[];E.d=0,m.then(s=>{u[d]=s,C(E)},s=>{u[r]=s,C(E)});var u={};return u[T]=s=>s(E),u}}var e={};return e[T]=s=>{},e[d]=m,e});P.a=(g,m,E)=>{var u;E&&((u=[]).d=-1);var e=new Set,s=g.exports,l,F,S,y=new Promise((w,a)=>{S=a,F=w});y[d]=s,y[T]=w=>(u&&w(u),e.forEach(w),y.catch(a=>{})),g.exports=y,m(w=>{l=b(w);var a,h=()=>l.map(o=>{if(o[r])throw o[r];return o[d]}),c=new Promise(o=>{a=()=>o(h),a.r=0;var x=p=>p!==u&&!e.has(p)&&(e.add(p),p&&!p.d&&(a.r++,p.push(a)));l.map(p=>p[T](x))});return a.r?c:h()},w=>(w?S(y[r]=w):F(s),C(u))),u&&u.d<0&&(u.d=0)}})(),P.d=(T,d)=>{for(var r in d)P.o(d,r)&&!P.o(T,r)&&Object.defineProperty(T,r,{enumerable:!0,get:d[r]})},P.o=(T,d)=>Object.prototype.hasOwnProperty.call(T,d);var $=P(6213)})();})();
