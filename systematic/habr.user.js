// ==UserScript==
// @name         Habr comments filter
// @description  Hide comments by filter
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://habr.com/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.76667969
// @icon         https://www.google.com/s2/favicons?sz=64&domain=habr.com
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/habr.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var $={5467:(N,d,r)=>{r.d(d,{E2:()=>p});var y=r(9928);function p(h,s={},t=null){const i=(0,y.Sw)(s,t);return i.append(h),i}function F(h,s=null,t={},i={}){const n=createActionLink(h,s,i);return p(n,t)}function f(h,s=null,t=null,i={},n={}){const b=createActionLinkWithIcon(h,t,s,n);return p(b,i)}},9928:(N,d,r)=>{r.d(d,{S:()=>s,Sw:()=>S,o5:()=>f});var y=r(4921),p=r(6754);function F(a,v,E){const x=t(a,"text",v);return x.value=E,x}function f(a,v,E,x,R,M){const D=t(a,"number",v);return D.value=E,D.step=x,D.min=R,D.max=M,D}function h(a,v,E){const x=t(a,"date",v);return x.value=E,x}function s(a,v,E){const x=t(a,"checkbox",v);return x.checked=E,x}function t(a={},v=null,E=null){const x=g("input",a);return v&&(x.type=v),E&&(x.addEventListener("keyup",(0,y.sg)(E,200)),x.addEventListener("change",(0,y.sg)(E,100))),x}function i(a={},v=null){return g("span",a,v)}function n(a={},v=null,E=null){const x=g("a",a,v);return E&&(x.href=E),x}function b(a,v=null,E={}){E.cursor||="pointer";const x=n(E,v);return a&&x.addEventListener("click",a),x}function T(a,v,E=null,x={},R={}){x.display||="inline-flex",x.alignItems||="center",x.gap||="0.25em";const M=b(a,E,x);return M.prepend(C(v,R)),M}function w(a={},v=null,E=null){const x=g("button",a,v);return E&&x.addEventListener("click",E),x}function S(a={},v=null){return g("div",a,v)}function c(a={}){return g("i",a)}function C(a,v={}){v.width||="1em",v.height||="1em",v.paddingBottom||="1px";const E=c(v);return E.setAttribute("data-lucide",a),E}function g(a,v,E=null){if(typeof v!="object"||v===null)throw new TypeError("styles should be an object");const x=document.createElement(a);return(0,p.ZM)(x,v),E&&(x.innerHTML=E),x}},573:(N,d,r)=>{r.d(d,{Fi:()=>p,fI:()=>F});function y(c,C=document){return!!C.querySelector(c)}function p(c,C=document,g=!1){const a=C.querySelector(c);return g&&!a&&console.log(`No element found for selector: ${c}`),a}function F(c,C=document,g=!1){const a=C.querySelectorAll(c);return g&&!a.length&&console.log(`No elements found for selector: ${c}`),a}function f(c,C=1){let g=c;for(let a=0;a<C;a++){if(!g.parentElement)return null;g=g.parentElement}return g}function h(c,C,g){return[...c.querySelectorAll(C)].find(a=>a.textContent.trim().includes(g))}function s(c,C,g=!1,a=!1,v=null){const E=p(C,c);return t(E,g,a,v)}function t(c,C=!1,g=!1,a=null){if(!c)return a===null?(console.log("No element found"),null):a;const v=c.innerText;return b(v,C,g)}function i(c,C,g=!1){const a=c[C];return t(a,g)}function n(c,C=!1,g=!1){const a=c.textContent;return b(a,C,g)}function b(c,C,g){C&&(c=removeNonNumber(c)),g&&(c=c.replace(",","."));const a=Number(c);return Number.isNaN(a)?(console.log(`Invalid number: ${c}`),0):a}function T(c){return[...c.childNodes].find(C=>C.nodeType===Node.TEXT_NODE)}function w(c){const C=g=>g.nodeType===Node.TEXT_NODE&&g.textContent.trim()!==""?[g]:[...g.childNodes].flatMap(C);return C(c)}function S(c){return normalizeSpacing(c.textContent)}},5539:(N,d,r)=>{r.d(d,{Bt:()=>p,kl:()=>t});function y(e,m){e.parentNode.insertBefore(m,e.nextSibling)}function p(e){e.style.display="none"}function F(e,m=1){const k=document.querySelector(e);k&&f(k,m)}function f(e,m=1){const k=getElementAncestor(e,m);k&&p(k)}function h(e){w(e),p(e)}function s(e){e.intersectionObserver||runOnceOnIntersection(e,()=>p(e))}function t(e){e.style.display=""}function i(e){const m=T(e);e.style.display=m}function n(e,m){m?p(e):t(e)}function b(e,m){m?s(e):(clearIntersectionObserver(e),t(e))}function T(e){return w(e),e.defaultDisplay}function w(e){if(e.defaultDisplay)return;const{display:m}=getComputedStyle(e);e.defaultDisplay=m}function S(){return{show:[],hide:[]}}function c(e,m,k){e?m.hide.push(k):m.show.push(k)}function C(e){e.show.forEach(t),e.hide.forEach(p)}function g(e,m,k=.3){m?v(e,k):a(e)}function a(e){e.style.opacity=""}function v(e,m=.3){e.style.opacity=m}function E(e){e.style.order=""}function x(e,m){e.style.order=m}function R(e,m){e.style.background=m}function M(e,m){const k=getFirstElement(m);k&&D(e,k)}function D(e,m){const k=createLink();k.href=e,m.parentNode.append(k),k.append(m)}function W(e,m){const k=getFirstElement(m);k&&u(e,k)}function u(e,m){const k=createLink();k.href=e,k.append(...m.childNodes),m.append(k)}function o(){const e=getURLQueryParam("scrollTo");if(!e)return;const m=document.getElementById(e);m?m.scrollIntoView():console.log(`Element with ID "${e}" was not found.`)}function l(e,m,k=null){const P=`${m}-click-passed`,L=k?A=>findElementByText(A,e,k):A=>getFirstElement(e,A);return function(A){if(A.hasAttribute(P))return!1;const _=L(A);return _&&_.click(),A.setAttribute(P,""),!0}}function I(e,m,k="text/plain"){const P=new Blob([e],{type:k}),L=URL.createObjectURL(P),A=document.createElement("a");A.href=L,A.download=m,document.body.appendChild(A),A.click(),document.body.removeChild(A),requestAnimationFrame(()=>URL.revokeObjectURL(L))}},6754:(N,d,r)=>{r.d(d,{ZM:()=>y});function y(h,s){Object.assign(h.style,s)}function p(h,s="custom-global-style"){let t=document.getElementById(s);t||(t=document.createElement("style"),t.id=s,t.type="text/css",document.head.appendChild(t)),t.textContent=h}function F(h){return Object.entries(h).map(([s,t])=>`${s.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${t};`).join(" ")}function f(h){return h?h.split(";").filter(s=>s.trim()!=="").reduce((s,t)=>{const[i,n]=t.split(":").map(T=>T.trim()),b=i.replace(/-([a-z])/g,(T,w)=>w.toUpperCase());return s[b]=n,s},{}):{}}},4921:(N,d,r)=>{r.d(d,{sg:()=>f,xk:()=>y});function y(n,b,T=null){const w=n.querySelector(b);return w?Promise.resolve(w):new Promise(S=>{const c=new MutationObserver(g);c.observe(n,{childList:!0,subtree:!0});let C;T&&(C=setTimeout(()=>{c.disconnect(),console.log(`No element found for selector: ${b}`),S(null)},T));function g(){const a=n.querySelector(b);a&&(C&&clearTimeout(C),c.disconnect(),S(a))}})}function p(n,b){return n.querySelector(b)?new Promise(w=>{const S=new MutationObserver(c);S.observe(n,{childList:!0,subtree:!0});function c(){n.querySelector(b)||(S.disconnect(),w())}}):Promise.resolve()}function F(n,b=400){return new Promise(T=>{let w;const S=new MutationObserver(()=>{clearTimeout(w),c()});function c(){w=setTimeout(()=>{S.disconnect(),T()},b)}c(),S.observe(n,{childList:!0,subtree:!0})})}function f(n,b=250){let T;return(...w)=>{clearTimeout(T),T=setTimeout(()=>n(...w),b)}}async function h(n){document.visibilityState==="visible"?await n():document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&await n()},{once:!0})}function s(n,b){const T=new IntersectionObserver(w=>{w.forEach(S=>{S.isIntersecting&&(b(),t(n))})});n.intersectionObserver=T,T.observe(n)}function t(n){n.intersectionObserver&&(n.intersectionObserver.disconnect(),n.intersectionObserver=null)}function i(n){n&&(n.disconnect(),n=null)}},3829:(N,d,r)=>{r.d(d,{JE:()=>F});function y(i,n){return!p(i,n)}function p(i,n){if(!n.value)return!0;const b=i.toLowerCase(),T=getSearchStrings(n),w=[],S=[];return T.forEach(c=>{if(c.startsWith("!")){const C=c.substring(1);C&&S.push(C)}else w.push(c)}),w.every(c=>b.includes(c))&&S.every(c=>!b.includes(c))}function F(i,n){return n.value!=null&&i<n.value}function f(i,n){return n.value!=null&&i>n.value}function h(i,n){return n.value==null?!1:i<parseDateFromISO(n.value)}function s(i,n){return n.value==null?!1:i>parseDateFromISO(n.value)}function t(i,n){return n.value&&i!==n.value}},4521:(N,d,r)=>{r.d(d,{z:()=>p});var y=r(3048);function p(F,f=null){return{createGlobalFilter(h,s=null,t=F){return y.V.create(h,s,t)},createSectionFilter(h,s=null,t=F){if(!f)throw new Error("sectionId must be provided to use createSectionFilter.");return y.V.createWithCompositeKey(f,h,s,t)}}}},5884:(N,d,r)=>{r.d(d,{Hw:()=>s,nW:()=>f});var y=r(9928),p=r(5467);function F(t,i,n={},b={}){const T=createTextInput(b,i.updateValueFromEvent,i.value);return createControl(T,n,t)}function f(t,i,n,b,T,w={},S={}){const c=(0,y.o5)(S,i.updateValueFromEvent,i.value,n,b,T);return(0,p.E2)(c,w,t)}function h(t,i,n={},b={}){const T=createDateInput(b,i.updateValueFromEvent,i.value);return createControl(T,n,t)}function s(t,i,n={},b={}){const T=(0,y.S)(b,i.updateValueFromEvent,i.value);return(0,p.E2)(T,n,t)}},7877:(N,d,r)=>{r.d(d,{aW:()=>C,pW:()=>D});var y=r(5884);function p(u,o={},l={}){return createTextFilterControl("\u041F\u043E\u0438\u0441\u043A: ",u,o,l)}function F(u,o={},l={},I=.1,e=3){return createNumberFilterControl("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",u,I,e,5,o,l)}function f(u,o={},l={},I=.1,e=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",u,I,e,5,o,l)}function h(u,o={},l={}){return t("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",u,o,l)}function s(u,o={},l={}){return t("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",u,o,l)}function t(u,o,l={},I={}){return createNumberFilterControl(u,o,"1","1","999999",l,I)}function i(u,o={},l={}){return createDateFilterControl("\u041C\u0438\u043D. \u0434\u0430\u0442\u0430: ",u,o,l)}function n(u,o={},l={}){return b("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",u,o,l)}function b(u,o,l={},I={}){return createNumberFilterControl(u,o,"5","0","100",l,I)}function T(u,o={},l={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",u,"5","0","100",o,l)}function w(u,o,l={},I={},e="250"){return createNumberFilterControl(u,o,e,"0","1000000",l,I)}function S(u,o={},l={},I="25"){return w("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",u,o,l,I)}function c(u,o={},l={},I="25"){return w("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",u,o,l,I)}function C(u,o={},l={}){return g("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",u,o,l)}function g(u,o,l={},I={}){return(0,y.nW)(u,o,"1","0","99999",l,I)}function a(u,o={},l={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",u,"1","2","7",o,l)}function v(u,o={},l={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",u,1,1,10,o,l)}function E(u,o={},l={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",u,o,l)}function x(u,o={},l={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",u,o,l)}function R(u,o={},l={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",u,o,l)}function M(u,o={},l={}){return createCheckboxFilterControl("\u0411\u0430\u043B\u043B\u044B: ",u,o,l)}function D(u,o={},l={}){return(0,y.Hw)("\u0412\u043A\u043B: ",u,o,l)}function W(u,o,l={}){const I=[{value:-25,emoji:"\u{1F48E}",tooltip:"\u0421\u0443\u043F\u0435\u0440 \u0446\u0435\u043D\u0430 (-25%)"},{value:-15,emoji:"\u{1F525}",tooltip:"\u041E\u0442\u043B\u0438\u0447\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-15%)"},{value:-5,emoji:"\u{1F31F}",tooltip:"\u041A\u043B\u0430\u0441\u0441\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-5%)"},{value:5,emoji:"\u{1F44C}",tooltip:"\u0425\u043E\u0440\u043E\u0448\u0430\u044F \u0446\u0435\u043D\u0430 (+5%)"}],e={active:{background:"#e3f2fd",borderColor:"#2196f3",boxShadow:"0 0 0 1px #2196f3"},inactive:{background:"#fff",borderColor:"#ccc",boxShadow:"none"},hover:{background:"#f5f5f5"}},m=createDiv({display:"inline-flex",gap:"4px",marginLeft:"4px"}),k=[],P=()=>o?parseFloat(o.value)||0:u.value,L=()=>{const A=P();k.forEach(({button:_,value:U})=>{const V=U<=A?e.active:e.inactive;Object.assign(_.style,V)})};return I.forEach(({value:A,emoji:_,tooltip:U})=>{const O=createButton({padding:"2px 6px",fontSize:"16px",cursor:"pointer",border:"1px solid #ccc",borderRadius:"4px",background:"#fff",transition:"all 0.2s",...l},_);O.title=U,O.type="button",O.addEventListener("click",V=>{V.preventDefault(),u.updateValue(A),o&&(o.value=A),L()}),O.addEventListener("mouseenter",()=>{A<=P()||(O.style.background=e.hover.background)}),O.addEventListener("mouseleave",()=>{L()}),k.push({button:O,value:A}),m.appendChild(O)}),L(),o&&(o.addEventListener("input",L),o.addEventListener("change",L)),m}},5213:(N,d,r)=>{r.d(d,{b:()=>F});var y=r(9928),p=r(573);function F(f,h,s=!1,t="customFiltersContainer"){let i=(0,p.Fi)(`#${t}`,f);if(i)if(s)i.remove();else return;i=(0,y.Sw)(),i.id=t,h(i,f)}},8200:(N,d,r)=>{r.d(d,{s:()=>y});function y(p){const{target:F}=p,{type:f}=F;switch(f){case"text":return`"${F.value}"`;case"number":return F.value;case"date":return`"${F.value}"`;case"checkbox":return F.checked;default:return console.log(`Unknown input type: ${f}`),null}}},157:(N,d,r)=>{r.d(d,{Fg:()=>y,vx:()=>F});const y=window.GM_setValue,p=window.GM.setValue,F=window.GM_getValue},1870:(N,d,r)=>{r.d(d,{j:()=>y});class y{constructor(F,f){this.value=F,this.onChange=f}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(N,d,r)=>{r.d(d,{V:()=>h});var y=r(1870),p=r(8200),F=r(3976),f=r(157);class h extends y.j{constructor(t,i=null,n=null){super((0,f.vx)(t,i),n),this.storageKey=t,this.defaultValue=i}static create(t,i=null,n=null){return new h(t,i,n)}static createWithCompositeKey(t,i,n=null,b=null){const T=`${t}-${i}`;return new h(T,n,b)}updateValueFromEvent=t=>{const i=(0,p.s)(t),n=(0,F.$)(i);this.updateValue(n)};updateValue(t,i=!0){this.value!==t&&((0,f.Fg)(this.storageKey,t),this.value=t,i&&this.onChangeIfDefined())}clearValue(t=!1){this.updateValue(null,t)}resetValue(t=!1){this.updateValue(this.defaultValue,t)}}},3976:(N,d,r)=>{r.d(d,{$:()=>y});function y(p){return p===""?null:JSON.parse(p)}},6213:(N,d,r)=>{r.a(N,async(y,p)=>{try{let v=function(u,o){let l=u.innerText;function I(){const e=u.innerText;e!==l&&(l=e,o()),requestAnimationFrame(I)}requestAnimationFrame(I)},x=function(u,o){(0,w.ZM)(u,t.r.FILTERS_CONTAINER),(0,w.ZM)(o,t.r.FILTERS_CONTAINER_WRAP);const l=(0,h.aW)(c,t.r.CONTROL,t.r.NUMBER_INPUT),I=(0,h.pW)(C,t.r.CONTROL,t.r.CHECKBOX_INPUT);u.append(l,I),o.append(u)},R=function(){(0,f.fI)(s.Z.COMMENTS).forEach(M)},M=function(u){if(!C.value){W(u);return}let o=g.commentsCache.get(u);if(!o){const I=(0,f.Fi)(s.Z.RATING_WRAP,u);if(!I)return;const e=I.innerText.trim();if(e==="")return;o={rating:+e},g.commentsCache.set(u,o)}(0,b.JE)(o.rating,c)?D(u):W(u)},D=function(u){(0,F.Bt)(u);const o=u.parentElement;o&&[...o.children].every(l=>l.style.display==="none")&&D(o)},W=function(u){(0,F.kl)(u);const o=u.parentElement;o&&o.style.display==="none"&&W(o)};var F=r(5539),f=r(573),h=r(7877),s=r(1719),t=r(9175),i=r(4521),n=r(5213),b=r(3829),T=r(4921),w=r(6754);const{createGlobalFilter:S}=(0,i.z)(R),c=S("min-rating-filter",4),C=S("filter-enabled",!0),g={commentsCache:new WeakMap};await a();async function a(){const u=await(0,T.xk)(document,s.Z.COMMENTS_TREE);v(u,E)}async function E(){const u=await(0,T.xk)(document,s.Z.COMMENTS_HEADER);(0,n.b)(u,x),R()}p()}catch(S){p(S)}},1)},1719:(N,d,r)=>{r.d(d,{Z:()=>y});const y={COMMENTS_TREE:".tm-comments__tree",COMMENTS_HEADER:".tm-comments-wrapper__header",COMMENTS:".tm-comment-thread__comment:not(.process-passed)",RATING_WRAP:".tm-votes-lever__score-counter"}},9175:(N,d,r)=>{r.d(d,{r:()=>p});const p={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",marginLeft:"28px"},FILTERS_CONTAINER_WRAP:{background:"#fff",borderBottom:"1px solid rgba(146, 156, 165, .4)",position:"sticky",top:"56px",zIndex:10},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},NUMBER_INPUT:{...{INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px",fontSize:"15px"}}.INPUT,width:"35px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},j={};function B(N){var d=j[N];if(d!==void 0)return d.exports;var r=j[N]={exports:{}};return $[N](r,r.exports,B),r.exports}(()=>{var N=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",d=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",r=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",y=F=>{F&&F.d<1&&(F.d=1,F.forEach(f=>f.r--),F.forEach(f=>f.r--?f.r++:f()))},p=F=>F.map(f=>{if(f!==null&&typeof f=="object"){if(f[N])return f;if(f.then){var h=[];h.d=0,f.then(i=>{s[d]=i,y(h)},i=>{s[r]=i,y(h)});var s={};return s[N]=i=>i(h),s}}var t={};return t[N]=i=>{},t[d]=f,t});B.a=(F,f,h)=>{var s;h&&((s=[]).d=-1);var t=new Set,i=F.exports,n,b,T,w=new Promise((S,c)=>{T=c,b=S});w[d]=i,w[N]=S=>(s&&S(s),t.forEach(S),w.catch(c=>{})),F.exports=w,f(S=>{n=p(S);var c,C=()=>n.map(a=>{if(a[r])throw a[r];return a[d]}),g=new Promise(a=>{c=()=>a(C),c.r=0;var v=E=>E!==s&&!t.has(E)&&(t.add(E),E&&!E.d&&(c.r++,E.push(c)));n.map(E=>E[N](v))});return c.r?g:C()},S=>(S?T(w[r]=S):b(i),y(s))),s&&s.d<0&&(s.d=0)}})(),B.d=(N,d)=>{for(var r in d)B.o(d,r)&&!B.o(N,r)&&Object.defineProperty(N,r,{enumerable:!0,get:d[r]})},B.o=(N,d)=>Object.prototype.hasOwnProperty.call(N,d);var G=B(6213)})();})();
