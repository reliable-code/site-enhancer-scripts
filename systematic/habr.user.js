// ==UserScript==
// @name         Habr comments filter
// @description  Hide comments by filter
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://habr.com/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.75784591
// @icon         https://www.google.com/s2/favicons?sz=64&domain=habr.com
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/habr.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var W={5467:(w,a,t)=>{t.d(a,{E2:()=>h});var C=t(9928);function h(E,r={},e=null){const o=(0,C.Sw)(r,e);return o.append(E),o}function g(E,r=null,e={},o={}){const m=createActionLink(E,r,o);return h(m,e)}function f(E,r=null,e=null,o={},m={}){const x=createActionLinkWithIcon(E,e,r,m);return h(x,o)}},9928:(w,a,t)=>{t.d(a,{S:()=>E,Sw:()=>F,o5:()=>f});var C=t(4921),h=t(6754);function g(c,i,y){const p=r(c,"text",i);return p.value=y,p}function f(c,i,y,p,L,O){const A=r(c,"number",i);return A.value=y,A.step=p,A.min=L,A.max=O,A}function E(c,i,y){const p=r(c,"checkbox",i);return p.checked=y,p}function r(c={},i=null,y=null){const p=v("input",c);return i&&(p.type=i),y&&(p.addEventListener("keyup",(0,C.sg)(y,200)),p.addEventListener("change",(0,C.sg)(y,100))),p}function e(c={},i=null){return v("span",c,i)}function o(c={},i=null,y=null){const p=v("a",c,i);return y&&(p.href=y),p}function m(c,i=null,y={}){y.cursor||="pointer";const p=o(y,i);return c&&p.addEventListener("click",c),p}function x(c,i,y=null,p={},L={}){p.display||="inline-flex",p.alignItems||="center",p.gap||="0.25em";const O=m(c,y,p);return O.prepend(l(i,L)),O}function T(c={},i=null,y=null){const p=v("button",c,i);return y&&p.addEventListener("click",y),p}function F(c={},i=null){return v("div",c,i)}function S(c={}){return v("i",c)}function l(c,i={}){i.width||="1em",i.height||="1em",i.paddingBottom||="1px";const y=S(i);return y.setAttribute("data-lucide",c),y}function v(c,i,y=null){if(typeof i!="object"||i===null)throw new TypeError("styles should be an object");const p=document.createElement(c);return(0,h.ZM)(p,i),y&&(p.innerHTML=y),p}},573:(w,a,t)=>{t.d(a,{Fi:()=>h,fI:()=>g});function C(l,v=document){return!!v.querySelector(l)}function h(l,v=document,c=!1){const i=v.querySelector(l);return c&&!i&&console.log(`No element found for selector: ${l}`),i}function g(l,v=document,c=!1){const i=v.querySelectorAll(l);return c&&!i.length&&console.log(`No elements found for selector: ${l}`),i}function f(l,v=1){let c=l;for(let i=0;i<v;i++){if(!c.parentElement)return null;c=c.parentElement}return c}function E(l,v,c){return[...l.querySelectorAll(v)].find(i=>i.textContent.trim().includes(c))}function r(l,v,c=!1,i=!1,y=null){const p=h(v,l);return e(p,c,i,y)}function e(l,v=!1,c=!1,i=null){if(!l)return i===null?(console.log("No element found"),null):i;const y=l.innerText;return x(y,v,c)}function o(l,v,c=!1){const i=l[v];return e(i,c)}function m(l,v=!1,c=!1){const i=l.textContent;return x(i,v,c)}function x(l,v,c){v&&(l=removeNonNumber(l)),c&&(l=l.replace(",","."));const i=Number(l);return Number.isNaN(i)?(console.log(`Invalid number: ${l}`),0):i}function T(l){return[...l.childNodes].find(v=>v.nodeType===Node.TEXT_NODE)}function F(l){const v=c=>c.nodeType===Node.TEXT_NODE&&c.textContent.trim()!==""?[c]:[...c.childNodes].flatMap(v);return v(l)}function S(l){return normalizeSpacing(l.textContent)}},5539:(w,a,t)=>{t.d(a,{Bt:()=>h,kl:()=>e});function C(n,b){n.parentNode.insertBefore(b,n.nextSibling)}function h(n){n.style.display="none"}function g(n,b=1){const k=document.querySelector(n);k&&f(k,b)}function f(n,b=1){const k=getElementAncestor(n,b);k&&h(k)}function E(n){F(n),h(n)}function r(n){n.intersectionObserver||runOnceOnIntersection(n,()=>h(n))}function e(n){n.style.display=""}function o(n){const b=T(n);n.style.display=b}function m(n,b){b?h(n):e(n)}function x(n,b){b?r(n):(clearIntersectionObserver(n),e(n))}function T(n){return F(n),n.defaultDisplay}function F(n){if(n.defaultDisplay)return;const{display:b}=getComputedStyle(n);n.defaultDisplay=b}function S(){return{show:[],hide:[]}}function l(n,b,k){n?b.hide.push(k):b.show.push(k)}function v(n){n.show.forEach(e),n.hide.forEach(h)}function c(n,b,k=.3){b?y(n,k):i(n)}function i(n){n.style.opacity=""}function y(n,b=.3){n.style.opacity=b}function p(n){n.style.order=""}function L(n,b){n.style.order=b}function O(n,b){n.style.background=b}function A(n,b){const k=getFirstElement(b);k&&s(n,k)}function s(n,b){const k=createLink();k.href=n,b.parentNode.append(k),k.append(b)}function d(n,b){const k=getFirstElement(b);k&&u(n,k)}function u(n,b){const k=createLink();k.href=n,k.append(...b.childNodes),b.append(k)}function N(){const n=getURLQueryParam("scrollTo");if(!n)return;const b=document.getElementById(n);b?b.scrollIntoView():console.log(`Element with ID "${n}" was not found.`)}function I(n,b,k){const P=`${k}-click-passed`;return function(R){if(R.hasAttribute(P))return;const _=findElementByText(R,n,b);_&&_.click(),R.setAttribute(P,"")}}function D(n,b,k="text/plain"){const P=new Blob([n],{type:k}),R=URL.createObjectURL(P),_=document.createElement("a");_.href=R,_.download=b,document.body.appendChild(_),_.click(),document.body.removeChild(_),requestAnimationFrame(()=>URL.revokeObjectURL(R))}},6754:(w,a,t)=>{t.d(a,{ZM:()=>C});function C(E,r){Object.assign(E.style,r)}function h(E,r="custom-global-style"){let e=document.getElementById(r);e||(e=document.createElement("style"),e.id=r,e.type="text/css",document.head.appendChild(e)),e.textContent=E}function g(E){return Object.entries(E).map(([r,e])=>`${r.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${e};`).join(" ")}function f(E){return E?E.split(";").filter(r=>r.trim()!=="").reduce((r,e)=>{const[o,m]=e.split(":").map(T=>T.trim()),x=o.replace(/-([a-z])/g,(T,F)=>F.toUpperCase());return r[x]=m,r},{}):{}}},4921:(w,a,t)=>{t.d(a,{sg:()=>f,xk:()=>C});function C(e,o,m=null){const x=e.querySelector(o);return x?Promise.resolve(x):new Promise(T=>{const F=new MutationObserver(l);F.observe(e,{childList:!0,subtree:!0});let S;m&&(S=setTimeout(()=>{F.disconnect(),console.log(`No element found for selector: ${o}`),T(null)},m));function l(){const v=e.querySelector(o);v&&(S&&clearTimeout(S),F.disconnect(),T(v))}})}function h(e,o){return e.querySelector(o)?new Promise(x=>{const T=new MutationObserver(F);T.observe(e,{childList:!0,subtree:!0});function F(){e.querySelector(o)||(T.disconnect(),x())}}):Promise.resolve()}function g(e,o=400){return new Promise(m=>{let x;const T=new MutationObserver(()=>{clearTimeout(x),F()});function F(){x=setTimeout(()=>{T.disconnect(),m()},o)}F(),T.observe(e,{childList:!0,subtree:!0})})}function f(e,o=250){let m;return(...x)=>{clearTimeout(m),m=setTimeout(()=>e(...x),o)}}function E(e,o){const m=new IntersectionObserver(x=>{x.forEach(T=>{T.isIntersecting&&(o(),r(e))})});e.intersectionObserver=m,m.observe(e)}function r(e){e.intersectionObserver&&(e.intersectionObserver.disconnect(),e.intersectionObserver=null)}},3829:(w,a,t)=>{t.d(a,{JE:()=>g});function C(r,e){return!h(r,e)}function h(r,e){if(!e.value)return!0;const o=r.toLowerCase(),m=getSearchStrings(e),x=[],T=[];return m.forEach(F=>{if(F.startsWith("!")){const S=F.substring(1);S&&T.push(S)}else x.push(F)}),x.every(F=>o.includes(F))&&T.every(F=>!o.includes(F))}function g(r,e){return e.value!=null&&r<e.value}function f(r,e){return e.value!=null&&r>e.value}function E(r,e){return e.value&&r!==e.value}},4521:(w,a,t)=>{t.d(a,{z:()=>h});var C=t(3048);function h(g,f=null){return{createGlobalFilter(E,r=null,e=g){return C.V.create(E,r,e)},createSectionFilter(E,r=null,e=g){if(!f)throw new Error("sectionId must be provided to use createSectionFilter.");return C.V.createWithCompositeKey(f,E,r,e)}}}},5884:(w,a,t)=>{t.d(a,{Hw:()=>E,nW:()=>f});var C=t(9928),h=t(5467);function g(r,e,o={},m={}){const x=createTextInput(m,e.updateValueFromEvent,e.value);return createControl(x,o,r)}function f(r,e,o,m,x,T={},F={}){const S=(0,C.o5)(F,e.updateValueFromEvent,e.value,o,m,x);return(0,h.E2)(S,T,r)}function E(r,e,o={},m={}){const x=(0,C.S)(m,e.updateValueFromEvent,e.value);return(0,h.E2)(x,o,r)}},7877:(w,a,t)=>{t.d(a,{aW:()=>l,pW:()=>A});var C=t(5884);function h(s,d={},u={}){return createTextFilterControl("\u041F\u043E\u0438\u0441\u043A: ",s,d,u)}function g(s,d={},u={},N=.1,I=3){return createNumberFilterControl("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",s,N,I,5,d,u)}function f(s,d={},u={},N=.1,I=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",s,N,I,5,d,u)}function E(s,d={},u={}){return e("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",s,d,u)}function r(s,d={},u={}){return e("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",s,d,u)}function e(s,d,u={},N={}){return createNumberFilterControl(s,d,"1","1","999999",u,N)}function o(s,d={},u={}){return m("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",s,d,u)}function m(s,d,u={},N={}){return createNumberFilterControl(s,d,"5","0","100",u,N)}function x(s,d={},u={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",s,"5","0","100",d,u)}function T(s,d,u={},N={},I="250"){return createNumberFilterControl(s,d,I,"0","1000000",u,N)}function F(s,d={},u={},N="25"){return T("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",s,d,u,N)}function S(s,d={},u={},N="25"){return T("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",s,d,u,N)}function l(s,d={},u={}){return v("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",s,d,u)}function v(s,d,u={},N={}){return(0,C.nW)(s,d,"1","0","99999",u,N)}function c(s,d={},u={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",s,"1","2","7",d,u)}function i(s,d={},u={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",s,1,1,10,d,u)}function y(s,d={},u={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",s,d,u)}function p(s,d={},u={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",s,d,u)}function L(s,d={},u={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",s,d,u)}function O(s,d={},u={}){return createCheckboxFilterControl("\u0411\u0430\u043B\u043B\u044B: ",s,d,u)}function A(s,d={},u={}){return(0,C.Hw)("\u0412\u043A\u043B: ",s,d,u)}},5213:(w,a,t)=>{t.d(a,{b:()=>g});var C=t(9928),h=t(573);function g(f,E,r=!1,e="customFiltersContainer"){let o=(0,h.Fi)(`#${e}`,f);if(o)if(r)o.remove();else return;o=(0,C.Sw)(),o.id=e,E(o,f)}},8200:(w,a,t)=>{t.d(a,{s:()=>C});function C(h){const{target:g}=h,{type:f}=g;switch(f){case"text":return`"${g.value}"`;case"number":return g.value;case"checkbox":return g.checked;default:return console.log(`Unknown input type: ${f}`),null}}},157:(w,a,t)=>{t.d(a,{Fg:()=>C,vx:()=>g});const C=window.GM_setValue,h=window.GM.setValue,g=window.GM_getValue},1870:(w,a,t)=>{t.d(a,{j:()=>C});class C{constructor(g,f){this.value=g,this.onChange=f}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(w,a,t)=>{t.d(a,{V:()=>E});var C=t(1870),h=t(8200),g=t(3976),f=t(157);class E extends C.j{constructor(e,o=null,m=null){super((0,f.vx)(e,o),m),this.storageKey=e,this.defaultValue=o}static create(e,o=null,m=null){return new E(e,o,m)}static createWithCompositeKey(e,o,m=null,x=null){const T=`${e}-${o}`;return new E(T,m,x)}updateValueFromEvent=e=>{const o=(0,h.s)(e),m=(0,g.$)(o);this.updateValue(m)};updateValue(e,o=!0){this.value!==e&&((0,f.Fg)(this.storageKey,e),this.value=e,o&&this.onChangeIfDefined())}clearValue(e=!1){this.updateValue(null,e)}resetValue(e=!1){this.updateValue(this.defaultValue,e)}}},3976:(w,a,t)=>{t.d(a,{$:()=>C});function C(h){return h===""?null:JSON.parse(h)}},6213:(w,a,t)=>{t.a(w,async(C,h)=>{try{let y=function(u,N){let I=u.innerText;function D(){const n=u.innerText;n!==I&&(I=n,N()),requestAnimationFrame(D)}requestAnimationFrame(D)},L=function(u,N){(0,F.ZM)(u,e.r.FILTERS_CONTAINER);const I=(0,E.aW)(l,e.r.CONTROL,e.r.NUMBER_INPUT),D=(0,E.pW)(v,e.r.CONTROL,e.r.CHECKBOX_INPUT);u.append(I,D),N.append(u)},O=function(){(0,f.fI)(r.Z.COMMENTS).forEach(A)},A=function(u){if(!v.value){d(u);return}let N=c.commentsCache.get(u);if(!N){const D=(0,f.Fi)(r.Z.RATING_WRAP,u);if(!D)return;const n=D.innerText.trim();if(n==="")return;N={rating:+n},c.commentsCache.set(u,N)}(0,x.JE)(N.rating,l)?s(u):d(u)},s=function(u){(0,g.Bt)(u);const N=u.parentElement;N&&[...N.children].every(I=>I.style.display==="none")&&s(N)},d=function(u){(0,g.kl)(u);const N=u.parentElement;N&&N.style.display==="none"&&d(N)};var g=t(5539),f=t(573),E=t(7877),r=t(1719),e=t(9175),o=t(4521),m=t(5213),x=t(3829),T=t(4921),F=t(6754);const{createGlobalFilter:S}=(0,o.z)(O),l=S("min-rating-filter",4),v=S("filter-enabled",!0),c={commentsCache:new WeakMap};await i();async function i(){const u=await(0,T.xk)(document,r.Z.COMMENTS_TREE);y(u,p)}async function p(){const u=await(0,T.xk)(document,r.Z.COMMENTS_HEADER);(0,m.b)(u,L),O()}h()}catch(S){h(S)}},1)},1719:(w,a,t)=>{t.d(a,{Z:()=>C});const C={COMMENTS_TREE:".tm-comments__tree",COMMENTS_HEADER:".tm-comments-wrapper__header",COMMENTS:".tm-comment-thread__comment:not(.process-passed)",RATING_WRAP:".tm-votes-lever__score-counter"}},9175:(w,a,t)=>{t.d(a,{r:()=>h});const h={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",marginLeft:"28px"},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},NUMBER_INPUT:{...{INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px",fontSize:"15px"}}.INPUT,width:"35px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},B={};function M(w){var a=B[w];if(a!==void 0)return a.exports;var t=B[w]={exports:{}};return W[w](t,t.exports,M),t.exports}(()=>{var w=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",a=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",t=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",C=g=>{g&&g.d<1&&(g.d=1,g.forEach(f=>f.r--),g.forEach(f=>f.r--?f.r++:f()))},h=g=>g.map(f=>{if(f!==null&&typeof f=="object"){if(f[w])return f;if(f.then){var E=[];E.d=0,f.then(o=>{r[a]=o,C(E)},o=>{r[t]=o,C(E)});var r={};return r[w]=o=>o(E),r}}var e={};return e[w]=o=>{},e[a]=f,e});M.a=(g,f,E)=>{var r;E&&((r=[]).d=-1);var e=new Set,o=g.exports,m,x,T,F=new Promise((S,l)=>{T=l,x=S});F[a]=o,F[w]=S=>(r&&S(r),e.forEach(S),F.catch(l=>{})),g.exports=F,f(S=>{m=h(S);var l,v=()=>m.map(i=>{if(i[t])throw i[t];return i[a]}),c=new Promise(i=>{l=()=>i(v),l.r=0;var y=p=>p!==r&&!e.has(p)&&(e.add(p),p&&!p.d&&(l.r++,p.push(l)));m.map(p=>p[w](y))});return l.r?c:v()},S=>(S?T(F[t]=S):x(o),C(r))),r&&r.d<0&&(r.d=0)}})(),M.d=(w,a)=>{for(var t in a)M.o(a,t)&&!M.o(w,t)&&Object.defineProperty(w,t,{enumerable:!0,get:a[t]})},M.o=(w,a)=>Object.prototype.hasOwnProperty.call(w,a);var V=M(6213)})();})();
