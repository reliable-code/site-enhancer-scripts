// ==UserScript==
// @name         Habr comments filter
// @description  Hide comments by filter
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://habr.com/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.75925047
// @icon         https://www.google.com/s2/favicons?sz=64&domain=habr.com
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/habr.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var V={5467:(T,s,n)=>{n.d(s,{E2:()=>v});var C=n(9928);function v(E,u={},e=null){const a=(0,C.Sw)(u,e);return a.append(E),a}function g(E,u=null,e={},a={}){const c=createActionLink(E,u,a);return v(c,e)}function m(E,u=null,e=null,a={},c={}){const y=createActionLinkWithIcon(E,e,u,c);return v(y,a)}},9928:(T,s,n)=>{n.d(s,{S:()=>E,Sw:()=>F,o5:()=>m});var C=n(4921),v=n(6754);function g(i,o,x){const p=u(i,"text",o);return p.value=x,p}function m(i,o,x,p,D,L){const A=u(i,"number",o);return A.value=x,A.step=p,A.min=D,A.max=L,A}function E(i,o,x){const p=u(i,"checkbox",o);return p.checked=x,p}function u(i={},o=null,x=null){const p=h("input",i);return o&&(p.type=o),x&&(p.addEventListener("keyup",(0,C.sg)(x,200)),p.addEventListener("change",(0,C.sg)(x,100))),p}function e(i={},o=null){return h("span",i,o)}function a(i={},o=null,x=null){const p=h("a",i,o);return x&&(p.href=x),p}function c(i,o=null,x={}){x.cursor||="pointer";const p=a(x,o);return i&&p.addEventListener("click",i),p}function y(i,o,x=null,p={},D={}){p.display||="inline-flex",p.alignItems||="center",p.gap||="0.25em";const L=c(i,x,p);return L.prepend(l(o,D)),L}function N(i={},o=null,x=null){const p=h("button",i,o);return x&&p.addEventListener("click",x),p}function F(i={},o=null){return h("div",i,o)}function w(i={}){return h("i",i)}function l(i,o={}){o.width||="1em",o.height||="1em",o.paddingBottom||="1px";const x=w(o);return x.setAttribute("data-lucide",i),x}function h(i,o,x=null){if(typeof o!="object"||o===null)throw new TypeError("styles should be an object");const p=document.createElement(i);return(0,v.ZM)(p,o),x&&(p.innerHTML=x),p}},573:(T,s,n)=>{n.d(s,{Fi:()=>v,fI:()=>g});function C(l,h=document){return!!h.querySelector(l)}function v(l,h=document,i=!1){const o=h.querySelector(l);return i&&!o&&console.log(`No element found for selector: ${l}`),o}function g(l,h=document,i=!1){const o=h.querySelectorAll(l);return i&&!o.length&&console.log(`No elements found for selector: ${l}`),o}function m(l,h=1){let i=l;for(let o=0;o<h;o++){if(!i.parentElement)return null;i=i.parentElement}return i}function E(l,h,i){return[...l.querySelectorAll(h)].find(o=>o.textContent.trim().includes(i))}function u(l,h,i=!1,o=!1,x=null){const p=v(h,l);return e(p,i,o,x)}function e(l,h=!1,i=!1,o=null){if(!l)return o===null?(console.log("No element found"),null):o;const x=l.innerText;return y(x,h,i)}function a(l,h,i=!1){const o=l[h];return e(o,i)}function c(l,h=!1,i=!1){const o=l.textContent;return y(o,h,i)}function y(l,h,i){h&&(l=removeNonNumber(l)),i&&(l=l.replace(",","."));const o=Number(l);return Number.isNaN(o)?(console.log(`Invalid number: ${l}`),0):o}function N(l){return[...l.childNodes].find(h=>h.nodeType===Node.TEXT_NODE)}function F(l){const h=i=>i.nodeType===Node.TEXT_NODE&&i.textContent.trim()!==""?[i]:[...i.childNodes].flatMap(h);return h(l)}function w(l){return normalizeSpacing(l.textContent)}},5539:(T,s,n)=>{n.d(s,{Bt:()=>v,kl:()=>e});function C(t,b){t.parentNode.insertBefore(b,t.nextSibling)}function v(t){t.style.display="none"}function g(t,b=1){const k=document.querySelector(t);k&&m(k,b)}function m(t,b=1){const k=getElementAncestor(t,b);k&&v(k)}function E(t){F(t),v(t)}function u(t){t.intersectionObserver||runOnceOnIntersection(t,()=>v(t))}function e(t){t.style.display=""}function a(t){const b=N(t);t.style.display=b}function c(t,b){b?v(t):e(t)}function y(t,b){b?u(t):(clearIntersectionObserver(t),e(t))}function N(t){return F(t),t.defaultDisplay}function F(t){if(t.defaultDisplay)return;const{display:b}=getComputedStyle(t);t.defaultDisplay=b}function w(){return{show:[],hide:[]}}function l(t,b,k){t?b.hide.push(k):b.show.push(k)}function h(t){t.show.forEach(e),t.hide.forEach(v)}function i(t,b,k=.3){b?x(t,k):o(t)}function o(t){t.style.opacity=""}function x(t,b=.3){t.style.opacity=b}function p(t){t.style.order=""}function D(t,b){t.style.order=b}function L(t,b){t.style.background=b}function A(t,b){const k=getFirstElement(b);k&&d(t,k)}function d(t,b){const k=createLink();k.href=t,b.parentNode.append(k),k.append(b)}function f(t,b){const k=getFirstElement(b);k&&r(t,k)}function r(t,b){const k=createLink();k.href=t,k.append(...b.childNodes),b.append(k)}function S(){const t=getURLQueryParam("scrollTo");if(!t)return;const b=document.getElementById(t);b?b.scrollIntoView():console.log(`Element with ID "${t}" was not found.`)}function I(t,b,k=null){const R=`${b}-click-passed`,P=k?O=>findElementByText(O,t,k):O=>getFirstElement(t,O);return function(O){if(O.hasAttribute(R))return!1;const W=P(O);return W&&W.click(),O.setAttribute(R,""),!0}}function _(t,b,k="text/plain"){const R=new Blob([t],{type:k}),P=URL.createObjectURL(R),O=document.createElement("a");O.href=P,O.download=b,document.body.appendChild(O),O.click(),document.body.removeChild(O),requestAnimationFrame(()=>URL.revokeObjectURL(P))}},6754:(T,s,n)=>{n.d(s,{ZM:()=>C});function C(E,u){Object.assign(E.style,u)}function v(E,u="custom-global-style"){let e=document.getElementById(u);e||(e=document.createElement("style"),e.id=u,e.type="text/css",document.head.appendChild(e)),e.textContent=E}function g(E){return Object.entries(E).map(([u,e])=>`${u.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${e};`).join(" ")}function m(E){return E?E.split(";").filter(u=>u.trim()!=="").reduce((u,e)=>{const[a,c]=e.split(":").map(N=>N.trim()),y=a.replace(/-([a-z])/g,(N,F)=>F.toUpperCase());return u[y]=c,u},{}):{}}},4921:(T,s,n)=>{n.d(s,{sg:()=>m,xk:()=>C});function C(c,y,N=null){const F=c.querySelector(y);return F?Promise.resolve(F):new Promise(w=>{const l=new MutationObserver(i);l.observe(c,{childList:!0,subtree:!0});let h;N&&(h=setTimeout(()=>{l.disconnect(),console.log(`No element found for selector: ${y}`),w(null)},N));function i(){const o=c.querySelector(y);o&&(h&&clearTimeout(h),l.disconnect(),w(o))}})}function v(c,y){return c.querySelector(y)?new Promise(F=>{const w=new MutationObserver(l);w.observe(c,{childList:!0,subtree:!0});function l(){c.querySelector(y)||(w.disconnect(),F())}}):Promise.resolve()}function g(c,y=400){return new Promise(N=>{let F;const w=new MutationObserver(()=>{clearTimeout(F),l()});function l(){F=setTimeout(()=>{w.disconnect(),N()},y)}l(),w.observe(c,{childList:!0,subtree:!0})})}function m(c,y=250){let N;return(...F)=>{clearTimeout(N),N=setTimeout(()=>c(...F),y)}}async function E(c){document.visibilityState==="visible"?await c():document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&await c()},{once:!0})}function u(c,y){const N=new IntersectionObserver(F=>{F.forEach(w=>{w.isIntersecting&&(y(),e(c))})});c.intersectionObserver=N,N.observe(c)}function e(c){c.intersectionObserver&&(c.intersectionObserver.disconnect(),c.intersectionObserver=null)}function a(c){c&&(c.disconnect(),c=null)}},3829:(T,s,n)=>{n.d(s,{JE:()=>g});function C(u,e){return!v(u,e)}function v(u,e){if(!e.value)return!0;const a=u.toLowerCase(),c=getSearchStrings(e),y=[],N=[];return c.forEach(F=>{if(F.startsWith("!")){const w=F.substring(1);w&&N.push(w)}else y.push(F)}),y.every(F=>a.includes(F))&&N.every(F=>!a.includes(F))}function g(u,e){return e.value!=null&&u<e.value}function m(u,e){return e.value!=null&&u>e.value}function E(u,e){return e.value&&u!==e.value}},4521:(T,s,n)=>{n.d(s,{z:()=>v});var C=n(3048);function v(g,m=null){return{createGlobalFilter(E,u=null,e=g){return C.V.create(E,u,e)},createSectionFilter(E,u=null,e=g){if(!m)throw new Error("sectionId must be provided to use createSectionFilter.");return C.V.createWithCompositeKey(m,E,u,e)}}}},5884:(T,s,n)=>{n.d(s,{Hw:()=>E,nW:()=>m});var C=n(9928),v=n(5467);function g(u,e,a={},c={}){const y=createTextInput(c,e.updateValueFromEvent,e.value);return createControl(y,a,u)}function m(u,e,a,c,y,N={},F={}){const w=(0,C.o5)(F,e.updateValueFromEvent,e.value,a,c,y);return(0,v.E2)(w,N,u)}function E(u,e,a={},c={}){const y=(0,C.S)(c,e.updateValueFromEvent,e.value);return(0,v.E2)(y,a,u)}},7877:(T,s,n)=>{n.d(s,{aW:()=>l,pW:()=>A});var C=n(5884);function v(d,f={},r={}){return createTextFilterControl("\u041F\u043E\u0438\u0441\u043A: ",d,f,r)}function g(d,f={},r={},S=.1,I=3){return createNumberFilterControl("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",d,S,I,5,f,r)}function m(d,f={},r={},S=.1,I=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",d,S,I,5,f,r)}function E(d,f={},r={}){return e("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",d,f,r)}function u(d,f={},r={}){return e("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",d,f,r)}function e(d,f,r={},S={}){return createNumberFilterControl(d,f,"1","1","999999",r,S)}function a(d,f={},r={}){return c("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",d,f,r)}function c(d,f,r={},S={}){return createNumberFilterControl(d,f,"5","0","100",r,S)}function y(d,f={},r={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",d,"5","0","100",f,r)}function N(d,f,r={},S={},I="250"){return createNumberFilterControl(d,f,I,"0","1000000",r,S)}function F(d,f={},r={},S="25"){return N("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",d,f,r,S)}function w(d,f={},r={},S="25"){return N("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",d,f,r,S)}function l(d,f={},r={}){return h("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",d,f,r)}function h(d,f,r={},S={}){return(0,C.nW)(d,f,"1","0","99999",r,S)}function i(d,f={},r={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",d,"1","2","7",f,r)}function o(d,f={},r={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",d,1,1,10,f,r)}function x(d,f={},r={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",d,f,r)}function p(d,f={},r={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",d,f,r)}function D(d,f={},r={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",d,f,r)}function L(d,f={},r={}){return createCheckboxFilterControl("\u0411\u0430\u043B\u043B\u044B: ",d,f,r)}function A(d,f={},r={}){return(0,C.Hw)("\u0412\u043A\u043B: ",d,f,r)}},5213:(T,s,n)=>{n.d(s,{b:()=>g});var C=n(9928),v=n(573);function g(m,E,u=!1,e="customFiltersContainer"){let a=(0,v.Fi)(`#${e}`,m);if(a)if(u)a.remove();else return;a=(0,C.Sw)(),a.id=e,E(a,m)}},8200:(T,s,n)=>{n.d(s,{s:()=>C});function C(v){const{target:g}=v,{type:m}=g;switch(m){case"text":return`"${g.value}"`;case"number":return g.value;case"checkbox":return g.checked;default:return console.log(`Unknown input type: ${m}`),null}}},157:(T,s,n)=>{n.d(s,{Fg:()=>C,vx:()=>g});const C=window.GM_setValue,v=window.GM.setValue,g=window.GM_getValue},1870:(T,s,n)=>{n.d(s,{j:()=>C});class C{constructor(g,m){this.value=g,this.onChange=m}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(T,s,n)=>{n.d(s,{V:()=>E});var C=n(1870),v=n(8200),g=n(3976),m=n(157);class E extends C.j{constructor(e,a=null,c=null){super((0,m.vx)(e,a),c),this.storageKey=e,this.defaultValue=a}static create(e,a=null,c=null){return new E(e,a,c)}static createWithCompositeKey(e,a,c=null,y=null){const N=`${e}-${a}`;return new E(N,c,y)}updateValueFromEvent=e=>{const a=(0,v.s)(e),c=(0,g.$)(a);this.updateValue(c)};updateValue(e,a=!0){this.value!==e&&((0,m.Fg)(this.storageKey,e),this.value=e,a&&this.onChangeIfDefined())}clearValue(e=!1){this.updateValue(null,e)}resetValue(e=!1){this.updateValue(this.defaultValue,e)}}},3976:(T,s,n)=>{n.d(s,{$:()=>C});function C(v){return v===""?null:JSON.parse(v)}},6213:(T,s,n)=>{n.a(T,async(C,v)=>{try{let x=function(r,S){let I=r.innerText;function _(){const t=r.innerText;t!==I&&(I=t,S()),requestAnimationFrame(_)}requestAnimationFrame(_)},D=function(r,S){(0,F.ZM)(r,e.r.FILTERS_CONTAINER);const I=(0,E.aW)(l,e.r.CONTROL,e.r.NUMBER_INPUT),_=(0,E.pW)(h,e.r.CONTROL,e.r.CHECKBOX_INPUT);r.append(I,_),S.append(r)},L=function(){(0,m.fI)(u.Z.COMMENTS).forEach(A)},A=function(r){if(!h.value){f(r);return}let S=i.commentsCache.get(r);if(!S){const _=(0,m.Fi)(u.Z.RATING_WRAP,r);if(!_)return;const t=_.innerText.trim();if(t==="")return;S={rating:+t},i.commentsCache.set(r,S)}(0,y.JE)(S.rating,l)?d(r):f(r)},d=function(r){(0,g.Bt)(r);const S=r.parentElement;S&&[...S.children].every(I=>I.style.display==="none")&&d(S)},f=function(r){(0,g.kl)(r);const S=r.parentElement;S&&S.style.display==="none"&&f(S)};var g=n(5539),m=n(573),E=n(7877),u=n(1719),e=n(9175),a=n(4521),c=n(5213),y=n(3829),N=n(4921),F=n(6754);const{createGlobalFilter:w}=(0,a.z)(L),l=w("min-rating-filter",4),h=w("filter-enabled",!0),i={commentsCache:new WeakMap};await o();async function o(){const r=await(0,N.xk)(document,u.Z.COMMENTS_TREE);x(r,p)}async function p(){const r=await(0,N.xk)(document,u.Z.COMMENTS_HEADER);(0,c.b)(r,D),L()}v()}catch(w){v(w)}},1)},1719:(T,s,n)=>{n.d(s,{Z:()=>C});const C={COMMENTS_TREE:".tm-comments__tree",COMMENTS_HEADER:".tm-comments-wrapper__header",COMMENTS:".tm-comment-thread__comment:not(.process-passed)",RATING_WRAP:".tm-votes-lever__score-counter"}},9175:(T,s,n)=>{n.d(s,{r:()=>v});const v={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",marginLeft:"28px"},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},NUMBER_INPUT:{...{INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px",fontSize:"15px"}}.INPUT,width:"35px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},B={};function M(T){var s=B[T];if(s!==void 0)return s.exports;var n=B[T]={exports:{}};return V[T](n,n.exports,M),n.exports}(()=>{var T=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",s=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",n=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",C=g=>{g&&g.d<1&&(g.d=1,g.forEach(m=>m.r--),g.forEach(m=>m.r--?m.r++:m()))},v=g=>g.map(m=>{if(m!==null&&typeof m=="object"){if(m[T])return m;if(m.then){var E=[];E.d=0,m.then(a=>{u[s]=a,C(E)},a=>{u[n]=a,C(E)});var u={};return u[T]=a=>a(E),u}}var e={};return e[T]=a=>{},e[s]=m,e});M.a=(g,m,E)=>{var u;E&&((u=[]).d=-1);var e=new Set,a=g.exports,c,y,N,F=new Promise((w,l)=>{N=l,y=w});F[s]=a,F[T]=w=>(u&&w(u),e.forEach(w),F.catch(l=>{})),g.exports=F,m(w=>{c=v(w);var l,h=()=>c.map(o=>{if(o[n])throw o[n];return o[s]}),i=new Promise(o=>{l=()=>o(h),l.r=0;var x=p=>p!==u&&!e.has(p)&&(e.add(p),p&&!p.d&&(l.r++,p.push(l)));c.map(p=>p[T](x))});return l.r?i:h()},w=>(w?N(F[n]=w):y(a),C(u))),u&&u.d<0&&(u.d=0)}})(),M.d=(T,s)=>{for(var n in s)M.o(s,n)&&!M.o(T,n)&&Object.defineProperty(T,n,{enumerable:!0,get:s[n]})},M.o=(T,s)=>Object.prototype.hasOwnProperty.call(T,s);var U=M(6213)})();})();
