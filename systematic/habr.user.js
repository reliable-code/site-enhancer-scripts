// ==UserScript==
// @name         Habr comments filter
// @description  Hide comments by filter
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://habr.com/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.76073497
// @icon         https://www.google.com/s2/favicons?sz=64&domain=habr.com
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/habr.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var V={5467:(N,d,r)=>{r.d(d,{E2:()=>b});var C=r(9928);function b(E,u={},e=null){const s=(0,C.Sw)(u,e);return s.append(E),s}function g(E,u=null,e={},s={}){const l=createActionLink(E,u,s);return b(l,e)}function p(E,u=null,e=null,s={},l={}){const F=createActionLinkWithIcon(E,e,u,l);return b(F,s)}},9928:(N,d,r)=>{r.d(d,{S:()=>E,Sw:()=>y,o5:()=>p});var C=r(4921),b=r(6754);function g(c,o,x){const v=u(c,"text",o);return v.value=x,v}function p(c,o,x,v,R,D){const O=u(c,"number",o);return O.value=x,O.step=v,O.min=R,O.max=D,O}function E(c,o,x){const v=u(c,"checkbox",o);return v.checked=x,v}function u(c={},o=null,x=null){const v=h("input",c);return o&&(v.type=o),x&&(v.addEventListener("keyup",(0,C.sg)(x,200)),v.addEventListener("change",(0,C.sg)(x,100))),v}function e(c={},o=null){return h("span",c,o)}function s(c={},o=null,x=null){const v=h("a",c,o);return x&&(v.href=x),v}function l(c,o=null,x={}){x.cursor||="pointer";const v=s(x,o);return c&&v.addEventListener("click",c),v}function F(c,o,x=null,v={},R={}){v.display||="inline-flex",v.alignItems||="center",v.gap||="0.25em";const D=l(c,x,v);return D.prepend(a(o,R)),D}function S(c={},o=null,x=null){const v=h("button",c,o);return x&&v.addEventListener("click",x),v}function y(c={},o=null){return h("div",c,o)}function T(c={}){return h("i",c)}function a(c,o={}){o.width||="1em",o.height||="1em",o.paddingBottom||="1px";const x=T(o);return x.setAttribute("data-lucide",c),x}function h(c,o,x=null){if(typeof o!="object"||o===null)throw new TypeError("styles should be an object");const v=document.createElement(c);return(0,b.ZM)(v,o),x&&(v.innerHTML=x),v}},573:(N,d,r)=>{r.d(d,{Fi:()=>b,fI:()=>g});function C(a,h=document){return!!h.querySelector(a)}function b(a,h=document,c=!1){const o=h.querySelector(a);return c&&!o&&console.log(`No element found for selector: ${a}`),o}function g(a,h=document,c=!1){const o=h.querySelectorAll(a);return c&&!o.length&&console.log(`No elements found for selector: ${a}`),o}function p(a,h=1){let c=a;for(let o=0;o<h;o++){if(!c.parentElement)return null;c=c.parentElement}return c}function E(a,h,c){return[...a.querySelectorAll(h)].find(o=>o.textContent.trim().includes(c))}function u(a,h,c=!1,o=!1,x=null){const v=b(h,a);return e(v,c,o,x)}function e(a,h=!1,c=!1,o=null){if(!a)return o===null?(console.log("No element found"),null):o;const x=a.innerText;return F(x,h,c)}function s(a,h,c=!1){const o=a[h];return e(o,c)}function l(a,h=!1,c=!1){const o=a.textContent;return F(o,h,c)}function F(a,h,c){h&&(a=removeNonNumber(a)),c&&(a=a.replace(",","."));const o=Number(a);return Number.isNaN(o)?(console.log(`Invalid number: ${a}`),0):o}function S(a){return[...a.childNodes].find(h=>h.nodeType===Node.TEXT_NODE)}function y(a){const h=c=>c.nodeType===Node.TEXT_NODE&&c.textContent.trim()!==""?[c]:[...c.childNodes].flatMap(h);return h(a)}function T(a){return normalizeSpacing(a.textContent)}},5539:(N,d,r)=>{r.d(d,{Bt:()=>b,kl:()=>e});function C(n,m){n.parentNode.insertBefore(m,n.nextSibling)}function b(n){n.style.display="none"}function g(n,m=1){const w=document.querySelector(n);w&&p(w,m)}function p(n,m=1){const w=getElementAncestor(n,m);w&&b(w)}function E(n){y(n),b(n)}function u(n){n.intersectionObserver||runOnceOnIntersection(n,()=>b(n))}function e(n){n.style.display=""}function s(n){const m=S(n);n.style.display=m}function l(n,m){m?b(n):e(n)}function F(n,m){m?u(n):(clearIntersectionObserver(n),e(n))}function S(n){return y(n),n.defaultDisplay}function y(n){if(n.defaultDisplay)return;const{display:m}=getComputedStyle(n);n.defaultDisplay=m}function T(){return{show:[],hide:[]}}function a(n,m,w){n?m.hide.push(w):m.show.push(w)}function h(n){n.show.forEach(e),n.hide.forEach(b)}function c(n,m,w=.3){m?x(n,w):o(n)}function o(n){n.style.opacity=""}function x(n,m=.3){n.style.opacity=m}function v(n){n.style.order=""}function R(n,m){n.style.order=m}function D(n,m){n.style.background=m}function O(n,m){const w=getFirstElement(m);w&&_(n,w)}function _(n,m){const w=createLink();w.href=n,m.parentNode.append(w),w.append(m)}function f(n,m){const w=getFirstElement(m);w&&t(n,w)}function t(n,m){const w=createLink();w.href=n,w.append(...m.childNodes),m.append(w)}function i(){const n=getURLQueryParam("scrollTo");if(!n)return;const m=document.getElementById(n);m?m.scrollIntoView():console.log(`Element with ID "${n}" was not found.`)}function k(n,m,w=null){const L=`${m}-click-passed`,M=w?A=>findElementByText(A,n,w):A=>getFirstElement(n,A);return function(A){if(A.hasAttribute(L))return!1;const P=M(A);return P&&P.click(),A.setAttribute(L,""),!0}}function I(n,m,w="text/plain"){const L=new Blob([n],{type:w}),M=URL.createObjectURL(L),A=document.createElement("a");A.href=M,A.download=m,document.body.appendChild(A),A.click(),document.body.removeChild(A),requestAnimationFrame(()=>URL.revokeObjectURL(M))}},6754:(N,d,r)=>{r.d(d,{ZM:()=>C});function C(E,u){Object.assign(E.style,u)}function b(E,u="custom-global-style"){let e=document.getElementById(u);e||(e=document.createElement("style"),e.id=u,e.type="text/css",document.head.appendChild(e)),e.textContent=E}function g(E){return Object.entries(E).map(([u,e])=>`${u.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${e};`).join(" ")}function p(E){return E?E.split(";").filter(u=>u.trim()!=="").reduce((u,e)=>{const[s,l]=e.split(":").map(S=>S.trim()),F=s.replace(/-([a-z])/g,(S,y)=>y.toUpperCase());return u[F]=l,u},{}):{}}},4921:(N,d,r)=>{r.d(d,{sg:()=>p,xk:()=>C});function C(l,F,S=null){const y=l.querySelector(F);return y?Promise.resolve(y):new Promise(T=>{const a=new MutationObserver(c);a.observe(l,{childList:!0,subtree:!0});let h;S&&(h=setTimeout(()=>{a.disconnect(),console.log(`No element found for selector: ${F}`),T(null)},S));function c(){const o=l.querySelector(F);o&&(h&&clearTimeout(h),a.disconnect(),T(o))}})}function b(l,F){return l.querySelector(F)?new Promise(y=>{const T=new MutationObserver(a);T.observe(l,{childList:!0,subtree:!0});function a(){l.querySelector(F)||(T.disconnect(),y())}}):Promise.resolve()}function g(l,F=400){return new Promise(S=>{let y;const T=new MutationObserver(()=>{clearTimeout(y),a()});function a(){y=setTimeout(()=>{T.disconnect(),S()},F)}a(),T.observe(l,{childList:!0,subtree:!0})})}function p(l,F=250){let S;return(...y)=>{clearTimeout(S),S=setTimeout(()=>l(...y),F)}}async function E(l){document.visibilityState==="visible"?await l():document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&await l()},{once:!0})}function u(l,F){const S=new IntersectionObserver(y=>{y.forEach(T=>{T.isIntersecting&&(F(),e(l))})});l.intersectionObserver=S,S.observe(l)}function e(l){l.intersectionObserver&&(l.intersectionObserver.disconnect(),l.intersectionObserver=null)}function s(l){l&&(l.disconnect(),l=null)}},3829:(N,d,r)=>{r.d(d,{JE:()=>g});function C(u,e){return!b(u,e)}function b(u,e){if(!e.value)return!0;const s=u.toLowerCase(),l=getSearchStrings(e),F=[],S=[];return l.forEach(y=>{if(y.startsWith("!")){const T=y.substring(1);T&&S.push(T)}else F.push(y)}),F.every(y=>s.includes(y))&&S.every(y=>!s.includes(y))}function g(u,e){return e.value!=null&&u<e.value}function p(u,e){return e.value!=null&&u>e.value}function E(u,e){return e.value&&u!==e.value}},4521:(N,d,r)=>{r.d(d,{z:()=>b});var C=r(3048);function b(g,p=null){return{createGlobalFilter(E,u=null,e=g){return C.V.create(E,u,e)},createSectionFilter(E,u=null,e=g){if(!p)throw new Error("sectionId must be provided to use createSectionFilter.");return C.V.createWithCompositeKey(p,E,u,e)}}}},5884:(N,d,r)=>{r.d(d,{Hw:()=>E,nW:()=>p});var C=r(9928),b=r(5467);function g(u,e,s={},l={}){const F=createTextInput(l,e.updateValueFromEvent,e.value);return createControl(F,s,u)}function p(u,e,s,l,F,S={},y={}){const T=(0,C.o5)(y,e.updateValueFromEvent,e.value,s,l,F);return(0,b.E2)(T,S,u)}function E(u,e,s={},l={}){const F=(0,C.S)(l,e.updateValueFromEvent,e.value);return(0,b.E2)(F,s,u)}},7877:(N,d,r)=>{r.d(d,{aW:()=>a,pW:()=>O});var C=r(5884);function b(f,t={},i={}){return createTextFilterControl("\u041F\u043E\u0438\u0441\u043A: ",f,t,i)}function g(f,t={},i={},k=.1,I=3){return createNumberFilterControl("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",f,k,I,5,t,i)}function p(f,t={},i={},k=.1,I=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",f,k,I,5,t,i)}function E(f,t={},i={}){return e("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",f,t,i)}function u(f,t={},i={}){return e("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",f,t,i)}function e(f,t,i={},k={}){return createNumberFilterControl(f,t,"1","1","999999",i,k)}function s(f,t={},i={}){return l("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",f,t,i)}function l(f,t,i={},k={}){return createNumberFilterControl(f,t,"5","0","100",i,k)}function F(f,t={},i={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",f,"5","0","100",t,i)}function S(f,t,i={},k={},I="250"){return createNumberFilterControl(f,t,I,"0","1000000",i,k)}function y(f,t={},i={},k="25"){return S("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",f,t,i,k)}function T(f,t={},i={},k="25"){return S("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",f,t,i,k)}function a(f,t={},i={}){return h("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",f,t,i)}function h(f,t,i={},k={}){return(0,C.nW)(f,t,"1","0","99999",i,k)}function c(f,t={},i={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",f,"1","2","7",t,i)}function o(f,t={},i={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",f,1,1,10,t,i)}function x(f,t={},i={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",f,t,i)}function v(f,t={},i={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",f,t,i)}function R(f,t={},i={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",f,t,i)}function D(f,t={},i={}){return createCheckboxFilterControl("\u0411\u0430\u043B\u043B\u044B: ",f,t,i)}function O(f,t={},i={}){return(0,C.Hw)("\u0412\u043A\u043B: ",f,t,i)}function _(f,t,i={}){const k=[{value:-25,emoji:"\u{1F48E}",tooltip:"\u0421\u0443\u043F\u0435\u0440 \u0446\u0435\u043D\u0430 (-25%)"},{value:-15,emoji:"\u{1F525}",tooltip:"\u041E\u0442\u043B\u0438\u0447\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-15%)"},{value:-5,emoji:"\u{1F31F}",tooltip:"\u041A\u043B\u0430\u0441\u0441\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-5%)"},{value:5,emoji:"\u{1F44C}",tooltip:"\u0425\u043E\u0440\u043E\u0448\u0430\u044F \u0446\u0435\u043D\u0430 (+5%)"}],I=createDiv({display:"inline-flex",gap:"4px",marginLeft:"4px"}),n=[],m=()=>{const w=t?parseFloat(t.value)||0:f.value;n.forEach(({button:L,value:M})=>{M<=w?(L.style.background="#e3f2fd",L.style.borderColor="#2196f3",L.style.boxShadow="0 0 0 1px #2196f3"):(L.style.background="#fff",L.style.borderColor="#ccc",L.style.boxShadow="none")})};return k.forEach(({value:w,emoji:L,tooltip:M})=>{const A=createButton({padding:"2px 6px",fontSize:"16px",cursor:"pointer",border:"1px solid #ccc",borderRadius:"4px",background:"#fff",transition:"all 0.2s",...i},L);A.title=M,A.type="button",A.addEventListener("click",P=>{P.preventDefault(),f.updateValue(w),t&&(t.value=w),m()}),A.addEventListener("mouseenter",()=>{const P=t?parseFloat(t.value)||0:f.value;w<=P||(A.style.background="#f5f5f5")}),A.addEventListener("mouseleave",()=>{m()}),n.push({button:A,value:w}),I.appendChild(A)}),m(),t&&(t.addEventListener("input",m),t.addEventListener("change",m)),I}},5213:(N,d,r)=>{r.d(d,{b:()=>g});var C=r(9928),b=r(573);function g(p,E,u=!1,e="customFiltersContainer"){let s=(0,b.Fi)(`#${e}`,p);if(s)if(u)s.remove();else return;s=(0,C.Sw)(),s.id=e,E(s,p)}},8200:(N,d,r)=>{r.d(d,{s:()=>C});function C(b){const{target:g}=b,{type:p}=g;switch(p){case"text":return`"${g.value}"`;case"number":return g.value;case"checkbox":return g.checked;default:return console.log(`Unknown input type: ${p}`),null}}},157:(N,d,r)=>{r.d(d,{Fg:()=>C,vx:()=>g});const C=window.GM_setValue,b=window.GM.setValue,g=window.GM_getValue},1870:(N,d,r)=>{r.d(d,{j:()=>C});class C{constructor(g,p){this.value=g,this.onChange=p}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(N,d,r)=>{r.d(d,{V:()=>E});var C=r(1870),b=r(8200),g=r(3976),p=r(157);class E extends C.j{constructor(e,s=null,l=null){super((0,p.vx)(e,s),l),this.storageKey=e,this.defaultValue=s}static create(e,s=null,l=null){return new E(e,s,l)}static createWithCompositeKey(e,s,l=null,F=null){const S=`${e}-${s}`;return new E(S,l,F)}updateValueFromEvent=e=>{const s=(0,b.s)(e),l=(0,g.$)(s);this.updateValue(l)};updateValue(e,s=!0){this.value!==e&&((0,p.Fg)(this.storageKey,e),this.value=e,s&&this.onChangeIfDefined())}clearValue(e=!1){this.updateValue(null,e)}resetValue(e=!1){this.updateValue(this.defaultValue,e)}}},3976:(N,d,r)=>{r.d(d,{$:()=>C});function C(b){return b===""?null:JSON.parse(b)}},6213:(N,d,r)=>{r.a(N,async(C,b)=>{try{let x=function(t,i){let k=t.innerText;function I(){const n=t.innerText;n!==k&&(k=n,i()),requestAnimationFrame(I)}requestAnimationFrame(I)},R=function(t,i){(0,y.ZM)(t,e.r.FILTERS_CONTAINER),(0,y.ZM)(i,e.r.FILTERS_CONTAINER_WRAP);const k=(0,E.aW)(a,e.r.CONTROL,e.r.NUMBER_INPUT),I=(0,E.pW)(h,e.r.CONTROL,e.r.CHECKBOX_INPUT);t.append(k,I),i.append(t)},D=function(){(0,p.fI)(u.Z.COMMENTS).forEach(O)},O=function(t){if(!h.value){f(t);return}let i=c.commentsCache.get(t);if(!i){const I=(0,p.Fi)(u.Z.RATING_WRAP,t);if(!I)return;const n=I.innerText.trim();if(n==="")return;i={rating:+n},c.commentsCache.set(t,i)}(0,F.JE)(i.rating,a)?_(t):f(t)},_=function(t){(0,g.Bt)(t);const i=t.parentElement;i&&[...i.children].every(k=>k.style.display==="none")&&_(i)},f=function(t){(0,g.kl)(t);const i=t.parentElement;i&&i.style.display==="none"&&f(i)};var g=r(5539),p=r(573),E=r(7877),u=r(1719),e=r(9175),s=r(4521),l=r(5213),F=r(3829),S=r(4921),y=r(6754);const{createGlobalFilter:T}=(0,s.z)(D),a=T("min-rating-filter",4),h=T("filter-enabled",!0),c={commentsCache:new WeakMap};await o();async function o(){const t=await(0,S.xk)(document,u.Z.COMMENTS_TREE);x(t,v)}async function v(){const t=await(0,S.xk)(document,u.Z.COMMENTS_HEADER);(0,l.b)(t,R),D()}b()}catch(T){b(T)}},1)},1719:(N,d,r)=>{r.d(d,{Z:()=>C});const C={COMMENTS_TREE:".tm-comments__tree",COMMENTS_HEADER:".tm-comments-wrapper__header",COMMENTS:".tm-comment-thread__comment:not(.process-passed)",RATING_WRAP:".tm-votes-lever__score-counter"}},9175:(N,d,r)=>{r.d(d,{r:()=>b});const b={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",marginLeft:"28px"},FILTERS_CONTAINER_WRAP:{background:"#fff",borderBottom:"1px solid rgba(146, 156, 165, .4)",position:"sticky",top:"56px",zIndex:10},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},NUMBER_INPUT:{...{INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px",fontSize:"15px"}}.INPUT,width:"35px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},W={};function B(N){var d=W[N];if(d!==void 0)return d.exports;var r=W[N]={exports:{}};return V[N](r,r.exports,B),r.exports}(()=>{var N=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",d=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",r=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",C=g=>{g&&g.d<1&&(g.d=1,g.forEach(p=>p.r--),g.forEach(p=>p.r--?p.r++:p()))},b=g=>g.map(p=>{if(p!==null&&typeof p=="object"){if(p[N])return p;if(p.then){var E=[];E.d=0,p.then(s=>{u[d]=s,C(E)},s=>{u[r]=s,C(E)});var u={};return u[N]=s=>s(E),u}}var e={};return e[N]=s=>{},e[d]=p,e});B.a=(g,p,E)=>{var u;E&&((u=[]).d=-1);var e=new Set,s=g.exports,l,F,S,y=new Promise((T,a)=>{S=a,F=T});y[d]=s,y[N]=T=>(u&&T(u),e.forEach(T),y.catch(a=>{})),g.exports=y,p(T=>{l=b(T);var a,h=()=>l.map(o=>{if(o[r])throw o[r];return o[d]}),c=new Promise(o=>{a=()=>o(h),a.r=0;var x=v=>v!==u&&!e.has(v)&&(e.add(v),v&&!v.d&&(a.r++,v.push(a)));l.map(v=>v[N](x))});return a.r?c:h()},T=>(T?S(y[r]=T):F(s),C(u))),u&&u.d<0&&(u.d=0)}})(),B.d=(N,d)=>{for(var r in d)B.o(d,r)&&!B.o(N,r)&&Object.defineProperty(N,r,{enumerable:!0,get:d[r]})},B.o=(N,d)=>Object.prototype.hasOwnProperty.call(N,d);var U=B(6213)})();})();
