// ==UserScript==
// @name         Habr comments filter
// @description  Hide comments by filter
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://habr.com/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.76943879
// @icon         https://www.google.com/s2/favicons?sz=64&domain=habr.com
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/habr.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var G={5467:(k,m,n)=>{n.d(m,{E2:()=>b});var x=n(9928);function b(C,f={},t=null){const s=(0,x.Sw)(f,t);return s.append(C),s}function F(C,f=null,t={},s={}){const o=createActionLink(C,f,s);return b(o,t)}function v(C,f=null,t=null,s={},o={},l={}){const r=createActionLinkWithIcon(C,t,f,o,l);return b(r,s)}},9928:(k,m,n)=>{n.d(m,{S:()=>f,Sw:()=>i,o5:()=>v});var x=n(4921),b=n(6754);function F(g,p,N){const y=t(g,"text",p);return y.value=N,y}function v(g,p,N,y,_,R){const L=t(g,"number",p);return L.value=N,L.step=y,L.min=_,L.max=R,L}function C(g,p,N){const y=t(g,"date",p);return y.value=N,y}function f(g,p,N){const y=t(g,"checkbox",p);return y.checked=N,y}function t(g={},p=null,N=null){const y=h("input",g);return p&&(y.type=p),N&&(y.addEventListener("keyup",(0,x.sg)(N,200)),y.addEventListener("change",(0,x.sg)(N,100))),y}function s(g,p,N){const y=h("select",g);return p&&y.addEventListener("change",p),y.value=N,y}function o(g={},p=null){return h("span",g,p)}function l(g={},p=null,N=null){const y=h("a",g,p);return N&&(y.href=N),y}function r(g,p=null,N={}){N.cursor||="pointer";const y=l(N,p);return g&&y.addEventListener("click",g),y}function E(g,p,N=null,y={},_={}){y.display||="inline-flex",y.alignItems||="center",y.gap||="0.25em";const R=r(g,N,y);return R.prepend(w(p,_)),R}function S(g={},p=null,N=null){const y=h("button",g,p);return N&&y.addEventListener("click",N),y}function i(g={},p=null){return h("div",g,p)}function T(g={},p=null){return h("i",g,p)}function w(g,p={}){p.width||="1em",p.height||="1em";const N=createLucideSvg(g);return applyStyles(N,p),N}function h(g,p,N=null){if(typeof p!="object"||p===null)throw new TypeError("styles should be an object");const y=document.createElement(g);return(0,b.ZM)(y,p),N&&(y.innerHTML=N),y}},573:(k,m,n)=>{n.d(m,{Fi:()=>b,fI:()=>F});function x(i,T=document){return!!T.querySelector(i)}function b(i,T=document,w=!1){const h=T.querySelector(i);return w&&!h&&console.log(`No element found for selector: ${i}`),h}function F(i,T=document,w=!1){const h=T.querySelectorAll(i);return w&&!h.length&&console.log(`No elements found for selector: ${i}`),h}function v(i,T=1){let w=i;for(let h=0;h<T;h++){if(!w.parentElement)return null;w=w.parentElement}return w}function C(i,T,w){return[...i.querySelectorAll(T)].find(h=>h.textContent.trim().includes(w))}function f(i,T,w=!1,h=!1,g=null){const p=b(T,i);return t(p,w,h,g)}function t(i,T=!1,w=!1,h=null){if(!i)return h===null?(console.log("No element found"),null):h;const g=i.innerText;return l(g,T,w)}function s(i,T,w=!1){const h=i[T];return t(h,w)}function o(i,T=!1,w=!1){const h=i.textContent;return l(h,T,w)}function l(i,T,w){T&&(i=removeNonNumber(i)),w&&(i=i.replace(",","."));const h=Number(i);return Number.isNaN(h)?(console.log(`Invalid number: ${i}`),0):h}function r(i){return[...i.childNodes].find(T=>T.nodeType===Node.TEXT_NODE)}function E(i){const T=w=>w.nodeType===Node.TEXT_NODE&&w.textContent.trim()!==""?[w]:[...w.childNodes].flatMap(T);return T(i)}function S(i){return normalizeSpacing(i.textContent)}},5539:(k,m,n)=>{n.d(m,{Bt:()=>b,kl:()=>t});function x(e,d){e.parentNode.insertBefore(d,e.nextSibling)}function b(e){e.style.display="none"}function F(e,d=1){const D=document.querySelector(e);D&&v(D,d)}function v(e,d=1){const D=getElementAncestor(e,d);D&&b(D)}function C(e){E(e),b(e)}function f(e){e.intersectionObserver||runOnceOnIntersection(e,()=>b(e))}function t(e){e.style.display=""}function s(e){const d=r(e);e.style.display=d}function o(e,d){d?b(e):t(e)}function l(e,d){d?f(e):(clearIntersectionObserver(e),t(e))}function r(e){return E(e),e.defaultDisplay}function E(e){if(e.defaultDisplay)return;const{display:d}=getComputedStyle(e);e.defaultDisplay=d}function S(){return{show:[],hide:[]}}function i(e,d,D){e?d.hide.push(D):d.show.push(D)}function T(e){e.show.forEach(t),e.hide.forEach(b)}function w(e,d,D=.3){d?g(e,D):h(e)}function h(e){e.style.opacity=""}function g(e,d=.3){e.style.opacity=d}function p(e){e.style.order=""}function N(e,d){e.style.order=d}function y(e,d){e.style.background=d}function _(e,d){const D=getFirstElement(d);D&&R(e,D)}function R(e,d){const D=createLink();D.href=e,d.parentNode.append(D),D.append(d)}function L(e,d){const D=getFirstElement(d);D&&I(e,D)}function I(e,d,D={}){const O=createLink(D);O.href=e,O.append(...d.childNodes),d.append(O)}function u(){const e=getURLQueryParam("scrollTo");if(!e)return;const d=document.getElementById(e);d?d.scrollIntoView():console.log(`Element with ID "${e}" was not found.`)}function c(e,d,D=null){const O=`${d}-click-passed`,V=D?A=>findElementByText(A,e,D):A=>getFirstElement(e,A);return function(A){if(A.hasAttribute(O))return!1;const M=V(A);return M&&M.click(),A.setAttribute(O,""),!0}}function a(e,d,D="text/plain"){const O=new Blob([e],{type:D}),V=URL.createObjectURL(O),A=document.createElement("a");A.href=V,A.download=d,document.body.appendChild(A),A.click(),document.body.removeChild(A),requestAnimationFrame(()=>URL.revokeObjectURL(V))}},6754:(k,m,n)=>{n.d(m,{ZM:()=>x});function x(C,f){Object.assign(C.style,f)}function b(C,f="custom-global-style"){let t=document.getElementById(f);t||(t=document.createElement("style"),t.id=f,t.type="text/css",document.head.appendChild(t)),t.textContent=C}function F(C){return Object.entries(C).map(([f,t])=>`${f.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${t};`).join(" ")}function v(C){return C?C.split(";").filter(f=>f.trim()!=="").reduce((f,t)=>{const[s,o]=t.split(":").map(r=>r.trim()),l=s.replace(/-([a-z])/g,(r,E)=>E.toUpperCase());return f[l]=o,f},{}):{}}},4921:(k,m,n)=>{n.d(m,{sg:()=>v,xk:()=>x});function x(o,l,r=null){const E=o.querySelector(l);return E?Promise.resolve(E):new Promise(S=>{const i=new MutationObserver(w);i.observe(o,{childList:!0,subtree:!0});let T;r&&(T=setTimeout(()=>{i.disconnect(),console.log(`No element found for selector: ${l}`),S(null)},r));function w(){const h=o.querySelector(l);h&&(T&&clearTimeout(T),i.disconnect(),S(h))}})}function b(o,l){return o.querySelector(l)?new Promise(E=>{const S=new MutationObserver(i);S.observe(o,{childList:!0,subtree:!0});function i(){o.querySelector(l)||(S.disconnect(),E())}}):Promise.resolve()}function F(o,l=400){return new Promise(r=>{let E;const S=new MutationObserver(()=>{clearTimeout(E),i()});function i(){E=setTimeout(()=>{S.disconnect(),r()},l)}i(),S.observe(o,{childList:!0,subtree:!0})})}function v(o,l=250){let r;return(...E)=>{clearTimeout(r),r=setTimeout(()=>o(...E),l)}}async function C(o){document.visibilityState==="visible"?await o():document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&await o()},{once:!0})}function f(o,l){const r=new IntersectionObserver(E=>{E.forEach(S=>{S.isIntersecting&&(l(),t(o))})});o.intersectionObserver=r,r.observe(o)}function t(o){o.intersectionObserver&&(o.intersectionObserver.disconnect(),o.intersectionObserver=null)}function s(o){o&&(o.disconnect(),o=null)}},3829:(k,m,n)=>{n.d(m,{JE:()=>C});function x(l,r){return!b(l,r)}function b(l,r){if(!r||!r.value)return!0;const E=parseFilterQuery(r.value);return F(l,E)}function F(l,r){if(!r||!r.length)return!0;const E=(l||"").toLowerCase();return r.every(S=>v(E,S))}function v(l,r){return r.some(({term:E,isNegative:S})=>{const i=l.includes(E);return S?!i:i})}function C(l,r){return r.value!=null&&l<r.value}function f(l,r){return r.value!=null&&l>r.value}function t(l,r){return r.value==null?!1:l<parseDateFromISO(r.value)}function s(l,r){return r.value==null?!1:l>parseDateFromISO(r.value)}function o(l,r){return r.value&&l!==r.value}},4521:(k,m,n)=>{n.d(m,{z:()=>b});var x=n(3048);function b(F,v=null){return{createGlobalFilter(C,f=null,t=F){return x.V.create(C,f,t)},createSectionFilter(C,f=null,t=F){if(!v)throw new Error("sectionId must be provided to use createSectionFilter.");return x.V.createWithCompositeKey(v,C,f,t)}}}},5884:(k,m,n)=>{n.d(m,{Hw:()=>t,nW:()=>v});var x=n(9928),b=n(5467);function F(s,o,l={},r={}){const E=createTextInput(r,o.updateValueFromEvent,o.value);return createControl(E,l,s)}function v(s,o,l,r,E,S={},i={}){const T=(0,x.o5)(i,o.updateValueFromEvent,o.value,l,r,E);return(0,b.E2)(T,S,s)}function C(s,o,l={},r={}){const E=createSelect(r,o.updateValueFromEvent,o.value);return createControl(E,l,s)}function f(s,o,l={},r={}){const E=createDateInput(r,o.updateValueFromEvent,o.value);return createControl(E,l,s)}function t(s,o,l={},r={}){const E=(0,x.S)(r,o.updateValueFromEvent,o.value);return(0,b.E2)(E,l,s)}},7877:(k,m,n)=>{n.d(m,{aW:()=>T,pW:()=>L});var x=n(5884);function b(u,c={},a={}){return createTextFilterControl("\u041F\u043E\u0438\u0441\u043A: ",u,c,a)}function F(u,c={},a={},e=.1,d=3){return createNumberFilterControl("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",u,e,d,5,c,a)}function v(u,c={},a={},e=.1,d=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",u,e,d,5,c,a)}function C(u,c={},a={}){return t("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",u,c,a)}function f(u,c={},a={}){return t("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",u,c,a)}function t(u,c,a={},e={}){return createNumberFilterControl(u,c,"1","1","999999",a,e)}function s(u,c={},a={}){return createDateFilterControl("\u041C\u0438\u043D. \u0434\u0430\u0442\u0430: ",u,c,a)}function o(u,c={},a={}){return l("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",u,c,a)}function l(u,c,a={},e={}){return createNumberFilterControl(u,c,"5","0","100",a,e)}function r(u,c={},a={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",u,"5","0","100",c,a)}function E(u,c,a={},e={},d="250"){return createNumberFilterControl(u,c,d,"0","1000000",a,e)}function S(u,c={},a={},e="25"){return E("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",u,c,a,e)}function i(u,c={},a={},e="25"){return E("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",u,c,a,e)}function T(u,c={},a={}){return w("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",u,c,a)}function w(u,c,a={},e={}){return(0,x.nW)(u,c,"1","0","99999",a,e)}function h(u,c={},a={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",u,"1","2","8",c,a)}function g(u,c={},a={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",u,1,1,10,c,a)}function p(u,c={},a={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",u,c,a)}function N(u,c={},a={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",u,c,a)}function y(u,c={},a={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",u,c,a)}function _(u,c={},a={}){return createCheckboxFilterControl("\u0411\u043E\u043D\u0443\u0441: ",u,c,a)}function R(u,c={},a={}){return createCheckboxFilterControl("\u0412 \u043D\u0430\u043B\u0438\u0447\u0438\u0438: ",u,c,a)}function L(u,c={},a={}){return(0,x.Hw)("\u0412\u043A\u043B: ",u,c,a)}function I(u,c,a={}){const e=[{value:-25,emoji:"\u{1F48E}",tooltip:"\u0421\u0443\u043F\u0435\u0440 \u0446\u0435\u043D\u0430 (-25%)"},{value:-15,emoji:"\u{1F525}",tooltip:"\u041E\u0442\u043B\u0438\u0447\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-15%)"},{value:-5,emoji:"\u{1F31F}",tooltip:"\u041A\u043B\u0430\u0441\u0441\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-5%)"},{value:5,emoji:"\u{1F44C}",tooltip:"\u0425\u043E\u0440\u043E\u0448\u0430\u044F \u0446\u0435\u043D\u0430 (+5%)"}],d={active:{background:"#e3f2fd",borderColor:"#2196f3",boxShadow:"0 0 0 1px #2196f3"},inactive:{background:"#fff",borderColor:"#ccc",boxShadow:"none"},hover:{background:"#f5f5f5"}},D=createDiv({display:"inline-flex",gap:"4px",marginLeft:"4px"}),O=[],V=()=>c?parseFloat(c.value)||0:u.value,A=()=>{const M=V();O.forEach(({button:U,value:j})=>{const W=j<=M?d.active:d.inactive;Object.assign(U.style,W)})};return e.forEach(({value:M,emoji:U,tooltip:j})=>{const B=createButton({padding:"2px 6px",fontSize:"16px",cursor:"pointer",border:"1px solid #ccc",borderRadius:"4px",background:"#fff",transition:"all 0.2s",...a},U);B.title=j,B.type="button",B.addEventListener("click",W=>{W.preventDefault(),u.updateValue(M),c&&(c.value=M),A()}),B.addEventListener("mouseenter",()=>{M<=V()||(B.style.background=d.hover.background)}),B.addEventListener("mouseleave",()=>{A()}),O.push({button:B,value:M}),D.appendChild(B)}),A(),c&&(c.addEventListener("input",A),c.addEventListener("change",A)),D}},5213:(k,m,n)=>{n.d(m,{b:()=>F});var x=n(9928),b=n(573);function F(v,C,f=!1,t="customFiltersContainer"){let s=(0,b.Fi)(`#${t}`,v);if(s)if(f)s.remove();else return;s=(0,x.Sw)(),s.id=t,C(s,v)}},8200:(k,m,n)=>{n.d(m,{s:()=>x});function x(b){const{target:F}=b,{type:v}=F;switch(v){case"text":return`"${F.value}"`;case"number":return F.value;case"select-one":return F.value;case"date":return`"${F.value}"`;case"checkbox":return F.checked;default:return console.log(`Unknown input type: ${v}`),null}}},157:(k,m,n)=>{n.d(m,{Fg:()=>x,vx:()=>F});const x=window.GM_setValue,b=window.GM.setValue,F=window.GM_getValue},1870:(k,m,n)=>{n.d(m,{j:()=>x});class x{constructor(F,v){this.value=F,this.onChange=v}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(k,m,n)=>{n.d(m,{V:()=>C});var x=n(1870),b=n(8200),F=n(3976),v=n(157);class C extends x.j{constructor(t,s=null,o=null){super((0,v.vx)(t,s),o),this.storageKey=t,this.defaultValue=s}static create(t,s=null,o=null){return new C(t,s,o)}static createWithCompositeKey(t,s,o=null,l=null){const r=`${t}-${s}`;return new C(r,o,l)}updateValueFromEvent=t=>{const s=(0,b.s)(t),o=(0,F.$)(s);this.updateValue(o)};updateValue(t,s=!0){this.value!==t&&((0,v.Fg)(this.storageKey,t),this.value=t,s&&this.onChangeIfDefined())}clearValue(t=!1){this.updateValue(null,t)}resetValue(t=!1){this.updateValue(this.defaultValue,t)}}},3976:(k,m,n)=>{n.d(m,{$:()=>x});function x(b){return b===""?null:JSON.parse(b)}},6213:(k,m,n)=>{n.a(k,async(x,b)=>{try{let g=function(I,u){let c=I.innerText;function a(){const e=I.innerText;e!==c&&(c=e,u()),requestAnimationFrame(a)}requestAnimationFrame(a)},N=function(I,u){(0,E.ZM)(I,t.r.FILTERS_CONTAINER),(0,E.ZM)(u,t.r.FILTERS_CONTAINER_WRAP);const c=(0,C.aW)(i,t.r.CONTROL,t.r.NUMBER_INPUT),a=(0,C.pW)(T,t.r.CONTROL,t.r.CHECKBOX_INPUT);I.append(c,a),u.append(I)},y=function(){(0,v.fI)(f.Z.COMMENTS).forEach(_)},_=function(I){if(!T.value){L(I);return}let u=w.commentsCache.get(I);if(!u){const a=(0,v.Fi)(f.Z.RATING_WRAP,I);if(!a)return;const e=a.innerText.trim();if(e==="")return;u={rating:+e},w.commentsCache.set(I,u)}(0,l.JE)(u.rating,i)?R(I):L(I)},R=function(I){(0,F.Bt)(I);const u=I.parentElement;u&&[...u.children].every(c=>c.style.display==="none")&&R(u)},L=function(I){(0,F.kl)(I);const u=I.parentElement;u&&u.style.display==="none"&&L(u)};var F=n(5539),v=n(573),C=n(7877),f=n(1719),t=n(9175),s=n(4521),o=n(5213),l=n(3829),r=n(4921),E=n(6754);const{createGlobalFilter:S}=(0,s.z)(y),i=S("min-rating-filter",4),T=S("filter-enabled",!0),w={commentsCache:new WeakMap};await h();async function h(){const I=await(0,r.xk)(document,f.Z.COMMENTS_TREE);g(I,p)}async function p(){const I=await(0,r.xk)(document,f.Z.COMMENTS_HEADER);(0,o.b)(I,N),y()}b()}catch(S){b(S)}},1)},1719:(k,m,n)=>{n.d(m,{Z:()=>x});const x={COMMENTS_TREE:".tm-comments__tree",COMMENTS_HEADER:".tm-comments-wrapper__header",COMMENTS:".tm-comment-thread__comment:not(.process-passed)",RATING_WRAP:".tm-votes-lever__score-counter"}},9175:(k,m,n)=>{n.d(m,{r:()=>b});const b={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",marginLeft:"28px"},FILTERS_CONTAINER_WRAP:{background:"#fff",borderBottom:"1px solid rgba(146, 156, 165, .4)",position:"sticky",top:"56px",zIndex:10},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},NUMBER_INPUT:{...{INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px",fontSize:"15px"}}.INPUT,width:"35px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},$={};function P(k){var m=$[k];if(m!==void 0)return m.exports;var n=$[k]={exports:{}};return G[k](n,n.exports,P),n.exports}(()=>{var k=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",m=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",n=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",x=F=>{F&&F.d<1&&(F.d=1,F.forEach(v=>v.r--),F.forEach(v=>v.r--?v.r++:v()))},b=F=>F.map(v=>{if(v!==null&&typeof v=="object"){if(v[k])return v;if(v.then){var C=[];C.d=0,v.then(s=>{f[m]=s,x(C)},s=>{f[n]=s,x(C)});var f={};return f[k]=s=>s(C),f}}var t={};return t[k]=s=>{},t[m]=v,t});P.a=(F,v,C)=>{var f;C&&((f=[]).d=-1);var t=new Set,s=F.exports,o,l,r,E=new Promise((S,i)=>{r=i,l=S});E[m]=s,E[k]=S=>(f&&S(f),t.forEach(S),E.catch(i=>{})),F.exports=E,v(S=>{o=b(S);var i,T=()=>o.map(h=>{if(h[n])throw h[n];return h[m]}),w=new Promise(h=>{i=()=>h(T),i.r=0;var g=p=>p!==f&&!t.has(p)&&(t.add(p),p&&!p.d&&(i.r++,p.push(i)));o.map(p=>p[k](g))});return i.r?w:T()},S=>(S?r(E[n]=S):l(s),x(f))),f&&f.d<0&&(f.d=0)}})(),P.d=(k,m)=>{for(var n in m)P.o(m,n)&&!P.o(k,n)&&Object.defineProperty(k,n,{enumerable:!0,get:m[n]})},P.o=(k,m)=>Object.prototype.hasOwnProperty.call(k,m);var H=P(6213)})();})();
