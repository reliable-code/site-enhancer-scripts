// ==UserScript==
// @name         Habr comments filter
// @description  Hide comments by filter
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://habr.com/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.76963183
// @icon         https://www.google.com/s2/favicons?sz=64&domain=habr.com
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/habr.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var G={7273:(g,f,t)=>{t.d(f,{S:()=>b});var F=t(5558);function h(m={},E=null){return createElement("span",m,E)}function b(m={},E=null){return(0,F.n)("div",m,E)}},5467:(g,f,t)=>{t.d(f,{E2:()=>h});var F=t(7273);function h(E,d={},u=null){const p=(0,F.S)(d,u);return p.append(E),p}function b(E,d=null,u={},p={}){const r=createActionLink(E,d,p);return h(r,u)}function m(E,d=null,u=null,p={},r={},o={}){const n=createActionLinkWithIcon(E,u,d,r,o);return h(n,p)}},5558:(g,f,t)=>{t.d(f,{n:()=>h});var F=t(6754);function h(b,m,E=null){if(typeof m!="object"||m===null)throw new TypeError("styles should be an object");const d=document.createElement(b);return(0,F.ZM)(d,m),E&&(d.innerHTML=E),d}},740:(g,f,t)=>{t.d(f,{S:()=>d,o5:()=>m});var F=t(5558),h=t(4921);function b(r,o,n){const c=u(r,"text",o);return c.value=n,c}function m(r,o,n,c,y,a){const C=u(r,"number",o);return C.value=n,C.step=c,C.min=y,C.max=a,C}function E(r,o,n){const c=u(r,"date",o);return c.value=n,c}function d(r,o,n){const c=u(r,"checkbox",o);return c.checked=n,c}function u(r={},o=null,n=null){const c=(0,F.n)("input",r);return o&&(c.type=o),n&&(c.addEventListener("keyup",(0,h.sg)(n,200)),c.addEventListener("change",(0,h.sg)(n,100))),c}function p(r,o,n){const c=createElement("select",r);return o&&c.addEventListener("change",o),c.value=n,c}},573:(g,f,t)=>{t.d(f,{Fi:()=>h,fI:()=>b});function F(a,C=document){return!!C.querySelector(a)}function h(a,C=document,T=!1){const x=C.querySelector(a);return T&&!x&&console.log(`No element found for selector: ${a}`),x}function b(a,C=document,T=!1){const x=C.querySelectorAll(a);return T&&!x.length&&console.log(`No elements found for selector: ${a}`),x}function m(a,C=1){let T=a;for(let x=0;x<C;x++){if(!T.parentElement)return null;T=T.parentElement}return T}function E(a,C,T){return[...a.querySelectorAll(C)].find(x=>x.textContent.trim().includes(T))}function d(a,C,T=!1,x=!1,k=null){const D=h(C,a);return u(D,T,x,k)}function u(a,C=!1,T=!1,x=null){if(!a)return x===null?(console.log("No element found"),null):x;const k=a.innerText;return o(k,C,T)}function p(a,C,T=!1){const x=a[C];return u(x,T)}function r(a,C=!1,T=!1){const x=a.textContent;return o(x,C,T)}function o(a,C,T){C&&(a=removeNonNumber(a)),T&&(a=a.replace(",","."));const x=Number(a);return Number.isNaN(x)?(console.log(`Invalid number: ${a}`),0):x}function n(a){return[...a.childNodes].find(C=>C.nodeType===Node.TEXT_NODE)}function c(a){const C=T=>T.nodeType===Node.TEXT_NODE&&T.textContent.trim()!==""?[T]:[...T.childNodes].flatMap(C);return C(a)}function y(a){return normalizeSpacing(a.textContent)}},5539:(g,f,t)=>{t.d(f,{Bt:()=>h,kl:()=>u});function F(e,v){e.parentNode.insertBefore(v,e.nextSibling)}function h(e){e.style.display="none"}function b(e,v=1){const w=document.querySelector(e);w&&m(w,v)}function m(e,v=1){const w=getElementAncestor(e,v);w&&h(w)}function E(e){c(e),h(e)}function d(e){e.intersectionObserver||runOnceOnIntersection(e,()=>h(e))}function u(e){e.style.display=""}function p(e){const v=n(e);e.style.display=v}function r(e,v){v?h(e):u(e)}function o(e,v){v?d(e):(clearIntersectionObserver(e),u(e))}function n(e){return c(e),e.defaultDisplay}function c(e){if(e.defaultDisplay)return;const{display:v}=getComputedStyle(e);e.defaultDisplay=v}function y(){return{show:[],hide:[]}}function a(e,v,w){e?v.hide.push(w):v.show.push(w)}function C(e){e.show.forEach(u),e.hide.forEach(h)}function T(e,v,w=.3){v?k(e,w):x(e)}function x(e){e.style.opacity=""}function k(e,v=.3){e.style.opacity=v}function D(e){e.style.order=""}function B(e,v){e.style.order=v}function P(e,v){e.style.background=v}function V(e,v){const w=getFirstElement(v);w&&R(e,w)}function R(e,v){const w=createLink();w.href=e,v.parentNode.append(w),w.append(v)}function _(e,v){const w=getFirstElement(v);w&&S(e,w)}function S(e,v,w={}){const A=createLink(w);A.href=e,A.append(...v.childNodes),v.append(A)}function i(){const e=getURLQueryParam("scrollTo");if(!e)return;const v=document.getElementById(e);v?v.scrollIntoView():console.log(`Element with ID "${e}" was not found.`)}function l(e,v,w=null){const A=`${v}-click-passed`,M=w?N=>findElementByText(N,e,w):N=>getFirstElement(e,N);return function(N){if(N.hasAttribute(A))return!1;const O=M(N);return O&&O.click(),N.setAttribute(A,""),!0}}function s(e,v,w="text/plain"){const A=new Blob([e],{type:w}),M=URL.createObjectURL(A),N=document.createElement("a");N.href=M,N.download=v,document.body.appendChild(N),N.click(),document.body.removeChild(N),requestAnimationFrame(()=>URL.revokeObjectURL(M))}},6754:(g,f,t)=>{t.d(f,{ZM:()=>F});function F(E,d){Object.assign(E.style,d)}function h(E,d="custom-global-style"){let u=document.getElementById(d);u||(u=document.createElement("style"),u.id=d,u.type="text/css",document.head.appendChild(u)),u.textContent=E}function b(E){return Object.entries(E).map(([d,u])=>`${d.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${u};`).join(" ")}function m(E){return E?E.split(";").filter(d=>d.trim()!=="").reduce((d,u)=>{const[p,r]=u.split(":").map(n=>n.trim()),o=p.replace(/-([a-z])/g,(n,c)=>c.toUpperCase());return d[o]=r,d},{}):{}}},4921:(g,f,t)=>{t.d(f,{sg:()=>m,xk:()=>F});function F(r,o,n=null){const c=r.querySelector(o);return c?Promise.resolve(c):new Promise(y=>{const a=new MutationObserver(T);a.observe(r,{childList:!0,subtree:!0});let C;n&&(C=setTimeout(()=>{a.disconnect(),console.log(`No element found for selector: ${o}`),y(null)},n));function T(){const x=r.querySelector(o);x&&(C&&clearTimeout(C),a.disconnect(),y(x))}})}function h(r,o){return r.querySelector(o)?new Promise(c=>{const y=new MutationObserver(a);y.observe(r,{childList:!0,subtree:!0});function a(){r.querySelector(o)||(y.disconnect(),c())}}):Promise.resolve()}function b(r,o=400){return new Promise(n=>{let c;const y=new MutationObserver(()=>{clearTimeout(c),a()});function a(){c=setTimeout(()=>{y.disconnect(),n()},o)}a(),y.observe(r,{childList:!0,subtree:!0})})}function m(r,o=250){let n;return function(...c){const y=this;clearTimeout(n),n=setTimeout(()=>r.apply(y,c),o)}}async function E(r){document.visibilityState==="visible"?await r():document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&await r()},{once:!0})}function d(r,o){const n=new IntersectionObserver(c=>{c.forEach(y=>{y.isIntersecting&&(o(),u(r))})});r.intersectionObserver=n,n.observe(r)}function u(r){r.intersectionObserver&&(r.intersectionObserver.disconnect(),r.intersectionObserver=null)}function p(r){r&&(r.disconnect(),r=null)}},3829:(g,f,t)=>{t.d(f,{JE:()=>E});function F(o,n){return!h(o,n)}function h(o,n){if(!n||!n.value)return!0;const c=parseFilterQuery(n.value);return b(o,c)}function b(o,n){if(!n||!n.length)return!0;const c=(o||"").toLowerCase();return n.every(y=>m(c,y))}function m(o,n){return n.some(({term:c,isNegative:y})=>{const a=o.includes(c);return y?!a:a})}function E(o,n){return n.value!=null&&o<n.value}function d(o,n){return n.value!=null&&o>n.value}function u(o,n){return n.value==null?!1:o<parseDateFromISO(n.value)}function p(o,n){return n.value==null?!1:o>parseDateFromISO(n.value)}function r(o,n){return n.value&&o!==n.value}},4521:(g,f,t)=>{t.d(f,{z:()=>h});var F=t(3048);function h(b,m=null){return{createGlobalFilter(E,d=null,u=b){return F.V.create(E,d,u)},createSectionFilter(E,d=null,u=b){if(!m)throw new Error("sectionId must be provided to use createSectionFilter.");return F.V.createWithCompositeKey(m,E,d,u)}}}},5884:(g,f,t)=>{t.d(f,{Hw:()=>u,nW:()=>m});var F=t(5467),h=t(740);function b(p,r,o={},n={}){const c=createTextInput(n,r.updateValueFromEvent,r.value);return createControl(c,o,p)}function m(p,r,o,n,c,y={},a={}){const C=(0,h.o5)(a,r.updateValueFromEvent,r.value,o,n,c);return(0,F.E2)(C,y,p)}function E(p,r,o={},n={}){const c=createSelect(n,r.updateValueFromEvent,r.value);return createControl(c,o,p)}function d(p,r,o={},n={}){const c=createDateInput(n,r.updateValueFromEvent,r.value);return createControl(c,o,p)}function u(p,r,o={},n={}){const c=(0,h.S)(n,r.updateValueFromEvent,r.value);return(0,F.E2)(c,o,p)}},7877:(g,f,t)=>{t.d(f,{aW:()=>C,pW:()=>_});var F=t(5884);function h(i,l={},s={}){return createTextFilterControl("\u041F\u043E\u0438\u0441\u043A: ",i,l,s)}function b(i,l={},s={},e=.1,v=3){return createNumberFilterControl("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",i,e,v,5,l,s)}function m(i,l={},s={},e=.1,v=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",i,e,v,5,l,s)}function E(i,l={},s={}){return u("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",i,l,s)}function d(i,l={},s={}){return u("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",i,l,s)}function u(i,l,s={},e={}){return createNumberFilterControl(i,l,"1","1","999999",s,e)}function p(i,l={},s={}){return createDateFilterControl("\u041C\u0438\u043D. \u0434\u0430\u0442\u0430: ",i,l,s)}function r(i,l={},s={}){return o("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",i,l,s)}function o(i,l,s={},e={}){return createNumberFilterControl(i,l,"5","0","100",s,e)}function n(i,l={},s={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",i,"5","0","100",l,s)}function c(i,l,s={},e={},v="250"){return createNumberFilterControl(i,l,v,"0","1000000",s,e)}function y(i,l={},s={},e="25"){return c("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",i,l,s,e)}function a(i,l={},s={},e="25"){return c("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",i,l,s,e)}function C(i,l={},s={}){return T("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",i,l,s)}function T(i,l,s={},e={}){return(0,F.nW)(i,l,"1","0","99999",s,e)}function x(i,l={},s={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",i,"1","2","8",l,s)}function k(i,l={},s={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",i,1,1,10,l,s)}function D(i,l={},s={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",i,l,s)}function B(i,l={},s={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",i,l,s)}function P(i,l={},s={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",i,l,s)}function V(i,l={},s={}){return createCheckboxFilterControl("\u0411\u043E\u043D\u0443\u0441: ",i,l,s)}function R(i,l={},s={}){return createCheckboxFilterControl("\u0412 \u043D\u0430\u043B\u0438\u0447\u0438\u0438: ",i,l,s)}function _(i,l={},s={}){return(0,F.Hw)("\u0412\u043A\u043B: ",i,l,s)}function S(i,l,s={}){const e=[{value:-25,emoji:"\u{1F48E}",tooltip:"\u0421\u0443\u043F\u0435\u0440 \u0446\u0435\u043D\u0430 (-25%)"},{value:-15,emoji:"\u{1F525}",tooltip:"\u041E\u0442\u043B\u0438\u0447\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-15%)"},{value:-5,emoji:"\u{1F31F}",tooltip:"\u041A\u043B\u0430\u0441\u0441\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-5%)"},{value:5,emoji:"\u{1F44C}",tooltip:"\u0425\u043E\u0440\u043E\u0448\u0430\u044F \u0446\u0435\u043D\u0430 (+5%)"}],v={active:{background:"#e3f2fd",borderColor:"#2196f3",boxShadow:"0 0 0 1px #2196f3"},inactive:{background:"#fff",borderColor:"#ccc",boxShadow:"none"},hover:{background:"#f5f5f5"}},w=createDiv({display:"inline-flex",gap:"4px",marginLeft:"4px"}),A=[],M=()=>l?parseFloat(l.value)||0:i.value,N=()=>{const O=M();A.forEach(({button:U,value:j})=>{const W=j<=O?v.active:v.inactive;Object.assign(U.style,W)})};return e.forEach(({value:O,emoji:U,tooltip:j})=>{const I=createButton({padding:"2px 6px",fontSize:"16px",cursor:"pointer",border:"1px solid #ccc",borderRadius:"4px",background:"#fff",transition:"all 0.2s",...s},U);I.title=j,I.type="button",I.addEventListener("click",W=>{W.preventDefault(),i.updateValue(O),l&&(l.value=O),N()}),I.addEventListener("mouseenter",()=>{O<=M()||(I.style.background=v.hover.background)}),I.addEventListener("mouseleave",()=>{N()}),A.push({button:I,value:O}),w.appendChild(I)}),N(),l&&(l.addEventListener("input",N),l.addEventListener("change",N)),w}},5213:(g,f,t)=>{t.d(f,{b:()=>b});var F=t(573),h=t(7273);function b(m,E,d=!1,u="customFiltersContainer"){let p=(0,F.Fi)(`#${u}`,m);if(p)if(d)p.remove();else return;p=(0,h.S)(),p.id=u,E(p,m)}},8200:(g,f,t)=>{t.d(f,{s:()=>F});function F(h){const{target:b}=h,{type:m}=b;switch(m){case"text":return`"${b.value}"`;case"number":return b.value;case"select-one":return b.value;case"date":return`"${b.value}"`;case"checkbox":return b.checked;default:return console.log(`Unknown input type: ${m}`),null}}},157:(g,f,t)=>{t.d(f,{Fg:()=>F,vx:()=>b});const F=window.GM_setValue,h=window.GM.setValue,b=window.GM_getValue},1870:(g,f,t)=>{t.d(f,{j:()=>F});class F{constructor(b,m){this.value=b,this.onChange=m}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(g,f,t)=>{t.d(f,{V:()=>E});var F=t(1870),h=t(8200),b=t(3976),m=t(157);class E extends F.j{constructor(u,p=null,r=null){super((0,m.vx)(u,p),r),this.storageKey=u,this.defaultValue=p}static create(u,p=null,r=null){return new E(u,p,r)}static createWithCompositeKey(u,p,r=null,o=null){const n=`${u}-${p}`;return new E(n,r,o)}updateValueFromEvent=u=>{const p=(0,h.s)(u),r=(0,b.$)(p);this.updateValue(r)};updateValue(u,p=!0){this.value!==u&&((0,m.Fg)(this.storageKey,u),this.value=u,p&&this.onChangeIfDefined())}clearValue(u=!1){this.updateValue(null,u)}resetValue(u=!1){this.updateValue(this.defaultValue,u)}}},3976:(g,f,t)=>{t.d(f,{$:()=>F});function F(h){return h===""?null:JSON.parse(h)}},6213:(g,f,t)=>{t.a(g,async(F,h)=>{try{let k=function(S,i){let l=S.innerText;function s(){const e=S.innerText;e!==l&&(l=e,i()),requestAnimationFrame(s)}requestAnimationFrame(s)},B=function(S,i){(0,c.ZM)(S,u.r.FILTERS_CONTAINER),(0,c.ZM)(i,u.r.FILTERS_CONTAINER_WRAP);const l=(0,E.aW)(a,u.r.CONTROL,u.r.NUMBER_INPUT),s=(0,E.pW)(C,u.r.CONTROL,u.r.CHECKBOX_INPUT);S.append(l,s),i.append(S)},P=function(){(0,m.fI)(d.Z.COMMENTS).forEach(V)},V=function(S){if(!C.value){_(S);return}let i=T.commentsCache.get(S);if(!i){const s=(0,m.Fi)(d.Z.RATING_WRAP,S);if(!s)return;const e=s.innerText.trim();if(e==="")return;i={rating:+e},T.commentsCache.set(S,i)}(0,o.JE)(i.rating,a)?R(S):_(S)},R=function(S){(0,b.Bt)(S);const i=S.parentElement;i&&[...i.children].every(l=>l.style.display==="none")&&R(i)},_=function(S){(0,b.kl)(S);const i=S.parentElement;i&&i.style.display==="none"&&_(i)};var b=t(5539),m=t(573),E=t(7877),d=t(1719),u=t(9175),p=t(4521),r=t(5213),o=t(3829),n=t(4921),c=t(6754);const{createGlobalFilter:y}=(0,p.z)(P),a=y("min-rating-filter",4),C=y("filter-enabled",!0),T={commentsCache:new WeakMap};await x();async function x(){const S=await(0,n.xk)(document,d.Z.COMMENTS_TREE);k(S,D)}async function D(){const S=await(0,n.xk)(document,d.Z.COMMENTS_HEADER);(0,r.b)(S,B),P()}h()}catch(y){h(y)}},1)},1719:(g,f,t)=>{t.d(f,{Z:()=>F});const F={COMMENTS_TREE:".tm-comments__tree",COMMENTS_HEADER:".tm-comments-wrapper__header",COMMENTS:".tm-comment-thread__comment:not(.process-passed)",RATING_WRAP:".tm-votes-lever__score-counter"}},9175:(g,f,t)=>{t.d(f,{r:()=>h});const h={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",marginLeft:"28px"},FILTERS_CONTAINER_WRAP:{background:"#fff",borderBottom:"1px solid rgba(146, 156, 165, .4)",position:"sticky",top:"56px",zIndex:10},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},NUMBER_INPUT:{...{INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px",fontSize:"15px"}}.INPUT,width:"35px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},$={};function L(g){var f=$[g];if(f!==void 0)return f.exports;var t=$[g]={exports:{}};return G[g](t,t.exports,L),t.exports}(()=>{var g=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",f=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",t=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",F=b=>{b&&b.d<1&&(b.d=1,b.forEach(m=>m.r--),b.forEach(m=>m.r--?m.r++:m()))},h=b=>b.map(m=>{if(m!==null&&typeof m=="object"){if(m[g])return m;if(m.then){var E=[];E.d=0,m.then(p=>{d[f]=p,F(E)},p=>{d[t]=p,F(E)});var d={};return d[g]=p=>p(E),d}}var u={};return u[g]=p=>{},u[f]=m,u});L.a=(b,m,E)=>{var d;E&&((d=[]).d=-1);var u=new Set,p=b.exports,r,o,n,c=new Promise((y,a)=>{n=a,o=y});c[f]=p,c[g]=y=>(d&&y(d),u.forEach(y),c.catch(a=>{})),b.exports=c,m(y=>{r=h(y);var a,C=()=>r.map(x=>{if(x[t])throw x[t];return x[f]}),T=new Promise(x=>{a=()=>x(C),a.r=0;var k=D=>D!==d&&!u.has(D)&&(u.add(D),D&&!D.d&&(a.r++,D.push(a)));r.map(D=>D[g](k))});return a.r?T:C()},y=>(y?n(c[t]=y):o(p),F(d))),d&&d.d<0&&(d.d=0)}})(),L.d=(g,f)=>{for(var t in f)L.o(f,t)&&!L.o(g,t)&&Object.defineProperty(g,t,{enumerable:!0,get:f[t]})},L.o=(g,f)=>Object.prototype.hasOwnProperty.call(g,f);var H=L(6213)})();})();
