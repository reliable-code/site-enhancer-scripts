// ==UserScript==
// @name         Habr comments filter
// @description  Hide comments by filter
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://habr.com/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.77032393
// @icon         https://www.google.com/s2/favicons?sz=64&domain=habr.com
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/habr.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var G={7273:(g,f,t)=>{t.d(f,{S:()=>h});var y=t(5558);function E(m={},v=null){return createElement("span",m,v)}function h(m={},v=null){return(0,y.n)("div",m,v)}},5467:(g,f,t)=>{t.d(f,{E2:()=>E});var y=t(7273);function E(v,d={},u=null){const p=(0,y.S)(d,u);return p.append(v),p}function h(v,d=null,u={},p={}){const r=createActionLink(v,d,p);return E(r,u)}function m(v,d=null,u=null,p={},r={},o={}){const n=createActionLinkWithIcon(v,u,d,r,o);return E(n,p)}},5558:(g,f,t)=>{t.d(f,{n:()=>E});var y=t(6754);function E(h,m,v=null){if(typeof m!="object"||m===null)throw new TypeError("styles should be an object");const d=document.createElement(h);return(0,y.ZM)(d,m),v&&(d.innerHTML=v),d}},740:(g,f,t)=>{t.d(f,{S:()=>d,o5:()=>m});var y=t(5558),E=t(4921);function h(r,o,n){const c=u(r,"text",o);return c.value=n,c}function m(r,o,n,c,F,a){const C=u(r,"number",o);return C.value=n,C.step=c,C.min=F,C.max=a,C}function v(r,o,n){const c=u(r,"date",o);return c.value=n,c}function d(r,o,n){const c=u(r,"checkbox",o);return c.checked=n,c}function u(r={},o=null,n=null){const c=(0,y.n)("input",r);return o&&(c.type=o),n&&(c.addEventListener("keyup",(0,E.sg)(n,200)),c.addEventListener("change",(0,E.sg)(n,100))),c}function p(r,o,n){const c=createElement("select",r);return o&&c.addEventListener("change",o),c.value=n,c}},573:(g,f,t)=>{t.d(f,{Fi:()=>E,fI:()=>h});function y(a,C=document){return!!C.querySelector(a)}function E(a,C=document,T=!1){const x=C.querySelector(a);return T&&!x&&console.log(`No element found for selector: ${a}`),x}function h(a,C=document,T=!1){const x=C.querySelectorAll(a);return T&&!x.length&&console.log(`No elements found for selector: ${a}`),x}function m(a,C=1){let T=a;for(let x=0;x<C;x++){if(!T.parentElement)return null;T=T.parentElement}return T}function v(a,C,T){return[...a.querySelectorAll(C)].find(x=>x.textContent.trim().includes(T))}function d(a,C,T=!1,x=!1,O=null){const D=E(C,a);return u(D,T,x,O)}function u(a,C=!1,T=!1,x=null){if(!a)return x===null?(console.log("No element found"),null):x;const O=a.innerText;return o(O,C,T)}function p(a,C,T=!1){const x=a[C];return u(x,T)}function r(a,C=!1,T=!1){const x=a.textContent;return o(x,C,T)}function o(a,C,T){C&&(a=removeNonNumber(a)),T&&(a=a.replace(",","."));const x=Number(a);return Number.isNaN(x)?(console.log(`Invalid number: ${a}`),0):x}function n(a){return[...a.childNodes].find(C=>C.nodeType===Node.TEXT_NODE)}function c(a){const C=T=>T.nodeType===Node.TEXT_NODE&&T.textContent.trim()!==""?[T]:[...T.childNodes].flatMap(C);return C(a)}function F(a){return normalizeSpacing(a.textContent)}},5539:(g,f,t)=>{t.d(f,{Bt:()=>E,kl:()=>u});function y(e,b){e.parentNode.insertBefore(b,e.nextSibling)}function E(e){e.style.display="none"}function h(e,b=1){const w=document.querySelector(e);w&&m(w,b)}function m(e,b=1){const w=getElementAncestor(e,b);w&&E(w)}function v(e){c(e),E(e)}function d(e){e.intersectionObserver||runOnceOnIntersection(e,()=>E(e))}function u(e){e.style.display=""}function p(e){const b=n(e);e.style.display=b}function r(e,b){b?E(e):u(e)}function o(e,b){b?d(e):(clearIntersectionObserver(e),u(e))}function n(e){return c(e),e.dataset.defaultDisplay}function c(e){if(e.dataset.defaultDisplay)return;const{display:b}=getComputedStyle(e);e.dataset.defaultDisplay=b}function F(){return{show:[],hide:[]}}function a(e,b,w){e?b.hide.push(w):b.show.push(w)}function C(e){e.show.forEach(u),e.hide.forEach(E)}function T(e,b,w=.3){b?O(e,w):x(e)}function x(e){e.style.opacity=""}function O(e,b=.3){e.style.opacity=b}function D(e){e.style.order=""}function B(e,b){e.style.order=b}function P(e,b,w,A="inline-flex"){b.style.display=e?A:"none",w.style.display=e?"none":A}function U(e,b){e.style.background=b}function V(e,b){const w=getFirstElement(b);w&&_(e,w)}function _(e,b){const w=createLink();w.href=e,b.parentNode.append(w),w.append(b)}function S(e,b){const w=getFirstElement(b);w&&i(e,w)}function i(e,b,w={}){const A=createLink(w);A.href=e,A.append(...b.childNodes),b.append(A)}function l(){const e=getURLQueryParam("scrollTo");if(!e)return;const b=document.getElementById(e);b?b.scrollIntoView():console.log(`Element with ID "${e}" was not found.`)}function s(e,b,w=null){const A=`${b}-click-passed`,I=w?k=>findElementByText(k,e,w):k=>getFirstElement(e,k);return function(k){if(k.hasAttribute(A))return!1;const R=I(k);return R&&R.click(),k.setAttribute(A,""),!0}}function N(e,b,w="text/plain"){const A=new Blob([e],{type:w}),I=URL.createObjectURL(A),k=document.createElement("a");k.href=I,k.download=b,document.body.appendChild(k),k.click(),document.body.removeChild(k),requestAnimationFrame(()=>URL.revokeObjectURL(I))}},6754:(g,f,t)=>{t.d(f,{ZM:()=>y});function y(v,d){Object.assign(v.style,d)}function E(v,d="custom-global-style"){let u=document.getElementById(d);u||(u=document.createElement("style"),u.id=d,u.type="text/css",document.head.appendChild(u)),u.textContent=v}function h(v){return Object.entries(v).map(([d,u])=>`${d.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${u};`).join(" ")}function m(v){return v?v.split(";").filter(d=>d.trim()!=="").reduce((d,u)=>{const[p,r]=u.split(":").map(n=>n.trim()),o=p.replace(/-([a-z])/g,(n,c)=>c.toUpperCase());return d[o]=r,d},{}):{}}},4921:(g,f,t)=>{t.d(f,{sg:()=>m,xk:()=>y});function y(r,o,n=null){const c=r.querySelector(o);return c?Promise.resolve(c):new Promise(F=>{const a=new MutationObserver(T);a.observe(r,{childList:!0,subtree:!0});let C;n&&(C=setTimeout(()=>{a.disconnect(),console.log(`No element found for selector: ${o}`),F(null)},n));function T(){const x=r.querySelector(o);x&&(C&&clearTimeout(C),a.disconnect(),F(x))}})}function E(r,o){return r.querySelector(o)?new Promise(c=>{const F=new MutationObserver(a);F.observe(r,{childList:!0,subtree:!0});function a(){r.querySelector(o)||(F.disconnect(),c())}}):Promise.resolve()}function h(r,o=400){return new Promise(n=>{let c;const F=new MutationObserver(()=>{clearTimeout(c),a()});function a(){c=setTimeout(()=>{F.disconnect(),n()},o)}a(),F.observe(r,{childList:!0,subtree:!0})})}function m(r,o=250){let n;return function(...c){const F=this;clearTimeout(n),n=setTimeout(()=>r.apply(F,c),o)}}async function v(r){document.visibilityState==="visible"?await r():document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&await r()},{once:!0})}function d(r,o){const n=new IntersectionObserver(c=>{c.forEach(F=>{F.isIntersecting&&(o(),u(r))})});r.intersectionObserver=n,n.observe(r)}function u(r){r.intersectionObserver&&(r.intersectionObserver.disconnect(),r.intersectionObserver=null)}function p(r){r&&(r.disconnect(),r=null)}},3829:(g,f,t)=>{t.d(f,{JE:()=>v});function y(o,n){return!E(o,n)}function E(o,n){if(!n||!n.value)return!0;const c=parseFilterQuery(n.value);return h(o,c)}function h(o,n){if(!n||!n.length)return!0;const c=(o||"").toLowerCase();return n.every(F=>m(c,F))}function m(o,n){return n.some(({term:c,isNegative:F})=>{const a=o.includes(c);return F?!a:a})}function v(o,n){return n.value!=null&&o<n.value}function d(o,n){return n.value!=null&&o>n.value}function u(o,n){return n.value==null?!1:o<parseDateFromISO(n.value)}function p(o,n){return n.value==null?!1:o>parseDateFromISO(n.value)}function r(o,n){return n.value&&o!==n.value}},4521:(g,f,t)=>{t.d(f,{z:()=>E});var y=t(3048);function E(h,m=null){return{createGlobalFilter(v,d=null,u=h){return y.V.create(v,d,u)},createSectionFilter(v,d=null,u=h){if(!m)throw new Error("sectionId must be provided to use createSectionFilter.");return y.V.createWithCompositeKey(m,v,d,u)}}}},5884:(g,f,t)=>{t.d(f,{Hw:()=>u,nW:()=>m});var y=t(5467),E=t(740);function h(p,r,o={},n={}){const c=createTextInput(n,r.updateValueFromEvent,r.value);return createControl(c,o,p)}function m(p,r,o,n,c,F={},a={}){const C=(0,E.o5)(a,r.updateValueFromEvent,r.value,o,n,c);return(0,y.E2)(C,F,p)}function v(p,r,o={},n={}){const c=createSelect(n,r.updateValueFromEvent,r.value);return createControl(c,o,p)}function d(p,r,o={},n={}){const c=createDateInput(n,r.updateValueFromEvent,r.value);return createControl(c,o,p)}function u(p,r,o={},n={}){const c=(0,E.S)(n,r.updateValueFromEvent,r.value);return(0,y.E2)(c,o,p)}},7877:(g,f,t)=>{t.d(f,{aW:()=>C,pW:()=>_});var y=t(5884);function E(i,l={},s={}){return createTextFilterControl("\u041F\u043E\u0438\u0441\u043A: ",i,l,s)}function h(i,l={},s={},N=.1,e=3){return createNumberFilterControl("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",i,N,e,5,l,s)}function m(i,l={},s={},N=.1,e=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",i,N,e,5,l,s)}function v(i,l={},s={}){return u("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",i,l,s)}function d(i,l={},s={}){return u("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",i,l,s)}function u(i,l,s={},N={}){return createNumberFilterControl(i,l,"1","1","999999",s,N)}function p(i,l={},s={}){return createDateFilterControl("\u041C\u0438\u043D. \u0434\u0430\u0442\u0430: ",i,l,s)}function r(i,l={},s={}){return o("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",i,l,s)}function o(i,l,s={},N={}){return createNumberFilterControl(i,l,"5","0","100",s,N)}function n(i,l={},s={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",i,"5","0","100",l,s)}function c(i,l,s={},N={},e="250"){return createNumberFilterControl(i,l,e,"0","1000000",s,N)}function F(i,l={},s={},N="25"){return c("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",i,l,s,N)}function a(i,l={},s={},N="25"){return c("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",i,l,s,N)}function C(i,l={},s={}){return T("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",i,l,s)}function T(i,l,s={},N={}){return(0,y.nW)(i,l,"1","0","99999",s,N)}function x(i,l={},s={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",i,"1","2","8",l,s)}function O(i,l={},s={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",i,1,1,10,l,s)}function D(i,l={},s={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",i,l,s)}function B(i,l={},s={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",i,l,s)}function P(i,l={},s={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",i,l,s)}function U(i,l={},s={}){return createCheckboxFilterControl("\u0411\u043E\u043D\u0443\u0441: ",i,l,s)}function V(i,l={},s={}){return createCheckboxFilterControl("\u0412 \u043D\u0430\u043B\u0438\u0447\u0438\u0438: ",i,l,s)}function _(i,l={},s={}){return(0,y.Hw)("\u0412\u043A\u043B: ",i,l,s)}function S(i,l,s={}){const N=[{value:-25,emoji:"\u{1F48E}",tooltip:"\u0421\u0443\u043F\u0435\u0440 \u0446\u0435\u043D\u0430 (-25%)"},{value:-15,emoji:"\u{1F525}",tooltip:"\u041E\u0442\u043B\u0438\u0447\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-15%)"},{value:-5,emoji:"\u{1F31F}",tooltip:"\u041A\u043B\u0430\u0441\u0441\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-5%)"},{value:5,emoji:"\u{1F44C}",tooltip:"\u0425\u043E\u0440\u043E\u0448\u0430\u044F \u0446\u0435\u043D\u0430 (+5%)"}],e={active:{background:"#e3f2fd",borderColor:"#2196f3",boxShadow:"0 0 0 1px #2196f3"},inactive:{background:"#fff",borderColor:"#ccc",boxShadow:"none"},hover:{background:"#f5f5f5"}},b=createDiv({display:"inline-flex",gap:"4px",marginLeft:"4px"}),w=[],A=()=>l?parseFloat(l.value)||0:i.value,I=()=>{const k=A();w.forEach(({button:R,value:j})=>{const W=j<=k?e.active:e.inactive;Object.assign(R.style,W)})};return N.forEach(({value:k,emoji:R,tooltip:j})=>{const L=createButton({padding:"2px 6px",fontSize:"16px",cursor:"pointer",border:"1px solid #ccc",borderRadius:"4px",background:"#fff",transition:"all 0.2s",...s},R);L.title=j,L.type="button",L.addEventListener("click",W=>{W.preventDefault(),i.updateValue(k),l&&(l.value=k),I()}),L.addEventListener("mouseenter",()=>{k<=A()||(L.style.background=e.hover.background)}),L.addEventListener("mouseleave",()=>{I()}),w.push({button:L,value:k}),b.appendChild(L)}),I(),l&&(l.addEventListener("input",I),l.addEventListener("change",I)),b}},5213:(g,f,t)=>{t.d(f,{b:()=>h});var y=t(573),E=t(7273);function h(m,v,d=!1,u="customFiltersContainer"){let p=(0,y.Fi)(`#${u}`,m);if(p)if(d)p.remove();else return;p=(0,E.S)(),p.id=u,v(p,m)}},8200:(g,f,t)=>{t.d(f,{s:()=>y});function y(E){const{target:h}=E,{type:m}=h;switch(m){case"text":return`"${h.value}"`;case"number":return h.value;case"select-one":return h.value;case"date":return`"${h.value}"`;case"checkbox":return h.checked;default:return console.log(`Unknown input type: ${m}`),null}}},157:(g,f,t)=>{t.d(f,{Fg:()=>y,vx:()=>h});const y=window.GM_setValue,E=window.GM.setValue,h=window.GM_getValue},1870:(g,f,t)=>{t.d(f,{j:()=>y});class y{constructor(h,m){this.value=h,this.onChange=m}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(g,f,t)=>{t.d(f,{V:()=>v});var y=t(1870),E=t(8200),h=t(3976),m=t(157);class v extends y.j{constructor(u,p=null,r=null){super((0,m.vx)(u,p),r),this.storageKey=u,this.defaultValue=p}static create(u,p=null,r=null){return new v(u,p,r)}static createWithCompositeKey(u,p,r=null,o=null){const n=`${u}-${p}`;return new v(n,r,o)}updateValueFromEvent=u=>{const p=(0,E.s)(u),r=(0,h.$)(p);this.updateValue(r)};updateValue(u,p=!0){this.value!==u&&((0,m.Fg)(this.storageKey,u),this.value=u,p&&this.onChangeIfDefined())}clearValue(u=!1){this.updateValue(null,u)}resetValue(u=!1){this.updateValue(this.defaultValue,u)}}},3976:(g,f,t)=>{t.d(f,{$:()=>y});function y(E){return E===""?null:JSON.parse(E)}},6213:(g,f,t)=>{t.a(g,async(y,E)=>{try{let O=function(S,i){let l=S.innerText;function s(){const N=S.innerText;N!==l&&(l=N,i()),requestAnimationFrame(s)}requestAnimationFrame(s)},B=function(S,i){(0,c.ZM)(S,u.r.FILTERS_CONTAINER),(0,c.ZM)(i,u.r.FILTERS_CONTAINER_WRAP);const l=(0,v.aW)(a,u.r.CONTROL,u.r.NUMBER_INPUT),s=(0,v.pW)(C,u.r.CONTROL,u.r.CHECKBOX_INPUT);S.append(l,s),i.append(S)},P=function(){(0,m.fI)(d.Z.COMMENTS).forEach(U)},U=function(S){if(!C.value){_(S);return}let i=T.commentsCache.get(S);if(!i){const s=(0,m.Fi)(d.Z.RATING_WRAP,S);if(!s)return;const N=s.innerText.trim();if(N==="")return;i={rating:+N},T.commentsCache.set(S,i)}(0,o.JE)(i.rating,a)?V(S):_(S)},V=function(S){(0,h.Bt)(S);const i=S.parentElement;i&&[...i.children].every(l=>l.style.display==="none")&&V(i)},_=function(S){(0,h.kl)(S);const i=S.parentElement;i&&i.style.display==="none"&&_(i)};var h=t(5539),m=t(573),v=t(7877),d=t(1719),u=t(9175),p=t(4521),r=t(5213),o=t(3829),n=t(4921),c=t(6754);const{createGlobalFilter:F}=(0,p.z)(P),a=F("min-rating-filter",4),C=F("filter-enabled",!0),T={commentsCache:new WeakMap};await x();async function x(){const S=await(0,n.xk)(document,d.Z.COMMENTS_TREE);O(S,D)}async function D(){const S=await(0,n.xk)(document,d.Z.COMMENTS_HEADER);(0,r.b)(S,B),P()}E()}catch(F){E(F)}},1)},1719:(g,f,t)=>{t.d(f,{Z:()=>y});const y={COMMENTS_TREE:".tm-comments__tree",COMMENTS_HEADER:".tm-comments-wrapper__header",COMMENTS:".tm-comment-thread__comment:not(.process-passed)",RATING_WRAP:".tm-votes-lever__score-counter"}},9175:(g,f,t)=>{t.d(f,{r:()=>E});const E={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",marginLeft:"28px"},FILTERS_CONTAINER_WRAP:{background:"#fff",borderBottom:"1px solid rgba(146, 156, 165, .4)",position:"sticky",top:"56px",zIndex:10},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},NUMBER_INPUT:{...{INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px",fontSize:"15px"}}.INPUT,width:"35px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},$={};function M(g){var f=$[g];if(f!==void 0)return f.exports;var t=$[g]={exports:{}};return G[g](t,t.exports,M),t.exports}(()=>{var g=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",f=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",t=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",y=h=>{h&&h.d<1&&(h.d=1,h.forEach(m=>m.r--),h.forEach(m=>m.r--?m.r++:m()))},E=h=>h.map(m=>{if(m!==null&&typeof m=="object"){if(m[g])return m;if(m.then){var v=[];v.d=0,m.then(p=>{d[f]=p,y(v)},p=>{d[t]=p,y(v)});var d={};return d[g]=p=>p(v),d}}var u={};return u[g]=p=>{},u[f]=m,u});M.a=(h,m,v)=>{var d;v&&((d=[]).d=-1);var u=new Set,p=h.exports,r,o,n,c=new Promise((F,a)=>{n=a,o=F});c[f]=p,c[g]=F=>(d&&F(d),u.forEach(F),c.catch(a=>{})),h.exports=c,m(F=>{r=E(F);var a,C=()=>r.map(x=>{if(x[t])throw x[t];return x[f]}),T=new Promise(x=>{a=()=>x(C),a.r=0;var O=D=>D!==d&&!u.has(D)&&(u.add(D),D&&!D.d&&(a.r++,D.push(a)));r.map(D=>D[g](O))});return a.r?T:C()},F=>(F?n(c[t]=F):o(p),y(d))),d&&d.d<0&&(d.d=0)}})(),M.d=(g,f)=>{for(var t in f)M.o(f,t)&&!M.o(g,t)&&Object.defineProperty(g,t,{enumerable:!0,get:f[t]})},M.o=(g,f)=>Object.prototype.hasOwnProperty.call(g,f);var H=M(6213)})();})();
