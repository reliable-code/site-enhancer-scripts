// ==UserScript==
// @name         Perek product cards filter
// @description  Hide product cards by filter
// @grant        GM_addValueChangeListener
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://www.perekrestok.ru/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.75621077
// @icon         https://www.google.com/s2/favicons?sz=64&domain=perekrestok.ru
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/perek.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var X={5467:(S,s,t)=>{t.d(s,{E2:()=>h});var d=t(9928);function h(f,n={},e=null){const o=(0,d.Sw)(n,e);return o.append(f),o}function m(f,n=null,e={},o={}){const g=createActionLink(f,n,o);return h(g,e)}function l(f,n=null,e=null,o={},g={}){const E=createActionLinkWithIcon(f,e,n,g);return h(E,o)}},9928:(S,s,t)=>{t.d(s,{S:()=>f,Sw:()=>y,kU:()=>m,o5:()=>l});var d=t(4921),h=t(6754);function m(a,i,v){const p=n(a,"text",i);return p.value=v,p}function l(a,i,v,p,L,V){const R=n(a,"number",i);return R.value=v,R.step=p,R.min=L,R.max=V,R}function f(a,i,v){const p=n(a,"checkbox",i);return p.checked=v,p}function n(a={},i=null,v=null){const p=c("input",a);return i&&(p.type=i),v&&(p.addEventListener("keyup",(0,d.sg)(v,200)),p.addEventListener("change",(0,d.sg)(v,100))),p}function e(a={},i=null){return c("span",a,i)}function o(a={},i=null,v=null){const p=c("a",a,i);return v&&(p.href=v),p}function g(a,i=null,v={}){v.cursor||="pointer";const p=o(v,i);return a&&p.addEventListener("click",a),p}function E(a,i,v=null,p={},L={}){p.display||="inline-flex",p.alignItems||="center",p.gap||="0.25em";const V=g(a,v,p);return V.prepend(r(i,L)),V}function N(a={},i=null,v=null){const p=c("button",a,i);return v&&p.addEventListener("click",v),p}function y(a={},i=null){return c("div",a,i)}function x(a={}){return c("i",a)}function r(a,i={}){i.width||="1em",i.height||="1em",i.paddingBottom||="1px";const v=x(i);return v.setAttribute("data-lucide",a),v}function c(a,i,v=null){if(typeof i!="object"||i===null)throw new TypeError("styles should be an object");const p=document.createElement(a);return(0,h.ZM)(p,i),v&&(p.innerHTML=v),p}},573:(S,s,t)=>{t.d(s,{Fi:()=>m,YA:()=>e,fI:()=>l});var d=t(4214);function h(r,c=document){return!!c.querySelector(r)}function m(r,c=document,a=!1){const i=c.querySelector(r);return a&&!i&&console.log(`No element found for selector: ${r}`),i}function l(r,c=document,a=!1){const i=c.querySelectorAll(r);return a&&!i.length&&console.log(`No elements found for selector: ${r}`),i}function f(r,c,a){return[...r.querySelectorAll(c)].find(i=>i.textContent.trim().includes(a))}function n(r,c,a=!1,i=!1,v=null){const p=m(c,r);return e(p,a,i,v)}function e(r,c=!1,a=!1,i=null){if(!r)return i===null?(console.log("No element found"),null):i;const v=r.innerText;return E(v,c,a)}function o(r,c,a=!1){const i=r[c];return e(i,a)}function g(r,c=!1,a=!1){const i=r.textContent;return E(i,c,a)}function E(r,c,a){c&&(r=(0,d.zr)(r)),a&&(r=r.replace(",","."));const i=Number(r);return Number.isNaN(i)?(console.log(`Invalid number: ${r}`),0):i}function N(r){return[...r.childNodes].find(c=>c.nodeType===Node.TEXT_NODE)}function y(r){const c=a=>a.nodeType===Node.TEXT_NODE&&a.textContent.trim()!==""?[a]:[...a.childNodes].flatMap(c);return c(r)}function x(r){return normalizeSpacing(r.textContent)}},5539:(S,s,t)=>{t.d(s,{Bt:()=>h,UC:()=>e,kl:()=>f});function d(u,C){u.parentNode.insertBefore(C,u.nextSibling)}function h(u){u.style.display="none"}function m(u){E(u),h(u)}function l(u){u.intersectionObserver||runOnceOnIntersection(u,()=>h(u))}function f(u){u.style.display=""}function n(u){const C=g(u);u.style.display=C}function e(u,C){C?h(u):f(u)}function o(u,C){C?l(u):(clearIntersectionObserver(u),f(u))}function g(u){return E(u),u.defaultDisplay}function E(u){if(u.defaultDisplay)return;const{display:C}=getComputedStyle(u);u.defaultDisplay=C}function N(){return{show:[],hide:[]}}function y(u,C,k){u?C.hide.push(k):C.show.push(k)}function x(u){u.show.forEach(f),u.hide.forEach(h)}function r(u,C,k=.3){C?a(u,k):c(u)}function c(u){u.style.opacity=""}function a(u,C=.3){u.style.opacity=C}function i(u){u.style.order=""}function v(u,C){u.style.order=C}function p(u,C){u.style.background=C}function L(u,C){const k=getFirstElement(C);k&&V(u,k)}function V(u,C){const k=createLink();k.href=u,C.parentNode.append(k),k.append(C)}function R(u,C){const k=getFirstElement(C);k&&b(u,k)}function b(u,C){const k=createLink();k.href=u,k.append(...C.childNodes),C.append(k)}function w(){const u=getURLQueryParam("scrollTo");if(!u)return;const C=document.getElementById(u);C?C.scrollIntoView():console.log(`Element with ID "${u}" was not found.`)}function F(u,C,k="text/plain"){const O=new Blob([u],{type:k}),H=URL.createObjectURL(O),G=document.createElement("a");G.href=H,G.download=C,document.body.appendChild(G),G.click(),document.body.removeChild(G),requestAnimationFrame(()=>URL.revokeObjectURL(H))}},6754:(S,s,t)=>{t.d(s,{ZM:()=>d});function d(f,n){Object.assign(f.style,n)}function h(f,n="custom-global-style"){let e=document.getElementById(n);e||(e=document.createElement("style"),e.id=n,e.type="text/css",document.head.appendChild(e)),e.textContent=f}function m(f){return Object.entries(f).map(([n,e])=>`${n.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${e};`).join(" ")}function l(f){return f?f.split(";").filter(n=>n.trim()!=="").reduce((n,e)=>{const[o,g]=e.split(":").map(N=>N.trim()),E=o.replace(/-([a-z])/g,(N,y)=>y.toUpperCase());return n[E]=g,n},{}):{}}},4921:(S,s,t)=>{t.d(s,{XW:()=>m,sg:()=>l});function d(e,o,g=null){const E=e.querySelector(o);return E?Promise.resolve(E):new Promise(N=>{const y=new MutationObserver(r);y.observe(e,{childList:!0,subtree:!0});let x;g&&(x=setTimeout(()=>{y.disconnect(),console.log(`No element found for selector: ${o}`),N(null)},g));function r(){const c=e.querySelector(o);c&&(x&&clearTimeout(x),y.disconnect(),N(c))}})}function h(e,o){return e.querySelector(o)?new Promise(E=>{const N=new MutationObserver(y);N.observe(e,{childList:!0,subtree:!0});function y(){e.querySelector(o)||(N.disconnect(),E())}}):Promise.resolve()}function m(e,o=400){return new Promise(g=>{let E;const N=new MutationObserver(()=>{clearTimeout(E),y()});function y(){E=setTimeout(()=>{N.disconnect(),g()},o)}y(),N.observe(e,{childList:!0,subtree:!0})})}function l(e,o=250){let g;return(...E)=>{clearTimeout(g),g=setTimeout(()=>e(...E),o)}}function f(e,o){const g=new IntersectionObserver(E=>{E.forEach(N=>{N.isIntersecting&&(o(),n(e))})});e.intersectionObserver=g,g.observe(e)}function n(e){e.intersectionObserver&&(e.intersectionObserver.disconnect(),e.intersectionObserver=null)}},3829:(S,s,t)=>{t.d(s,{Ay:()=>h,JE:()=>l,iG:()=>f});var d=t(8355);function h(e,o){return!m(e,o)}function m(e,o){if(!o.value)return!0;const g=e.toLowerCase(),E=(0,d.R)(o),N=[],y=[];return E.forEach(x=>{if(x.startsWith("!")){const r=x.substring(1);r&&y.push(r)}else N.push(x)}),N.every(x=>g.includes(x))&&y.every(x=>!g.includes(x))}function l(e,o){return o.value!=null&&e<o.value}function f(e,o){return o.value!=null&&e>o.value}function n(e,o){return o.value&&e!==o.value}},4521:(S,s,t)=>{t.d(s,{z:()=>h});var d=t(3048);function h(m,l=null){return{createGlobalFilter(f,n=null,e=m){return d.V.create(f,n,e)},createSectionFilter(f,n=null,e=m){if(!l)throw new Error("sectionId must be provided to use createSectionFilter.");return d.V.createWithCompositeKey(l,f,n,e)}}}},5884:(S,s,t)=>{t.d(s,{Hw:()=>f,Nm:()=>m,nW:()=>l});var d=t(9928),h=t(5467);function m(n,e,o={},g={}){const E=(0,d.kU)(g,e.updateValueFromEvent,e.value);return(0,h.E2)(E,o,n)}function l(n,e,o,g,E,N={},y={}){const x=(0,d.o5)(y,e.updateValueFromEvent,e.value,o,g,E);return(0,h.E2)(x,N,n)}function f(n,e,o={},g={}){const E=(0,d.S)(g,e.updateValueFromEvent,e.value);return(0,h.E2)(E,o,n)}},7877:(S,s,t)=>{t.d(s,{E9:()=>h,EY:()=>v,H1:()=>x,HX:()=>m,pW:()=>R});var d=t(5884);function h(b,w={},F={}){return(0,d.Nm)("\u041F\u043E\u0438\u0441\u043A: ",b,w,F)}function m(b,w={},F={},u=.1,C=3){return(0,d.nW)("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",b,u,C,5,w,F)}function l(b,w={},F={},u=.1,C=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",b,u,C,5,w,F)}function f(b,w={},F={}){return e("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",b,w,F)}function n(b,w={},F={}){return e("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",b,w,F)}function e(b,w,F={},u={}){return createNumberFilterControl(b,w,"1","1","999999",F,u)}function o(b,w={},F={}){return g("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",b,w,F)}function g(b,w,F={},u={}){return createNumberFilterControl(b,w,"5","0","100",F,u)}function E(b,w={},F={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",b,"5","0","100",w,F)}function N(b,w,F={},u={},C="250"){return(0,d.nW)(b,w,C,"0","1000000",F,u)}function y(b,w={},F={},u="25"){return N("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",b,w,F,u)}function x(b,w={},F={},u="25"){return N("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",b,w,F,u)}function r(b,w={},F={}){return c("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",b,w,F)}function c(b,w,F={},u={}){return createNumberFilterControl(b,w,"1","0","99999",F,u)}function a(b,w={},F={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",b,"1","2","7",w,F)}function i(b,w={},F={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",b,1,1,10,w,F)}function v(b,w={},F={}){return(0,d.Hw)("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",b,w,F)}function p(b,w={},F={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",b,w,F)}function L(b,w={},F={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",b,w,F)}function V(b,w={},F={}){return createCheckboxFilterControl("\u0411\u0430\u043B\u043B\u044B: ",b,w,F)}function R(b,w={},F={}){return(0,d.Hw)("\u0412\u043A\u043B: ",b,w,F)}},8355:(S,s,t)=>{t.d(s,{R:()=>d});function d(m){return m.value.toLowerCase().split(",").map(l=>l.trim()).filter(l=>l!=="")}function h(m){return d(m).filter(l=>!l.startsWith("!"))}},5213:(S,s,t)=>{t.d(s,{b:()=>m});var d=t(9928),h=t(573);function m(l,f,n=!1,e="customFiltersContainer"){let o=(0,h.Fi)(`#${e}`,l);if(o)if(n)o.remove();else return;o=(0,d.Sw)(),o.id=e,f(o,l)}},4444:(S,s,t)=>{t.d(s,{s:()=>d});function d(h){let f=2166136261;for(let n=0;n<h.length;n+=1){const e=h.charCodeAt(n);f^=e,f=Math.imul(f,16777619)}return f>>>0}},5081:(S,s,t)=>{t.d(s,{B:()=>m});var d=t(4444);function h(l){return(0,d.s)(l).toString(16).padStart(8,"0")}function m(l,f="common"){return l?h(l):f}},8200:(S,s,t)=>{t.d(s,{s:()=>d});function d(h){const{target:m}=h,{type:l}=m;switch(l){case"text":return`"${m.value}"`;case"number":return m.value;case"checkbox":return m.checked;default:return console.log(`Unknown input type: ${l}`),null}}},157:(S,s,t)=>{t.d(s,{Fg:()=>d,vx:()=>m});const d=window.GM_setValue,h=window.GM.setValue,m=window.GM_getValue,l=window.GM_addValueChangeListener},1870:(S,s,t)=>{t.d(s,{j:()=>d});class d{constructor(m,l){this.value=m,this.onChange=l}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(S,s,t)=>{t.d(s,{V:()=>f});var d=t(1870),h=t(8200),m=t(3976),l=t(157);class f extends d.j{constructor(e,o=null,g=null){super((0,l.vx)(e,o),g),this.storageKey=e,this.defaultValue=o}static create(e,o=null,g=null){return new f(e,o,g)}static createWithCompositeKey(e,o,g=null,E=null){const N=`${e}-${o}`;return new f(N,g,E)}updateValueFromEvent=e=>{const o=(0,h.s)(e),g=(0,m.$)(o);this.updateValue(g)};updateValue(e,o=!0){this.value!==e&&((0,l.Fg)(this.storageKey,e),this.value=e,o&&this.onChangeIfDefined())}clearValue(e=!1){this.updateValue(null,e)}resetValue(e=!1){this.updateValue(this.defaultValue,e)}}},3976:(S,s,t)=>{t.d(s,{$:()=>d});function d(h){return h===""?null:JSON.parse(h)}},4214:(S,s,t)=>{t.d(s,{zr:()=>h});function d(n){return n.replace(/\D/g,"")}function h(n){return n.replace(/[^\d.,-]/g,"")}function m(n){return n.replace(/\s/g,"")}function l(n){return n.charAt(0).toUpperCase()+n.slice(1)}function f(n){return n.replace(/\s+/g," ").trim()}},5406:(S,s,t)=>{t.d(s,{Es:()=>x,Fc:()=>d});function d(r,c="common",a=!1){const{pathname:i}=window.location;return h(i,r,c,a)}function h(r,c,a,i=!1){const v=r.split("/");c=c<0?v.length+c:c;const p=v[c]||a;return i&&console.log(`Pathname element: ${p}`),p}function m(r,c="common",a=!1){const i=d(r,"",a);return l(i,c,a)}function l(r,c,a){if(!r)return c;const i=r.split("-").at(-1);return a&&console.log(`Pathname element ending: ${i}`),i}function f(r,c,a="common",i=!1){const v=h(r,c,"",i);return l(v,a,i)}function n(r){return new URLSearchParams(window.location.search).get(r)}function e(r){return r.split("?")[0]}function o(r){return window.location.pathname.includes(r)}function g(r){return r.some(c=>o(c))}function E(r){return window.location.pathname.split("/").some(a=>a===r)}function N(r){try{const c=new URL(window.location.href);Object.entries(r).forEach(([a,i])=>{c.searchParams.set(a,i)}),window.location.href=c.toString()}catch(c){console.error("Failed to redirect:",c)}}function y(r,c=[]){const a={pathname:window.location.pathname};c.forEach(p=>{a[p]=n(p)});function i(){const p={pathname:window.location.pathname};c.forEach(L=>{p[L]=n(L)}),Object.keys(a).some(L=>a[L]!==p[L])&&r()}let v=window.location.href;setInterval(()=>{window.location.href!==v&&(v=window.location.href,i())},200),window.addEventListener("popstate",i)}function x(r=[]){y(()=>window.location.reload(),r)}},4709:(S,s,t)=>{t.a(S,async(d,h)=>{try{let C=function(){const T=(0,n.Fi)(e.Z.TAG_FILTER)||(0,n.Fi)(e.Z.SORT_SELECT)?.parentNode?.parentNode;T&&((0,g.b)(T,k),O(),H())},k=function(T,I){(0,c.ZM)(T,N.r.FILTERS_CONTAINER);const A=(0,y.E9)(p,N.r.CONTROL,N.r.TEXT_INPUT),$=(0,y.HX)(L,N.r.CONTROL,N.r.NUMBER_INPUT),Z=(0,y.EY)(V,N.r.CONTROL,N.r.CHECKBOX_INPUT),j=(0,y.H1)(R,N.r.CONTROL,N.r.NUMBER_INPUT),B=(0,x.nW)("\u041C\u0438\u043D. \u0440\u0430\u0437\u043C\u0435\u0440: ",b,"2","1","10000",N.r.CONTROL,N.r.NUMBER_INPUT),P=(0,y.pW)(w,N.r.CONTROL,N.r.CHECKBOX_INPUT);T.append(A,$,Z,j,B,P),I.append(T)},O=function(){const T=(0,n.fI)(e.Z.RELATED_SLIDER);T.length&&T.forEach(I=>{I.parentNode.remove(),console.log("removed related slider")})},H=function(){(0,n.fI)(e.Z.PRODUCT).forEach(G)},G=function(T){if(!w.value){(0,E.kl)(T);return}const I=(0,n.Fi)(e.Z.PRODUCT_NAME,T),A=(0,n.Fi)(e.Z.PRODUCT_PRICE,T);if(!I||!A){(0,E.Bt)(T);return}const $=I.innerText,Z=(0,n.YA)(A,!0,!0),j=(0,r.Ay)($,p)||Q(T)||(0,r.iG)(Z,R)||Y(T);(0,E.UC)(T,j)},Q=function(T){const I=(0,n.Fi)(e.Z.PRODUCT_RATING,T);if(!I)return!V.value;const A=(0,n.YA)(I,!0,!0,0);return(0,r.JE)(A,L)},Y=function(T){const I=(0,n.Fi)(e.Z.PRODUCT_VOLUME,T);if(!I)return b.value;const A=(0,n.YA)(I,!0,!0,0);return(0,r.JE)(A,b)};var m=t(5406),l=t(5081),f=t(4521),n=t(573),e=t(5767),o=t(4921),g=t(5213),E=t(5539),N=t(3607),y=t(7877),x=t(5884),r=t(3829),c=t(6754);(0,m.Es)();const a=(0,l.B)((0,m.Fc)(-1)),{createGlobalFilter:i,createSectionFilter:v}=(0,f.z)(H,a),p=v("name-filter"),L=v("min-rating-filter",4.7),V=v("no-rating-filter",!0),R=v("max-price-filter"),b=v("min-volume-filter"),w=i("filter-enabled",!0),F=(0,n.Fi)(e.Z.CONTENT);F&&(await u(),new MutationObserver((0,o.sg)(u)).observe(F,{childList:!0}));async function u(){const T=(0,n.Fi)(e.Z.CATALOG_CONTENT);T&&(await(0,o.XW)(T),C(),new MutationObserver((0,o.sg)(C)).observe(T,{childList:!0,subtree:!0}))}h()}catch(a){h(a)}},1)},5767:(S,s,t)=>{t.d(s,{Z:()=>d});const d={CONTENT:".content",CATALOG_CONTENT:".catalog-content",TAG_FILTER:".tag__filter",SORT_SELECT:".page-header__select-sort",RELATED_SLIDER:".related-slider",PRODUCT:".product-card-wrapper",PRODUCT_NAME:".product-card__title",PRODUCT_PRICE:".price-new",PRODUCT_RATING:".rating-value",PRODUCT_VOLUME:".product-card__size"}},3607:(S,s,t)=>{t.d(s,{r:()=>h});const d={INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px 6px",fontSize:"15px"}},h={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",paddingTop:"8px",flexFlow:"wrap"},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},TEXT_INPUT:{...d.INPUT,width:"155px"},NUMBER_INPUT:{...d.INPUT,width:"75px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},z={};function U(S){var s=z[S];if(s!==void 0)return s.exports;var t=z[S]={exports:{}};return X[S](t,t.exports,U),t.exports}(()=>{var S=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",s=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",t=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",d=m=>{m&&m.d<1&&(m.d=1,m.forEach(l=>l.r--),m.forEach(l=>l.r--?l.r++:l()))},h=m=>m.map(l=>{if(l!==null&&typeof l=="object"){if(l[S])return l;if(l.then){var f=[];f.d=0,l.then(o=>{n[s]=o,d(f)},o=>{n[t]=o,d(f)});var n={};return n[S]=o=>o(f),n}}var e={};return e[S]=o=>{},e[s]=l,e});U.a=(m,l,f)=>{var n;f&&((n=[]).d=-1);var e=new Set,o=m.exports,g,E,N,y=new Promise((x,r)=>{N=r,E=x});y[s]=o,y[S]=x=>(n&&x(n),e.forEach(x),y.catch(r=>{})),m.exports=y,l(x=>{g=h(x);var r,c=()=>g.map(i=>{if(i[t])throw i[t];return i[s]}),a=new Promise(i=>{r=()=>i(c),r.r=0;var v=p=>p!==n&&!e.has(p)&&(e.add(p),p&&!p.d&&(r.r++,p.push(r)));g.map(p=>p[S](v))});return r.r?a:c()},x=>(x?N(y[t]=x):E(o),d(n))),n&&n.d<0&&(n.d=0)}})(),U.d=(S,s)=>{for(var t in s)U.o(s,t)&&!U.o(S,t)&&Object.defineProperty(S,t,{enumerable:!0,get:s[t]})},U.o=(S,s)=>Object.prototype.hasOwnProperty.call(S,s);var J=U(4709)})();})();
