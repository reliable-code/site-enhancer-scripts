// ==UserScript==
// @name         Perek product cards filter
// @description  Hide product cards by filter
// @grant        GM_addValueChangeListener
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://www.perekrestok.ru/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.75656429
// @icon         https://www.google.com/s2/favicons?sz=64&domain=perekrestok.ru
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/perek.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var Q={5467:(E,s,t)=>{t.d(s,{E2:()=>p});var d=t(9928);function p(h,n={},e=null){const u=(0,d.Sw)(n,e);return u.append(h),u}function m(h,n=null,e={},u={}){const g=createActionLink(h,n,u);return p(g,e)}function l(h,n=null,e=null,u={},g={}){const S=createActionLinkWithIcon(h,e,n,g);return p(S,u)}},9928:(E,s,t)=>{t.d(s,{S:()=>h,Sw:()=>y,kU:()=>m,o5:()=>l});var d=t(4921),p=t(6754);function m(o,r,a){const f=n(o,"text",r);return f.value=a,f}function l(o,r,a,f,I,V){const A=n(o,"number",r);return A.value=a,A.step=f,A.min=I,A.max=V,A}function h(o,r,a){const f=n(o,"checkbox",r);return f.checked=a,f}function n(o={},r=null,a=null){const f=i("input",o);return r&&(f.type=r),a&&(f.addEventListener("keyup",(0,d.sg)(a,200)),f.addEventListener("change",(0,d.sg)(a,100))),f}function e(o={},r=null){return i("span",o,r)}function u(o={},r=null,a=null){const f=i("a",o,r);return a&&(f.href=a),f}function g(o,r=null,a={}){a.cursor||="pointer";const f=u(a,r);return o&&f.addEventListener("click",o),f}function S(o,r,a=null,f={},I={}){f.display||="inline-flex",f.alignItems||="center",f.gap||="0.25em";const V=g(o,a,f);return V.prepend(v(r,I)),V}function b(o={},r=null,a=null){const f=i("button",o,r);return a&&f.addEventListener("click",a),f}function y(o={},r=null){return i("div",o,r)}function x(o={}){return i("i",o)}function v(o,r={}){r.width||="1em",r.height||="1em",r.paddingBottom||="1px";const a=x(r);return a.setAttribute("data-lucide",o),a}function i(o,r,a=null){if(typeof r!="object"||r===null)throw new TypeError("styles should be an object");const f=document.createElement(o);return(0,p.ZM)(f,r),a&&(f.innerHTML=a),f}},573:(E,s,t)=>{t.d(s,{Fi:()=>m,YA:()=>u,fI:()=>l});var d=t(4214);function p(i,o=document){return!!o.querySelector(i)}function m(i,o=document,r=!1){const a=o.querySelector(i);return r&&!a&&console.log(`No element found for selector: ${i}`),a}function l(i,o=document,r=!1){const a=o.querySelectorAll(i);return r&&!a.length&&console.log(`No elements found for selector: ${i}`),a}function h(i,o=1){let r=i;for(let a=0;a<o;a++){if(!r.parentElement)return null;r=r.parentElement}return r}function n(i,o,r){return[...i.querySelectorAll(o)].find(a=>a.textContent.trim().includes(r))}function e(i,o,r=!1,a=!1,f=null){const I=m(o,i);return u(I,r,a,f)}function u(i,o=!1,r=!1,a=null){if(!i)return a===null?(console.log("No element found"),null):a;const f=i.innerText;return b(f,o,r)}function g(i,o,r=!1){const a=i[o];return u(a,r)}function S(i,o=!1,r=!1){const a=i.textContent;return b(a,o,r)}function b(i,o,r){o&&(i=(0,d.zr)(i)),r&&(i=i.replace(",","."));const a=Number(i);return Number.isNaN(a)?(console.log(`Invalid number: ${i}`),0):a}function y(i){return[...i.childNodes].find(o=>o.nodeType===Node.TEXT_NODE)}function x(i){const o=r=>r.nodeType===Node.TEXT_NODE&&r.textContent.trim()!==""?[r]:[...r.childNodes].flatMap(o);return o(i)}function v(i){return normalizeSpacing(i.textContent)}},5539:(E,s,t)=>{t.d(s,{Bt:()=>p,UC:()=>g,kl:()=>e});function d(c,C){c.parentNode.insertBefore(C,c.nextSibling)}function p(c){c.style.display="none"}function m(c,C=1){const T=document.querySelector(c);T&&l(T,C)}function l(c,C=1){const T=getElementAncestor(c,C);T&&p(T)}function h(c){y(c),p(c)}function n(c){c.intersectionObserver||runOnceOnIntersection(c,()=>p(c))}function e(c){c.style.display=""}function u(c){const C=b(c);c.style.display=C}function g(c,C){C?p(c):e(c)}function S(c,C){C?n(c):(clearIntersectionObserver(c),e(c))}function b(c){return y(c),c.defaultDisplay}function y(c){if(c.defaultDisplay)return;const{display:C}=getComputedStyle(c);c.defaultDisplay=C}function x(){return{show:[],hide:[]}}function v(c,C,T){c?C.hide.push(T):C.show.push(T)}function i(c){c.show.forEach(e),c.hide.forEach(p)}function o(c,C,T=.3){C?a(c,T):r(c)}function r(c){c.style.opacity=""}function a(c,C=.3){c.style.opacity=C}function f(c){c.style.order=""}function I(c,C){c.style.order=C}function V(c,C){c.style.background=C}function A(c,C){const T=getFirstElement(C);T&&w(c,T)}function w(c,C){const T=createLink();T.href=c,C.parentNode.append(T),T.append(C)}function N(c,C){const T=getFirstElement(C);T&&F(c,T)}function F(c,C){const T=createLink();T.href=c,T.append(...C.childNodes),C.append(T)}function L(){const c=getURLQueryParam("scrollTo");if(!c)return;const C=document.getElementById(c);C?C.scrollIntoView():console.log(`Element with ID "${c}" was not found.`)}function U(c,C,T="text/plain"){const Z=new Blob([c],{type:T}),$=URL.createObjectURL(Z),O=document.createElement("a");O.href=$,O.download=C,document.body.appendChild(O),O.click(),document.body.removeChild(O),requestAnimationFrame(()=>URL.revokeObjectURL($))}},6754:(E,s,t)=>{t.d(s,{ZM:()=>d});function d(h,n){Object.assign(h.style,n)}function p(h,n="custom-global-style"){let e=document.getElementById(n);e||(e=document.createElement("style"),e.id=n,e.type="text/css",document.head.appendChild(e)),e.textContent=h}function m(h){return Object.entries(h).map(([n,e])=>`${n.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${e};`).join(" ")}function l(h){return h?h.split(";").filter(n=>n.trim()!=="").reduce((n,e)=>{const[u,g]=e.split(":").map(b=>b.trim()),S=u.replace(/-([a-z])/g,(b,y)=>y.toUpperCase());return n[S]=g,n},{}):{}}},4921:(E,s,t)=>{t.d(s,{XW:()=>m,sg:()=>l});function d(e,u,g=null){const S=e.querySelector(u);return S?Promise.resolve(S):new Promise(b=>{const y=new MutationObserver(v);y.observe(e,{childList:!0,subtree:!0});let x;g&&(x=setTimeout(()=>{y.disconnect(),console.log(`No element found for selector: ${u}`),b(null)},g));function v(){const i=e.querySelector(u);i&&(x&&clearTimeout(x),y.disconnect(),b(i))}})}function p(e,u){return e.querySelector(u)?new Promise(S=>{const b=new MutationObserver(y);b.observe(e,{childList:!0,subtree:!0});function y(){e.querySelector(u)||(b.disconnect(),S())}}):Promise.resolve()}function m(e,u=400){return new Promise(g=>{let S;const b=new MutationObserver(()=>{clearTimeout(S),y()});function y(){S=setTimeout(()=>{b.disconnect(),g()},u)}y(),b.observe(e,{childList:!0,subtree:!0})})}function l(e,u=250){let g;return(...S)=>{clearTimeout(g),g=setTimeout(()=>e(...S),u)}}function h(e,u){const g=new IntersectionObserver(S=>{S.forEach(b=>{b.isIntersecting&&(u(),n(e))})});e.intersectionObserver=g,g.observe(e)}function n(e){e.intersectionObserver&&(e.intersectionObserver.disconnect(),e.intersectionObserver=null)}},3829:(E,s,t)=>{t.d(s,{Ay:()=>p,JE:()=>l,iG:()=>h});var d=t(8355);function p(e,u){return!m(e,u)}function m(e,u){if(!u.value)return!0;const g=e.toLowerCase(),S=(0,d.R)(u),b=[],y=[];return S.forEach(x=>{if(x.startsWith("!")){const v=x.substring(1);v&&y.push(v)}else b.push(x)}),b.every(x=>g.includes(x))&&y.every(x=>!g.includes(x))}function l(e,u){return u.value!=null&&e<u.value}function h(e,u){return u.value!=null&&e>u.value}function n(e,u){return u.value&&e!==u.value}},4521:(E,s,t)=>{t.d(s,{z:()=>p});var d=t(3048);function p(m,l=null){return{createGlobalFilter(h,n=null,e=m){return d.V.create(h,n,e)},createSectionFilter(h,n=null,e=m){if(!l)throw new Error("sectionId must be provided to use createSectionFilter.");return d.V.createWithCompositeKey(l,h,n,e)}}}},5884:(E,s,t)=>{t.d(s,{Hw:()=>h,Nm:()=>m,nW:()=>l});var d=t(9928),p=t(5467);function m(n,e,u={},g={}){const S=(0,d.kU)(g,e.updateValueFromEvent,e.value);return(0,p.E2)(S,u,n)}function l(n,e,u,g,S,b={},y={}){const x=(0,d.o5)(y,e.updateValueFromEvent,e.value,u,g,S);return(0,p.E2)(x,b,n)}function h(n,e,u={},g={}){const S=(0,d.S)(g,e.updateValueFromEvent,e.value);return(0,p.E2)(S,u,n)}},7877:(E,s,t)=>{t.d(s,{E9:()=>p,EY:()=>a,H1:()=>x,HX:()=>m,pW:()=>A});var d=t(5884);function p(w,N={},F={}){return(0,d.Nm)("\u041F\u043E\u0438\u0441\u043A: ",w,N,F)}function m(w,N={},F={},L=.1,U=3){return(0,d.nW)("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",w,L,U,5,N,F)}function l(w,N={},F={},L=.1,U=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",w,L,U,5,N,F)}function h(w,N={},F={}){return e("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",w,N,F)}function n(w,N={},F={}){return e("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",w,N,F)}function e(w,N,F={},L={}){return createNumberFilterControl(w,N,"1","1","999999",F,L)}function u(w,N={},F={}){return g("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",w,N,F)}function g(w,N,F={},L={}){return createNumberFilterControl(w,N,"5","0","100",F,L)}function S(w,N={},F={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",w,"5","0","100",N,F)}function b(w,N,F={},L={},U="250"){return(0,d.nW)(w,N,U,"0","1000000",F,L)}function y(w,N={},F={},L="25"){return b("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",w,N,F,L)}function x(w,N={},F={},L="25"){return b("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",w,N,F,L)}function v(w,N={},F={}){return i("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",w,N,F)}function i(w,N,F={},L={}){return createNumberFilterControl(w,N,"1","0","99999",F,L)}function o(w,N={},F={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",w,"1","2","7",N,F)}function r(w,N={},F={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",w,1,1,10,N,F)}function a(w,N={},F={}){return(0,d.Hw)("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",w,N,F)}function f(w,N={},F={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",w,N,F)}function I(w,N={},F={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",w,N,F)}function V(w,N={},F={}){return createCheckboxFilterControl("\u0411\u0430\u043B\u043B\u044B: ",w,N,F)}function A(w,N={},F={}){return(0,d.Hw)("\u0412\u043A\u043B: ",w,N,F)}},8355:(E,s,t)=>{t.d(s,{R:()=>d});function d(m){return m.value.toLowerCase().split(",").map(l=>l.trim()).filter(l=>l!=="")}function p(m){return d(m).filter(l=>!l.startsWith("!"))}},5213:(E,s,t)=>{t.d(s,{b:()=>m});var d=t(9928),p=t(573);function m(l,h,n=!1,e="customFiltersContainer"){let u=(0,p.Fi)(`#${e}`,l);if(u)if(n)u.remove();else return;u=(0,d.Sw)(),u.id=e,h(u,l)}},4444:(E,s,t)=>{t.d(s,{s:()=>d});function d(p){let h=2166136261;for(let n=0;n<p.length;n+=1){const e=p.charCodeAt(n);h^=e,h=Math.imul(h,16777619)}return h>>>0}},5081:(E,s,t)=>{t.d(s,{B:()=>m});var d=t(4444);function p(l){return(0,d.s)(l).toString(16).padStart(8,"0")}function m(l,h="common"){return l?p(l):h}},8200:(E,s,t)=>{t.d(s,{s:()=>d});function d(p){const{target:m}=p,{type:l}=m;switch(l){case"text":return`"${m.value}"`;case"number":return m.value;case"checkbox":return m.checked;default:return console.log(`Unknown input type: ${l}`),null}}},157:(E,s,t)=>{t.d(s,{Fg:()=>d,vx:()=>m});const d=window.GM_setValue,p=window.GM.setValue,m=window.GM_getValue,l=window.GM_addValueChangeListener},1870:(E,s,t)=>{t.d(s,{j:()=>d});class d{constructor(m,l){this.value=m,this.onChange=l}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(E,s,t)=>{t.d(s,{V:()=>h});var d=t(1870),p=t(8200),m=t(3976),l=t(157);class h extends d.j{constructor(e,u=null,g=null){super((0,l.vx)(e,u),g),this.storageKey=e,this.defaultValue=u}static create(e,u=null,g=null){return new h(e,u,g)}static createWithCompositeKey(e,u,g=null,S=null){const b=`${e}-${u}`;return new h(b,g,S)}updateValueFromEvent=e=>{const u=(0,p.s)(e),g=(0,m.$)(u);this.updateValue(g)};updateValue(e,u=!0){this.value!==e&&((0,l.Fg)(this.storageKey,e),this.value=e,u&&this.onChangeIfDefined())}clearValue(e=!1){this.updateValue(null,e)}resetValue(e=!1){this.updateValue(this.defaultValue,e)}}},3976:(E,s,t)=>{t.d(s,{$:()=>d});function d(p){return p===""?null:JSON.parse(p)}},4214:(E,s,t)=>{t.d(s,{zr:()=>p});function d(n){return n.replace(/\D/g,"")}function p(n){return n.replace(/[^\d.,-]/g,"")}function m(n){return n.replace(/\s/g,"")}function l(n){return n.charAt(0).toUpperCase()+n.slice(1)}function h(n){return n.replace(/\s+/g," ").trim()}},5406:(E,s,t)=>{t.d(s,{Es:()=>x,Fc:()=>d});function d(v,i="common",o=!1){const{pathname:r}=window.location;return p(r,v,i,o)}function p(v,i,o,r=!1){const a=v.split("/");i=i<0?a.length+i:i;const f=a[i]||o;return r&&console.log(`Pathname element: ${f}`),f}function m(v,i="common",o=!1){const r=d(v,"",o);return l(r,i,o)}function l(v,i,o){if(!v)return i;const r=v.split("-").at(-1);return o&&console.log(`Pathname element ending: ${r}`),r}function h(v,i,o="common",r=!1){const a=p(v,i,"",r);return l(a,o,r)}function n(v){return new URLSearchParams(window.location.search).get(v)}function e(v){return v.split("?")[0]}function u(v){return window.location.pathname.includes(v)}function g(v){return v.some(i=>u(i))}function S(v){return window.location.pathname.split("/").some(o=>o===v)}function b(v){try{const i=new URL(window.location.href);Object.entries(v).forEach(([o,r])=>{i.searchParams.set(o,r)}),window.location.href=i.toString()}catch(i){console.error("Failed to redirect:",i)}}function y(v,i=[]){const o={pathname:window.location.pathname};i.forEach(f=>{o[f]=n(f)});function r(){const f={pathname:window.location.pathname};i.forEach(I=>{f[I]=n(I)}),Object.keys(o).some(I=>o[I]!==f[I])&&v()}let a=window.location.href;setInterval(()=>{window.location.href!==a&&(a=window.location.href,r())},200),window.addEventListener("popstate",r)}function x(v=[]){y(()=>window.location.reload(),v)}},4709:(E,s,t)=>{t.a(E,async(d,p)=>{try{let U=function(){const k=(0,n.Fi)(e.Z.TAG_FILTER)||(0,n.Fi)(e.Z.SORT_SELECT)?.parentNode?.parentNode;k&&((0,g.b)(k,c),C(),T())},c=function(k,R){(0,i.ZM)(k,b.r.FILTERS_CONTAINER);const G=(0,y.E9)(f,b.r.CONTROL,b.r.TEXT_INPUT),j=(0,y.HX)(I,b.r.CONTROL,b.r.NUMBER_INPUT),z=(0,y.EY)(V,b.r.CONTROL,b.r.CHECKBOX_INPUT),X=(0,y.H1)(A,b.r.CONTROL,b.r.NUMBER_INPUT),Y=(0,x.nW)("\u041C\u0438\u043D. \u0440\u0430\u0437\u043C\u0435\u0440: ",w,"2","1","10000",b.r.CONTROL,b.r.NUMBER_INPUT),P=(0,y.pW)(N,b.r.CONTROL,b.r.CHECKBOX_INPUT);k.append(G,j,z,X,Y,P),R.append(k)},C=function(){const k=(0,n.fI)(e.Z.RELATED_SLIDER);k.length&&k.forEach(R=>{R.parentNode.remove(),console.log("removed related slider")})},T=function(){(0,n.fI)(e.Z.PRODUCT).forEach(Z)},Z=function(k){if(!N.value){(0,S.kl)(k);return}const R=(0,n.Fi)(e.Z.PRODUCT_NAME,k),G=(0,n.Fi)(e.Z.PRODUCT_PRICE,k);if(!R||!G){(0,S.Bt)(k);return}const j=R.innerText,z=(0,n.YA)(G,!0,!0),X=(0,v.Ay)(j,f)||$(k)||(0,v.iG)(z,A)||O(k);(0,S.UC)(k,X)},$=function(k){const R=(0,n.Fi)(e.Z.PRODUCT_RATING,k);if(!R)return!V.value;const G=(0,n.YA)(R,!0,!0,0);return(0,v.JE)(G,I)},O=function(k){const R=(0,n.Fi)(e.Z.PRODUCT_VOLUME,k);if(!R)return w.value;const G=(0,n.YA)(R,!0,!0,0);return(0,v.JE)(G,w)};var m=t(5406),l=t(5081),h=t(4521),n=t(573),e=t(5767),u=t(4921),g=t(5213),S=t(5539),b=t(3607),y=t(7877),x=t(5884),v=t(3829),i=t(6754);(0,m.Es)();const o=(0,l.B)((0,m.Fc)(-1)),{createGlobalFilter:r,createSectionFilter:a}=(0,h.z)(T,o),f=a("name-filter"),I=a("min-rating-filter",4.7),V=a("no-rating-filter",!0),A=a("max-price-filter"),w=a("min-volume-filter"),N=r("filter-enabled",!0),F=(0,n.Fi)(e.Z.CONTENT);F&&(await L(),new MutationObserver((0,u.sg)(L)).observe(F,{childList:!0}));async function L(){const k=(0,n.Fi)(e.Z.CATALOG_CONTENT);k&&(await(0,u.XW)(k),U(),new MutationObserver((0,u.sg)(U)).observe(k,{childList:!0,subtree:!0}))}p()}catch(o){p(o)}},1)},5767:(E,s,t)=>{t.d(s,{Z:()=>d});const d={CONTENT:".content",CATALOG_CONTENT:".catalog-content",TAG_FILTER:".tag__filter",SORT_SELECT:".page-header__select-sort",RELATED_SLIDER:".related-slider",PRODUCT:".product-card-wrapper",PRODUCT_NAME:".product-card__title",PRODUCT_PRICE:".price-new",PRODUCT_RATING:".rating-value",PRODUCT_VOLUME:".product-card__size"}},3607:(E,s,t)=>{t.d(s,{r:()=>p});const d={INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px 6px",fontSize:"15px"}},p={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",paddingTop:"8px",flexFlow:"wrap"},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},TEXT_INPUT:{...d.INPUT,width:"155px"},NUMBER_INPUT:{...d.INPUT,width:"75px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},B={};function H(E){var s=B[E];if(s!==void 0)return s.exports;var t=B[E]={exports:{}};return Q[E](t,t.exports,H),t.exports}(()=>{var E=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",s=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",t=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",d=m=>{m&&m.d<1&&(m.d=1,m.forEach(l=>l.r--),m.forEach(l=>l.r--?l.r++:l()))},p=m=>m.map(l=>{if(l!==null&&typeof l=="object"){if(l[E])return l;if(l.then){var h=[];h.d=0,l.then(u=>{n[s]=u,d(h)},u=>{n[t]=u,d(h)});var n={};return n[E]=u=>u(h),n}}var e={};return e[E]=u=>{},e[s]=l,e});H.a=(m,l,h)=>{var n;h&&((n=[]).d=-1);var e=new Set,u=m.exports,g,S,b,y=new Promise((x,v)=>{b=v,S=x});y[s]=u,y[E]=x=>(n&&x(n),e.forEach(x),y.catch(v=>{})),m.exports=y,l(x=>{g=p(x);var v,i=()=>g.map(r=>{if(r[t])throw r[t];return r[s]}),o=new Promise(r=>{v=()=>r(i),v.r=0;var a=f=>f!==n&&!e.has(f)&&(e.add(f),f&&!f.d&&(v.r++,f.push(v)));g.map(f=>f[E](a))});return v.r?o:i()},x=>(x?b(y[t]=x):S(u),d(n))),n&&n.d<0&&(n.d=0)}})(),H.d=(E,s)=>{for(var t in s)H.o(s,t)&&!H.o(E,t)&&Object.defineProperty(E,t,{enumerable:!0,get:s[t]})},H.o=(E,s)=>Object.prototype.hasOwnProperty.call(E,s);var J=H(4709)})();})();
