// ==UserScript==
// @name         Vkusv product cards filter
// @description  Hide product cards by filter
// @grant        GM_addStyle
// @grant        GM_deleteValue
// @grant        GM_listValues
// @grant        GM_addValueChangeListener
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://vkusvill.ru/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.77032510
// @icon         https://www.google.com/s2/favicons?sz=64&domain=vkusvill.ru
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/vkusv.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var It={5406:(C,g,f)=>{f.d(g,{$F:()=>d,Fc:()=>T,z2:()=>j});function T(c,s="common",l=!1){const{pathname:p}=window.location;return k(p,c,s,l)}function k(c,s,l,p=!1){const E=c.split("/");s=s<0?E.length+s:s;const _=E[s]||l;return p&&console.log(`Pathname element: ${_}`),_}function S(c,s="common",l=!1){const p=T(c,"",l);return m(p,s,l)}function m(c,s,l){if(!c)return s;const p=c.split("-").at(-1);return l&&console.log(`Pathname element ending: ${p}`),p}function O(c,s,l="common",p=!1){const E=k(c,s,"",p);return m(E,l,p)}function d(c){return new URLSearchParams(window.location.search).get(c)}function A(c){return c.split("?")[0]}function b(c){return window.location.pathname.includes(c)}function I(c){return c.some(s=>b(s))}function j(...c){return window.location.pathname.split("/").some(l=>c.includes(l))}function H(c){try{const s=new URL(window.location.href);Object.entries(c).forEach(([l,p])=>{s.searchParams.set(l,p)}),window.location.href=s.toString()}catch(s){console.error("Failed to redirect:",s)}}function U(c,s=[]){const l=new AbortController;let p=!1;const E=N=>{const D=new URL(N),w={pathname:D.pathname};return s.forEach(J=>{w[J]=D.searchParams.get(J)}),w};let _=E(window.location.href);return window.navigation.addEventListener("navigatesuccess",async()=>{if(p)return;const N=E(window.navigation.currentEntry.url);if(Object.keys(_).some(w=>_[w]!==N[w])){_=N,p=!0;try{await c(N)}catch(w){console.error("URL observer error:",w)}finally{p=!1}}},{signal:l.signal}),()=>l.abort()}function L(c,s=[]){const l={pathname:window.location.pathname};s.forEach(D=>{l[D]=d(D)});let p=!1;async function E(){if(p)return;const D={pathname:window.location.pathname};if(s.forEach(w=>{D[w]=d(w)}),Object.keys(l).some(w=>l[w]!==D[w])){Object.assign(l,D),p=!0;try{await c()}catch(w){console.error("Error in URL observer callback:",w)}finally{p=!1}}}function _(){E().catch(D=>{console.error("Error in URL change handler:",D)})}let N=window.location.href;setInterval(()=>{window.location.href!==N&&(console.log("URL changed:",window.location.href),N=window.location.href,_())},200),window.addEventListener("popstate",_)}function R(c=[]){L(()=>window.location.reload(),c)}},7061:(C,g,f)=>{f.a(C,async(T,k)=>{try{var S=f(5406),m=f(6714),O=f(1970);(0,O.N)(),await d();async function d(){(0,S.z2)("cart","goods","offers","populyarnoe","search")&&await(0,m.P)()}k()}catch(d){k(d)}},1)},1970:(C,g,f)=>{f.d(g,{N:()=>T});function T(){window.GM_addStyle(`        
        .userscript-control {
            color: #707070 !important;

            &:hover {
                color: #1a1a1a !important;
            }
        }
        
        .custom-filters-button {
            padding: 10px 16px !important;
            color: #ffffff !important;
            background-color: #179C49 !important;
            border-radius: 12px !important;
            
            &:hover {
                background-color: #179948 !important;
            }
        }

        .ProductCard__content {
            .ProductCard__notice {
                order: 1 !important;
                display: flex !important;
                flex-grow: 1 !important;
                align-items: flex-end !important;
                margin: 0 0 6px !important;
            }
        
            .ProductCard__price {
                order: 2 !important;
                flex-grow: 1 !important;
                align-items: flex-end !important;
        
                &:has(+ .ProductCard__notice) {
                    flex-grow: 0 !important;
                }
        
                .Price {
                    &:not(.Price--label) {
                        padding: 3px 0 !important;
                    }
        
                    &._last {
                        line-height: 1.25em !important;
                        &::before { border: none !important; }
                    }
                }
            }
        
            .ProductCard__cartFooter {
                order: 3 !important;
            }

            .ProductCards__item.not-in-snapshot & {
                background-color: #e6fffa !important;
                border-radius: 0 0 12px 12px !important;
            }
        }

        .VV22_Modal_Forgot {
            & .modal-dialog {
                max-width: 1220px !important;
                max-height: 95vh !important;
                margin: 2.5vh auto !important;

                .modal-content {
                    max-height: 95vh !important;

                    .Modal__inner {
                        max-height: none !important;

                        .lk-modal-alert__title {
                            margin-bottom: 10px !important;
                            padding-right: 0 !important;
                        }

                        .ProductCards__item {
                            width: 25% !important;
                        }
                    }
                }
            }
        }
        
        .HProductCard__Avail {
            font-size: 13px !important;
        }
    `)}},6714:(C,g,f)=>{f.d(g,{P:()=>Ne});const T={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const k=["svg",T,[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}],["circle",{cx:"12",cy:"13",r:"3"}]]];class S{constructor(e,n){this.value=e,this.onChange=n}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}function m(t){const{target:e}=t,{type:n}=e;switch(n){case"text":return`"${e.value}"`;case"number":return e.value;case"select-one":return e.value;case"date":return`"${e.value}"`;case"checkbox":return e.checked;default:return console.log(`Unknown input type: ${n}`),null}}function O(t){return t===""?null:JSON.parse(t)}const d=window.GM_setValue,A=window.GM.setValue,b=window.GM_getValue;class I extends S{constructor(e,n=null,r=null){super(b(e,n),r),this.storageKey=e,this.defaultValue=n}static create(e,n=null,r=null){return new I(e,n,r)}static createWithCompositeKey(e,n,r=null,o=null){const i=`${e}-${n}`;return new I(i,r,o)}updateValueFromEvent=e=>{const n=m(e),r=O(n);this.updateValue(r)};updateValue(e,n=!0){this.value!==e&&(d(this.storageKey,e),this.value=e,n&&this.onChangeIfDefined())}clearValue(e=!1){this.updateValue(null,e)}resetValue(e=!1){this.updateValue(this.defaultValue,e)}}function j(t,e=null){return{createGlobalFilter(n,r=null,o=t){return I.create(n,r,o)},createSectionFilter(n,r=null,o=t){if(!e)throw new Error("sectionId must be provided to use createSectionFilter.");return I.createWithCompositeKey(e,n,r,o)}}}function H(t){let r=2166136261;for(let o=0;o<t.length;o+=1){const i=t.charCodeAt(o);r^=i,r=Math.imul(r,16777619)}return r>>>0}function U(t){return H(t).toString(16).padStart(8,"0")}function L(t,e="common"){return t?U(t):e}function R(t){return t.replace(/\D/g,"")}function c(t){return t.replace(/[^\d.,-]/g,"")}function s(t){return t.replace(/\s/g,"")}function l(t){return t.charAt(0).toUpperCase()+t.slice(1)}function p(t){return t.replace(/\s+/g," ").trim()}function E(t,e=document){return!!e.querySelector(t)}function _(t,e=document,n=!1){const r=e.querySelector(t);return n&&!r&&console.log(`No element found for selector: ${t}`),r}function N(t,e=document,n=!1){const r=e.querySelectorAll(t);return n&&!r.length&&console.log(`No elements found for selector: ${t}`),r}function D(t,e=1){let n=t;for(let r=0;r<e;r++){if(!n.parentElement)return null;n=n.parentElement}return n}function w(t,e,n){return[...t.querySelectorAll(e)].find(r=>r.textContent.trim().includes(n))}function J(t,e,n=!1,r=!1,o=null){const i=_(e,t);return Q(i,n,r,o)}function Q(t,e=!1,n=!1,r=null){if(!t)return r===null?(console.log("No element found"),null):r;const o=t.innerText;return lt(o,e,n)}function Ye(t,e,n=!1){const r=t[e];return Q(r,n)}function qe(t,e=!1,n=!1){const r=t.textContent;return lt(r,e,n)}function lt(t,e,n){e&&(t=c(t)),n&&(t=t.replace(",","."));const r=Number(t);return Number.isNaN(r)?(console.log(`Invalid number: ${t}`),0):r}function Ze(t){return[...t.childNodes].find(e=>e.nodeType===Node.TEXT_NODE)}function Je(t){const e=n=>n.nodeType===Node.TEXT_NODE&&n.textContent.trim()!==""?[n]:[...n.childNodes].flatMap(e);return e(t)}function tn(t){return normalizeSpacing(t.textContent)}const z={INPUT:{border:"1px solid #d0d0d0",borderRadius:"12px",padding:"10px 16px",fontSize:"16px"},CONTROL:{display:"flex",gap:"8px",alignItems:"center",fontSize:"16px",fontWeight:"400"}},F={FILTERS_CONTAINER:{display:"flex",flexWrap:"wrap",width:"100%",gap:"12px 18px"},CONTROL:z.CONTROL,FILTERS_INFO:{...z.CONTROL,width:"100%",justifyContent:"flex-end",marginRight:"6px",fontSize:"14px",color:"#9ca3af"},TEXT_INPUT_CONTROL:{...z.CONTROL,flexGrow:1,minWidth:"180px"},TEXT_INPUT:{...z.INPUT,flexGrow:1},NUMBER_INPUT:{...z.INPUT,width:"90px"},CHECKBOX_INPUT:{width:"21px",height:"21px",cursor:"pointer",accentColor:"#179C49"}},tt={DISLIKE_CONTROL:{marginLeft:"auto",gap:"3px"},DISLIKE_BUTTON_ICON_SM:{height:"0.9em",marginBottom:"1px",marginRight:"2px"},DISLIKE_BUTTON_ICON_MD:{marginBottom:"4px"},REMOVE_DISLIKE_BUTTON_ICON_SM:{height:"0.9em",marginBottom:"1px"},REMOVE_DISLIKE_BUTTON_ICON_MD:{marginBottom:"5px"}},M={PRODUCT_CARD:".ProductCards__item",PRODUCT_CARD_DATA:".ProductCard",PRODUCT_NAME:".ProductCard__link",PRODUCT_RATING_WRAP:".ProductCard__ratingText",PRODUCT_PRICE_CONTAINER:".ProductCard__price",PRODUCT_PRICE_WRAP:".js-datalayer-catalog-list-price",SHOW_MORE_BUTTON:".js-prods-modal-load-more"};function Rt(t,e,n=null){const r=t.querySelector(e);return r?Promise.resolve(r):new Promise(o=>{const i=new MutationObserver(h);i.observe(t,{childList:!0,subtree:!0});let a;n&&(a=setTimeout(()=>{i.disconnect(),console.log(`No element found for selector: ${e}`),o(null)},n));function h(){const v=t.querySelector(e);v&&(a&&clearTimeout(a),i.disconnect(),o(v))}})}function en(t,e){return t.querySelector(e)?new Promise(r=>{const o=new MutationObserver(i);o.observe(t,{childList:!0,subtree:!0});function i(){t.querySelector(e)||(o.disconnect(),r())}}):Promise.resolve()}function nn(t,e=400){return new Promise(n=>{let r;const o=new MutationObserver(()=>{clearTimeout(r),i()});function i(){r=setTimeout(()=>{o.disconnect(),n()},e)}i(),o.observe(t,{childList:!0,subtree:!0})})}function dt(t,e=250){let n;return function(...r){const o=this;clearTimeout(n),n=setTimeout(()=>t.apply(o,r),e)}}async function rn(t){document.visibilityState==="visible"?await t():document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&await t()},{once:!0})}function on(t,e){const n=new IntersectionObserver(r=>{r.forEach(o=>{o.isIntersecting&&(e(),Nt(t))})});t.intersectionObserver=n,n.observe(t)}function Nt(t){t.intersectionObserver&&(t.intersectionObserver.disconnect(),t.intersectionObserver=null)}function ft(t){t&&(t.disconnect(),t=null)}class et{constructor(e=Date.now(),n=null,r=null,o={}){this.lastCheckDate=e,this.lowestPrice=n,this.highestPrice=r,this.priceHistory=o}get lowestPriceValue(){return this.lowestPrice?this.lowestPrice.value:0}get highestPriceValue(){return this.highestPrice?this.highestPrice.value:0}updateLastCheckDate=()=>{this.lastCheckDate=Date.now()};static fromObject(e){const{lastCheckDate:n,lowestPrice:r,highestPrice:o,priceHistory:i}=e;return new et(n,r,o,i)}}class Y extends et{constructor(e=Date.now(),n=null,r=null,o={},i=null){super(e,n,r,o),this.rating=i}static fromObject(e){const{lastCheckDate:n,lowestPrice:r,highestPrice:o,priceHistory:i,rating:a}=e;return new Y(n,r,o,i,a)}}const pt=window.GM_listValues;function un(t,e,n=!1){getStorageValue("dbVersion")!==e&&(t(),!n&&setStorageValue("dbVersion",e))}function an(t,e=!0){const n=pt();mt(n,t,e)}function kt(t,e,n=!0){const o=pt().filter(t);mt(o,e,n)}function mt(t,e,n){let r=0;t.forEach(o=>{const i=getStorageValue(o);n&&console.log(o,i),e(o,i),r+=1}),n&&console.log(`Total entries processed: ${r}`)}function cn(t,e=!1){kt(t,r=>{e||window.GM_deleteValue(r)})}const q={LAST_RATE_UPDATE:"last-rate-update",REVIEWS_LAST_PRODUCT_ARTICLE:"reviews-last-product-article"};function At(t,e,n=!1){const r=ht(t),o=b(r),i=Ut(o);n&&i.rating===1||(i.rating=e,i.updateLastCheckDate(),d(r,i),d(q.LAST_RATE_UPDATE,Date.now()))}function ht(t){return`product-${t}`}function Ut(t){return t?Y.fromObject(t):new Y}function Bt(t){const e=ht(t);return b(e)}function gt(t){return Bt(t)?.rating??null}function sn(t){return setStorageValue(q.REVIEWS_LAST_PRODUCT_ARTICLE,t)}function ln(){return getStorageValue(q.REVIEWS_LAST_PRODUCT_ARTICLE)}function dn(){const t=o=>o.startsWith("product-"),e=[],n=(o,i)=>{new Date(i.lastCheckDate)<getDateMonthsAgo(9)&&e.push(i.lastCheckDate)};processEntriesByKeyFilter(t,n,!1),[...e].sort((o,i)=>new Date(o)-new Date(i)).forEach(o=>{console.log(new Date(o).toLocaleDateString())})}function nt(t,e){Object.assign(t.style,e)}function fn(t,e="custom-global-style"){let n=document.getElementById(e);n||(n=document.createElement("style"),n.id=e,n.type="text/css",document.head.appendChild(n)),n.textContent=t}function pn(t){return Object.entries(t).map(([e,n])=>`${e.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${n};`).join(" ")}function mn(t){return t?t.split(";").filter(e=>e.trim()!=="").reduce((e,n)=>{const[r,o]=n.split(":").map(a=>a.trim()),i=r.replace(/-([a-z])/g,(a,h)=>h.toUpperCase());return e[i]=o,e},{}):{}}function rt(t,e,n=null){if(typeof e!="object"||e===null)throw new TypeError("styles should be an object");const r=document.createElement(t);return nt(r,e),n&&(r.innerHTML=n),r}function hn(t={},e=null){return createElement("span",t,e)}function ot(t={},e=null){return rt("div",t,e)}function Mt(t,e,n=!1,r="customFiltersContainer"){let o=_(`#${r}`,t);if(o)if(n)o.remove();else return;o=ot(),o.id=r,e(o,t)}function K(t,e={},n=null){const r=ot(e,n);return r.append(t),r}function gn(t,e=null,n={},r={}){const o=createActionLink(t,e,r);return K(o,n)}function Cn(t,e=null,n=null,r={},o={},i={}){const a=createActionLinkWithIcon(t,n,e,o,i);return K(a,r)}function Vt(t,e,n){const r=Z(t,"text",e);return r.value=n,r}function Wt(t,e,n,r,o,i){const a=Z(t,"number",e);return a.value=n,a.step=r,a.min=o,a.max=i,a}function En(t,e,n){const r=Z(t,"date",e);return r.value=n,r}function jt(t,e,n){const r=Z(t,"checkbox",e);return r.checked=n,r}function Z(t={},e=null,n=null){const r=rt("input",t);return e&&(r.type=e),n&&(r.addEventListener("keyup",dt(n,200)),r.addEventListener("change",dt(n,100))),r}function _n(t,e,n){const r=createElement("select",t);return e&&r.addEventListener("change",e),r.value=n,r}function Kt(t,e,n={},r={}){const o=Vt(r,e.updateValueFromEvent,e.value);return K(o,n,t)}function Ct(t,e,n,r,o,i={},a={}){const h=Wt(a,e.updateValueFromEvent,e.value,n,r,o);return K(h,i,t)}function vn(t,e,n={},r={}){const o=createSelect(r,e.updateValueFromEvent,e.value);return createControl(o,n,t)}function bn(t,e,n={},r={}){const o=createDateInput(r,e.updateValueFromEvent,e.value);return createControl(o,n,t)}function Et(t,e,n={},r={}){const o=jt(r,e.updateValueFromEvent,e.value);return K(o,n,t)}function $t(t,e={},n={}){return Kt("\u041F\u043E\u0438\u0441\u043A: ",t,e,n)}function Gt(t,e={},n={},r=.1,o=3){return Ct("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",t,r,o,5,e,n)}function wn(t,e={},n={},r=.1,o=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",t,r,o,5,e,n)}function Sn(t,e={},n={}){return _t("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",t,e,n)}function yn(t,e={},n={}){return _t("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",t,e,n)}function _t(t,e,n={},r={}){return createNumberFilterControl(t,e,"1","1","999999",n,r)}function Tn(t,e={},n={}){return createDateFilterControl("\u041C\u0438\u043D. \u0434\u0430\u0442\u0430: ",t,e,n)}function Ln(t,e={},n={}){return Ht("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",t,e,n)}function Ht(t,e,n={},r={}){return createNumberFilterControl(t,e,"5","0","100",n,r)}function Dn(t,e={},n={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",t,"5","0","100",e,n)}function vt(t,e,n={},r={},o="250"){return Ct(t,e,o,"0","1000000",n,r)}function Fn(t,e={},n={},r="25"){return vt("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",t,e,n,r)}function zt(t,e={},n={},r="25"){return vt("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",t,e,n,r)}function On(t,e={},n={}){return Xt("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",t,e,n)}function Xt(t,e,n={},r={}){return createNumberFilterControl(t,e,"1","0","99999",n,r)}function Pn(t,e={},n={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",t,"1","2","8",e,n)}function xn(t,e={},n={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",t,1,1,10,e,n)}function In(t,e={},n={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",t,e,n)}function Rn(t,e={},n={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",t,e,n)}function Nn(t,e={},n={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",t,e,n)}function kn(t,e={},n={}){return createCheckboxFilterControl("\u0411\u043E\u043D\u0443\u0441: ",t,e,n)}function An(t,e={},n={}){return createCheckboxFilterControl("\u0412 \u043D\u0430\u043B\u0438\u0447\u0438\u0438: ",t,e,n)}function Qt(t,e={},n={}){return Et("\u0412\u043A\u043B: ",t,e,n)}function Un(t,e,n={}){const r=[{value:-25,emoji:"\u{1F48E}",tooltip:"\u0421\u0443\u043F\u0435\u0440 \u0446\u0435\u043D\u0430 (-25%)"},{value:-15,emoji:"\u{1F525}",tooltip:"\u041E\u0442\u043B\u0438\u0447\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-15%)"},{value:-5,emoji:"\u{1F31F}",tooltip:"\u041A\u043B\u0430\u0441\u0441\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-5%)"},{value:5,emoji:"\u{1F44C}",tooltip:"\u0425\u043E\u0440\u043E\u0448\u0430\u044F \u0446\u0435\u043D\u0430 (+5%)"}],o={active:{background:"#e3f2fd",borderColor:"#2196f3",boxShadow:"0 0 0 1px #2196f3"},inactive:{background:"#fff",borderColor:"#ccc",boxShadow:"none"},hover:{background:"#f5f5f5"}},i=createDiv({display:"inline-flex",gap:"4px",marginLeft:"4px"}),a=[],h=()=>e?parseFloat(e.value)||0:t.value,v=()=>{const y=h();a.forEach(({button:P,value:W})=>{const G=W<=y?o.active:o.inactive;Object.assign(P.style,G)})};return r.forEach(({value:y,emoji:P,tooltip:W})=>{const x=createButton({padding:"2px 6px",fontSize:"16px",cursor:"pointer",border:"1px solid #ccc",borderRadius:"4px",background:"#fff",transition:"all 0.2s",...n},P);x.title=W,x.type="button",x.addEventListener("click",G=>{G.preventDefault(),t.updateValue(y),e&&(e.value=y),v()}),x.addEventListener("mouseenter",()=>{y<=h()||(x.style.background=o.hover.background)}),x.addEventListener("mouseleave",()=>{v()}),a.push({button:x,value:y}),i.appendChild(x)}),v(),e&&(e.addEventListener("input",v),e.addEventListener("change",v)),i}var V=f(5406);const bt={selectors:{productList:".ProductCards > .js-datalayer-catalog-list",productListContainer:".Catalog__col",productListHeader:".FilterPanelInner"},getSectionName:()=>(0,V.Fc)(-2)},Yt=[{id:"cart",matches:()=>(0,V.z2)("cart"),params:{selectors:{productList:"#js-modal-cart-prods-scroll > .js-datalayer-catalog-list",productListContainer:".Modal__inner",productListHeader:".lk-modal-alert__title"},filtersContainerStyles:{marginTop:"20px"},unwantedSelectors:[".js-delivery__form--vv-recoms-slider",".Delivery__Order__OrderBody-Block:has(.VV23_OrderPagePackages)",".VV24_RepeatLastOrder"],isSnapshotFeatureEnabled:!0,getSectionName:()=>(0,V.Fc)(-2)}},{id:"catalog",matches:()=>(0,V.z2)("goods","populyarnoe"),params:{...bt,filtersContainerStyles:{marginTop:"12px"}}},{id:"offers",matches:()=>(0,V.z2)("offers"),params:{...bt,filtersContainerStyles:{margin:"22px 0 6px"}}},{id:"search",matches:()=>(0,V.z2)("search"),params:{selectors:{productList:".ProductCards > .js-datalayer-catalog-list",productListContainer:"#search-result-general-container",productListHeader:'[class*="_SearchPageHeader__Menu"]'},filtersContainerStyles:{marginTop:"12px"},getSectionName:()=>(0,V.$F)("q")}}];function qt(){const t=Yt.find(e=>e.matches());if(!t)throw new Error(`Unknown context for URL: ${window.location.pathname}`);return t.params}function Bn(t,e){t.parentNode.insertBefore(e,t.nextSibling)}function X(t){t.style.display="none"}function Mn(t,e=1){const n=document.querySelector(t);n&&Zt(n,e)}function Zt(t,e=1){const n=getElementAncestor(t,e);n&&X(n)}function Vn(t){wt(t),X(t)}function Jt(t){t.intersectionObserver||runOnceOnIntersection(t,()=>X(t))}function it(t){t.style.display=""}function Wn(t){const e=te(t);t.style.display=e}function jn(t,e){e?X(t):it(t)}function Kn(t,e){e?Jt(t):(clearIntersectionObserver(t),it(t))}function te(t){return wt(t),t.dataset.defaultDisplay}function wt(t){if(t.dataset.defaultDisplay)return;const{display:e}=getComputedStyle(t);t.dataset.defaultDisplay=e}function ee(){return{show:[],hide:[]}}function ne(t,e,n){t?e.hide.push(n):e.show.push(n)}function re(t){t.show.forEach(it),t.hide.forEach(X)}function $n(t,e,n=.3){e?ie(t,n):oe(t)}function oe(t){t.style.opacity=""}function ie(t,e=.3){t.style.opacity=e}function Gn(t){t.style.order=""}function Hn(t,e){t.style.order=e}function ue(t,e,n,r="inline-flex"){e.style.display=t?r:"none",n.style.display=t?"none":r}function zn(t,e){t.style.background=e}function Xn(t,e){const n=getFirstElement(e);n&&ae(t,n)}function ae(t,e){const n=createLink();n.href=t,e.parentNode.append(n),n.append(e)}function Qn(t,e){const n=getFirstElement(e);n&&ce(t,n)}function ce(t,e,n={}){const r=createLink(n);r.href=t,r.append(...e.childNodes),e.append(r)}function Yn(){const t=getURLQueryParam("scrollTo");if(!t)return;const e=document.getElementById(t);e?e.scrollIntoView():console.log(`Element with ID "${t}" was not found.`)}function qn(t,e,n=null){const r=`${e}-click-passed`,o=n?i=>findElementByText(i,t,n):i=>getFirstElement(t,i);return function(i){if(i.hasAttribute(r))return!1;const a=o(i);return a&&a.click(),i.setAttribute(r,""),!0}}function Zn(t,e,n="text/plain"){const r=new Blob([t],{type:n}),o=URL.createObjectURL(r),i=document.createElement("a");i.href=o,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i),requestAnimationFrame(()=>URL.revokeObjectURL(o))}function Jn(t){if(!t)return[];const n=St(t).flat().filter(r=>r&&!r.isNegative&&r.term).map(r=>r.term);return[...new Set(n)]}function St(t){return t?t.toLowerCase().split(",").map(se).filter(Boolean):[]}function se(t){const e=t.split("/").map(r=>r.trim()).filter(Boolean);if(e.length===0)return null;const n=e.map(le).filter(Boolean);return n.length>0?n:null}function le(t){const e=t.startsWith("!"),n=e?t.slice(1).trim():t;return n?{term:n,isNegative:e}:null}function tr(t,e){yt(t,n=>n.style.display!=="none",e)}function er(t,e){yt(t,n=>n.style.opacity==="",e)}function yt(t,e,n){const r=[...t].filter(e).length,o=t.length;Tt(n,r,o)}function Tt(t,e,n){t.textContent=`\u041F\u043E\u043A\u0430\u0437\u0430\u043D\u043E: ${e} \u0438\u0437 ${n}`}function de(t,e){return!fe(t,e)}function fe(t,e){if(!e||!e.value)return!0;const n=St(e.value);return pe(t,n)}function pe(t,e){if(!e||!e.length)return!0;const n=(t||"").toLowerCase();return e.every(r=>me(n,r))}function me(t,e){return e.some(({term:n,isNegative:r})=>{const o=t.includes(n);return r?!o:o})}function he(t,e){return e.value!=null&&t<e.value}function ge(t,e){return e.value!=null&&t>e.value}function nr(t,e){return e.value==null?!1:t<parseDateFromISO(e.value)}function rr(t,e){return e.value==null?!1:t>parseDateFromISO(e.value)}function or(t,e){return e.value&&t!==e.value}const Ce=["svg",T,[["path",{d:"M17 14V2"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z"}]]];const Ee=["svg",T,[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]]];const Lt=(t,e,n=[])=>{const r=document.createElementNS("http://www.w3.org/2000/svg",t);return Object.keys(e).forEach(o=>{r.setAttribute(o,String(e[o]))}),n.length&&n.forEach(o=>{const i=Lt(...o);r.appendChild(i)}),r};var _e=([t,e,n])=>Lt(t,e,n);function ir(t={},e=null){return createElement("i",t,e)}function ve(t,e={}){e.width||="1em",e.height||="1em";const n=_e(t);return nt(n,e),n}function be(t={},e=null,n=null){const r=rt("a",t,e);return n&&(r.href=n),r}function we(t,e=null,n={}){n.cursor||="pointer";const r=be(n,e);return t&&r.addEventListener("click",t),r}function Se(t,e,n=null,r={},o={}){r.display||="inline-flex",r.alignItems||="center",r.gap||="0.25em";const i=we(t,n,r);return i.prepend(ve(e,o)),i}function ut(t,e,n,r=null,o={},i={},a="userscript-control"){const h=P=>{P.stopPropagation(),P.preventDefault(),window.confirm(n)&&t()},v=r?`<span>${r}</span>`:null,y=Se(h,e,v,o,i);return y.classList.add(a),y}function ye(t,e,n={},r={}){return ut(t,Ce,"\u0412\u044B\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u043D\u0438\u0437\u043A\u0438\u0439 \u0440\u0435\u0439\u0442\u0438\u043D\u0433?",e?"\u0414\u0438\u0437\u043B\u0430\u0439\u043A":null,n,r)}function Te(t,e,n={},r={}){return ut(t,Ee,"\u0423\u0431\u0440\u0430\u0442\u044C \u043D\u0438\u0437\u043A\u0438\u0439 \u0440\u0435\u0439\u0442\u0438\u043D\u0433?",e?"\u0423\u0431\u0440\u0430\u0442\u044C \u0434\u0438\u0437\u043B\u0430\u0439\u043A":null,n,r)}function ur(t={},e=null,n=null){const r=createElement("button",t,e);return n&&r.addEventListener("click",n),r}function ar(t){let e=0,n=0;t.forEach(o=>{e+=o.rating,n+=1});const r=n>0?e/n:0;return roundToPrecision(r)}function Le(t){return function(e){const n=gt(e.productId);e.storedRating!==n&&(e.storedRating=n,e.rating=n??e.originalRating,e.ratingWrap&&t(e.ratingWrap,e.rating),Ft(n,e.dislikeControls))}}function De(t,e,n,r={}){const{needLabel:o,onDislike:i,onRemoveDislike:a,styles:h={}}=r,v=ye(()=>Fe(e,i),o,h.link,h.dislikeIcon),y=Te(()=>Oe(e,a),o,h.link,h.removeDislikeIcon);t.append(v,y);const P={dislikeButton:v,removeDislikeButton:y};return Ft(n,P),P}async function Fe(t,e){await Dt(t,1,e)}async function Oe(t,e){await Dt(t,null,e)}async function Dt(t,e,n){At(t,e),n&&await n(e)}function Ft(t,e){const{dislikeButton:n,removeDislikeButton:r}=e;ue(t!==1,n,r)}const Ot="products-snapshot";function at(t){d(Ot,xe(t))}function cr(){at([])}function Pe(){const t=ct();return t||(at([]),ct())}function ct(){const t=b(Ot);return t&&(t.idsSet=new Set(t.ids)),t}function xe(t){return{ids:t,createdAt:Date.now()}}const Ie=window.GM_addValueChangeListener,Re=Le(xt),Pt={NO_RATING_TEXTS:["\u043D\u043E\u0432\u0435\u043D\u044C\u043A\u0438\u0439","\u043E\u0446\u0435\u043D\u043A\u0443"],NEW_PRODUCT_RATING:5},u={context:null,productList:null,productListObserver:null,isFiltersInitialized:!1,filters:{nameFilter:null,minRatingFilter:null,maxPriceFilter:null,notInSnapshotFilter:null,filterEnabled:null},productCardsInfo:null,productCardsCache:new WeakMap,productIds:[],productsSnapshot:null};async function Ne(t){t&&ze();try{u.context=qt(),ke(u.context.unwantedSelectors),Ae(),await Be()}catch(e){console.warn(e.message)}}function ke(t){if(!t?.length)return;const n=`
        ${t.join(`,
`)} {
            display: none !important;
        }
    `;window.GM_addStyle(n)}function Ae(){if(!u.isFiltersInitialized){const t=Ue(),{createSectionFilter:e}=j($,t);u.filters.nameFilter=e("name-filter"),u.filters.minRatingFilter=e("min-rating-filter",4.6),u.filters.maxPriceFilter=e("max-price-filter",800),u.context.isSnapshotFeatureEnabled&&(u.filters.notInSnapshotFilter=e("not-in-snapshot-filter",!1)),u.filters.filterEnabled=e("filter-enabled",!0),u.isFiltersInitialized=!0}}function Ue(){return L(u.context.getSectionName())}async function Be(){const{selectors:t}=u.context;u.productList=await Rt(document,t.productList);const e=u.productList.closest(t.productListContainer),n=_(t.productListHeader,e);n&&(Mt(n,Me),Ie(q.LAST_RATE_UPDATE,()=>$(!0)),u.context.isSnapshotFeatureEnabled&&(u.productsSnapshot=Pe()),$(!1),u.productListObserver&&ft(u.productListObserver),u.productListObserver=new MutationObserver(()=>$(!1)),u.productListObserver.observe(u.productList,{childList:!0}))}function Me(t,e){nt(t,{...F.FILTERS_CONTAINER,...u.context.filtersContainerStyles});const n=$t(u.filters.nameFilter,F.TEXT_INPUT_CONTROL,F.TEXT_INPUT),r=Gt(u.filters.minRatingFilter,F.CONTROL,F.NUMBER_INPUT),o=zt(u.filters.maxPriceFilter,F.CONTROL,F.NUMBER_INPUT);if(t.append(n,r,o),u.context.isSnapshotFeatureEnabled){const a=Et("\u0412\u043D\u0435 \u0441\u043D\u0438\u043C\u043A\u0430: ",u.filters.notInSnapshotFilter,F.CONTROL,F.CHECKBOX_INPUT);t.append(a)}const i=Qt(u.filters.filterEnabled,F.CONTROL,F.CHECKBOX_INPUT);if(t.append(i),u.context.isSnapshotFeatureEnabled){const a=Ve(F.CONTROL);t.append(a)}u.productCardsInfo=ot(F.FILTERS_INFO),t.append(u.productCardsInfo),e.append(t)}function Ve(t={}){const e=We();return K(e,t)}function We(){return ut(()=>{at(u.productIds),u.productsSnapshot=ct(),$(!1)},k,"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0441\u043D\u0438\u043C\u043E\u043A \u0442\u043E\u0432\u0430\u0440\u043E\u0432?","\u0421\u043D\u0438\u043C\u043E\u043A",{gap:"5px"},{},"custom-filters-button")}function $(t=!1){const e=N(M.PRODUCT_CARD,u.productList),n=ee(),r=[];if(e.forEach(i=>{const a=je(i,t);ne(a,n,i);const h=u.productCardsCache.get(i);h?.productId&&r.push(h.productId)}),re(n),Tt(u.productCardsInfo,n.show.length,e.length),u.productIds=r,t)return;_(M.SHOW_MORE_BUTTON,u.productList)?.click()}function je(t,e){if(!u.filters.filterEnabled.value)return!1;let n=u.productCardsCache.get(t);if(n)e&&Re(n);else{const r=_(M.PRODUCT_CARD_DATA,t);if(!r)return!0;const o=_(M.PRODUCT_NAME,r),i=_(M.PRODUCT_RATING_WRAP,r),a=_(M.PRODUCT_PRICE_CONTAINER,r);if(!o||!i||!a)return!0;const h=_(M.PRODUCT_PRICE_WRAP,a);if(!h)return!0;const v=r.dataset.id,y=o.textContent.trim(),P=i?.textContent.trim(),W=gt(v),x=Ke(W,i),G=Q(h),Xe=Ge(a,v,W);n={productId:v,nameWrap:o,name:y,ratingWrap:i,originalRating:P,storedRating:W,rating:x,price:G,dislikeControls:Xe},u.productCardsCache.set(t,n)}return He(n.nameWrap),u.context.isSnapshotFeatureEnabled&&(n.notInSnapshot=!u.productsSnapshot.idsSet.has(n.productId),t.classList.toggle("not-in-snapshot",n.notInSnapshot),u.filters.notInSnapshotFilter.value&&!n.notInSnapshot)?!0:de(n.name,u.filters.nameFilter)||he(n.rating,u.filters.minRatingFilter)||ge(n.price,u.filters.maxPriceFilter)}function Ke(t,e){return t?(xt(e,t),t):$e(e.textContent)?Pt.NEW_PRODUCT_RATING:Q(e,!0,!1,0)}function xt(t,e){t.textContent=e.toString().padEnd(4)}function $e(t){return Pt.NO_RATING_TEXTS.some(e=>t.toLowerCase().includes(e))}function Ge(t,e,n){const r=()=>$(!0),o={needLabel:!1,onDislike:r,onRemoveDislike:r,styles:{link:tt.DISLIKE_CONTROL,dislikeIcon:tt.DISLIKE_BUTTON_ICON_MD,removeDislikeIcon:tt.REMOVE_DISLIKE_BUTTON_ICON_MD}};return De(t,e,n,o)}function He(t){t.style.maxHeight="4lh",t.style.webkitLineClamp=4}function ze(){u.productList=null,u.isFiltersInitialized=!1,u.filters={nameFilter:null,minRatingFilter:null,maxPriceFilter:null,notInSnapshotFilter:null,filterEnabled:null},u.productCardsCache=new WeakMap,u.productIds=[],u.productsSnapshot=null,ft(u.productListObserver)}}},st={};function B(C){var g=st[C];if(g!==void 0)return g.exports;var f=st[C]={exports:{}};return It[C](f,f.exports,B),f.exports}(()=>{var C=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",g=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",f=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",T=S=>{S&&S.d<1&&(S.d=1,S.forEach(m=>m.r--),S.forEach(m=>m.r--?m.r++:m()))},k=S=>S.map(m=>{if(m!==null&&typeof m=="object"){if(m[C])return m;if(m.then){var O=[];O.d=0,m.then(b=>{d[g]=b,T(O)},b=>{d[f]=b,T(O)});var d={};return d[C]=b=>b(O),d}}var A={};return A[C]=b=>{},A[g]=m,A});B.a=(S,m,O)=>{var d;O&&((d=[]).d=-1);var A=new Set,b=S.exports,I,j,H,U=new Promise((L,R)=>{H=R,j=L});U[g]=b,U[C]=L=>(d&&L(d),A.forEach(L),U.catch(R=>{})),S.exports=U,m(L=>{I=k(L);var R,c=()=>I.map(l=>{if(l[f])throw l[f];return l[g]}),s=new Promise(l=>{R=()=>l(c),R.r=0;var p=E=>E!==d&&!A.has(E)&&(A.add(E),E&&!E.d&&(R.r++,E.push(R)));I.map(E=>E[C](p))});return R.r?s:c()},L=>(L?H(U[f]=L):j(b),T(d))),d&&d.d<0&&(d.d=0)}})(),B.d=(C,g)=>{for(var f in g)B.o(g,f)&&!B.o(C,f)&&Object.defineProperty(C,f,{enumerable:!0,get:g[f]})},B.o=(C,g)=>Object.prototype.hasOwnProperty.call(C,g);var Qe=B(7061)})();})();
