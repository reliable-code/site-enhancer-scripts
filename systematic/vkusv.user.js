// ==UserScript==
// @name         Vkusv product cards filter
// @description  Hide product cards by filter
// @grant        GM_addStyle
// @grant        GM_deleteValue
// @grant        GM_listValues
// @grant        GM_addValueChangeListener
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://vkusvill.ru/*
// @namespace    https://github.com/reliable-code/site-enhancer-scripts
// @version      1.0.77116688
// @icon         https://www.google.com/s2/favicons?sz=64&domain=vkusvill.ru
// @author       reliable-code
// @downloadURL  https://raw.githubusercontent.com/reliable-code/site-enhancer-scripts/main/systematic/vkusv.user.js
// ==/UserScript==

(()=>{(()=>{"use strict";var Nt={5406:(C,g,d)=>{d.d(g,{$F:()=>p,Fc:()=>T,z2:()=>A});function T(s,c="common",l=!1){const{pathname:f}=window.location;return x(f,s,c,l)}function x(s,c,l,f=!1){const E=s.split("/");c=c<0?E.length+c:c;const k=E[c]||l;return f&&console.log(`Pathname element: ${k}`),k}function b(s,c="common",l=!1){const f=T(s,"",l);return m(f,c,l)}function m(s,c,l){if(!s)return c;const f=s.split("-").at(-1);return l&&console.log(`Pathname element ending: ${f}`),f}function P(s,c,l="common",f=!1){const E=x(s,c,"",f);return m(E,l,f)}function p(s){return new URLSearchParams(window.location.search).get(s)}function L(s){return s.split("?")[0]}function O(s){return window.location.pathname.includes(s)}function U(s){return s.some(c=>O(c))}function A(...s){return window.location.pathname.split("/").some(l=>s.includes(l))}function z(s){try{const c=new URL(window.location.href);Object.entries(s).forEach(([l,f])=>{c.searchParams.set(l,f)}),window.location.href=c.toString()}catch(c){console.error("Failed to redirect:",c)}}function B(s,c=[]){const l=new AbortController;let f=!1;const E=_=>{const w=new URL(_),y={pathname:w.pathname};return c.forEach(J=>{y[J]=w.searchParams.get(J)}),y};let k=E(window.location.href);return window.navigation.addEventListener("navigatesuccess",async()=>{if(f)return;const _=E(window.navigation.currentEntry.url);if(Object.keys(k).some(y=>k[y]!==_[y])){k=_,f=!0;try{await s(_)}catch(y){console.error("URL observer error:",y)}finally{f=!1}}},{signal:l.signal}),()=>l.abort()}function D(s,c=[]){const l={pathname:window.location.pathname};c.forEach(w=>{l[w]=p(w)});let f=!1;async function E(){if(f)return;const w={pathname:window.location.pathname};if(c.forEach(y=>{w[y]=p(y)}),Object.keys(l).some(y=>l[y]!==w[y])){Object.assign(l,w),f=!0;try{await s()}catch(y){console.error("Error in URL observer callback:",y)}finally{f=!1}}}function k(){E().catch(w=>{console.error("Error in URL change handler:",w)})}let _=window.location.href;setInterval(()=>{window.location.href!==_&&(console.log("URL changed:",window.location.href),_=window.location.href,k())},200),window.addEventListener("popstate",k)}function I(s=[]){D(()=>window.location.reload(),s)}},7061:(C,g,d)=>{d.a(C,async(T,x)=>{try{var b=d(5406),m=d(6142),P=d(3414);(0,P.N)(),await p();async function p(){(0,b.z2)("cart","goods","offers","populyarnoe","search")&&await(0,m.P)()}x()}catch(p){x(p)}},1)},3414:(C,g,d)=>{d.d(g,{N:()=>x});const T=`.us-control{color:#707070!important;&:hover{color:#1a1a1a!important}}
`;function x(){window.GM_addStyle(T)}},6142:(C,g,d)=>{d.d(g,{P:()=>ke});const T={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const x=["svg",T,[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}],["circle",{cx:"12",cy:"13",r:"3"}]]],b=`.custom-filters-button{padding:10px 16px!important;color:#fff!important;background-color:#179c49!important;border-radius:12px!important;&:hover{background-color:#179948!important}}.ProductCard__content{.ProductCard__notice{order:1!important;display:flex!important;flex-grow:1!important;align-items:flex-end!important;margin:0 0 6px!important}.ProductCard__price{order:2!important;flex-grow:1!important;align-items:flex-end!important;&:has(+.ProductCard__notice){flex-grow:0!important}.Price{&:not(.Price--label){padding:3px 0!important}&._last{line-height:1.25em!important;&:before{border:none!important}}}}.ProductCard__cartFooter{order:3!important}.ProductCards__item.not-in-snapshot &{background-color:#e6fffa!important;border-radius:0 0 12px 12px!important}}.VV22_Modal_Forgot{.modal-dialog{max-width:1220px!important;max-height:95vh!important;margin:2.5vh auto!important;.modal-content{max-height:95vh!important;.Modal__inner{max-height:none!important;.lk-modal-alert__title{margin-bottom:10px!important;padding-right:0!important}.ProductCards__item{width:25%!important}}}}}.HProductCard__Avail{font-size:13px!important}
`;class m{constructor(e,n){this.value=e,this.onChange=n}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}function P(t){const{target:e}=t,{type:n}=e;switch(n){case"text":return`"${e.value}"`;case"number":return e.value;case"select-one":return e.value;case"date":return`"${e.value}"`;case"checkbox":return e.checked;default:return console.log(`Unknown input type: ${n}`),null}}function p(t){return t===""?null:JSON.parse(t)}const L=window.GM_setValue,O=window.GM.setValue,U=window.GM_getValue;class A extends m{constructor(e,n=null,r=null){super(U(e,n),r),this.storageKey=e,this.defaultValue=n}static create(e,n=null,r=null){return new A(e,n,r)}static createWithCompositeKey(e,n,r=null,o=null){const i=`${e}-${n}`;return new A(i,r,o)}updateValueFromEvent=e=>{const n=P(e),r=p(n);this.updateValue(r)};updateValue(e,n=!0){this.value!==e&&(L(this.storageKey,e),this.value=e,n&&this.onChangeIfDefined())}clearValue(e=!1){this.updateValue(null,e)}resetValue(e=!1){this.updateValue(this.defaultValue,e)}}function z(t,e=null){return{createGlobalFilter(n,r=null,o=t){return A.create(n,r,o)},createSectionFilter(n,r=null,o=t){if(!e)throw new Error("sectionId must be provided to use createSectionFilter.");return A.createWithCompositeKey(e,n,r,o)}}}function B(t){let r=2166136261;for(let o=0;o<t.length;o+=1){const i=t.charCodeAt(o);r^=i,r=Math.imul(r,16777619)}return r>>>0}function D(t){return B(t).toString(16).padStart(8,"0")}function I(t,e="common"){return t?D(t):e}function s(t){return t.replace(/\D/g,"")}function c(t){return t.replace(/[^\d.,-]/g,"")}function l(t){return t.replace(/\s/g,"")}function f(t){return t.charAt(0).toUpperCase()+t.slice(1)}function E(t){return t.replace(/\s+/g," ").trim()}function k(t,e=document){return!!e.querySelector(t)}function _(t,e=document,n=!1){const r=e.querySelector(t);return n&&!r&&console.log(`No element found for selector: ${t}`),r}function w(t,e=document,n=!1){const r=e.querySelectorAll(t);return n&&!r.length&&console.log(`No elements found for selector: ${t}`),r}function y(t,e=1){let n=t;for(let r=0;r<e;r++){if(!n.parentElement)return null;n=n.parentElement}return n}function J(t,e,n){return[...t.querySelectorAll(e)].find(r=>r.textContent.trim().includes(n))}function Ze(t,e,n=!1,r=!1,o=null){const i=_(e,t);return Q(i,n,r,o)}function Q(t,e=!1,n=!1,r=null){if(!t)return r===null?(console.log("No element found"),null):r;const o=t.innerText;return lt(o,e,n)}function Je(t,e,n=!1){const r=t[e];return Q(r,n)}function tn(t,e=!1,n=!1){const r=t.textContent;return lt(r,e,n)}function lt(t,e,n){e&&(t=c(t)),n&&(t=t.replace(",","."));const r=Number(t);return Number.isNaN(r)?(console.log(`Invalid number: ${t}`),0):r}function en(t){return[...t.childNodes].find(e=>e.nodeType===Node.TEXT_NODE)}function nn(t){const e=n=>n.nodeType===Node.TEXT_NODE&&n.textContent.trim()!==""?[n]:[...n.childNodes].flatMap(e);return e(t)}function rn(t){return normalizeSpacing(t.textContent)}const X={INPUT:{border:"1px solid #d0d0d0",borderRadius:"12px",padding:"10px 16px",fontSize:"16px"},CONTROL:{display:"flex",gap:"8px",alignItems:"center",fontSize:"16px",fontWeight:"400"}},F={FILTERS_CONTAINER:{display:"flex",flexWrap:"wrap",width:"100%",gap:"12px 18px"},CONTROL:X.CONTROL,FILTERS_INFO:{...X.CONTROL,width:"100%",justifyContent:"flex-end",marginRight:"6px",fontSize:"14px",color:"#9ca3af"},TEXT_INPUT_CONTROL:{...X.CONTROL,flexGrow:1,minWidth:"180px"},TEXT_INPUT:{...X.INPUT,flexGrow:1},NUMBER_INPUT:{...X.INPUT,width:"90px"},CHECKBOX_INPUT:{width:"21px",height:"21px",cursor:"pointer",accentColor:"#179C49"}},tt={DISLIKE_CONTROL:{marginLeft:"auto",gap:"3px"},DISLIKE_BUTTON_ICON_SM:{height:"0.9em",marginBottom:"1px",marginRight:"2px"},DISLIKE_BUTTON_ICON_MD:{marginBottom:"4px"},REMOVE_DISLIKE_BUTTON_ICON_SM:{height:"0.9em",marginBottom:"1px"},REMOVE_DISLIKE_BUTTON_ICON_MD:{marginBottom:"5px"}},V={PRODUCT_CARD:".ProductCards__item",PRODUCT_CARD_DATA:".ProductCard",PRODUCT_NAME:".ProductCard__link",PRODUCT_RATING_WRAP:".ProductCard__ratingText",PRODUCT_PRICE_CONTAINER:".ProductCard__price",PRODUCT_PRICE_WRAP:".js-datalayer-catalog-list-price",SHOW_MORE_BUTTON:".js-prods-modal-load-more"};function At(t,e,n=null){const r=t.querySelector(e);return r?Promise.resolve(r):new Promise(o=>{const i=new MutationObserver(h);i.observe(t,{childList:!0,subtree:!0});let a;n&&(a=setTimeout(()=>{i.disconnect(),console.log(`No element found for selector: ${e}`),o(null)},n));function h(){const v=t.querySelector(e);v&&(a&&clearTimeout(a),i.disconnect(),o(v))}})}function on(t,e){return t.querySelector(e)?new Promise(r=>{const o=new MutationObserver(i);o.observe(t,{childList:!0,subtree:!0});function i(){t.querySelector(e)||(o.disconnect(),r())}}):Promise.resolve()}function un(t,e=400){return new Promise(n=>{let r;const o=new MutationObserver(()=>{clearTimeout(r),i()});function i(){r=setTimeout(()=>{o.disconnect(),n()},e)}i(),o.observe(t,{childList:!0,subtree:!0})})}function dt(t,e=250){let n;return function(...r){const o=this;clearTimeout(n),n=setTimeout(()=>t.apply(o,r),e)}}async function an(t){document.visibilityState==="visible"?await t():document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&await t()},{once:!0})}function sn(t,e){const n=new IntersectionObserver(r=>{r.forEach(o=>{o.isIntersecting&&(e(),kt(t))})});t.intersectionObserver=n,n.observe(t)}function kt(t){t.intersectionObserver&&(t.intersectionObserver.disconnect(),t.intersectionObserver=null)}function ft(t){t&&(t.disconnect(),t=null)}class et{constructor(e=Date.now(),n=null,r=null,o={}){this.lastCheckDate=e,this.lowestPrice=n,this.highestPrice=r,this.priceHistory=o}get lowestPriceValue(){return this.lowestPrice?this.lowestPrice.value:0}get highestPriceValue(){return this.highestPrice?this.highestPrice.value:0}updateLastCheckDate=()=>{this.lastCheckDate=Date.now()};static fromObject(e){const{lastCheckDate:n,lowestPrice:r,highestPrice:o,priceHistory:i}=e;return new et(n,r,o,i)}}class Y extends et{constructor(e=Date.now(),n=null,r=null,o={},i=null){super(e,n,r,o),this.rating=i}static fromObject(e){const{lastCheckDate:n,lowestPrice:r,highestPrice:o,priceHistory:i,rating:a}=e;return new Y(n,r,o,i,a)}}const pt=window.GM_listValues;function cn(t,e,n=!1){getStorageValue("dbVersion")!==e&&(t(),!n&&setStorageValue("dbVersion",e))}function ln(t,e=!0){const n=pt();mt(n,t,e)}function Ut(t,e,n=!0){const o=pt().filter(t);mt(o,e,n)}function mt(t,e,n){let r=0;t.forEach(o=>{const i=getStorageValue(o);n&&console.log(o,i),e(o,i),r+=1}),n&&console.log(`Total entries processed: ${r}`)}function dn(t,e=!1){Ut(t,r=>{e||window.GM_deleteValue(r)})}const q={LAST_RATE_UPDATE:"last-rate-update",REVIEWS_LAST_PRODUCT_ARTICLE:"reviews-last-product-article"};function Bt(t,e,n=!1){const r=ht(t),o=U(r),i=Mt(o);n&&i.rating===1||(i.rating=e,i.updateLastCheckDate(),L(r,i),L(q.LAST_RATE_UPDATE,Date.now()))}function ht(t){return`product-${t}`}function Mt(t){return t?Y.fromObject(t):new Y}function Vt(t){const e=ht(t);return U(e)}function gt(t){return Vt(t)?.rating??null}function fn(t){return setStorageValue(q.REVIEWS_LAST_PRODUCT_ARTICLE,t)}function pn(){return getStorageValue(q.REVIEWS_LAST_PRODUCT_ARTICLE)}function mn(){const t=o=>o.startsWith("product-"),e=[],n=(o,i)=>{new Date(i.lastCheckDate)<getDateMonthsAgo(9)&&e.push(i.lastCheckDate)};processEntriesByKeyFilter(t,n,!1),[...e].sort((o,i)=>new Date(o)-new Date(i)).forEach(o=>{console.log(new Date(o).toLocaleDateString())})}function nt(t,e){Object.assign(t.style,e)}function hn(t,e="custom-global-style"){let n=document.getElementById(e);n||(n=document.createElement("style"),n.id=e,n.type="text/css",document.head.appendChild(n)),n.textContent=t}function gn(t){return Object.entries(t).map(([e,n])=>`${e.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${n};`).join(" ")}function Cn(t){return t?t.split(";").filter(e=>e.trim()!=="").reduce((e,n)=>{const[r,o]=n.split(":").map(a=>a.trim()),i=r.replace(/-([a-z])/g,(a,h)=>h.toUpperCase());return e[i]=o,e},{}):{}}function rt(t,e,n=null){if(typeof e!="object"||e===null)throw new TypeError("styles should be an object");const r=document.createElement(t);return nt(r,e),n&&(r.innerHTML=n),r}function En(t={},e=null){return createElement("span",t,e)}function ot(t={},e=null){return rt("div",t,e)}function Wt(t,e,n=!1,r="customFiltersContainer"){let o=t.querySelector(`#${r}`);if(o){if(!n)return;o.replaceChildren()}else o=ot(),o.id=r;e(o,t)}function K(t,e={},n=null){const r=ot(e,n);return r.append(t),r}function _n(t,e=null,n={},r={}){const o=createActionLink(t,e,r);return K(o,n)}function vn(t,e=null,n=null,r={},o={},i={}){const a=createActionLinkWithIcon(t,n,e,o,i);return K(a,r)}function jt(t,e,n){const r=Z(t,"text",e);return r.value=n,r}function Kt(t,e,n,r,o,i){const a=Z(t,"number",e);return a.value=n,a.step=r,a.min=o,a.max=i,a}function yn(t,e,n){const r=Z(t,"date",e);return r.value=n,r}function Gt(t,e,n){const r=Z(t,"checkbox",e);return r.checked=n,r}function Z(t={},e=null,n=null){const r=rt("input",t);return e&&(r.type=e),n&&(r.addEventListener("keyup",dt(n,200)),r.addEventListener("change",dt(n,100))),r}function bn(t,e,n){const r=createElement("select",t);return e&&r.addEventListener("change",e),r.value=n,r}function $t(t,e,n={},r={}){const o=jt(r,e.updateValueFromEvent,e.value);return K(o,n,t)}function Ct(t,e,n,r,o,i={},a={}){const h=Kt(a,e.updateValueFromEvent,e.value,n,r,o);return K(h,i,t)}function wn(t,e,n={},r={}){const o=createSelect(r,e.updateValueFromEvent,e.value);return createControl(o,n,t)}function Sn(t,e,n={},r={}){const o=createDateInput(r,e.updateValueFromEvent,e.value);return createControl(o,n,t)}function Et(t,e,n={},r={}){const o=Gt(r,e.updateValueFromEvent,e.value);return K(o,n,t)}function Ht(t,e={},n={}){return $t("\u041F\u043E\u0438\u0441\u043A: ",t,e,n)}function zt(t,e={},n={},r=.1,o=3){return Ct("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",t,r,o,5,e,n)}function Tn(t,e={},n={},r=.1,o=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",t,r,o,5,e,n)}function Ln(t,e={},n={}){return _t("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",t,e,n)}function Dn(t,e={},n={}){return _t("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",t,e,n)}function _t(t,e,n={},r={}){return createNumberFilterControl(t,e,"1","1","999999",n,r)}function Fn(t,e={},n={}){return createDateFilterControl("\u041C\u0438\u043D. \u0434\u0430\u0442\u0430: ",t,e,n)}function On(t,e={},n={}){return Xt("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",t,e,n)}function Xt(t,e,n={},r={}){return createNumberFilterControl(t,e,"5","0","100",n,r)}function xn(t,e={},n={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",t,"5","0","100",e,n)}function vt(t,e,n={},r={},o="250"){return Ct(t,e,o,"0","1000000",n,r)}function Pn(t,e={},n={},r="25"){return vt("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",t,e,n,r)}function Qt(t,e={},n={},r="25"){return vt("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",t,e,n,r)}function In(t,e={},n={}){return Yt("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",t,e,n)}function Yt(t,e,n={},r={}){return createNumberFilterControl(t,e,"1","0","99999",n,r)}function Rn(t,e={},n={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",t,"1","2","8",e,n)}function Nn(t,e={},n={}){return createNumberFilterControl("\u0421\u0442\u0440\u043E\u043A \u0438\u043C\u0435\u043D\u0438: ",t,1,1,10,e,n)}function An(t,e={},n={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",t,e,n)}function kn(t,e={},n={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",t,e,n)}function Un(t,e={},n={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",t,e,n)}function Bn(t,e={},n={}){return createCheckboxFilterControl("\u0411\u043E\u043D\u0443\u0441: ",t,e,n)}function Mn(t,e={},n={}){return createCheckboxFilterControl("\u0412 \u043D\u0430\u043B\u0438\u0447\u0438\u0438: ",t,e,n)}function qt(t,e={},n={}){return Et("\u0412\u043A\u043B: ",t,e,n)}function Vn(t,e,n={}){const r=[{value:-25,emoji:"\u{1F48E}",tooltip:"\u0421\u0443\u043F\u0435\u0440 \u0446\u0435\u043D\u0430 (-25%)"},{value:-15,emoji:"\u{1F525}",tooltip:"\u041E\u0442\u043B\u0438\u0447\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-15%)"},{value:-5,emoji:"\u{1F31F}",tooltip:"\u041A\u043B\u0430\u0441\u0441\u043D\u0430\u044F \u0446\u0435\u043D\u0430 (-5%)"},{value:5,emoji:"\u{1F44C}",tooltip:"\u0425\u043E\u0440\u043E\u0448\u0430\u044F \u0446\u0435\u043D\u0430 (+5%)"}],o={active:{background:"#e3f2fd",borderColor:"#2196f3",boxShadow:"0 0 0 1px #2196f3"},inactive:{background:"#fff",borderColor:"#ccc",boxShadow:"none"},hover:{background:"#f5f5f5"}},i=createDiv({display:"inline-flex",gap:"4px",marginLeft:"4px"}),a=[],h=()=>e?parseFloat(e.value)||0:t.value,v=()=>{const S=h();a.forEach(({button:R,value:j})=>{const H=j<=S?o.active:o.inactive;Object.assign(R.style,H)})};return r.forEach(({value:S,emoji:R,tooltip:j})=>{const N=createButton({padding:"2px 6px",fontSize:"16px",cursor:"pointer",border:"1px solid #ccc",borderRadius:"4px",background:"#fff",transition:"all 0.2s",...n},R);N.title=j,N.type="button",N.addEventListener("click",H=>{H.preventDefault(),t.updateValue(S),e&&(e.value=S),v()}),N.addEventListener("mouseenter",()=>{S<=h()||(N.style.background=o.hover.background)}),N.addEventListener("mouseleave",()=>{v()}),a.push({button:N,value:S}),i.appendChild(N)}),v(),e&&(e.addEventListener("input",v),e.addEventListener("change",v)),i}var W=d(5406);const yt={selectors:{productList:".ProductCards > .js-datalayer-catalog-list",productListContainer:".Catalog__col",productListHeader:".FilterPanelInner"},getSectionName:()=>(0,W.Fc)(-2)},Zt=[{id:"cart",matches:()=>(0,W.z2)("cart"),params:{selectors:{productList:"#js-modal-cart-prods-scroll > .js-datalayer-catalog-list",productListContainer:".Modal__inner",productListHeader:".lk-modal-alert__title"},filtersContainerStyles:{marginTop:"20px"},unwantedSelectors:[".js-delivery__form--vv-recoms-slider",".Delivery__Order__OrderBody-Block:has(.VV23_OrderPagePackages)",".VV24_RepeatLastOrder"],isSnapshotFeatureEnabled:!0,getSectionName:()=>(0,W.Fc)(-2)}},{id:"catalog",matches:()=>(0,W.z2)("goods","populyarnoe"),params:{...yt,filtersContainerStyles:{marginTop:"12px"}}},{id:"offers",matches:()=>(0,W.z2)("offers"),params:{...yt,filtersContainerStyles:{margin:"22px 0 6px"}}},{id:"search",matches:()=>(0,W.z2)("search"),params:{selectors:{productList:".ProductCards > .js-datalayer-catalog-list",productListContainer:"#search-result-general-container",productListHeader:'[class*="_SearchPageHeader__Menu"]'},filtersContainerStyles:{marginTop:"12px"},getSectionName:()=>(0,W.$F)("q")}}];function Jt(){const t=Zt.find(e=>e.matches());if(!t)throw new Error(`Unknown context for URL: ${window.location.pathname}`);return t.params}function Wn(t,e){t.parentNode.insertBefore(e,t.nextSibling)}function G(t){t.style.display="none"}function jn(t,e=1){const n=document.querySelector(t);n&&te(n,e)}function te(t,e=1){const n=getElementAncestor(t,e);n&&G(n)}function Kn(t,e,n){const r=findElementByText(t,e,n);r&&G(r)}function Gn(t){bt(t),G(t)}function ee(t){t.intersectionObserver||runOnceOnIntersection(t,()=>G(t))}function it(t){t.style.display=""}function $n(t){const e=ne(t);t.style.display=e}function Hn(t,e){e?G(t):it(t)}function zn(t,e){e?ee(t):(clearIntersectionObserver(t),it(t))}function ne(t){return bt(t),t.dataset.defaultDisplay}function bt(t){if(t.dataset.defaultDisplay)return;const{display:e}=getComputedStyle(t);t.dataset.defaultDisplay=e}function re(){return{show:[],hide:[]}}function oe(t,e,n){t?e.hide.push(n):e.show.push(n)}function ie(t){t.show.forEach(it),t.hide.forEach(G)}function Xn(t,e,n=.3){e?ae(t,n):ue(t)}function ue(t){t.style.opacity=""}function ae(t,e=.3){t.style.opacity=e}function Qn(t){t.style.order=""}function Yn(t,e){t.style.order=e}function se(t,e,n,r="inline-flex"){e.style.display=t?r:"none",n.style.display=t?"none":r}function qn(t,e=.3){t.style.transition="opacity 0.3s",t.style.opacity=e,wt(t)}function Zn(t){t.style.opacity="",St(t)}function Jn(t){t.style.animation="loading-pulse 2.5s ease-in-out infinite",wt(t)}function tr(t){t.style.animation="",St(t)}function wt(t){t.style.pointerEvents="none",t.style.cursor="wait"}function St(t){t.style.pointerEvents="",t.style.cursor=""}function er(t,e){const n=getFirstElement(e);n&&ce(t,n)}function ce(t,e){const n=createLink();n.href=t,e.parentNode.append(n),n.append(e)}function nr(t,e){const n=getFirstElement(e);n&&le(t,n)}function le(t,e,n={}){const r=createLink(n);r.href=t,r.append(...e.childNodes),e.append(r)}function rr(){const t=getURLQueryParam("scrollTo");if(!t)return;const e=document.getElementById(t);e?e.scrollIntoView():console.log(`Element with ID "${t}" was not found.`)}function or(t,e,n=null){const r=`${e}-click-passed`,o=n?i=>findElementByText(i,t,n):i=>getFirstElement(t,i);return function(i){if(i.hasAttribute(r))return!1;const a=o(i);return a&&a.click(),i.setAttribute(r,""),!0}}function ir(t,e,n="text/plain"){const r=new Blob([t],{type:n}),o=URL.createObjectURL(r),i=document.createElement("a");i.href=o,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i),requestAnimationFrame(()=>URL.revokeObjectURL(o))}function ur(t){if(!t)return[];const n=Tt(t).flat().filter(r=>r&&!r.isNegative&&r.term).map(r=>r.term);return[...new Set(n)]}function Tt(t){return t?t.toLowerCase().split(",").map(de).filter(Boolean):[]}function de(t){const e=t.split("/").map(r=>r.trim()).filter(Boolean);if(e.length===0)return null;const n=e.map(fe).filter(Boolean);return n.length>0?n:null}function fe(t){const e=t.startsWith("!"),n=e?t.slice(1).trim():t;return n?{term:n,isNegative:e}:null}function ar(t,e){Lt(t,n=>n.style.display!=="none",e)}function sr(t,e){Lt(t,n=>n.style.opacity==="",e)}function Lt(t,e,n){const r=[...t].filter(e).length,o=t.length;Dt(n,r,o)}function Dt(t,e,n){t.textContent=`\u041F\u043E\u043A\u0430\u0437\u0430\u043D\u043E: ${e} \u0438\u0437 ${n}`}function pe(t,e){return!me(t,e)}function me(t,e){if(!e||!e.value)return!0;const n=Tt(e.value);return he(t,n)}function he(t,e){if(!e||!e.length)return!0;const n=(t||"").toLowerCase();return e.every(r=>ge(n,r))}function ge(t,e){return e.some(({term:n,isNegative:r})=>{const o=t.includes(n);return r?!o:o})}function Ce(t,e){return e.value!=null&&t<e.value}function Ee(t,e){return e.value!=null&&t>e.value}function cr(t,e){return e.value==null?!1:t<parseDateFromISO(e.value)}function lr(t,e){return e.value==null?!1:t>parseDateFromISO(e.value)}function dr(t,e){return e.value&&t!==e.value}const _e=["svg",T,[["path",{d:"M17 14V2"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z"}]]];const ve=["svg",T,[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]]];const Ft=(t,e,n=[])=>{const r=document.createElementNS("http://www.w3.org/2000/svg",t);return Object.keys(e).forEach(o=>{r.setAttribute(o,String(e[o]))}),n.length&&n.forEach(o=>{const i=Ft(...o);r.appendChild(i)}),r};var ye=([t,e,n])=>Ft(t,e,n);function fr(t={},e=null){return createElement("i",t,e)}function be(t,e={}){e.width||="1em",e.height||="1em";const n=ye(t);return nt(n,e),n}function we(t={},e=null,n=null){const r=rt("a",t,e);return n&&(r.href=n),r}function Se(t,e=null,n={}){n.cursor||="pointer";const r=we(n,e);return t&&r.addEventListener("click",t),r}function Te(t,e,n=null,r={},o={}){r.display||="inline-flex",r.alignItems||="center",r.gap||="0.25em";const i=Se(t,n,r);return i.prepend(be(e,o)),i}function ut(t,e,n,r=null,o={},i={},a="us-control"){const h=R=>{R.stopPropagation(),R.preventDefault(),window.confirm(n)&&t()},v=r?`<span>${r}</span>`:null,S=Te(h,e,v,o,i);return S.classList.add(a),S}function Le(t,e,n={},r={}){return ut(t,_e,"\u0412\u044B\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u043D\u0438\u0437\u043A\u0438\u0439 \u0440\u0435\u0439\u0442\u0438\u043D\u0433?",e?"\u0414\u0438\u0437\u043B\u0430\u0439\u043A":null,n,r)}function De(t,e,n={},r={}){return ut(t,ve,"\u0423\u0431\u0440\u0430\u0442\u044C \u043D\u0438\u0437\u043A\u0438\u0439 \u0440\u0435\u0439\u0442\u0438\u043D\u0433?",e?"\u0423\u0431\u0440\u0430\u0442\u044C \u0434\u0438\u0437\u043B\u0430\u0439\u043A":null,n,r)}function pr(t={},e=null,n=null){const r=createElement("button",t,e);return n&&r.addEventListener("click",n),r}function mr(t){let e=0,n=0;t.forEach(o=>{e+=o.rating,n+=1});const r=n>0?e/n:0;return roundToPrecision(r)}function Fe(t){return function(e){const n=gt(e.productId);e.storedRating!==n&&(e.storedRating=n,e.rating=n??e.originalRating,e.ratingWrap&&t(e.ratingWrap,e.rating),xt(n,e.dislikeControls))}}function Oe(t,e,n,r={}){const{needLabel:o,onDislike:i,onRemoveDislike:a,styles:h={}}=r,v=Le(()=>xe(e,i),o,h.link,h.dislikeIcon),S=De(()=>Pe(e,a),o,h.link,h.removeDislikeIcon);t.append(v,S);const R={dislikeButton:v,removeDislikeButton:S};return xt(n,R),R}async function xe(t,e){await Ot(t,1,e)}async function Pe(t,e){await Ot(t,null,e)}async function Ot(t,e,n){Bt(t,e),n&&await n(e)}function xt(t,e){const{dislikeButton:n,removeDislikeButton:r}=e;se(t!==1,n,r)}const Pt="products-snapshot";function at(t){L(Pt,Re(t))}function hr(){at([])}function Ie(){const t=st();return t||(at([]),st())}function st(){const t=U(Pt);return t&&(t.idsSet=new Set(t.ids)),t}function Re(t){return{ids:t,createdAt:Date.now()}}const Ne=window.GM_addValueChangeListener,Ae=Fe(Rt),It={NO_RATING_TEXTS:["\u043D\u043E\u0432\u0435\u043D\u044C\u043A\u0438\u0439","\u043E\u0446\u0435\u043D\u043A\u0443"],NEW_PRODUCT_RATING:5},u={isStylesAdded:!1,context:null,productList:null,productListObserver:null,isFiltersInitialized:!1,filters:{nameFilter:null,minRatingFilter:null,maxPriceFilter:null,notInSnapshotFilter:null,filterEnabled:null},productCardsInfo:null,productCardsCache:new WeakMap,productIds:[],productsSnapshot:null};async function ke(t){u.isStylesAdded||(window.GM_addStyle(b),u.isStylesAdded=!0),t&&Qe();try{u.context=Jt(),Ue(u.context.unwantedSelectors),Be(),await Ve()}catch(e){console.warn(e.message)}}function Ue(t){if(!t?.length)return;const n=`
        ${t.join(`,
`)} {
            display: none !important;
        }
    `;window.GM_addStyle(n)}function Be(){if(!u.isFiltersInitialized){const t=Me(),{createSectionFilter:e}=z($,t);u.filters.nameFilter=e("name-filter"),u.filters.minRatingFilter=e("min-rating-filter",4.6),u.filters.maxPriceFilter=e("max-price-filter",800),u.context.isSnapshotFeatureEnabled&&(u.filters.notInSnapshotFilter=e("not-in-snapshot-filter",!1)),u.filters.filterEnabled=e("filter-enabled",!0),u.isFiltersInitialized=!0}}function Me(){return I(u.context.getSectionName())}async function Ve(){const{selectors:t}=u.context;u.productList=await At(document,t.productList);const e=u.productList.closest(t.productListContainer),n=_(t.productListHeader,e);n&&(Wt(n,We),Ne(q.LAST_RATE_UPDATE,()=>$(!0)),u.context.isSnapshotFeatureEnabled&&(u.productsSnapshot=Ie()),$(!1),u.productListObserver&&ft(u.productListObserver),u.productListObserver=new MutationObserver(()=>$(!1)),u.productListObserver.observe(u.productList,{childList:!0}))}function We(t,e){nt(t,{...F.FILTERS_CONTAINER,...u.context.filtersContainerStyles});const n=Ht(u.filters.nameFilter,F.TEXT_INPUT_CONTROL,F.TEXT_INPUT),r=zt(u.filters.minRatingFilter,F.CONTROL,F.NUMBER_INPUT),o=Qt(u.filters.maxPriceFilter,F.CONTROL,F.NUMBER_INPUT);if(t.append(n,r,o),u.context.isSnapshotFeatureEnabled){const a=Et("\u0412\u043D\u0435 \u0441\u043D\u0438\u043C\u043A\u0430: ",u.filters.notInSnapshotFilter,F.CONTROL,F.CHECKBOX_INPUT);t.append(a)}const i=qt(u.filters.filterEnabled,F.CONTROL,F.CHECKBOX_INPUT);if(t.append(i),u.context.isSnapshotFeatureEnabled){const a=je(F.CONTROL);t.append(a)}u.productCardsInfo=ot(F.FILTERS_INFO),t.append(u.productCardsInfo),e.append(t)}function je(t={}){const e=Ke();return K(e,t)}function Ke(){return ut(()=>{at(u.productIds),u.productsSnapshot=st(),$(!1)},x,"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0441\u043D\u0438\u043C\u043E\u043A \u0442\u043E\u0432\u0430\u0440\u043E\u0432?","\u0421\u043D\u0438\u043C\u043E\u043A",{gap:"5px"},{},"custom-filters-button")}function $(t=!1){const e=w(V.PRODUCT_CARD,u.productList),n=re(),r=[];if(e.forEach(i=>{const a=Ge(i,t);oe(a,n,i);const h=u.productCardsCache.get(i);h?.productId&&r.push(h.productId)}),ie(n),Dt(u.productCardsInfo,n.show.length,e.length),u.productIds=r,t)return;_(V.SHOW_MORE_BUTTON,u.productList)?.click()}function Ge(t,e){if(!u.filters.filterEnabled.value)return!1;let n=u.productCardsCache.get(t);if(n)e&&Ae(n);else{const r=_(V.PRODUCT_CARD_DATA,t);if(!r)return!0;const o=_(V.PRODUCT_NAME,r),i=_(V.PRODUCT_RATING_WRAP,r),a=_(V.PRODUCT_PRICE_CONTAINER,r);if(!o||!i||!a)return!0;const h=_(V.PRODUCT_PRICE_WRAP,a);if(!h)return!0;const v=r.dataset.id,S=o.textContent.trim(),R=i?.textContent.trim(),j=gt(v),N=$e(j,i),H=Q(h),Ye=ze(a,v,j);n={productId:v,nameWrap:o,name:S,ratingWrap:i,originalRating:R,storedRating:j,rating:N,price:H,dislikeControls:Ye},u.productCardsCache.set(t,n)}return Xe(n.nameWrap),u.context.isSnapshotFeatureEnabled&&(n.notInSnapshot=!u.productsSnapshot.idsSet.has(n.productId),t.classList.toggle("not-in-snapshot",n.notInSnapshot),u.filters.notInSnapshotFilter.value&&!n.notInSnapshot)?!0:pe(n.name,u.filters.nameFilter)||Ce(n.rating,u.filters.minRatingFilter)||Ee(n.price,u.filters.maxPriceFilter)}function $e(t,e){return t?(Rt(e,t),t):He(e.textContent)?It.NEW_PRODUCT_RATING:Q(e,!0,!1,0)}function Rt(t,e){t.textContent=e.toString().padEnd(4)}function He(t){return It.NO_RATING_TEXTS.some(e=>t.toLowerCase().includes(e))}function ze(t,e,n){const r=()=>$(!0),o={needLabel:!1,onDislike:r,onRemoveDislike:r,styles:{link:tt.DISLIKE_CONTROL,dislikeIcon:tt.DISLIKE_BUTTON_ICON_MD,removeDislikeIcon:tt.REMOVE_DISLIKE_BUTTON_ICON_MD}};return Oe(t,e,n,o)}function Xe(t){t.style.maxHeight="4lh",t.style.webkitLineClamp=4}function Qe(){u.productList=null,u.isFiltersInitialized=!1,u.filters={nameFilter:null,minRatingFilter:null,maxPriceFilter:null,notInSnapshotFilter:null,filterEnabled:null},u.productCardsCache=new WeakMap,u.productIds=[],u.productsSnapshot=null,ft(u.productListObserver)}}},ct={};function M(C){var g=ct[C];if(g!==void 0)return g.exports;var d=ct[C]={exports:{}};return Nt[C](d,d.exports,M),d.exports}(()=>{var C=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",g=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",d=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",T=b=>{b&&b.d<1&&(b.d=1,b.forEach(m=>m.r--),b.forEach(m=>m.r--?m.r++:m()))},x=b=>b.map(m=>{if(m!==null&&typeof m=="object"){if(m[C])return m;if(m.then){var P=[];P.d=0,m.then(O=>{p[g]=O,T(P)},O=>{p[d]=O,T(P)});var p={};return p[C]=O=>O(P),p}}var L={};return L[C]=O=>{},L[g]=m,L});M.a=(b,m,P)=>{var p;P&&((p=[]).d=-1);var L=new Set,O=b.exports,U,A,z,B=new Promise((D,I)=>{z=I,A=D});B[g]=O,B[C]=D=>(p&&D(p),L.forEach(D),B.catch(I=>{})),b.exports=B,m(D=>{U=x(D);var I,s=()=>U.map(l=>{if(l[d])throw l[d];return l[g]}),c=new Promise(l=>{I=()=>l(s),I.r=0;var f=E=>E!==p&&!L.has(E)&&(L.add(E),E&&!E.d&&(I.r++,E.push(I)));U.map(E=>E[C](f))});return I.r?c:s()},D=>(D?z(B[d]=D):A(O),T(p))),p&&p.d<0&&(p.d=0)}})(),M.d=(C,g)=>{for(var d in g)M.o(g,d)&&!M.o(C,d)&&Object.defineProperty(C,d,{enumerable:!0,get:g[d]})},M.o=(C,g)=>Object.prototype.hasOwnProperty.call(C,g);var qe=M(7061)})();})();
